<!DOCTYPE html>
<!-- saved from url=(0045)https://dragonlance.jp/fvtt-5e-pc-viewer.html -->
<html lang="ja"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<meta name="viewport" content="width=device-width,initial-scale=1">
<title>FVTT D&amp;D5e Character Sheet Viewer</title>
<style>
:root{--bg:#1a1714;--sf:#242018;--sf2:#2e2820;--bd:#3e362a;--bda:#8b7340;--tx:#e8e2d6;--tm:#9e9486;--td:#6e6458;--ac:#c9a84c;--acd:#7a6630;--red:#c44040;--grn:#48a848;--blu:#5588cc}
*,*::before,*::after{box-sizing:border-box}
html,body{margin:0;height:100%}
body{background:var(--bg);color:var(--tx);font:14px/1.5 'Segoe UI',system-ui,-apple-system,'Hiragino Kaku Gothic ProN',Meiryo,sans-serif}

/* Toolbar */
.toolbar{background:var(--sf);border-bottom:1px solid var(--bd);padding:10px 16px;display:flex;flex-wrap:wrap;gap:8px;align-items:center;position:sticky;top:0;z-index:100;backdrop-filter:blur(6px)}
.toolbar-title{font-size:15px;font-weight:700;color:var(--ac);margin-right:auto}
.btn,input[type=file]{background:var(--sf2);border:1px solid var(--bd);color:var(--tx);padding:6px 12px;border-radius:6px;font-size:13px}
.btn{cursor:pointer;transition:border-color .15s}
.btn:hover{border-color:var(--ac)}
.btn-export{background:#2a3020;border-color:#4a6030;color:#a0d070}
.btn-export:hover{border-color:#80c040}
select.btn{appearance:auto}

.dropzone{border:2px dashed var(--bd);border-radius:12px;padding:24px;text-align:center;color:var(--tm);margin:16px;transition:.2s}
.dropzone.drag{border-color:var(--ac);color:var(--tx);background:rgba(201,168,76,.05)}

/* Sheet */
.sheet{max-width:1120px;margin:0 auto;padding:12px 16px 48px;display:none}
.sheet.active{display:block}

/* Header */
.char-header{text-align:center;padding:20px 0 14px;border-bottom:2px solid var(--bda);margin-bottom:16px}
.char-name{font-size:30px;font-weight:700;letter-spacing:.04em}
.char-sub{font-size:14px;color:var(--tm);margin-top:4px}

/* 3-column body */
.sheet-body{display:grid;grid-template-columns:86px minmax(220px,1fr) minmax(300px,1.4fr);gap:12px;margin-bottom:16px}

/* Ability boxes */
.ab-col{display:flex;flex-direction:column;gap:16px}
.ab-box{position:relative;border:2px solid var(--bda);border-radius:8px;padding:8px 4px 22px;text-align:center;background:var(--sf)}
.ab-lbl{font-size:10px;font-weight:700;text-transform:uppercase;letter-spacing:1.5px;color:var(--ac)}
.ab-score{font-size:26px;font-weight:700;line-height:1.2}
.ab-mod{position:absolute;bottom:-14px;left:50%;transform:translateX(-50%);width:36px;height:28px;display:flex;align-items:center;justify-content:center;border:2px solid var(--bda);border-radius:14px;background:var(--sf);font-size:14px;font-weight:700}

/* Panels */
.panel{background:var(--sf);border:1px solid var(--bd);border-radius:8px;padding:10px 12px}
.panel+.panel{margin-top:10px}
.p-title{font-size:10px;font-weight:700;text-transform:uppercase;letter-spacing:1.5px;color:var(--ac);text-align:center;padding-bottom:5px;border-bottom:1px solid var(--bd);margin-bottom:6px}

/* Prof & Inspiration */
.prof-row{display:flex;gap:8px;margin-bottom:10px}
.prof-box{flex:1;display:flex;align-items:center;gap:8px;background:var(--sf);border:1px solid var(--bd);border-radius:8px;padding:8px 10px}
.prof-box .big{font-size:22px;font-weight:700;color:var(--ac);min-width:34px;text-align:center}
.prof-box .lbl{font-size:10px;text-transform:uppercase;letter-spacing:.8px;color:var(--tm);line-height:1.3}

/* Dot */
.dot{display:inline-block;width:10px;height:10px;border:1.5px solid var(--ac);border-radius:50%;flex-shrink:0;margin-right:5px;vertical-align:middle}
.dot.full{background:var(--ac)}
.dot.half{background:linear-gradient(90deg,var(--ac) 50%,transparent 50%)}
.dot.expert{background:var(--ac);box-shadow:0 0 0 2px var(--sf),0 0 0 3.5px var(--ac)}

/* Save / Skill rows */
.s-row{display:flex;align-items:center;padding:2.5px 0;font-size:13px}
.s-row .bonus{min-width:30px;text-align:right;font-weight:600;margin-right:6px}
.s-row .name{flex:1}
.s-row .abil{font-size:10px;color:var(--td);text-transform:uppercase;margin-left:3px}

/* Passive */
.passive{display:flex;align-items:center;background:var(--sf);border:1px solid var(--bd);border-radius:8px;padding:6px 10px;margin-top:10px}
.passive .big{font-size:20px;font-weight:700;min-width:32px;text-align:center;margin-right:8px}
.passive .lbl{font-size:10px;text-transform:uppercase;letter-spacing:.8px;color:var(--tm)}

/* Combat trio */
.combat-trio{display:flex;gap:8px;margin-bottom:10px}
.c-box{flex:1;text-align:center;border:2px solid var(--bda);border-radius:8px;padding:6px 4px;background:var(--sf)}
.c-box .lbl{font-size:9px;font-weight:700;text-transform:uppercase;letter-spacing:1px;color:var(--ac)}
.c-box .val{font-size:26px;font-weight:700}
.c-box .unit{font-size:11px;color:var(--tm)}

/* HP */
.hp-panel{border:2px solid var(--bda);border-radius:8px;padding:10px;background:var(--sf);margin-bottom:10px}
.hp-row{display:flex;justify-content:center;align-items:center;gap:6px}
.hp-cur{font-size:28px;font-weight:700;width:60px;text-align:center;background:transparent;border:1px solid var(--bd);border-radius:6px;color:var(--tx);font-family:inherit}
.hp-cur:focus{border-color:var(--ac);outline:none}
.hp-sep{color:var(--td);font-size:20px;font-weight:700}
.hp-max{font-size:28px;font-weight:700}
.hp-bar{height:6px;background:var(--sf2);border-radius:3px;overflow:hidden;margin:6px 0}
.hp-bar-fill{height:100%;border-radius:3px;transition:width .3s,background .3s}
.hp-adj{display:flex;justify-content:center;gap:6px;margin-top:6px}
.hp-adj-input{width:50px;text-align:center;background:var(--sf2);border:1px solid var(--bd);border-radius:4px;color:var(--tx);font-size:13px;padding:3px}
.hp-adj-input:focus{border-color:var(--ac);outline:none}
.hp-btn{padding:3px 10px;border-radius:4px;cursor:pointer;font-size:12px;font-weight:700;border:1px solid}
.hp-btn-dmg{background:#3a2020;border-color:#804040;color:#e08080}
.hp-btn-dmg:hover{background:#4a2020;border-color:#c04040}
.hp-btn-heal{background:#203a20;border-color:#408040;color:#80e080}
.hp-btn-heal:hover{background:#204a20;border-color:#40c040}
.hp-temp-row{display:flex;justify-content:center;align-items:center;gap:4px;margin-top:4px;font-size:12px;color:var(--blu)}
.hp-temp-input{width:40px;text-align:center;background:transparent;border:1px solid var(--bd);border-radius:4px;color:var(--blu);font-size:12px;padding:2px;font-family:inherit}
.hp-temp-input:focus{border-color:var(--ac);outline:none}

/* HD & Death */
.hd-death{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-bottom:10px}
.mini-p{background:var(--sf);border:1px solid var(--bd);border-radius:8px;padding:8px;text-align:center}
.mini-p .lbl{font-size:10px;text-transform:uppercase;letter-spacing:1px;color:var(--ac);margin-bottom:3px}
.dd{display:flex;justify-content:center;gap:5px;margin:2px 0}
.dd .d{width:14px;height:14px;border:1.5px solid var(--td);border-radius:50%;cursor:pointer;transition:all .15s}
.dd .d:hover{border-color:var(--ac);transform:scale(1.2)}
.dd .d.ok{background:var(--grn);border-color:var(--grn)}
.dd .d.ng{background:var(--red);border-color:var(--red)}

/* Tables */
.t{width:100%;border-collapse:collapse;font-size:13px}
.t th{font-size:10px;text-transform:uppercase;letter-spacing:1px;color:var(--tm);font-weight:600;text-align:left;padding:4px 6px;border-bottom:1px solid var(--bd)}
.t td{padding:4px 6px;border-bottom:1px solid rgba(62,54,42,.4);vertical-align:top}

/* Hide native number spinner */
input[type=number]::-webkit-inner-spin-button,input[type=number]::-webkit-outer-spin-button{-webkit-appearance:none;margin:0}
input[type=number]{-moz-appearance:textfield}

/* Inline edit inputs */
.e-num{width:42px;text-align:center;background:transparent;border:1px solid var(--bd);border-radius:4px;color:var(--tx);font-size:13px;padding:2px 4px;font-family:inherit}
.e-num:focus{border-color:var(--ac);outline:none}
.e-coin{width:48px;text-align:center;background:transparent;border:1px solid var(--bd);border-radius:4px;font-size:13px;padding:2px 4px;font-family:inherit}
.e-coin:focus{border-color:var(--ac);outline:none}
.coin-pp .e-coin{color:#b0b8cc}
.coin-gp .e-coin{color:#d4a848}
.coin-ep .e-coin{color:#8898a8}
.coin-sp .e-coin{color:#a8b0b8}
.coin-cp .e-coin{color:#b88860}

/* Number control +/- buttons */
.nc{display:inline-flex;align-items:center;gap:2px;vertical-align:middle}
.nc-btn{width:26px;height:26px;display:inline-flex;align-items:center;justify-content:center;border:1px solid var(--bd);border-radius:5px;background:var(--sf2);color:var(--tm);font-size:16px;font-weight:700;cursor:pointer;user-select:none;line-height:1;padding:0;transition:all .12s}
.nc-btn:hover{border-color:var(--ac);color:var(--tx);background:var(--sf)}
.nc-btn:active{transform:scale(.9);background:var(--bda);color:var(--bg)}
.nc .e-num,.nc .e-coin{border-radius:0;border-left:none;border-right:none}
.nc .nc-btn:first-child{border-radius:5px 0 0 5px}
.nc .nc-btn:last-child{border-radius:0 5px 5px 0}

/* Clickable toggles */
.clickable{cursor:pointer;user-select:none;transition:transform .1s}
.clickable:hover{transform:scale(1.15)}
.clickable:active{transform:scale(.95)}

/* Full-width sections */
.sec{background:var(--sf);border:1px solid var(--bd);border-radius:8px;padding:12px 14px;margin-bottom:12px}
.sec-title{font-size:11px;font-weight:700;text-transform:uppercase;letter-spacing:1.5px;color:var(--ac);border-bottom:1px solid var(--bd);padding-bottom:5px;margin-bottom:8px}

/* Personality grid */
.pers-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:12px}
.pers-box{background:var(--sf);border:1px solid var(--bd);border-radius:8px;padding:10px 12px}
.pers-box .lbl{font-size:10px;font-weight:700;text-transform:uppercase;letter-spacing:1px;color:var(--ac);margin-bottom:3px}
.pers-box .ct{font-size:13px;color:var(--tm);line-height:1.5}

/* Prof & Languages */
.pl-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:10px}
.pl-grp .lbl{font-size:10px;font-weight:700;text-transform:uppercase;color:var(--ac);margin-bottom:3px}
.pl-grp .items{font-size:12px;color:var(--tm)}
.pill{display:inline-block;border:1px solid var(--bd);border-radius:999px;padding:1px 8px;margin:2px 3px 2px 0;font-size:12px}

/* Spells */
.sp-meta{display:flex;flex-wrap:wrap;gap:12px;margin-bottom:8px;font-size:13px}
.sp-meta b{color:var(--tm);font-weight:600}
.sp-slots{display:flex;flex-wrap:wrap;gap:10px;margin-bottom:10px;font-size:12px}
.sl-grp{display:flex;align-items:center;gap:3px}
.sl-grp .lv{font-size:11px;color:var(--tm);min-width:26px}
.sl-d{width:14px;height:14px;border:1.5px solid var(--acd);border-radius:50%;cursor:pointer;transition:all .15s}
.sl-d:hover{border-color:var(--ac);transform:scale(1.2)}
.sl-d.on{background:var(--ac);border-color:var(--ac)}
.sp-lv{border:1px solid var(--bd);border-radius:8px;margin-bottom:6px}
.sp-lv summary{cursor:pointer;padding:6px 10px;font-size:13px;font-weight:600;user-select:none}
.sp-lv summary:hover{color:var(--ac)}
.sp-lv-body{padding:0 10px 8px}
.sp-entry{display:flex;align-items:flex-start;gap:6px;padding:3px 0;font-size:13px;border-bottom:1px solid rgba(62,54,42,.3)}
.sp-entry:last-child{border-bottom:none}
.sp-entry .prep{color:var(--grn);font-size:14px;flex-shrink:0;width:18px;text-align:center;cursor:pointer;user-select:none;transition:transform .1s}
.sp-entry .prep:hover{transform:scale(1.3)}
.sp-entry .prep.off{color:var(--td)}
.sp-entry .sn{font-weight:600;min-width:110px}
.sp-entry .sd{font-size:12px;color:var(--tm);flex:1}

/* Features */
.feat-item{border-bottom:1px solid rgba(62,54,42,.4);padding:5px 0}
.feat-item:last-child{border-bottom:none}
.feat-item .fn{font-weight:600;font-size:13px}
.feat-item .fs{font-size:11px;color:var(--td);margin-left:6px}
.feat-item .fd{font-size:12px;color:var(--tm);margin-top:2px;line-height:1.5}
.feat-uses{display:inline-flex;align-items:center;gap:3px;margin-left:8px;font-size:12px;color:var(--blu)}

/* Currency */
.coins{display:flex;gap:14px;justify-content:center;padding:6px 0;font-size:13px}
.coin{display:flex;align-items:center;gap:3px}
.coin .cl{font-size:11px;font-weight:700;text-transform:uppercase}
.coin-pp .cl{color:#b0b8cc}
.coin-gp .cl{color:#d4a848}
.coin-ep .cl{color:#8898a8}
.coin-sp .cl{color:#a8b0b8}
.coin-cp .cl{color:#b88860}

/* Equipped toggle */
.eq-toggle{cursor:pointer;user-select:none;font-size:14px}
.eq-toggle:hover{filter:brightness(1.3)}

/* Bio */
.bio-ct{font-size:13px;line-height:1.7;color:var(--tm)}
.bio-ct h1,.bio-ct h2,.bio-ct h3{color:var(--tx);margin:10px 0 4px}

/* Responsive */
@media(max-width:900px){
  .sheet-body{grid-template-columns:1fr}
  .ab-col{flex-direction:row;flex-wrap:wrap;justify-content:center;gap:10px}
  .pers-grid{grid-template-columns:1fr}
  .pl-grid{grid-template-columns:1fr}
}
@media(max-width:600px){
  body{font-size:13px}
  .toolbar{padding:8px 10px;gap:6px}
  .toolbar-title{font-size:13px;width:100%}
  input[type=file]{font-size:11px;max-width:160px;overflow:hidden}
  .btn{padding:5px 8px;font-size:12px}
  .dropzone{margin:8px;padding:16px;font-size:13px}
  .sheet{padding:8px 8px 40px}
  .char-name{font-size:22px}
  .char-sub{font-size:12px}
  .combat-trio{flex-wrap:wrap}
  .c-box{min-width:0}
  .c-box .val{font-size:22px}
  .hp-cur{font-size:22px;width:50px}
  .hp-max{font-size:22px}
  .hp-adj{flex-wrap:wrap;gap:4px}
  .hp-btn{padding:6px 12px;font-size:13px}
  .hd-death{grid-template-columns:1fr}
  .coins{flex-wrap:wrap;gap:8px}
  .coin{gap:2px}
  .nc-btn{width:30px;height:30px;font-size:18px}
  .nc{gap:1px}
  .e-num{width:38px;font-size:12px}
  .e-coin{width:42px;font-size:12px}
  .sp-entry{flex-wrap:wrap}
  .sp-entry .sn{min-width:0}
  .sp-entry .sd{width:100%;padding-left:24px}
  .sp-slots{gap:8px}
  .sec{padding:10px 8px}
  .panel{padding:8px}
  /* Tables scroll horizontally if needed */
  .panel,.sec{overflow-x:auto;-webkit-overflow-scrolling:touch}
  .t{min-width:280px}
  .t th,.t td{padding:4px 4px;font-size:12px}
  .prof-row{flex-wrap:wrap}
  .prof-box{padding:6px 8px}
  .feat-item .fn{font-size:12px}
  .feat-item .fd{font-size:11px}
  .pl-grp{margin-bottom:6px}
}
.text-m{color:var(--tm)}
.text-d{color:var(--td)}
.text-s{font-size:12px}
/* Prevent horizontal overflow */
html{overflow-x:hidden}
.sheet,.sec,.panel{max-width:100%}

/* Item tooltip */
.tip{position:relative;cursor:help;border-bottom:1px dotted var(--td)}
.tip .tip-body{display:none;position:absolute;left:0;top:calc(100% + 6px);width:min(360px,85vw);background:var(--sf);border:1px solid var(--bda);border-radius:8px;padding:10px 12px;font-size:12px;line-height:1.6;color:var(--tm);text-align:left;white-space:normal;z-index:200;box-shadow:0 4px 16px rgba(0,0,0,.5);font-weight:400;pointer-events:none}
.tip:hover .tip-body,.tip:focus .tip-body{display:block}

/* Footer */
.site-footer{text-align:center;padding:16px;font-size:11px;color:var(--td);border-top:1px solid var(--bd);margin-top:24px}
.mit-tip{position:relative;display:inline;cursor:help;color:var(--tm);text-decoration:underline dotted var(--td);text-underline-offset:2px}
.mit-tip .mit-body{display:none;position:absolute;bottom:calc(100% + 8px);left:50%;transform:translateX(-50%);width:min(480px,90vw);background:var(--sf);border:1px solid var(--bd);border-radius:8px;padding:12px 14px;font-size:11px;line-height:1.6;color:var(--tm);text-align:left;white-space:pre-wrap;z-index:200;box-shadow:0 4px 20px rgba(0,0,0,.5)}
.mit-tip:hover .mit-body,.mit-tip:focus .mit-body{display:block}
</style>
</head>
<body>
<div class="toolbar">
  <span class="toolbar-title">D&amp;D 5e Character Sheet</span>
  <input id="file" type="file" accept=".json,application/json">
  <button class="btn" id="demoBtn">Demo Sample</button>
  <button class="btn btn-export" id="exportBtn" style="display: inline-block;">Export JSON</button>
  <select id="actorSel" class="btn" style="display:none"></select>
</div>
<div id="dropzone" class="dropzone" style="display: none;">
  JSONファイルをドラッグ＆ドロップ / ファイル選択で読み込み<br>
  <span class="text-s text-m">Foundry VTT D&amp;D5e Actor JSON対応 — すべてローカル処理</span>
</div>
<div id="sheet" class="sheet active"><div class="char-header"><div class="char-name">ミンター</div><div class="char-sub">ファイター (サムライ) Lv5 · ヒューマン · 異邦人 · — · 9100 XP</div></div><div class="sheet-body"><div class="ab-col"><div class="ab-box"><div class="ab-lbl">STR</div><div class="ab-score">10</div><div class="ab-mod">+0</div></div><div class="ab-box"><div class="ab-lbl">DEX</div><div class="ab-score">17</div><div class="ab-mod">+3</div></div><div class="ab-box"><div class="ab-lbl">CON</div><div class="ab-score">14</div><div class="ab-mod">+2</div></div><div class="ab-box"><div class="ab-lbl">INT</div><div class="ab-score">11</div><div class="ab-mod">+0</div></div><div class="ab-box"><div class="ab-lbl">WIS</div><div class="ab-score">14</div><div class="ab-mod">+2</div></div><div class="ab-box"><div class="ab-lbl">CHA</div><div class="ab-score">8</div><div class="ab-mod">-1</div></div></div><div><div class="prof-row"><div class="prof-box"><div class="big clickable" data-action="toggle-inspiration">★</div><div class="lbl">Inspiration</div></div><div class="prof-box"><div class="big">+3</div><div class="lbl">習熟ボーナス</div></div></div><div class="panel"><div class="p-title">セーヴィング・スロー</div><div class="s-row"><div class="dot full"></div><div class="bonus">+3</div><div class="name">筋力</div></div><div class="s-row"><div class="dot "></div><div class="bonus">+3</div><div class="name">敏捷</div></div><div class="s-row"><div class="dot full"></div><div class="bonus">+5</div><div class="name">耐久</div></div><div class="s-row"><div class="dot "></div><div class="bonus">+0</div><div class="name">知力</div></div><div class="s-row"><div class="dot "></div><div class="bonus">+2</div><div class="name">判断</div></div><div class="s-row"><div class="dot "></div><div class="bonus">-1</div><div class="name">魅力</div></div></div><div class="panel"><div class="p-title">技能</div><div class="s-row"><div class="dot "></div><div class="bonus">+3</div><div class="name">軽業<span class="abil">dex</span></div></div><div class="s-row"><div class="dot "></div><div class="bonus">+2</div><div class="name">動物使い<span class="abil">wis</span></div></div><div class="s-row"><div class="dot "></div><div class="bonus">+0</div><div class="name">魔法学<span class="abil">int</span></div></div><div class="s-row"><div class="dot full"></div><div class="bonus">+3</div><div class="name">運動<span class="abil">str</span></div></div><div class="s-row"><div class="dot "></div><div class="bonus">-1</div><div class="name">ペテン<span class="abil">cha</span></div></div><div class="s-row"><div class="dot full"></div><div class="bonus">+3</div><div class="name">歴史<span class="abil">int</span></div></div><div class="s-row"><div class="dot full"></div><div class="bonus">+5</div><div class="name">看破<span class="abil">wis</span></div></div><div class="s-row"><div class="dot "></div><div class="bonus">-1</div><div class="name">威圧<span class="abil">cha</span></div></div><div class="s-row"><div class="dot "></div><div class="bonus">+0</div><div class="name">捜査<span class="abil">int</span></div></div><div class="s-row"><div class="dot "></div><div class="bonus">+2</div><div class="name">医術<span class="abil">wis</span></div></div><div class="s-row"><div class="dot "></div><div class="bonus">+0</div><div class="name">自然<span class="abil">int</span></div></div><div class="s-row"><div class="dot full"></div><div class="bonus">+5</div><div class="name">知覚<span class="abil">wis</span></div></div><div class="s-row"><div class="dot "></div><div class="bonus">-1</div><div class="name">芸能<span class="abil">cha</span></div></div><div class="s-row"><div class="dot "></div><div class="bonus">-1</div><div class="name">説得<span class="abil">cha</span></div></div><div class="s-row"><div class="dot "></div><div class="bonus">+0</div><div class="name">宗教<span class="abil">int</span></div></div><div class="s-row"><div class="dot "></div><div class="bonus">+3</div><div class="name">手先の早業<span class="abil">dex</span></div></div><div class="s-row"><div class="dot "></div><div class="bonus">+3</div><div class="name">隠密<span class="abil">dex</span></div></div><div class="s-row"><div class="dot "></div><div class="bonus">+2</div><div class="name">生存<span class="abil">wis</span></div></div></div><div class="passive"><div class="big">15</div><div class="lbl">受動知覚 (Passive Perception)</div></div></div><div><div class="combat-trio"><div class="c-box"><div class="lbl">AC</div><div class="val">16</div></div><div class="c-box"><div class="lbl">イニシアチブ</div><div class="val">+3</div></div><div class="c-box"><div class="lbl">移動速度</div><div class="val">30</div><div class="unit">ft</div></div></div><div class="hp-panel"><div class="p-title">ヒットポイント</div><div class="hp-row"><span class="nc"><button type="button" class="nc-btn" data-nc="-1">−</button><input type="number" class="hp-cur" data-action="set-hp" value="44" min="0" max="44"><button type="button" class="nc-btn" data-nc="1">+</button></span><span class="hp-sep">/</span><span class="hp-max">44</span></div><div class="hp-bar"><div class="hp-bar-fill" style="width:100%;background:var(--grn)"></div></div><div class="hp-adj"><button class="hp-btn hp-btn-dmg" data-action="hp-dmg">Damage</button><span class="nc"><button type="button" class="nc-btn" data-nc="-1">−</button><input type="number" class="hp-adj-input" id="hpDelta" value="0" min="0"><button type="button" class="nc-btn" data-nc="1">+</button></span><button class="hp-btn hp-btn-heal" data-action="hp-heal">Heal</button></div><div class="hp-temp-row">一時HP: <span class="nc"><button type="button" class="nc-btn" data-nc="-1">−</button><input type="number" class="hp-temp-input" data-action="set-temp-hp" value="0" min="0"><button type="button" class="nc-btn" data-nc="1">+</button></span></div></div><div class="hd-death"><div class="mini-p"><div class="lbl">ヒットダイス</div><div style="margin:3px 0"><span class="text-s">d10</span> <span style="font-weight:700">5</span>/5 <button class="hp-btn hp-btn-dmg" style="font-size:10px;padding:1px 6px" data-action="hd-use" data-class-idx="0">使用</button> <button class="hp-btn hp-btn-heal" style="font-size:10px;padding:1px 6px" data-action="hd-recover" data-class-idx="0">回復</button></div></div><div class="mini-p"><div class="lbl">デス・セーヴ</div><div class="text-s">成功</div><div class="dd"><div class="d " data-action="death-success" data-idx="0"></div><div class="d " data-action="death-success" data-idx="1"></div><div class="d " data-action="death-success" data-idx="2"></div></div><div class="text-s">失敗</div><div class="dd"><div class="d " data-action="death-failure" data-idx="0"></div><div class="d " data-action="death-failure" data-idx="1"></div><div class="d " data-action="death-failure" data-idx="2"></div></div></div></div><div class="panel"><div class="p-title">攻撃</div><table class="t"><thead><tr><th>名称</th><th>攻撃</th><th>ダメージ</th></tr></thead><tbody><tr><td><span class="tip" tabindex="0">シミター<span class="tip-body">この武器の湾曲した刃は、手元近くでは広く、鋭い先端に向かって弧を描くように細く鍛えられている。</span></span></td><td>+6</td><td>—</td></tr><tr><td><span class="tip" tabindex="0">ロングボウ<span class="tip-body">長く太い薄削りの木が張り詰めた弦によって湾曲しており、遠くまで威力の高い矢を発射することができる。</span></span></td><td>+6</td><td>—</td></tr><tr><td><span class="tip" tabindex="0">ダガー +1<span class="tip-body">君はこの魔法の武器を用いた攻撃ロールとダメージ・ロールに+1ボーナスを得る。</span></span></td><td>+7</td><td>— +1</td></tr><tr><td><span class="tip" tabindex="0">ショートソード<span class="tip-body">1d6&nbsp;[刺突]&nbsp; - 妙技, 軽武器




革で包まれたしっかりした握りを持つ中型の剣。扱いやすく汎用性に優れた武器。</span></span></td><td>+6</td><td>—</td></tr></tbody></table></div><div class="panel"><div class="p-title">装備・所持品</div><table class="t"><thead><tr><th>名称</th><th>種別</th><th>数</th></tr></thead><tbody><tr><td><span class="tip" tabindex="0">探検家パック<span class="tip-body">背負い袋には、1立方フィートまたは30ポンドの道具を入れることができます。また、バックパックの外側に、ベッドロールやロープのコイルなどのアイテムをストラップで取り付けることもできます。</span></span></td><td class="text-s text-m">container</td><td><span class="nc"><button type="button" class="nc-btn" data-nc="-1">−</button><input type="number" class="e-num" data-action="set-quantity" data-item-idx="7" value="1" min="0"><button type="button" class="nc-btn" data-nc="1">+</button></span></td></tr><tr><td><span class="tip" tabindex="0">ほくち箱<span class="tip-body">この小箱の中には、火打ち石と打ち金、ほくちが入っている。君は1回のアクションとして、松明や、その他の引火性の強い可燃物に火を付けることができる。それ以外のものに火を付けるには1分かかる。</span></span></td><td class="text-s text-m">loot</td><td><span class="nc"><button type="button" class="nc-btn" data-nc="-1">−</button><input type="number" class="e-num" data-action="set-quantity" data-item-idx="8" value="1" min="0"><button type="button" class="nc-btn" data-nc="1">+</button></span></td></tr><tr><td><span class="tip" tabindex="0">トーチ<span class="tip-body">たいまつは、半径20フィートまでを明るく照らし、その先20フィートまでを薄暗い明かりで照らす。たいまつは1時間、燃え続ける。君は火の付いた たいまつで近接攻撃を行なうこともでき、命中したなら1[火]ダメージを与える。</span></span></td><td class="text-s text-m">consumable</td><td><span class="nc"><button type="button" class="nc-btn" data-nc="-1">−</button><input type="number" class="e-num" data-action="set-quantity" data-item-idx="9" value="10" min="0"><button type="button" class="nc-btn" data-nc="1">+</button></span></td></tr><tr><td><span class="tip" tabindex="0">携帯用寝具<span class="tip-body">旅人が寝るときに使う、丸められた布。</span></span></td><td class="text-s text-m">loot</td><td><span class="nc"><button type="button" class="nc-btn" data-nc="-1">−</button><input type="number" class="e-num" data-action="set-quantity" data-item-idx="10" value="1" min="0"><button type="button" class="nc-btn" data-nc="1">+</button></span></td></tr><tr><td><span class="tip" tabindex="0">保存食<span class="tip-body">保存食は、主に水気の無い乾物を揃えたもので、長旅に向いた携行食だ。これには堅パンや干し肉、干し果物、ナッツなどが含まれる。</span></span></td><td class="text-s text-m">consumable</td><td><span class="nc"><button type="button" class="nc-btn" data-nc="-1">−</button><input type="number" class="e-num" data-action="set-quantity" data-item-idx="11" value="8" min="0"><button type="button" class="nc-btn" data-nc="1">+</button></span></td></tr><tr><td><span class="tip" tabindex="0">ヘンプロープ（50フィート）<span class="tip-body">ロープはHP2。引きちぎる場合、難易度17【筋力】判定を要する。</span></span></td><td class="text-s text-m">consumable</td><td><span class="nc"><button type="button" class="nc-btn" data-nc="-1">−</button><input type="number" class="e-num" data-action="set-quantity" data-item-idx="12" value="1" min="0"><button type="button" class="nc-btn" data-nc="1">+</button></span></td></tr><tr><td><span class="tip" tabindex="0">水袋<span class="tip-body">4パイント液体を入れることができる。</span></span></td><td class="text-s text-m">consumable</td><td><span class="nc"><button type="button" class="nc-btn" data-nc="-1">−</button><input type="number" class="e-num" data-action="set-quantity" data-item-idx="13" value="1" min="0"><button type="button" class="nc-btn" data-nc="1">+</button></span></td></tr><tr><td><span class="tip" tabindex="0">携帯用炊事用具<span class="tip-body">錫でできた入れ物の中には、1つのコップ、ナイフ、フォーク、スプーンなどが入っている。さらに入れ物自体が2つに分かれ、一方は平鍋、もう一方は皿として使用できる。</span></span></td><td class="text-s text-m">loot</td><td><span class="nc"><button type="button" class="nc-btn" data-nc="-1">−</button><input type="number" class="e-num" data-action="set-quantity" data-item-idx="14" value="1" min="0"><button type="button" class="nc-btn" data-nc="1">+</button></span></td></tr><tr><td><span class=" eq-toggle" style="color:var(--td)" data-action="toggle-equip" data-item-idx="15">◇</span> <span class="tip" tabindex="0">旅人の服<span class="tip-body">旅人が着用する服のセット。</span></span></td><td class="text-s text-m">equipment</td><td><span class="nc"><button type="button" class="nc-btn" data-nc="-1">−</button><input type="number" class="e-num" data-action="set-quantity" data-item-idx="15" value="1" min="0"><button type="button" class="nc-btn" data-nc="1">+</button></span></td></tr><tr><td><span class="tip" tabindex="0">ポーチ<span class="tip-body">布、または革製の小物入れ。スリング･ブリットなら20個、ブロウガン用ニードルなら50本などを入れておくことができる。0.2立方フィート / 6ポンドの物を入れることができる。</span></span></td><td class="text-s text-m">container</td><td><span class="nc"><button type="button" class="nc-btn" data-nc="-1">−</button><input type="number" class="e-num" data-action="set-quantity" data-item-idx="18" value="1" min="0"><button type="button" class="nc-btn" data-nc="1">+</button></span></td></tr><tr><td><span class="tip" tabindex="0">小さな装飾品<span class="tip-body">@Compendium[completecompendium.background.ac4zWXPCkAX0Z1Ld]{異邦人}である君の故郷の工芸様式で作られた小さな装飾品(10gp相等)</span></span></td><td class="text-s text-m">loot</td><td><span class="nc"><button type="button" class="nc-btn" data-nc="-1">−</button><input type="number" class="e-num" data-action="set-quantity" data-item-idx="19" value="1" min="0"><button type="button" class="nc-btn" data-nc="1">+</button></span></td></tr><tr><td><span class="tip" tabindex="0">故郷から持ってきた不正確な地図<span class="tip-body">@Compendium[completecompendium.background.ac4zWXPCkAX0Z1Ld]{異邦人}である君が故郷から持ってきた地図。これを参照すれば君がいまフェイルーンのどこにいるかがわかる</span></span></td><td class="text-s text-m">loot</td><td><span class="nc"><button type="button" class="nc-btn" data-nc="-1">−</button><input type="number" class="e-num" data-action="set-quantity" data-item-idx="20" value="1" min="0"><button type="button" class="nc-btn" data-nc="1">+</button></span></td></tr><tr><td><span class="tip" tabindex="0">アロー<span class="tip-body">あらゆる種類の弓に使用される標準的な矢弾。滑らかな木製の軸にガチョウの羽の矢羽根と鍛造した金属製の矢尻が付いた平凡な矢である。</span></span></td><td class="text-s text-m">consumable</td><td><span class="nc"><button type="button" class="nc-btn" data-nc="-1">−</button><input type="number" class="e-num" data-action="set-quantity" data-item-idx="22" value="12" min="0"><button type="button" class="nc-btn" data-nc="1">+</button></span></td></tr><tr><td><span class=" eq-toggle" style="color:var(--grn)" data-action="toggle-equip" data-item-idx="24">◆</span> <span class="tip" tabindex="0">スケイル・メイル<span class="tip-body">この鎧は、まるで魚の鱗のように金属の小片を重ね合わせて作られている。この防具一式には、革のコートとレギンス (場合によって別途スカートも付属)、籠手も含まれる。</span></span></td><td class="text-s text-m">equipment</td><td><span class="nc"><button type="button" class="nc-btn" data-nc="-1">−</button><input type="number" class="e-num" data-action="set-quantity" data-item-idx="24" value="1" min="0"><button type="button" class="nc-btn" data-nc="1">+</button></span></td></tr><tr><td><span class="tip" tabindex="0">油 (ビン)<span class="tip-body">1パイント(約500cc)の油が入った陶器製のビン。
君は1回のアクションとして、5ﾌｨｰﾄ以内のクリーチャーに中の油を浴びせるか、20ﾌｨｰﾄまで投擲することができる(衝撃で割れる)。
どちらの場合も、油ビンを代用武器として扱い、1回の遠隔攻撃として判定する。命中したら対象は油で覆われる。
油は1分後に乾くが、それまでに[火]ダメージを与えたなら、追加で5[火]ダメージを与えることができる。
あるいは、君は1回のアクションとして平らな地面に油をまき、5×5ﾌｨｰﾄの範囲を油で覆うことができる。これに火が付いたなら2ラウンド燃え続け、その範囲に入ったクリーチャーに5[火]ダメージを与えることができる。1体のクリーチャーが、1ターンに2回以上、このダメージを受けることは無い。</span></span></td><td class="text-s text-m">loot</td><td><span class="nc"><button type="button" class="nc-btn" data-nc="-1">−</button><input type="number" class="e-num" data-action="set-quantity" data-item-idx="25" value="1" min="0"><button type="button" class="nc-btn" data-nc="1">+</button></span></td></tr><tr><td><span class="tip" tabindex="0">ブラッド・アーマー・オーブ<span class="tip-body">3レベル &amp;Reference[Spell Scroll]近接武器攻撃で敵を攻撃した際、この呪文をボーナスアクションとして即座に発動できます（この呪文は他の方法では発動できません）。攻撃した敵は出血状態である必要があります。ターゲットが出血(ヒットポイントが半分以下)になってない場合、呪文は効果を発揮せずに終了します。敵から流れた血は魔法によって量が増し、あなたの周りに鎧を形成し、呪文の持続時間中、あなたのアーマークラスを 18 + 【敏捷力】修正値に上昇させます。この鎧は筋力要件がなく、呪文の詠唱を妨げず、【敏捷力】〈隠密〉判定に不利も受けません。あなたが攻撃したクリーチャーがセレスチャルだった場合、血の鎧は、呪文の持続時間中、あなたの【魅力】セーヴィング・スローに有利を与えます。</span></span></td><td class="text-s text-m">consumable</td><td><span class="nc"><button type="button" class="nc-btn" data-nc="-1">−</button><input type="number" class="e-num" data-action="set-quantity" data-item-idx="26" value="1" min="0"><button type="button" class="nc-btn" data-nc="1">+</button></span></td></tr><tr><td><span class=" eq-toggle" style="color:var(--grn)" data-action="toggle-equip" data-item-idx="32">◆</span> <span class="tip" tabindex="0">リング・オヴ・プロテクション<span class="tip-body">Ring of Protection／守りの指輪
指輪、レア（要同調）
&nbsp;この指輪を着用している間、君はACとすべてのセーヴィング・スローに＋1のボーナスを得る。</span></span></td><td class="text-s text-m">equipment</td><td><span class="nc"><button type="button" class="nc-btn" data-nc="-1">−</button><input type="number" class="e-num" data-action="set-quantity" data-item-idx="32" value="1" min="0"><button type="button" class="nc-btn" data-nc="1">+</button></span></td></tr><tr><td><span class="tip" tabindex="0">矢筒<span class="tip-body">矢筒には最大20本の矢を収納することができます。</span></span></td><td class="text-s text-m">container</td><td><span class="nc"><button type="button" class="nc-btn" data-nc="-1">−</button><input type="number" class="e-num" data-action="set-quantity" data-item-idx="34" value="1" min="0"><button type="button" class="nc-btn" data-nc="1">+</button></span></td></tr><tr><td><span class="tip" tabindex="0">矢筒<span class="tip-body">矢筒には最大20本の矢を収納することができます。</span></span></td><td class="text-s text-m">container</td><td><span class="nc"><button type="button" class="nc-btn" data-nc="-1">−</button><input type="number" class="e-num" data-action="set-quantity" data-item-idx="35" value="1" min="0"><button type="button" class="nc-btn" data-nc="1">+</button></span></td></tr><tr><td><span class=" eq-toggle" style="color:var(--grn)" data-action="toggle-equip" data-item-idx="36">◆</span> <span class="tip" tabindex="0">ゴーグルズ・オヴ・ナイト／暗視のゴーグル<span class="tip-body">その他の魔法のアイテム
アンコモン
この黒いゴーグルを着用している間、君は暗視60フィートを得る。元から暗視を有している場合、このゴーグルを着用することで暗視の距離が60フィート伸びる。</span></span></td><td class="text-s text-m">equipment</td><td><span class="nc"><button type="button" class="nc-btn" data-nc="-1">−</button><input type="number" class="e-num" data-action="set-quantity" data-item-idx="36" value="1" min="0"><button type="button" class="nc-btn" data-nc="1">+</button></span></td></tr><tr><td><span class="tip" tabindex="0">ポーション・オヴ・ヒーリング／癒しの水薬<span class="tip-body">ポーションの赤い液体をゆらすと、ほのかな光輝を放つ。
このポーションを飲むことで、2d4 + 2ヒットポイントが回復する。</span></span></td><td class="text-s text-m">consumable</td><td><span class="nc"><button type="button" class="nc-btn" data-nc="-1">−</button><input type="number" class="e-num" data-action="set-quantity" data-item-idx="38" value="1" min="0"><button type="button" class="nc-btn" data-nc="1">+</button></span></td></tr></tbody></table><div class="coins"><span class="coin coin-pp"><span class="cl">PP</span> <span class="nc"><button type="button" class="nc-btn" data-nc="-1">−</button><input type="number" class="e-coin" data-action="set-currency" data-coin="pp" value="0" min="0"><button type="button" class="nc-btn" data-nc="1">+</button></span></span><span class="coin coin-gp"><span class="cl">GP</span> <span class="nc"><button type="button" class="nc-btn" data-nc="-1">−</button><input type="number" class="e-coin" data-action="set-currency" data-coin="gp" value="21" min="0"><button type="button" class="nc-btn" data-nc="1">+</button></span></span><span class="coin coin-ep"><span class="cl">EP</span> <span class="nc"><button type="button" class="nc-btn" data-nc="-1">−</button><input type="number" class="e-coin" data-action="set-currency" data-coin="ep" value="3" min="0"><button type="button" class="nc-btn" data-nc="1">+</button></span></span><span class="coin coin-sp"><span class="cl">SP</span> <span class="nc"><button type="button" class="nc-btn" data-nc="-1">−</button><input type="number" class="e-coin" data-action="set-currency" data-coin="sp" value="5" min="0"><button type="button" class="nc-btn" data-nc="1">+</button></span></span><span class="coin coin-cp"><span class="cl">CP</span> <span class="nc"><button type="button" class="nc-btn" data-nc="-1">−</button><input type="number" class="e-coin" data-action="set-currency" data-coin="cp" value="0" min="0"><button type="button" class="nc-btn" data-nc="1">+</button></span></span></div></div></div></div><div class="pers-grid"><div class="pers-box"><div class="lbl">性格特徴</div><div class="ct"><p><span style="font-family: &#39;Noto Sans JP&#39;">一日の始まり、あるいは終わりに周りの者には馴染みのない、ちょっとした伝統的な儀式を行う。</span></p></div></div><div class="pers-box"><div class="lbl">理想</div><div class="ct"><p><span style="font-family: &#39;Noto Sans JP&#39;">疑念。用心が肝要だ。ここでは誰が友で誰が敵かわからないのだから。(属性問わず)</span></p></div></div><div class="pers-box"><div class="lbl">絆</div><div class="ct"><p><span style="font-family: &#39;Noto Sans JP&#39;">この見知らぬ土地の美と不思議に心を奪われてしまった。</span></p></div></div><div class="pers-box"><div class="lbl">弱点</div><div class="ct"><p><span style="font-family: &#39;Noto Sans JP&#39;">この地の人々のエキゾチックな美しさに弱い。</span></p></div></div></div><div class="sec"><div class="sec-title">習熟・言語</div><div class="pl-grid"><div class="pl-grp"><div class="lbl">言語</div><div class="items"><span class="pill">common</span><span class="pill">draconic</span><span class="pill">orc</span><span class="pill">giant</span></div></div><div class="pl-grp"><div class="lbl">武器習熟</div><div class="items"><span class="pill">sim</span><span class="pill">mar</span></div></div><div class="pl-grp"><div class="lbl">防具習熟</div><div class="items"><span class="pill">lgt</span><span class="pill">med</span><span class="pill">hvy</span><span class="pill">shl</span></div></div></div></div><div class="sec"><div class="sec-title">特徴・特技</div><div class="feat-item"><span class="fn"><span class="tip" tabindex="0">戦闘スタイル<span class="tip-body">君は得意の戦法として1種類の戦闘スタイルを採用する。以下の中から1つを選択すること。これ以後また戦闘スタイルを選択することがあっても、同一の戦闘スタイルを2度選択することはできない。
ファイターの選択肢
@Compendium[dnd5e.classfeatures.8YwPFv3UAPjWVDNf]@Compendium[dnd5e.classfeatures.zSlV0O2rQMdoq6pB]@Compendium[dnd5e.classfeatures.hCop9uJrWhF1QPb4]@Compendium[dnd5e.classfeatures.3Nc6u9pyStByuJsm]@Compendium[dnd5e.classfeatures.06NVMYf58Z76O85O]@Compendium[dnd5e.classfeatures.mHcSjcHJ8oZu3hkb]
パラディンの選択肢
@Compendium[dnd5e.classfeatures.zSlV0O2rQMdoq6pB]@Compendium[dnd5e.classfeatures.hCop9uJrWhF1QPb4]@Compendium[dnd5e.classfeatures.3Nc6u9pyStByuJsm]@Compendium[dnd5e.classfeatures.06NVMYf58Z76O85O]
レンジャーの選択肢
@Compendium[dnd5e.classfeatures.8YwPFv3UAPjWVDNf]@Compendium[dnd5e.classfeatures.zSlV0O2rQMdoq6pB]@Compendium[dnd5e.classfeatures.hCop9uJrWhF1QPb4]@Compendium[dnd5e.classfeatures.mHcSjcHJ8oZu3hkb]</span></span></span><span class="fs">ファイター 1</span><div class="fd">君は得意の戦法として1種類の戦闘スタイルを採用する。以下の中から1つを選択すること。これ以後また戦闘スタイルを選択することがあっても、同一の戦闘スタイルを2度選択することはできない。
ファイターの選択肢
@Compendium[dnd5e.classfeatures.8YwPFv3UAPjWVDNf]@Compendium[dnd5e.classfeatures.zSlV0O2rQMdoq6pB]@Compendium[dnd5e.classfeatures.hCop9uJrWhF1QPb4]@…</div></div><div class="feat-item"><span class="fn"><span class="tip" tabindex="0">底力<span class="tip-body">君は持久力の泉を有しており、危機を逃れるために泉から力を汲み上げる。君は自身のターンに、1回のボーナス・アクションを用いて、(1d10+ファイター・レベル)のヒット・ポイントを回復する。この特徴はひとたび使用したなら、小休憩または大休憩を終了するまでは、再び使用できない。</span></span></span><span class="feat-uses">(<span class="nc"><button type="button" class="nc-btn" data-nc="-1">−</button><input type="number" class="e-num" style="width:32px" data-action="set-uses" data-item-idx="2" value="0" min="0" max="1"><button type="button" class="nc-btn" data-nc="1">+</button></span> / 1)</span><span class="fs">ファイター 1</span><div class="fd">君は持久力の泉を有しており、危機を逃れるために泉から力を汲み上げる。君は自身のターンに、1回のボーナス・アクションを用いて、(1d10+ファイター・レベル)のヒット・ポイントを回復する。この特徴はひとたび使用したなら、小休憩または大休憩を終了するまでは、再び使用できない。</div></div><div class="feat-item"><span class="fn"><span class="tip" tabindex="0">二刀流<span class="tip-body">二刀流を行なうとき、君は2つ目の武器の攻撃のダメージにも能力修正値を足せる。</span></span></span><span class="fs">ファイター 1, チャンピオン 10, レンジャー 2</span><div class="fd">二刀流を行なうとき、君は2つ目の武器の攻撃のダメージにも能力修正値を足せる。</div></div><div class="feat-item"><span class="fn"><span class="tip" tabindex="0">二刀の使い手<span class="tip-body">君は二刀流での戦い方を会得しており、以下の利益を得る：君は左右の手でそれぞれ1つずつの近接武器を使用している際、ACに＋1のボーナスを得る。君は使用する片手近接武器が“軽武器”でなくても二刀流を行なえる。君は通常ならば一つのみ武器を抜いたりしまったりできる時に、2つの片手用武器を同時に抜いたりしまったりできる。</span></span></span><span class="fs">feat</span><div class="fd">君は二刀流での戦い方を会得しており、以下の利益を得る：君は左右の手でそれぞれ1つずつの近接武器を使用している際、ACに＋1のボーナスを得る。君は使用する片手近接武器が“軽武器”でなくても二刀流を行なえる。君は通常ならば一つのみ武器を抜いたりしまったりできる時に、2つの片手用武器を同時に抜いたりしまったりできる。</div></div><div class="feat-item"><span class="fn"><span class="tip" tabindex="0">注目の的<span class="tip-body">君の言葉の抑揚、立居振舞、話の中に出てくるたとえ、顔形。どれをとっても君が異邦の客である事は明白だ。君の行くところ、常に奇異の目がつきまとう。それがわずらわしいこともある。反面、学者や遼遠の地に心引かれる者たちが君に好意的な関心をよせることもある。もちろん、世間一般の人々が君の故郷の話を聞きたがる事もよくある。君はこうして興味関心を利用して、普通ならあえない人物に会い、普通なら出入りできない場所に出入りができる。貴人や学者や豪商などが、君の出てきたはるかな国や、その人々の事を聞きたがるのだ。</span></span></span><span class="fs">異邦人</span><div class="fd">君の言葉の抑揚、立居振舞、話の中に出てくるたとえ、顔形。どれをとっても君が異邦の客である事は明白だ。君の行くところ、常に奇異の目がつきまとう。それがわずらわしいこともある。反面、学者や遼遠の地に心引かれる者たちが君に好意的な関心をよせることもある。もちろん、世間一般の人々が君の故郷の話を聞きたがる事もよくある。君はこうして興味関心を利用して、普通ならあえない人物に会い、普通なら出入りできない場所に出入りができる。貴人や学者や豪商などが、君の出てきたはるかな国や、その人々の事を聞きたがるのだ。</div></div><div class="feat-item"><span class="fn"><span class="tip" tabindex="0">怒涛のアクション<span class="tip-body">君は短時間だけ通常の限界を超えて活動できる。君は自分のターンにおいて、通常のアクション(と、場合によって許される1回のボーナス・アクション)に加えて、さらに追加で1回のアクションを行なえる。この特徴はひとたび使用したなら、小休憩または大休憩を終了するまでは、再び使用できない。17レベル以降、君はこの特徴を次の休憩までの間に2回使用できるようになるが、それでも1ターンには1回しか使用できない。</span></span></span><span class="feat-uses">(<span class="nc"><button type="button" class="nc-btn" data-nc="-1">−</button><input type="number" class="e-num" style="width:32px" data-action="set-uses" data-item-idx="23" value="0" min="0" max="@scale.fighter.action-surge"><button type="button" class="nc-btn" data-nc="1">+</button></span> / @scale.fighter.action-surge)</span><span class="fs">ファイター 2</span><div class="fd">君は短時間だけ通常の限界を超えて活動できる。君は自分のターンにおいて、通常のアクション(と、場合によって許される1回のボーナス・アクション)に加えて、さらに追加で1回のアクションを行なえる。この特徴はひとたび使用したなら、小休憩または大休憩を終了するまでは、再び使用できない。17レベル以降、君はこの特徴を次の休憩までの間に2回使用できるようになるが、それでも1ターンには1回しか使用できない。</div></div><div class="feat-item"><span class="fn"><span class="tip" tabindex="0">Martial Archetype<span class="tip-body">At 3rd level, you choose an archetype that you strive to emulate in your combat styles and techniques, such as Champion. The archetype you choose grants you features at 3rd level and again at 7th, 10th, 15th, and 18th level.</span></span></span><span class="fs">Fighter 3</span><div class="fd">At 3rd level, you choose an archetype that you strive to emulate in your combat styles and techniques, such as Champion. The archetype you choose grants you features at 3rd level and again at 7th, 10th, 15th, and 18th level.</div></div><div class="feat-item"><span class="fn"><span class="tip" tabindex="0">習熟追加(サムライ)<span class="tip-body">３レベルでこの類型を選んだ時点で、君は以下のいずれか１つの技能を選んで習熟する：〈看破〉、〈芸能〉、〈説得〉、〈歴史〉。あるいは、技能の代わりに１種類の言語を選んで習得してもよい。</span></span></span><span class="fs">feat</span><div class="fd">３レベルでこの類型を選んだ時点で、君は以下のいずれか１つの技能を選んで習熟する：〈看破〉、〈芸能〉、〈説得〉、〈歴史〉。あるいは、技能の代わりに１種類の言語を選んで習得してもよい。</div></div><div class="feat-item"><span class="fn"><span class="tip" tabindex="0">侍魂<span class="tip-body">３レベル以降、戦闘に一意専心する君の攻撃は過たず敵を打ち、また君を打ち倒すことは困難になる。君は自分のターンに１回のボーナス・アクションとして、そのターンの終了時まで自分のすべての攻撃ロールに有利を得ることができる。これを行なった時、君はさらに一時的ヒット・ポイント５を得る。この一時的ヒット・ポイントは君のファイター・レベルが特定の値に達するたび、以下のように増加する；１０レベルで１０、１５レベルで１５。
　君はこの特徴を３回だけ使用できる。君が大休憩を終えるたび、消費した使用回数はすべて回復する。</span></span></span><span class="feat-uses">(<span class="nc"><button type="button" class="nc-btn" data-nc="-1">−</button><input type="number" class="e-num" style="width:32px" data-action="set-uses" data-item-idx="30" value="0" min="0" max="3"><button type="button" class="nc-btn" data-nc="1">+</button></span> / 3)</span><span class="fs">feat</span><div class="fd">３レベル以降、戦闘に一意専心する君の攻撃は過たず敵を打ち、また君を打ち倒すことは困難になる。君は自分のターンに１回のボーナス・アクションとして、そのターンの終了時まで自分のすべての攻撃ロールに有利を得ることができる。これを行なった時、君はさらに一時的ヒット・ポイント５を得る。この一時的ヒット・ポイントは君のファイター・レベルが特定の値に達するたび、以下のように増加する；１０レベルで１０、１５レベルで１５。
　君はこの特徴を３回だけ使用できる。君が大休憩を終えるたび、消費した使用回数はすべて回復す…</div></div><div class="feat-item"><span class="fn"><span class="tip" tabindex="0">刺し貫き屋<span class="tip-body">君は戦闘において狙った目標を過たず貫けるようになった。君は以下の利益をすべて得る：君の【筋力】あるいは【敏捷力】の数値を1上昇させる（最大値20）。1ターンに1回、[刺突]ダメージを与える君の攻撃がクリーチャーにヒットした時、その攻撃のダメージ・ダイスの1つを再ロールできる。必ず再ロールの結果を用いること。[刺突]ダメージを与える君の攻撃がクリーチャーにクリティカル・ヒットした後、そのクリティカル・ヒットによる追加のダメージを決めるためのダイス・ロールに、ダイスをもう1つ加えることができる。</span></span></span><span class="fs">feat</span><div class="fd">君は戦闘において狙った目標を過たず貫けるようになった。君は以下の利益をすべて得る：君の【筋力】あるいは【敏捷力】の数値を1上昇させる（最大値20）。1ターンに1回、[刺突]ダメージを与える君の攻撃がクリーチャーにヒットした時、その攻撃のダメージ・ダイスの1つを再ロールできる。必ず再ロールの結果を用いること。[刺突]ダメージを与える君の攻撃がクリーチャーにクリティカル・ヒットした後、そのクリティカル・ヒットによる追加のダメージを決めるためのダイス・ロールに、ダイスをもう1つ加えることができる。</div></div><div class="feat-item"><span class="fn"><span class="tip" tabindex="0">追加攻撃<span class="tip-body">君は自分のターンに攻撃アクションをとるたびに1回ではなく計2回の攻撃を行なえるようになる。この攻撃回数はフェイター11レベルで計3回、20レベルで計4回まで増加する。</span></span></span><span class="fs">ファイター 5</span><div class="fd">君は自分のターンに攻撃アクションをとるたびに1回ではなく計2回の攻撃を行なえるようになる。この攻撃回数はフェイター11レベルで計3回、20レベルで計4回まで増加する。</div></div></div><div class="sec"><div class="sec-title">経歴・外見</div><div class="bio-ct"><p><span style="font-family:&#39;Noto Sans JP&#39;">遠方の国からやってきた異邦人。<br style="color:rgb(0, 0, 0);font-family:&#39;Noto Sans JP&#39;;font-size:12px;font-style:normal;font-variant-ligatures:normal;font-variant-caps:normal;font-weight:400;letter-spacing:normal;orphans:2;text-align:start;text-indent:0px;text-transform:none;widows:2;word-spacing:0px;-webkit-text-stroke-width:0px;white-space:normal;text-decoration-thickness:initial;text-decoration-style:initial;text-decoration-color:initial">「彼は忠義に厚く仕えていた主人を亡くしたことがきっかけで国を出た。彼は今新たな土地で新たな主君を探しているのだ」<br style="color:rgb(0, 0, 0);font-family:&#39;Noto Sans JP&#39;;font-size:12px;font-style:normal;font-variant-ligatures:normal;font-variant-caps:normal;font-weight:400;letter-spacing:normal;orphans:2;text-align:start;text-indent:0px;text-transform:none;widows:2;word-spacing:0px;-webkit-text-stroke-width:0px;white-space:normal;text-decoration-thickness:initial;text-decoration-style:initial;text-decoration-color:initial">「いや彼は故郷の君主の息子の一人で、何か大きな事を成し遂げることで次なる君主へと認められようとしているのだ」<br style="color:rgb(0, 0, 0);font-family:&#39;Noto Sans JP&#39;;font-size:12px;font-style:normal;font-variant-ligatures:normal;font-variant-caps:normal;font-weight:400;letter-spacing:normal;orphans:2;text-align:start;text-indent:0px;text-transform:none;widows:2;word-spacing:0px;-webkit-text-stroke-width:0px;white-space:normal;text-decoration-thickness:initial;text-decoration-style:initial;text-decoration-color:initial">「彼の持ち物の大半は虎のマークが入っている。あのタイガーマークは遠方の侵略者の印なのではないか。他の仲間と共に我らの土地に浸透し奪おうとしているのだ」<br style="color:rgb(0, 0, 0);font-family:&#39;Noto Sans JP&#39;;font-size:12px;font-style:normal;font-variant-ligatures:normal;font-variant-caps:normal;font-weight:400;letter-spacing:normal;orphans:2;text-align:start;text-indent:0px;text-transform:none;widows:2;word-spacing:0px;-webkit-text-stroke-width:0px;white-space:normal;text-decoration-thickness:initial;text-decoration-style:initial;text-decoration-color:initial">……などは異国のイントネーションや言葉の細かな違い、更に彼が強く否定できず寡黙な人柄であることから、尾ひれが付き続けたことによる膨らんだ噂である。<br style="color:rgb(0, 0, 0);font-family:&#39;Noto Sans JP&#39;;font-size:12px;font-style:normal;font-variant-ligatures:normal;font-variant-caps:normal;font-weight:400;letter-spacing:normal;orphans:2;text-align:start;text-indent:0px;text-transform:none;widows:2;word-spacing:0px;-webkit-text-stroke-width:0px;white-space:normal;text-decoration-thickness:initial;text-decoration-style:initial;text-decoration-color:initial"><br style="color:rgb(0, 0, 0);font-family:&#39;Noto Sans JP&#39;;font-size:12px;font-style:normal;font-variant-ligatures:normal;font-variant-caps:normal;font-weight:400;letter-spacing:normal;orphans:2;text-align:start;text-indent:0px;text-transform:none;widows:2;word-spacing:0px;-webkit-text-stroke-width:0px;white-space:normal;text-decoration-thickness:initial;text-decoration-style:initial;text-decoration-color:initial">本名は大岡光忠。<br style="color:rgb(0, 0, 0);font-family:&#39;Noto Sans JP&#39;;font-size:12px;font-style:normal;font-variant-ligatures:normal;font-variant-caps:normal;font-weight:400;letter-spacing:normal;orphans:2;text-align:start;text-indent:0px;text-transform:none;widows:2;word-spacing:0px;-webkit-text-stroke-width:0px;white-space:normal;text-decoration-thickness:initial;text-decoration-style:initial;text-decoration-color:initial">家は確かに大陸でいう貴族のようなものであったが無精で不躾で忠義はなく、家出のような形で国を飛び出してきた。<br style="color:rgb(0, 0, 0);font-family:&#39;Noto Sans JP&#39;;font-size:12px;font-style:normal;font-variant-ligatures:normal;font-variant-caps:normal;font-weight:400;letter-spacing:normal;orphans:2;text-align:start;text-indent:0px;text-transform:none;widows:2;word-spacing:0px;-webkit-text-stroke-width:0px;white-space:normal;text-decoration-thickness:initial;text-decoration-style:initial;text-decoration-color:initial">剣の才はあったので腕試し感覚で荒事をして回っていたが、言葉がうまく伝わらないことも度々ありいつのまにかラッパンアスクに挑むことになっていた。<br style="color:rgb(0, 0, 0);font-family:&#39;Noto Sans JP&#39;;font-size:12px;font-style:normal;font-variant-ligatures:normal;font-variant-caps:normal;font-weight:400;letter-spacing:normal;orphans:2;text-align:start;text-indent:0px;text-transform:none;widows:2;word-spacing:0px;-webkit-text-stroke-width:0px;white-space:normal;text-decoration-thickness:initial;text-decoration-style:initial;text-decoration-color:initial">故郷にはないタイプの人間(特に女性)と食事に目が無い。<br style="color:rgb(0, 0, 0);font-family:&#39;Noto Sans JP&#39;;font-size:12px;font-style:normal;font-variant-ligatures:normal;font-variant-caps:normal;font-weight:400;letter-spacing:normal;orphans:2;text-align:start;text-indent:0px;text-transform:none;widows:2;word-spacing:0px;-webkit-text-stroke-width:0px;white-space:normal;text-decoration-thickness:initial;text-decoration-style:initial;text-decoration-color:initial"><br style="color:rgb(0, 0, 0);font-family:&#39;Noto Sans JP&#39;;font-size:12px;font-style:normal;font-variant-ligatures:normal;font-variant-caps:normal;font-weight:400;letter-spacing:normal;orphans:2;text-align:start;text-indent:0px;text-transform:none;widows:2;word-spacing:0px;-webkit-text-stroke-width:0px;white-space:normal;text-decoration-thickness:initial;text-decoration-style:initial;text-decoration-color:initial">脇差と大弓は海を渡る際に持ってきた、それ以外の武器はこちらに来てから購入。<br style="color:rgb(0, 0, 0);font-family:&#39;Noto Sans JP&#39;;font-size:12px;font-style:normal;font-variant-ligatures:normal;font-variant-caps:normal;font-weight:400;letter-spacing:normal;orphans:2;text-align:start;text-indent:0px;text-transform:none;widows:2;word-spacing:0px;-webkit-text-stroke-width:0px;white-space:normal;text-decoration-thickness:initial;text-decoration-style:initial;text-decoration-color:initial">虎のマークの道具は故郷では大変質の良いもので、特に湯が冷めにくい魔法のような瓶がお気に入り。</span></p></div></div></div>
<footer class="site-footer">Copyright © 2026, Kendermore Convention &amp; Visitors Bureau Office. Licensed under the <span class="mit-tip" tabindex="0">MIT License<span class="mit-body">MIT License

Copyright (c) 2026 Kendermore Convention &amp; Visitors Bureau Office

Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the "Software"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.</span></span>.</footer>

<script>
const $=s=>document.querySelector(s);
const ABILS={str:'筋力',dex:'敏捷',con:'耐久',int:'知力',wis:'判断',cha:'魅力'};
const SKILL_MAP={
  acr:['軽業','dex'],ani:['動物使い','wis'],arc:['魔法学','int'],ath:['運動','str'],
  dec:['ペテン','cha'],his:['歴史','int'],ins:['看破','wis'],itm:['威圧','cha'],
  inv:['捜査','int'],med:['医術','wis'],nat:['自然','int'],prc:['知覚','wis'],
  prf:['芸能','cha'],per:['説得','cha'],rel:['宗教','int'],slt:['手先の早業','dex'],
  ste:['隠密','dex'],sur:['生存','wis']
};
const SCHOOLS={abj:'防御',con:'召喚',div:'占術',enc:'心術',evo:'力術',ill:'幻術',nec:'死霊',trs:'変成'};

function mod(s){return Math.floor(((s??10)-10)/2)}
function fm(m){return m>=0?'+'+m:''+m}
function tx(html){if(!html)return '';const d=document.createElement('div');d.innerHTML=html;return d.textContent.trim()}
function dotCls(p){return p>=2?'expert':p>=1?'full':p>0?'half':''}
function clamp(v,lo,hi){return Math.max(lo,Math.min(hi,v))}
function tip(name,descHtml){
  const desc=tx(descHtml);
  if(!desc) return name;
  const safe=desc.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/"/g,'&quot;');
  return `<span class="tip" tabindex="0">${name}<span class="tip-body">${safe}</span></span>`;
}
function nc(cls,attrs,val,min,max){
  const mn=min!=null?` min="${min}"`:'';
  const mx=max!=null?` max="${max}"`:'';
  return `<span class="nc"><button type="button" class="nc-btn" data-nc="-1">−</button><input type="number" class="${cls}" ${attrs} value="${val}"${mn}${mx}><button type="button" class="nc-btn" data-nc="1">+</button></span>`;
}

// --- Data ---
let currentActor=null;
let currentActors=[];
let dirty=false;

function ensurePath(obj,...keys){
  let c=obj;
  for(const k of keys){if(!c[k])c[k]={};c=c[k];}
  return c;
}

function pickActors(json){
  if(Array.isArray(json)) return json.filter(a=>a?.type==='character'||a?.type==='npc'||a?.system?.abilities);
  if(json?.actors) return json.actors.filter(a=>a?.type==='character'||a?.system?.abilities);
  if(json?.type&&json?.system) return [json];
  return [];
}

function getLevel(actor){
  const items=actor.items||[];
  const cls=items.filter(i=>i.type==='class');
  if(cls.length>0) return cls.reduce((s,c)=>s+(c.system?.levels||0),0);
  const sys=actor.system||{};
  return sys.details?.level??sys.details?.levels??0;
}

function getClasses(items){
  const cls=items.filter(i=>i.type==='class');
  if(!cls.length) return '—';
  return cls.map(c=>{
    const sub=items.find(i=>i.type==='subclass'&&(i.system?.classIdentifier===c.system?.identifier||i.system?.parentClass===c._id));
    return c.name+(sub?' ('+sub.name+')':'');
  }).join(' / ');
}

function getRace(actor){
  const raceItem=(actor.items||[]).find(i=>i.type==='race');
  if(raceItem) return raceItem.name;
  const r=actor.system?.details?.race;
  return (typeof r==='string')?r:'';
}

function getBackground(actor){
  const bgItem=(actor.items||[]).find(i=>i.type==='background');
  if(bgItem) return bgItem.name;
  const r=actor.system?.details?.background;
  return (typeof r==='string')?r:'';
}

function getAC(sys,items){
  if(typeof sys.attributes?.ac?.value==='number') return sys.attributes.ac.value;
  if(typeof sys.attributes?.ac?.flat==='number') return sys.attributes.ac.flat;
  if(typeof sys.attributes?.ac==='number') return sys.attributes.ac;
  const dexMod=mod(sys.abilities?.dex?.value);
  const calc=sys.attributes?.ac?.calc||'default';
  const armors=(items||[]).filter(i=>(i.type==='equipment'||i.type==='armor')&&i.system?.equipped&&i.system?.armor?.value);
  if(armors.length){
    let best=10;
    for(const a of armors){
      const av=a.system.armor.value;
      const at=a.system?.type?.value||a.system?.armor?.type||'light';
      if(at==='heavy') best=Math.max(best,av);
      else if(at==='medium') best=Math.max(best,av+Math.min(dexMod,2));
      else if(at==='shield') best+=2;
      else best=Math.max(best,av+dexMod);
    }
    return best;
  }
  if(calc==='mage') return 13+dexMod;
  if(calc==='natural') return 10+dexMod;
  return 10+dexMod;
}

function getAbilMod(sys,abil){
  const a=sys.abilities?.[abil]||{};
  return typeof a.mod==='number'?a.mod:mod(a.value);
}

function weaponDmg(ws,sys,prof){
  const acts=ws.activities?Object.values(ws.activities):[];
  const atk=acts.find(a=>a.type==='attack'||a.type==='damage');
  if(atk){
    let ability=atk.attack?.ability||ws.ability||'';
    const atkType=atk.attack?.type?.value||'melee';
    let abilMod;
    if(ability==='spellcasting'){
      ability=sys.attributes?.spellcasting||'int';
      abilMod=getAbilMod(sys,ability);
    }else if(ability&&sys.abilities?.[ability]){
      abilMod=getAbilMod(sys,ability);
    }else{
      const props=Array.isArray(ws.properties)?ws.properties:(ws.properties?.value||[]);
      const fin=Array.isArray(props)?props.includes('fin'):false;
      if(atkType==='ranged') abilMod=getAbilMod(sys,'dex');
      else if(fin) abilMod=Math.max(getAbilMod(sys,'str'),getAbilMod(sys,'dex'));
      else abilMod=getAbilMod(sys,'str');
    }
    const mag=ws.magicalBonus||0;
    const ab=parseInt(atk.attack?.bonus)||0;
    const pr=ws.proficient!==false?(sys.attributes?.prof??prof??2):0;
    const atkTotal=abilMod+pr+mag+ab;
    const parts=atk.damage?.parts||[];
    let dmg=parts.map(p=>{
      if(Array.isArray(p)) return p.join(' ');
      let d='';
      if(p.number&&p.denomination) d=p.number+'d'+p.denomination;
      if(p.bonus) d+=(String(p.bonus).startsWith('+')||String(p.bonus).startsWith('-')?'':'+')+p.bonus;
      const types=(p.types||[]).filter(t=>t&&t!=='none');
      return [d,types.join('/')].filter(Boolean).join(' ');
    }).join(' + ')||'—';
    if(dmg!=='—'&&abilMod) dmg+=' '+fm(abilMod);
    if(mag>0) dmg+=' +'+mag;
    return {atk:fm(atkTotal),dmg};
  }
  const ability=ws.ability||'str';
  const abilMod=getAbilMod(sys,ability);
  const pr2=ws.proficient!==false?(sys.attributes?.prof??prof??2):0;
  const atkB=abilMod+pr2+(ws.attackBonus||0);
  const parts=(ws.damage?.parts||[]).map(p=>Array.isArray(p)?p.join(' '):String(p)).join(' / ');
  return {atk:fm(atkB),dmg:parts||'—'};
}

// --- Save details open state ---
function saveDetailsState(){
  const state={};
  document.querySelectorAll('#sheet details').forEach((d,i)=>{state[i]=d.open;});
  return state;
}
function restoreDetailsState(state){
  document.querySelectorAll('#sheet details').forEach((d,i)=>{if(i in state)d.open=state[i];});
}

// --- Render ---
function render(actor){
  if(!actor){$('#sheet').innerHTML='<p class="text-m">キャラが見つかりません</p>';return;}
  currentActor=actor;

  const detState=saveDetailsState();
  const scrollY=window.scrollY;

  const sys=actor.system||{};
  const items=actor.items||[];
  const level=getLevel(actor);
  const prof=sys.attributes?.prof??Math.floor(Math.max(level-1,0)/4)+2;
  let h='';

  // Header
  const name=actor.name||'(unnamed)';
  const cls=getClasses(items);
  const race=getRace(actor);
  const bg=getBackground(actor);
  const align=sys.details?.alignment||'';
  const xp=sys.details?.xp?.value;
  h+=`<div class="char-header"><div class="char-name">${name}</div><div class="char-sub">${cls} Lv${level||'?'} · ${race||'—'} · ${bg||'—'} · ${align||'—'}${xp!=null?' · '+xp+' XP':''}</div></div>`;

  h+='<div class="sheet-body">';

  // Col1: Abilities
  h+='<div class="ab-col">';
  for(const[k,label] of Object.entries(ABILS)){
    const a=sys.abilities?.[k]||{};
    const sc=a.value??10;
    const m=typeof a.mod==='number'?a.mod:mod(sc);
    h+=`<div class="ab-box"><div class="ab-lbl">${k.toUpperCase()}</div><div class="ab-score">${sc}</div><div class="ab-mod">${fm(m)}</div></div>`;
  }
  h+='</div>';

  // Col2: Saves & Skills
  h+='<div>';

  // Inspiration & Prof
  const insp=sys.attributes?.inspiration;
  h+=`<div class="prof-row"><div class="prof-box"><div class="big clickable" data-action="toggle-inspiration">${insp?'★':'☆'}</div><div class="lbl">Inspiration</div></div><div class="prof-box"><div class="big">+${prof}</div><div class="lbl">習熟ボーナス</div></div></div>`;

  // Saves
  h+='<div class="panel"><div class="p-title">セーヴィング・スロー</div>';
  for(const[k,label] of Object.entries(ABILS)){
    const a=sys.abilities?.[k]||{};
    const m=getAbilMod(sys,k);
    const p=a.proficient?true:false;
    const total=p?m+prof:m;
    h+=`<div class="s-row"><div class="dot ${p?'full':''}"></div><div class="bonus">${fm(total)}</div><div class="name">${label}</div></div>`;
  }
  h+='</div>';

  // Skills
  h+='<div class="panel"><div class="p-title">技能</div>';
  for(const[k,[label,defAbil]] of Object.entries(SKILL_MAP)){
    const sk=sys.skills?.[k]||{};
    const abil=sk.ability||defAbil;
    const abilMod=getAbilMod(sys,abil);
    const pl=sk.value??sk.prof??0;
    const total=abilMod+(pl?Math.round(prof*pl):0);
    h+=`<div class="s-row"><div class="dot ${dotCls(pl)}"></div><div class="bonus">${fm(total)}</div><div class="name">${label}<span class="abil">${abil}</span></div></div>`;
  }
  h+='</div>';

  // Passive Perception
  const prc=sys.skills?.prc||{};
  const prcAbil=prc.ability||'wis';
  const prcMod=getAbilMod(sys,prcAbil);
  const prcPl=prc.value??prc.prof??0;
  const passiveP=10+prcMod+(prcPl?Math.round(prof*prcPl):0);
  h+=`<div class="passive"><div class="big">${passiveP}</div><div class="lbl">受動知覚 (Passive Perception)</div></div>`;
  h+='</div>';

  // Col3: Combat
  h+='<div>';

  // AC, Init, Speed
  const ac=getAC(sys,items);
  const init=getAbilMod(sys,'dex')+(parseInt(sys.attributes?.init?.bonus)||0);
  const spd=sys.attributes?.movement?.walk??sys.attributes?.speed?.value??30;
  h+=`<div class="combat-trio"><div class="c-box"><div class="lbl">AC</div><div class="val">${ac}</div></div><div class="c-box"><div class="lbl">イニシアチブ</div><div class="val">${fm(init)}</div></div><div class="c-box"><div class="lbl">移動速度</div><div class="val">${spd}</div><div class="unit">ft</div></div></div>`;

  // HP
  const hp=ensurePath(sys,'attributes','hp');
  const hpCur=hp.value??0;
  const hpMax=hp.max??hpCur;
  const hpTemp=hp.temp??0;
  const hpR=hpMax>0?hpCur/hpMax:1;
  const hpC=hpR>.5?'var(--grn)':hpR>.25?'#c8a030':'var(--red)';
  h+=`<div class="hp-panel"><div class="p-title">ヒットポイント</div>`;
  h+=`<div class="hp-row">${nc('hp-cur','data-action="set-hp"',hpCur,0,hpMax)}<span class="hp-sep">/</span><span class="hp-max">${hpMax}</span></div>`;
  h+=`<div class="hp-bar"><div class="hp-bar-fill" style="width:${Math.round(hpR*100)}%;background:${hpC}"></div></div>`;
  h+=`<div class="hp-adj"><button class="hp-btn hp-btn-dmg" data-action="hp-dmg">Damage</button>${nc('hp-adj-input','id="hpDelta"',0,0,null)}<button class="hp-btn hp-btn-heal" data-action="hp-heal">Heal</button></div>`;
  h+=`<div class="hp-temp-row">一時HP: ${nc('hp-temp-input','data-action="set-temp-hp"',hpTemp,0,null)}</div>`;
  h+=`</div>`;

  // Hit Dice & Death Saves
  const clsItems=items.filter(i=>i.type==='class');
  h+=`<div class="hd-death">`;
  // Hit Dice
  h+=`<div class="mini-p"><div class="lbl">ヒットダイス</div>`;
  if(clsItems.length){
    for(let ci=0;ci<clsItems.length;ci++){
      const c=clsItems[ci];
      const hd=c.system?.hd||{};
      const den=hd.denomination||'d8';
      const lvl=c.system?.levels||0;
      const spent=hd.spent||0;
      const remain=lvl-spent;
      h+=`<div style="margin:3px 0"><span class="text-s">${den}</span> <span style="font-weight:700">${remain}</span>/${lvl} `;
      h+=`<button class="hp-btn hp-btn-dmg" style="font-size:10px;padding:1px 6px" data-action="hd-use" data-class-idx="${ci}">使用</button> `;
      h+=`<button class="hp-btn hp-btn-heal" style="font-size:10px;padding:1px 6px" data-action="hd-recover" data-class-idx="${ci}">回復</button>`;
      h+=`</div>`;
    }
  }else h+='<div>—</div>';
  h+=`</div>`;
  // Death Saves
  const death=ensurePath(sys,'attributes','death');
  const dS=death.success||0,dF=death.failure||0;
  h+=`<div class="mini-p"><div class="lbl">デス・セーヴ</div>`;
  h+=`<div class="text-s">成功</div><div class="dd">${[0,1,2].map(i=>`<div class="d ${i<dS?'ok':''}" data-action="death-success" data-idx="${i}"></div>`).join('')}</div>`;
  h+=`<div class="text-s">失敗</div><div class="dd">${[0,1,2].map(i=>`<div class="d ${i<dF?'ng':''}" data-action="death-failure" data-idx="${i}"></div>`).join('')}</div>`;
  h+=`</div></div>`;

  // Attacks
  const weapons=items.filter(i=>i.type==='weapon');
  h+='<div class="panel"><div class="p-title">攻撃</div>';
  if(weapons.length){
    h+='<table class="t"><thead><tr><th>名称</th><th>攻撃</th><th>ダメージ</th></tr></thead><tbody>';
    for(const w of weapons){
      const r=weaponDmg(w.system||{},sys,prof);
      h+=`<tr><td>${tip(w.name,w.system?.description?.value)}</td><td>${r.atk}</td><td>${r.dmg}</td></tr>`;
    }
    h+='</tbody></table>';
  }else h+='<div class="text-m text-s">—</div>';
  h+='</div>';

  // Equipment
  const eqTypes=new Set(['equipment','consumable','tool','loot','backpack','armor','container']);
  const eqItems=items.filter(i=>eqTypes.has(i.type));
  if(eqItems.length){
    h+='<div class="panel"><div class="p-title">装備・所持品</div><table class="t"><thead><tr><th>名称</th><th>種別</th><th>数</th></tr></thead><tbody>';
    for(const it of eqItems){
      const s=it.system||{};
      const idx=items.indexOf(it);
      const hasEquip=(it.type==='equipment'||it.type==='armor');
      const eqIcon=hasEquip?(s.equipped?'◆':'◇'):'';
      const eqAttr=hasEquip?` data-action="toggle-equip" data-item-idx="${idx}"`:'';
      const eqCls=hasEquip?' eq-toggle':'';
      const eqColor=s.equipped?'color:var(--grn)':'color:var(--td)';
      h+=`<tr><td>${hasEquip?`<span class="${eqCls}" style="${eqColor}"${eqAttr}>${eqIcon}</span> `:''}${tip(it.name,s.description?.value)}</td><td class="text-s text-m">${it.type}</td><td>${nc('e-num',`data-action="set-quantity" data-item-idx="${idx}"`,s.quantity??1,0,null)}</td></tr>`;
    }
    h+='</tbody></table>';
    // Currency
    const cur=ensurePath(sys,'currency');
    h+=`<div class="coins">`;
    for(const[k,label] of [['pp','PP'],['gp','GP'],['ep','EP'],['sp','SP'],['cp','CP']]){
      h+=`<span class="coin coin-${k}"><span class="cl">${label}</span> ${nc('e-coin',`data-action="set-currency" data-coin="${k}"`,cur[k]||0,0,null)}</span>`;
    }
    h+=`</div></div>`;
  }

  // Senses
  const senses=sys.attributes?.senses||{};
  const sl=[];
  if(senses.darkvision)sl.push('暗視 '+senses.darkvision+'ft');
  if(senses.blindsight)sl.push('盲目視 '+senses.blindsight+'ft');
  if(senses.tremorsense)sl.push('振動感知 '+senses.tremorsense+'ft');
  if(senses.truesight)sl.push('真実の目 '+senses.truesight+'ft');
  if(sl.length) h+=`<div style="font-size:12px;color:var(--tm);text-align:center;margin-top:6px">${sl.join(' · ')}</div>`;

  h+='</div>'; // end col3
  h+='</div>'; // end sheet-body

  // Personality
  const det=sys.details||{};
  const trait=det.trait||'';
  const ideal=det.ideal||'';
  const bond=det.bond||'';
  const flaw=det.flaw||'';
  if(trait||ideal||bond||flaw){
    h+='<div class="pers-grid">';
    h+=`<div class="pers-box"><div class="lbl">性格特徴</div><div class="ct">${trait||'—'}</div></div>`;
    h+=`<div class="pers-box"><div class="lbl">理想</div><div class="ct">${ideal||'—'}</div></div>`;
    h+=`<div class="pers-box"><div class="lbl">絆</div><div class="ct">${bond||'—'}</div></div>`;
    h+=`<div class="pers-box"><div class="lbl">弱点</div><div class="ct">${flaw||'—'}</div></div>`;
    h+='</div>';
  }

  // Proficiencies & Languages
  const traits=sys.traits||{};
  const langs=Array.isArray(traits.languages?.value)?traits.languages.value:[];
  const wProf=Array.isArray(traits.weaponProf?.value)?traits.weaponProf.value:[];
  const aProf=Array.isArray(traits.armorProf?.value)?traits.armorProf.value:[];
  if(langs.length||wProf.length||aProf.length){
    h+='<div class="sec"><div class="sec-title">習熟・言語</div><div class="pl-grid">';
    h+=`<div class="pl-grp"><div class="lbl">言語</div><div class="items">${langs.map(l=>'<span class="pill">'+l+'</span>').join('')||'—'}</div></div>`;
    h+=`<div class="pl-grp"><div class="lbl">武器習熟</div><div class="items">${wProf.map(w=>'<span class="pill">'+w+'</span>').join('')||'—'}</div></div>`;
    h+=`<div class="pl-grp"><div class="lbl">防具習熟</div><div class="items">${aProf.map(a=>'<span class="pill">'+a+'</span>').join('')||'—'}</div></div>`;
    h+='</div></div>';
  }

  // Features (with uses)
  const featTypes=new Set(['feat','class','race','background','subclass']);
  const allFeats=items.filter(i=>featTypes.has(i.type));
  if(allFeats.length){
    h+='<div class="sec"><div class="sec-title">特徴・特技</div>';
    for(const f of allFeats){
      if(f.type==='class'||f.type==='race'||f.type==='background'||f.type==='subclass') continue;
      const desc=tx(f.system?.description?.value);
      const short=desc.length>250?desc.substring(0,250)+'…':desc;
      const src=f.system?.requirements||f.type||'';
      const idx=items.indexOf(f);
      const uses=f.system?.uses;
      const hasUses=uses&&(uses.max||uses.value);
      let usesHtml='';
      if(hasUses){
        const uMax=uses.max||0;
        const uVal=uses.value||0;
        // uses.value = how many SPENT in some formats, or remaining in others.
        // In FVTT dnd5e: uses.value = remaining, uses.max = maximum
        usesHtml=`<span class="feat-uses">(${nc('e-num',`style="width:32px" data-action="set-uses" data-item-idx="${idx}"`,uVal,0,uMax)} / ${uMax})</span>`;
      }
      h+=`<div class="feat-item"><span class="fn">${tip(f.name,f.system?.description?.value)}</span>${usesHtml}<span class="fs">${src}</span>${short?'<div class="fd">'+short+'</div>':''}</div>`;
    }
    h+='</div>';
  }

  // Spells
  const spells=items.filter(i=>i.type==='spell');
  if(spells.length){
    h+='<div class="sec"><div class="sec-title">呪文</div>';

    // Spellcasting info
    const scAbil=sys.attributes?.spellcasting||'';
    if(scAbil){
      const scMod=getAbilMod(sys,scAbil);
      const dc=8+prof+scMod;
      const sAtk=prof+scMod;
      h+=`<div class="sp-meta"><div><b>呪文発動能力:</b> ${ABILS[scAbil]||scAbil.toUpperCase()}</div><div><b>呪文セーヴDC:</b> ${dc}</div><div><b>呪文攻撃:</b> ${fm(sAtk)}</div></div>`;
    }

    // Spell slots (editable)
    const slots=ensurePath(sys,'spells');
    const hasSlots=Object.keys(slots).some(k=>k.startsWith('spell')&&(slots[k]?.value>0||slots[k]?.override>0));
    if(hasSlots){
      h+='<div class="sp-slots">';
      for(let lv=1;lv<=9;lv++){
        const s=slots['spell'+lv];
        if(!s) continue;
        const max=s.override??s.value??0;
        if(!max) continue;
        const cur=s.value??0;
        h+=`<div class="sl-grp"><span class="lv">${lv}lv</span>`;
        for(let i=0;i<max;i++){
          h+=`<div class="sl-d ${i<cur?'on':''}" data-action="toggle-slot" data-slot-lv="${lv}" data-slot-idx="${i}"></div>`;
        }
        h+='</div>';
      }
      h+='</div>';
    }

    // Group by level
    const byLv=new Map();
    for(const sp of spells){
      const lv=sp.system?.level??0;
      if(!byLv.has(lv)) byLv.set(lv,[]);
      byLv.get(lv).push(sp);
    }
    const levels=[...byLv.keys()].sort((a,b)=>a-b);
    for(const lv of levels){
      const list=byLv.get(lv);
      const pretty=lv===0?'キャントリップ':'Lv'+lv;
      h+=`<details class="sp-lv"${lv<=1?' open':''}><summary>${pretty} (${list.length})</summary><div class="sp-lv-body">`;
      for(const sp of list){
        const ss=sp.system||{};
        const school=SCHOOLS[ss.school]||ss.school||'';
        const actType=ss.activation?.type||'';
        const range=ss.range?.value||ss.range||'';
        const dur=ss.duration?.value||(ss.duration?.units&&ss.duration.units!=='inst'?ss.duration.units:'')||'';
        const conc=ss.properties?.value?.includes?.('concentration')||ss.components?.concentration||false;
        const ritual=ss.properties?.value?.includes?.('ritual')||ss.components?.ritual||false;
        const prepared=ss.preparation?.prepared||ss.preparation?.mode==='always'||ss.preparation?.mode==='atwill'||lv===0;
        const canToggle=lv>0&&ss.preparation?.mode!=='always'&&ss.preparation?.mode!=='atwill';
        const tags=[school,actType,range?'射程:'+range:'',dur?'持続:'+dur:'',conc?'集中':'',ritual?'儀式':''].filter(Boolean).join(' · ');
        const idx=items.indexOf(sp);
        h+=`<div class="sp-entry"><span class="prep ${prepared?'':'off'}" ${canToggle?`data-action="toggle-prepared" data-item-idx="${idx}"`:''} ${canToggle?'title="クリックで準備切替"':''}>${prepared?'●':'○'}</span><span class="sn">${tip(sp.name,ss.description?.value)}</span><span class="sd">${tags}</span></div>`;
      }
      h+='</div></details>';
    }
    h+='</div>';
  }

  // Biography
  const bio=det.biography?.value||'';
  const appear=det.appearance||'';
  if(bio||appear){
    h+='<div class="sec"><div class="sec-title">経歴・外見</div>';
    if(appear) h+=`<div style="font-size:13px;color:var(--tm);margin-bottom:8px;white-space:pre-line">${appear}</div>`;
    if(bio) h+=`<div class="bio-ct">${bio}</div>`;
    h+='</div>';
  }

  $('#sheet').innerHTML=h;
  $('#sheet').classList.add('active');
  $('#dropzone').style.display='none';
  $('#exportBtn').style.display='inline-block';

  restoreDetailsState(detState);
  window.scrollTo(0,scrollY);
}

// --- Event Delegation ---
$('#sheet').addEventListener('click',e=>{
  const t=e.target;
  const action=t.dataset?.action;
  if(!action||!currentActor) return;
  const sys=currentActor.system;

  if(action==='toggle-inspiration'){
    const attr=ensurePath(sys,'attributes');
    attr.inspiration=!attr.inspiration;
    markDirty();render(currentActor);
  }

  if(action==='hp-dmg'||action==='hp-heal'){
    const input=document.getElementById('hpDelta');
    const delta=parseInt(input?.value)||0;
    if(delta<=0) return;
    const hp=ensurePath(sys,'attributes','hp');
    const max=hp.max??hp.value??0;
    if(action==='hp-dmg'){
      let dmg=delta;
      // Temp HP absorbs first
      const temp=hp.temp||0;
      if(temp>0){
        const absorbed=Math.min(temp,dmg);
        hp.temp=temp-absorbed;
        dmg-=absorbed;
      }
      hp.value=clamp((hp.value??0)-dmg,0,max);
    }else{
      hp.value=clamp((hp.value??0)+delta,0,max);
    }
    markDirty();render(currentActor);
  }

  if(action==='death-success'){
    const idx=parseInt(t.dataset.idx);
    const death=ensurePath(sys,'attributes','death');
    const cur=death.success||0;
    death.success=(idx<cur)?idx:idx+1;
    markDirty();render(currentActor);
  }
  if(action==='death-failure'){
    const idx=parseInt(t.dataset.idx);
    const death=ensurePath(sys,'attributes','death');
    const cur=death.failure||0;
    death.failure=(idx<cur)?idx:idx+1;
    markDirty();render(currentActor);
  }

  if(action==='hd-use'){
    const ci=parseInt(t.dataset.classIdx);
    const clsItems=(currentActor.items||[]).filter(i=>i.type==='class');
    const c=clsItems[ci];if(!c) return;
    const hd=ensurePath(c,'system','hd');
    const lvl=c.system?.levels||0;
    const spent=hd.spent||0;
    if(spent<lvl){hd.spent=spent+1;markDirty();render(currentActor);}
  }
  if(action==='hd-recover'){
    const ci=parseInt(t.dataset.classIdx);
    const clsItems=(currentActor.items||[]).filter(i=>i.type==='class');
    const c=clsItems[ci];if(!c) return;
    const hd=ensurePath(c,'system','hd');
    if((hd.spent||0)>0){hd.spent=(hd.spent||0)-1;markDirty();render(currentActor);}
  }

  if(action==='toggle-slot'){
    const lv=parseInt(t.dataset.slotLv);
    const idx=parseInt(t.dataset.slotIdx);
    const slots=ensurePath(sys,'spells');
    const key='spell'+lv;
    if(!slots[key]) slots[key]={value:0,override:0};
    const s=slots[key];
    const max=s.override??s.value??0;
    const cur=s.value??0;
    // Click on a filled dot = set value to that index (consume)
    // Click on an empty dot = set value to index+1 (restore)
    if(idx<cur) s.value=idx; else s.value=idx+1;
    s.value=clamp(s.value,0,max);
    markDirty();render(currentActor);
  }

  if(action==='toggle-prepared'){
    const idx=parseInt(t.dataset.itemIdx);
    const item=currentActor.items[idx];if(!item) return;
    const prep=ensurePath(item,'system','preparation');
    prep.prepared=!prep.prepared;
    markDirty();render(currentActor);
  }

  if(action==='toggle-equip'){
    const idx=parseInt(t.dataset.itemIdx);
    const item=currentActor.items[idx];if(!item) return;
    const s=ensurePath(item,'system');
    s.equipped=!s.equipped;
    markDirty();render(currentActor);
  }
});

// +/- button handler
$('#sheet').addEventListener('click',e=>{
  const btn=e.target.closest('[data-nc]');
  if(!btn) return;
  const wrap=btn.closest('.nc');
  const input=wrap?.querySelector('input[type=number]');
  if(!input) return;
  const step=parseInt(btn.dataset.nc)||0;
  const min=input.min!==''?parseInt(input.min):-Infinity;
  const max=input.max!==''?parseInt(input.max):Infinity;
  input.value=clamp((parseInt(input.value)||0)+step,min,max);
  input.dispatchEvent(new Event('change',{bubbles:true}));
});

// Number input changes (HP, temp, quantity, currency, uses)
$('#sheet').addEventListener('change',e=>{
  const t=e.target;
  const action=t.dataset?.action;
  if(!action||!currentActor) return;
  const sys=currentActor.system;
  const val=parseInt(t.value)||0;

  if(action==='set-hp'){
    const hp=ensurePath(sys,'attributes','hp');
    const max=hp.max??hp.value??999;
    hp.value=clamp(val,0,max);
    markDirty();render(currentActor);
  }
  if(action==='set-temp-hp'){
    const hp=ensurePath(sys,'attributes','hp');
    hp.temp=Math.max(0,val);
    markDirty();render(currentActor);
  }
  if(action==='set-quantity'){
    const idx=parseInt(t.dataset.itemIdx);
    const item=currentActor.items[idx];if(!item) return;
    ensurePath(item,'system').quantity=Math.max(0,val);
    markDirty();
  }
  if(action==='set-currency'){
    const coin=t.dataset.coin;
    const cur=ensurePath(sys,'currency');
    cur[coin]=Math.max(0,val);
    markDirty();
  }
  if(action==='set-uses'){
    const idx=parseInt(t.dataset.itemIdx);
    const item=currentActor.items[idx];if(!item) return;
    const uses=ensurePath(item,'system','uses');
    const max=uses.max||0;
    uses.value=clamp(val,0,max);
    markDirty();
  }
});

function markDirty(){
  dirty=true;
  const btn=$('#exportBtn');
  if(btn) btn.textContent='Export JSON *';
}

// --- Export ---
$('#exportBtn').addEventListener('click',()=>{
  if(!currentActor) return;
  const json=JSON.stringify(currentActor,null,2);
  const blob=new Blob([json],{type:'application/json'});
  const url=URL.createObjectURL(blob);
  const a=document.createElement('a');
  a.href=url;
  a.download=(currentActor.name||'character').replace(/[^a-zA-Z0-9_\-\u3000-\u9fff]/g,'_')+'.json';
  a.click();
  URL.revokeObjectURL(url);
  dirty=false;
  $('#exportBtn').textContent='Export JSON';
});

// --- Actor selection ---
function populateSelect(actors){
  const sel=$('#actorSel');
  if(actors.length<=1){sel.style.display='none';return;}
  sel.style.display='inline-block';sel.innerHTML='';
  actors.forEach((a,i)=>{
    const o=document.createElement('option');
    o.value=i;o.textContent=(a.name||'(no name)')+' Lv'+(getLevel(a)||'?');
    sel.appendChild(o);
  });
  sel.onchange=()=>render(actors[+sel.value]);
}

function handleJson(text){
  let data;try{data=JSON.parse(text)}catch(e){alert('JSON解析に失敗');return;}
  currentActors=pickActors(data);
  dirty=false;
  $('#exportBtn').textContent='Export JSON';
  populateSelect(currentActors);
  render(currentActors[0]);
}

function readFile(f){const r=new FileReader();r.onload=e=>handleJson(e.target.result);r.readAsText(f,'utf-8');}

// Drag & drop
const dz=$('#dropzone');
['dragenter','dragover'].forEach(e=>dz.addEventListener(e,ev=>{ev.preventDefault();dz.classList.add('drag')}));
['dragleave','drop'].forEach(e=>dz.addEventListener(e,ev=>{ev.preventDefault();dz.classList.remove('drag')}));
dz.addEventListener('drop',e=>{const f=e.dataTransfer.files?.[0];if(f)readFile(f)});
$('#file').addEventListener('click',function(){this.value=''});
$('#file').addEventListener('change',e=>{const f=e.target.files?.[0];if(f)readFile(f)});

// Demo
$('#demoBtn').addEventListener('click',()=>{
  handleJson(JSON.stringify({
    name:"Melissa the Heretic",type:"character",
    system:{
      details:{level:5,race:"Human",alignment:"Lawful Good",
        trait:"信仰に篤く、困っている人を見過ごせない。",
        ideal:"癒し：傷ついた者を癒すことが自分の使命。",
        bond:"幼い頃に救ってくれた神官への恩義を忘れない。",
        flaw:"頑固で、一度決めたことを曲げようとしない。",
        biography:{value:"<p>元シーク教徒。ヘイヴンの神殿で、シーク教徒が隠していた「異端の力」に触れ、まことのクレリックとなる。</p><p>それが元でシーカー評議会で異端審問にかけられ、辺境の村ソレースに逃げて来たのだが...</p>"},
        appearance:"Gender: Female\nEyes: Dark Blue\nHair: Brown\nHeight: 5'2''"
      },
      abilities:{str:{value:14,mod:2,proficient:0},dex:{value:16,mod:3,proficient:1},con:{value:14,mod:2,proficient:0},int:{value:10,mod:0,proficient:0},wis:{value:18,mod:4,proficient:1},cha:{value:12,mod:1,proficient:0}},
      skills:{prc:{value:1,ability:'wis'},per:{value:1,ability:'cha'},ste:{value:1,ability:'dex'},med:{value:2,ability:'wis'},ins:{value:1,ability:'wis'},rel:{value:1,ability:'int'}},
      attributes:{ac:{value:17},hp:{value:36,max:36,temp:0},prof:3,movement:{walk:30},senses:{darkvision:0},speed:{value:30},
        death:{success:0,failure:0},inspiration:false,spellcasting:'wis'},
      traits:{languages:{value:["Common","Elvish","Dwarvish"]},weaponProf:{value:["sim"]},armorProf:{value:["lgt","med","shl"]}},
      spells:{spell1:{value:4,override:4},spell2:{value:3,override:3},spell3:{value:2,override:2}},
      currency:{pp:2,gp:45,ep:0,sp:12,cp:30},
      resources:{primary:{value:2,max:3,sr:false,lr:true,label:"Channel Divinity"}}
    },
    items:[
      {type:'class',name:'Cleric',system:{levels:5,hd:{denomination:'d8',spent:1},identifier:'cleric',spellcasting:{progression:'full',ability:'wis'}}},
      {type:'subclass',name:'Life Domain',system:{classIdentifier:'cleric'}},
      {type:'race',name:'Human',system:{}},
      {type:'background',name:'Acolyte',system:{}},
      {type:'weapon',name:'Mace',system:{ability:'str',proficient:true,attackBonus:0,damage:{parts:[["1d6+2","bludgeoning"]]},properties:{},description:{value:'A simple melee weapon. 1d6 bludgeoning damage.'}}},
      {type:'weapon',name:'Light Crossbow',system:{ability:'dex',proficient:true,attackBonus:0,damage:{parts:[["1d8+3","piercing"]]},properties:{amm:true,lod:true},description:{value:'A simple ranged weapon. 1d8 piercing damage. Ammunition (range 80/320), loading, two-handed.'}}},
      {type:'equipment',name:'Chain Shirt',system:{quantity:1,equipped:true,armor:{value:13,type:'medium'},description:{value:"Medium armor, AC 13 + DEX (max 2)."}}},
      {type:'equipment',name:'Shield',system:{quantity:1,equipped:true,armor:{value:2,type:'shield'},description:{value:"+2 AC."}}},
      {type:'feat',name:'Channel Divinity',system:{uses:{value:2,max:3},description:{value:'Turn Undead or Preserve Life.'}}},
      {type:'feat',name:'Disciple of Life',system:{description:{value:'Healing spells restore additional HP equal to 2 + spell level.'}}},
      {type:'feat',name:'Blessed Healer',system:{description:{value:'When you cast a healing spell on another, you also regain HP.'}}},
      {type:'consumable',name:'Holy Water',system:{quantity:3,description:{value:'Splash weapon dealing 2d6 radiant to fiends/undead.'}}},
      {type:'tool',name:'Medallion of Mishakal',system:{quantity:1,description:{value:'A blue crystal medallion, holy symbol of Mishakal, goddess of healing.'}}},
      {type:'tool',name:"Priest's Pack",system:{quantity:1,weight:29,description:{value:'Includes a backpack, blanket, candles, tinderbox, alms box, incense, censer, vestments, rations, and a waterskin.'}}},
      {type:'spell',name:'Guidance',system:{level:0,school:'div',activation:{type:'Action',cost:1},range:{value:'Touch'},duration:{value:'1 min'},description:{value:'Add 1d4 to an ability check.'},preparation:{prepared:true}}},
      {type:'spell',name:'Sacred Flame',system:{level:0,school:'evo',activation:{type:'Action',cost:1},range:{value:'60 ft'},duration:{units:'inst'},description:{value:'DEX save or 2d8 radiant damage.'},preparation:{prepared:true}}},
      {type:'spell',name:'Spare the Dying',system:{level:0,school:'nec',activation:{type:'Action',cost:1},range:{value:'Touch'},duration:{units:'inst'},description:{value:'Stabilize a creature at 0 HP.'},preparation:{prepared:true}}},
      {type:'spell',name:'Bless',system:{level:1,school:'enc',activation:{type:'Action',cost:1},range:{value:'30 ft'},duration:{value:'1 min'},description:{value:'Up to 3 creatures add 1d4 to attacks/saves.'},preparation:{prepared:true,mode:'prepared'},properties:{value:['concentration']}}},
      {type:'spell',name:'Cure Wounds',system:{level:1,school:'evo',activation:{type:'Action',cost:1},range:{value:'Touch'},duration:{units:'inst'},description:{value:'Heal 1d8 + WIS mod HP.'},preparation:{prepared:true,mode:'prepared'}}},
      {type:'spell',name:'Shield of Faith',system:{level:1,school:'abj',activation:{type:'Bonus',cost:1},range:{value:'60 ft'},duration:{value:'10 min'},description:{value:'+2 AC to target.'},preparation:{prepared:true,mode:'prepared'},properties:{value:['concentration']}}},
      {type:'spell',name:'Healing Word',system:{level:1,school:'evo',activation:{type:'Bonus',cost:1},range:{value:'60 ft'},duration:{units:'inst'},description:{value:'Heal 1d4 + WIS mod HP as bonus action.'},preparation:{prepared:true,mode:'prepared'}}},
      {type:'spell',name:'Spiritual Weapon',system:{level:2,school:'evo',activation:{type:'Bonus',cost:1},range:{value:'60 ft'},duration:{value:'1 min'},description:{value:'Create spectral weapon. 1d8 + WIS force damage.'},preparation:{prepared:true,mode:'prepared'}}},
      {type:'spell',name:'Lesser Restoration',system:{level:2,school:'abj',activation:{type:'Action',cost:1},range:{value:'Touch'},duration:{units:'inst'},description:{value:'End one disease or condition.'},preparation:{prepared:true,mode:'prepared'}}},
      {type:'spell',name:'Spirit Guardians',system:{level:3,school:'con',activation:{type:'Action',cost:1},range:{value:'Self (15ft)'},duration:{value:'10 min'},description:{value:'Spirits guard you. Enemies take 3d8 radiant.'},preparation:{prepared:true,mode:'prepared'},properties:{value:['concentration']}}},
      {type:'spell',name:'Revivify',system:{level:3,school:'nec',activation:{type:'Action',cost:1},range:{value:'Touch'},duration:{units:'inst'},description:{value:'Return creature dead within 1 minute to life with 1 HP.'},preparation:{prepared:true,mode:'prepared'}}}
    ]
  }));
});

// Warn on unsaved
window.addEventListener('beforeunload',e=>{
  if(dirty){e.preventDefault();e.returnValue='';}
});
// ブラウザの遷移対策
(() => {
  window.addEventListener('beforeunload', (e) => {
    e.preventDefault();
    e.returnValue = '';
  });

  const pushGuard = () => history.pushState({ __guard: true, t: Date.now() }, '', location.href);
  history.replaceState({ __base: true }, '', location.href);
  pushGuard();
  window.addEventListener('pageshow', (e) => {
    if (e.persisted) pushGuard();
  });
  const armWithUserActivation = () => pushGuard();
  window.addEventListener('pointerdown', armWithUserActivation, { once: true, capture: true });
  window.addEventListener('keydown', armWithUserActivation, { once: true, capture: true });
  window.addEventListener('popstate', () => {
    history.go(1);
    setTimeout(pushGuard, 0);
  });

})();
</script>


<deepl-input-controller translate="no"><template shadowrootmode="open"><link rel="stylesheet" href="chrome-extension://cofdbpoegempjloogbagkncekinflcnj/build/content.css"><div dir="ltr" style="visibility: initial !important;"><div class="dl-input-translation-container svelte-95aucy"><div></div></div></div></template></deepl-input-controller></body></html>