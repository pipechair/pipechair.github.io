<!DOCTYPE html>
<!-- saved from url=(0152)file:///F:/SynologyDrive/D&D5e%20%E6%97%A5%E6%9C%AC%E8%AA%9E%E3%83%99%E3%83%BC%E3%82%B7%E3%83%83%E3%82%AF/FVTT%20D&D5e%20Character%20Sheet%20Viewer.html -->
<html lang="ja"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<meta name="viewport" content="width=device-width,initial-scale=1">
<title>FVTT D&amp;D5e Character Sheet Viewer</title>
<style>
:root{--bg:#1a1714;--sf:#242018;--sf2:#2e2820;--bd:#3e362a;--bda:#8b7340;--tx:#e8e2d6;--tm:#9e9486;--td:#6e6458;--ac:#c9a84c;--acd:#7a6630;--red:#c44040;--grn:#48a848;--blu:#5588cc}
*,*::before,*::after{box-sizing:border-box}
html,body{margin:0;height:100%}
body{background:var(--bg);color:var(--tx);font:14px/1.5 'Segoe UI',system-ui,-apple-system,'Hiragino Kaku Gothic ProN',Meiryo,sans-serif}

/* Toolbar */
.toolbar{background:var(--sf);border-bottom:1px solid var(--bd);padding:10px 16px;display:flex;flex-wrap:wrap;gap:8px;align-items:center;position:sticky;top:0;z-index:100;backdrop-filter:blur(6px)}
.toolbar-title{font-size:15px;font-weight:700;color:var(--ac);margin-right:auto}
.btn,input[type=file]{background:var(--sf2);border:1px solid var(--bd);color:var(--tx);padding:6px 12px;border-radius:6px;font-size:13px}
.btn{cursor:pointer;transition:border-color .15s}
.btn:hover{border-color:var(--ac)}
.btn-export{background:#2a3020;border-color:#4a6030;color:#a0d070}
.btn-export:hover{border-color:#80c040}
.btn-restore{background:#302a20;border-color:#605030;color:#d0b070}
.btn-restore:hover{border-color:#a08040}
select.btn{appearance:auto}

/* Autosave toggle */
.autosave-toggle{display:flex;align-items:center;gap:6px;cursor:pointer;user-select:none;font-size:12px;color:var(--tm)}
.autosave-toggle input{display:none}
.autosave-slider{width:36px;height:20px;background:var(--sf2);border:1px solid var(--bd);border-radius:10px;position:relative;transition:background .2s}
.autosave-slider::after{content:'';position:absolute;left:2px;top:2px;width:14px;height:14px;background:var(--td);border-radius:50%;transition:transform .2s,background .2s}
.autosave-toggle input:checked+.autosave-slider{background:var(--acd);border-color:var(--ac)}
.autosave-toggle input:checked+.autosave-slider::after{transform:translateX(16px);background:var(--ac)}
.autosave-label{color:var(--tm)}

.dropzone{border:2px dashed var(--bd);border-radius:12px;padding:24px;text-align:center;color:var(--tm);margin:16px;transition:.2s}
.dropzone.drag{border-color:var(--ac);color:var(--tx);background:rgba(201,168,76,.05)}

/* Sheet */
.sheet{max-width:1120px;margin:0 auto;padding:12px 16px 48px;display:none}
.sheet.active{display:block}

/* Header */
.char-header{text-align:center;padding:20px 0 14px;border-bottom:2px solid var(--bda);margin-bottom:16px}
.char-name{font-size:30px;font-weight:700;letter-spacing:.04em}
.char-sub{font-size:14px;color:var(--tm);margin-top:4px}

/* 3-column body */
.sheet-body{display:grid;grid-template-columns:86px minmax(220px,1fr) minmax(300px,1.4fr);gap:12px;margin-bottom:16px}

/* Ability boxes */
.ab-col{display:flex;flex-direction:column;gap:16px}
.ab-box{position:relative;border:2px solid var(--bda);border-radius:8px;padding:8px 4px 22px;text-align:center;background:var(--sf)}
.ab-lbl{font-size:10px;font-weight:700;text-transform:uppercase;letter-spacing:1.5px;color:var(--ac)}
.ab-score{font-size:26px;font-weight:700;line-height:1.2}
.ab-mod{position:absolute;bottom:-14px;left:50%;transform:translateX(-50%);width:36px;height:28px;display:flex;align-items:center;justify-content:center;border:2px solid var(--bda);border-radius:14px;background:var(--sf);font-size:14px;font-weight:700}

/* Panels */
.panel{background:var(--sf);border:1px solid var(--bd);border-radius:8px;padding:10px 12px}
.panel+.panel{margin-top:10px}
.p-title{font-size:10px;font-weight:700;text-transform:uppercase;letter-spacing:1.5px;color:var(--ac);text-align:center;padding-bottom:5px;border-bottom:1px solid var(--bd);margin-bottom:6px}

/* Prof & Inspiration */
.prof-row{display:flex;gap:8px;margin-bottom:10px}
.prof-box{flex:1;display:flex;align-items:center;gap:8px;background:var(--sf);border:1px solid var(--bd);border-radius:8px;padding:8px 10px}
.prof-box .big{font-size:22px;font-weight:700;color:var(--ac);min-width:34px;text-align:center}
.prof-box .lbl{font-size:10px;text-transform:uppercase;letter-spacing:.8px;color:var(--tm);line-height:1.3}

/* Dot */
.dot{display:inline-block;width:10px;height:10px;border:1.5px solid var(--ac);border-radius:50%;flex-shrink:0;margin-right:5px;vertical-align:middle}
.dot.full{background:var(--ac)}
.dot.half{background:linear-gradient(90deg,var(--ac) 50%,transparent 50%)}
.dot.expert{background:var(--ac);box-shadow:0 0 0 2px var(--sf),0 0 0 3.5px var(--ac)}

/* Save / Skill rows */
.s-row{display:flex;align-items:center;padding:2.5px 0;font-size:13px}
.s-row .bonus{min-width:30px;text-align:right;font-weight:600;margin-right:6px}
.s-row .name{flex:1}
.s-row .abil{font-size:10px;color:var(--td);text-transform:uppercase;margin-left:3px}

/* Passive */
.passive{display:flex;align-items:center;background:var(--sf);border:1px solid var(--bd);border-radius:8px;padding:6px 10px;margin-top:10px}
.passive .big{font-size:20px;font-weight:700;min-width:32px;text-align:center;margin-right:8px}
.passive .lbl{font-size:10px;text-transform:uppercase;letter-spacing:.8px;color:var(--tm)}

/* Combat trio */
.combat-trio{display:flex;gap:8px;margin-bottom:10px}
.c-box{flex:1;text-align:center;border:2px solid var(--bda);border-radius:8px;padding:6px 4px;background:var(--sf)}
.c-box .lbl{font-size:9px;font-weight:700;text-transform:uppercase;letter-spacing:1px;color:var(--ac)}
.c-box .val{font-size:26px;font-weight:700}
.c-box .unit{font-size:11px;color:var(--tm)}

/* HP */
.hp-panel{border:2px solid var(--bda);border-radius:8px;padding:10px;background:var(--sf);margin-bottom:10px}
.hp-row{display:flex;justify-content:center;align-items:center;gap:6px}
.hp-cur{font-size:28px;font-weight:700;width:60px;text-align:center;background:transparent;border:1px solid var(--bd);border-radius:6px;color:var(--tx);font-family:inherit}
.hp-cur:focus{border-color:var(--ac);outline:none}
.hp-sep{color:var(--td);font-size:20px;font-weight:700}
.hp-max{font-size:28px;font-weight:700}
.hp-bar{height:6px;background:var(--sf2);border-radius:3px;overflow:hidden;margin:6px 0}
.hp-bar-fill{height:100%;border-radius:3px;transition:width .3s,background .3s}
.hp-adj{display:flex;justify-content:center;gap:6px;margin-top:6px}
.hp-adj-input{width:50px;text-align:center;background:var(--sf2);border:1px solid var(--bd);border-radius:4px;color:var(--tx);font-size:13px;padding:3px}
.hp-adj-input:focus{border-color:var(--ac);outline:none}
.hp-btn{padding:3px 10px;border-radius:4px;cursor:pointer;font-size:12px;font-weight:700;border:1px solid}
.hp-btn-dmg{background:#3a2020;border-color:#804040;color:#e08080}
.hp-btn-dmg:hover{background:#4a2020;border-color:#c04040}
.hp-btn-heal{background:#203a20;border-color:#408040;color:#80e080}
.hp-btn-heal:hover{background:#204a20;border-color:#40c040}
.hp-temp-row{display:flex;justify-content:center;align-items:center;gap:4px;margin-top:4px;font-size:12px;color:var(--blu)}
.hp-temp-input{width:40px;text-align:center;background:transparent;border:1px solid var(--bd);border-radius:4px;color:var(--blu);font-size:12px;padding:2px;font-family:inherit}
.hp-temp-input:focus{border-color:var(--ac);outline:none}

/* HD & Death */
.hd-death{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-bottom:10px}
.mini-p{background:var(--sf);border:1px solid var(--bd);border-radius:8px;padding:8px;text-align:center}
.mini-p .lbl{font-size:10px;text-transform:uppercase;letter-spacing:1px;color:var(--ac);margin-bottom:3px}
.dd{display:flex;justify-content:center;gap:5px;margin:2px 0}
.dd .d{width:14px;height:14px;border:1.5px solid var(--td);border-radius:50%;cursor:pointer;transition:all .15s}
.dd .d:hover{border-color:var(--ac);transform:scale(1.2)}
.dd .d.ok{background:var(--grn);border-color:var(--grn)}
.dd .d.ng{background:var(--red);border-color:var(--red)}

/* Tables */
.t{width:100%;border-collapse:collapse;font-size:13px}
.t th{font-size:10px;text-transform:uppercase;letter-spacing:1px;color:var(--tm);font-weight:600;text-align:left;padding:4px 6px;border-bottom:1px solid var(--bd)}
.t td{padding:4px 6px;border-bottom:1px solid rgba(62,54,42,.4);vertical-align:top}

/* Hide native number spinner */
input[type=number]::-webkit-inner-spin-button,input[type=number]::-webkit-outer-spin-button{-webkit-appearance:none;margin:0}
input[type=number]{-moz-appearance:textfield}

/* Inline edit inputs */
.e-num{width:42px;text-align:center;background:transparent;border:1px solid var(--bd);border-radius:4px;color:var(--tx);font-size:13px;padding:2px 4px;font-family:inherit}
.e-num:focus{border-color:var(--ac);outline:none}
.e-coin{width:48px;text-align:center;background:transparent;border:1px solid var(--bd);border-radius:4px;font-size:13px;padding:2px 4px;font-family:inherit}
.e-coin:focus{border-color:var(--ac);outline:none}
.coin-pp .e-coin{color:#b0b8cc}
.coin-gp .e-coin{color:#d4a848}
.coin-ep .e-coin{color:#8898a8}
.coin-sp .e-coin{color:#a8b0b8}
.coin-cp .e-coin{color:#b88860}

/* Number control +/- buttons */
.nc{display:inline-flex;align-items:center;gap:2px;vertical-align:middle}
.nc-btn{width:26px;height:26px;display:inline-flex;align-items:center;justify-content:center;border:1px solid var(--bd);border-radius:5px;background:var(--sf2);color:var(--tm);font-size:16px;font-weight:700;cursor:pointer;user-select:none;line-height:1;padding:0;transition:all .12s}
.nc-btn:hover{border-color:var(--ac);color:var(--tx);background:var(--sf)}
.nc-btn:active{transform:scale(.9);background:var(--bda);color:var(--bg)}
.nc .e-num,.nc .e-coin{border-radius:0;border-left:none;border-right:none}
.nc .nc-btn:first-child{border-radius:5px 0 0 5px}
.nc .nc-btn:last-child{border-radius:0 5px 5px 0}

/* Clickable toggles */
.clickable{cursor:pointer;user-select:none;transition:transform .1s}
.clickable:hover{transform:scale(1.15)}
.clickable:active{transform:scale(.95)}

/* Full-width sections */
.sec{background:var(--sf);border:1px solid var(--bd);border-radius:8px;padding:12px 14px;margin-bottom:12px}
.sec-title{font-size:11px;font-weight:700;text-transform:uppercase;letter-spacing:1.5px;color:var(--ac);border-bottom:1px solid var(--bd);padding-bottom:5px;margin-bottom:8px}

/* Personality grid */
.pers-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:12px}
.pers-box{background:var(--sf);border:1px solid var(--bd);border-radius:8px;padding:10px 12px}
.pers-box .lbl{font-size:10px;font-weight:700;text-transform:uppercase;letter-spacing:1px;color:var(--ac);margin-bottom:3px}
.pers-box .ct{font-size:13px;color:var(--tm);line-height:1.5}
.pers-box.clickable{cursor:pointer;transition:border-color .15s}
.pers-box.clickable:hover{border-color:var(--ac);transform:none}

/* Prof & Languages */
.pl-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:10px}
.pl-grp .lbl{font-size:10px;font-weight:700;text-transform:uppercase;color:var(--ac);margin-bottom:3px}
.pl-grp .items{font-size:12px;color:var(--tm)}
.pill{display:inline-block;border:1px solid var(--bd);border-radius:999px;padding:1px 8px;margin:2px 3px 2px 0;font-size:12px}

/* Spells */
.sp-meta{display:flex;flex-wrap:wrap;gap:12px;margin-bottom:8px;font-size:13px}
.sp-meta b{color:var(--tm);font-weight:600}
.sp-slots{display:flex;flex-wrap:wrap;gap:10px;margin-bottom:10px;font-size:12px}
.sl-grp{display:flex;align-items:center;gap:3px}
.sl-grp .lv{font-size:11px;color:var(--tm);min-width:26px}
.sl-d{width:14px;height:14px;border:1.5px solid var(--acd);border-radius:50%;cursor:pointer;transition:all .15s}
.sl-d:hover{border-color:var(--ac);transform:scale(1.2)}
.sl-d.on{background:var(--ac);border-color:var(--ac)}
.sp-lv{border:1px solid var(--bd);border-radius:8px;margin-bottom:6px}
.sp-lv summary{cursor:pointer;padding:6px 10px;font-size:13px;font-weight:600;user-select:none}
.sp-lv summary:hover{color:var(--ac)}
.sp-lv-body{padding:0 10px 8px}
.sp-entry{display:flex;align-items:flex-start;gap:6px;padding:3px 0;font-size:13px;border-bottom:1px solid rgba(62,54,42,.3)}
.sp-entry:last-child{border-bottom:none}
.sp-entry .prep{color:var(--grn);font-size:14px;flex-shrink:0;width:18px;text-align:center;cursor:pointer;user-select:none;transition:transform .1s}
.sp-entry .prep:hover{transform:scale(1.3)}
.sp-entry .prep.off{color:var(--td)}
.sp-entry .sn{font-weight:600;min-width:110px}
.sp-entry .sd{font-size:12px;color:var(--tm);flex:1}

/* Features */
.feat-item{border-bottom:1px solid rgba(62,54,42,.4);padding:5px 0}
.feat-item:last-child{border-bottom:none}
.feat-item .fn{font-weight:600;font-size:13px}
.feat-item .fs{font-size:11px;color:var(--td);margin-left:6px}
.feat-item .fd{font-size:12px;color:var(--tm);margin-top:2px;line-height:1.5}
.feat-uses{display:inline-flex;align-items:center;gap:3px;margin-left:8px;font-size:12px;color:var(--blu)}

/* Currency */
.coins{display:flex;gap:14px;justify-content:center;padding:6px 0;font-size:13px}
.coin{display:flex;align-items:center;gap:3px}
.coin .cl{font-size:11px;font-weight:700;text-transform:uppercase}
.coin-pp .cl{color:#b0b8cc}
.coin-gp .cl{color:#d4a848}
.coin-ep .cl{color:#8898a8}
.coin-sp .cl{color:#a8b0b8}
.coin-cp .cl{color:#b88860}

/* Equipped toggle */
.eq-toggle{cursor:pointer;user-select:none;font-size:14px}
.eq-toggle:hover{filter:brightness(1.3)}

/* Bio */
.bio-ct{font-size:13px;line-height:1.7;color:var(--tm)}
.bio-ct h1,.bio-ct h2,.bio-ct h3{color:var(--tx);margin:10px 0 4px}
.bio-section.clickable{cursor:pointer;transition:border-color .15s}
.bio-section.clickable:hover{border-color:var(--ac);transform:none}

/* Responsive */
@media(max-width:900px){
  .sheet-body{grid-template-columns:1fr}
  .ab-col{flex-direction:row;flex-wrap:wrap;justify-content:center;gap:10px}
  .pers-grid{grid-template-columns:1fr}
  .pl-grid{grid-template-columns:1fr}
}
@media(max-width:600px){
  body{font-size:13px}
  .toolbar{padding:8px 10px;gap:6px}
  .toolbar-title{font-size:13px;width:100%}
  input[type=file]{font-size:11px;max-width:160px;overflow:hidden}
  .btn{padding:5px 8px;font-size:12px}
  .dropzone{margin:8px;padding:16px;font-size:13px}
  .sheet{padding:8px 8px 40px}
  .char-name{font-size:22px}
  .char-sub{font-size:12px}
  .combat-trio{flex-wrap:wrap}
  .c-box{min-width:0}
  .c-box .val{font-size:22px}
  .hp-cur{font-size:22px;width:50px}
  .hp-max{font-size:22px}
  .hp-adj{flex-wrap:wrap;gap:4px}
  .hp-btn{padding:6px 12px;font-size:13px}
  .hd-death{grid-template-columns:1fr}
  .coins{flex-wrap:wrap;gap:8px}
  .coin{gap:2px}
  .nc-btn{width:30px;height:30px;font-size:18px}
  .nc{gap:1px}
  .e-num{width:38px;font-size:12px}
  .e-coin{width:42px;font-size:12px}
  .sp-entry{flex-wrap:wrap}
  .sp-entry .sn{min-width:0}
  .sp-entry .sd{width:100%;padding-left:24px}
  .sp-slots{gap:8px}
  .sec{padding:10px 8px}
  .panel{padding:8px}
  /* Tables scroll horizontally if needed */
  .panel,.sec{overflow-x:auto;-webkit-overflow-scrolling:touch}
  .t{min-width:280px}
  .t th,.t td{padding:4px 4px;font-size:12px}
  .prof-row{flex-wrap:wrap}
  .prof-box{padding:6px 8px}
  .feat-item .fn{font-size:12px}
  .feat-item .fd{font-size:11px}
  .pl-grp{margin-bottom:6px}
}
.text-m{color:var(--tm)}
.text-d{color:var(--td)}
.text-s{font-size:12px}
/* Prevent horizontal overflow */
html{overflow-x:hidden}
.sheet,.sec,.panel{max-width:100%}

/* Item tooltip - clickable for edit */
.tip{position:relative;cursor:pointer;border-bottom:1px dotted var(--td)}
.tip:hover{color:var(--ac)}
.tip .tip-body{display:none;position:absolute;left:0;top:calc(100% + 6px);width:min(360px,85vw);background:var(--sf);border:1px solid var(--bda);border-radius:8px;padding:10px 12px;font-size:12px;line-height:1.6;color:var(--tm);text-align:left;white-space:normal;z-index:200;box-shadow:0 4px 16px rgba(0,0,0,.5);font-weight:400;pointer-events:none}
.tip:hover .tip-body,.tip:focus .tip-body{display:block}

/* Modal */
.modal-overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,.7);z-index:300;align-items:center;justify-content:center;padding:16px}
.modal-overlay.open{display:flex}
.modal{background:var(--sf);border:2px solid var(--bda);border-radius:12px;width:min(600px,95vw);max-height:90vh;display:flex;flex-direction:column;box-shadow:0 8px 32px rgba(0,0,0,.6)}
.modal-header{display:flex;align-items:center;padding:12px 16px;border-bottom:1px solid var(--bd)}
.modal-title{flex:1;font-size:16px;font-weight:700;color:var(--ac)}
.modal-close{background:none;border:none;font-size:24px;color:var(--tm);cursor:pointer;padding:0 4px;line-height:1}
.modal-close:hover{color:var(--tx)}
.modal-body{flex:1;overflow-y:auto;padding:16px}
.modal-footer{display:flex;gap:8px;justify-content:flex-end;padding:12px 16px;border-top:1px solid var(--bd)}
.modal-label{display:block;font-size:12px;color:var(--tm);margin-bottom:4px}
.modal-input{width:100%;background:var(--sf2);border:1px solid var(--bd);border-radius:6px;color:var(--tx);font-size:14px;padding:8px 10px;font-family:inherit;resize:vertical}
.modal-input:focus{border-color:var(--ac);outline:none}
.modal-name{resize:none;overflow:hidden}
.modal-name.multi{min-height:80px;overflow-y:auto;resize:vertical}
.modal-textarea{min-height:200px}
.modal-btn{padding:8px 16px;border-radius:6px;font-size:13px;font-weight:600;cursor:pointer;border:1px solid}
.modal-btn-cancel{background:var(--sf2);border-color:var(--bd);color:var(--tm)}
.modal-btn-cancel:hover{border-color:var(--ac);color:var(--tx)}
.modal-btn-save{background:#2a4020;border-color:#4a8030;color:#a0e070}
.modal-btn-save:hover{background:#304820;border-color:#60a040}
.modal-btn-edit{background:#203040;border-color:#406080;color:#80b0e0}
.modal-btn-edit:hover{background:#284050;border-color:#5080a0}
.modal-btn-edit.active{background:#406080;border-color:#80b0e0}
.modal-btn-revert{background:#402020;border-color:#804040;color:#e0a080}
.modal-btn-revert:hover{background:#503030;border-color:#a06060}

/* Modal view/edit modes */
.modal-view{line-height:1.7;color:var(--tm);font-size:14px;min-height:100px;max-height:400px;overflow-y:auto;padding:12px;background:var(--sf2);border:1px solid var(--bd);border-radius:6px}
.modal-view h1,.modal-view h2,.modal-view h3{color:var(--tx);margin:12px 0 6px;font-size:1.1em}
.modal-view p{margin:8px 0}
.modal-view ul,.modal-view ol{margin:8px 0;padding-left:24px}
.modal-view li{margin:4px 0}
.modal-view strong,.modal-view b{color:var(--tx)}
.modal-view em,.modal-view i{font-style:italic}
.modal-no-desc{color:var(--td);font-style:italic}

/* Footer */
.site-footer{text-align:center;padding:16px;font-size:11px;color:var(--td);border-top:1px solid var(--bd);margin-top:24px}
.mit-tip{position:relative;display:inline;cursor:help;color:var(--tm);text-decoration:underline dotted var(--td);text-underline-offset:2px}
.mit-tip .mit-body{display:none;position:absolute;bottom:calc(100% + 8px);left:50%;transform:translateX(-50%);width:min(480px,90vw);background:var(--sf);border:1px solid var(--bd);border-radius:8px;padding:12px 14px;font-size:11px;line-height:1.6;color:var(--tm);text-align:left;white-space:pre-wrap;z-index:200;box-shadow:0 4px 20px rgba(0,0,0,.5)}
.mit-tip:hover .mit-body,.mit-tip:focus .mit-body{display:block}
</style>
</head>
<body>
<div class="toolbar">
  <span class="toolbar-title">D&amp;D 5e Character Sheet</span>
  <input id="file" type="file" accept=".json,application/json">
  <button class="btn" id="demoBtn">Demo Sample</button>
  <button class="btn btn-export" id="exportBtn" style="display: inline-block;">Export JSON</button>
  <button class="btn btn-restore" id="restoreBtn" style="display:none">復元</button>
  <select id="actorSel" class="btn" style="display:none"></select>
  <label class="autosave-toggle"><input type="checkbox" id="autoSaveChk"><span class="autosave-slider"></span><span class="autosave-label">自動保存</span></label>
  <label class="autosave-toggle"><input type="checkbox" id="editModeChk"><span class="autosave-slider"></span><span class="autosave-label">詳細修正</span></label>
</div>
<div id="dropzone" class="dropzone" style="display: none;">
  JSONファイルをドラッグ＆ドロップ / ファイル選択で読み込み<br>
  <span class="text-s text-m">Foundry VTT D&amp;D5e Actor JSON対応 — すべてローカル処理</span>
</div>
<div id="sheet" class="sheet active"><div class="char-header"><div class="char-name">ヴァネッサ</div><div class="char-sub">クレリック (黄昏の領域) Lv5 · ハーフオーク · 侍祭 · — · 9780 XP</div></div><div class="sheet-body"><div class="ab-col"><div class="ab-box"><div class="ab-lbl">STR</div><div class="ab-score">18</div><div class="ab-mod">+4</div></div><div class="ab-box"><div class="ab-lbl">DEX</div><div class="ab-score">8</div><div class="ab-mod">-1</div></div><div class="ab-box"><div class="ab-lbl">CON</div><div class="ab-score">18</div><div class="ab-mod">+4</div></div><div class="ab-box"><div class="ab-lbl">INT</div><div class="ab-score">8</div><div class="ab-mod">-1</div></div><div class="ab-box"><div class="ab-lbl">WIS</div><div class="ab-score">16</div><div class="ab-mod">+3</div></div><div class="ab-box"><div class="ab-lbl">CHA</div><div class="ab-score">10</div><div class="ab-mod">+0</div></div></div><div><div class="prof-row"><div class="prof-box"><div class="big clickable" data-action="toggle-inspiration">★</div><div class="lbl">Inspiration</div></div><div class="prof-box"><div class="big">+3</div><div class="lbl">習熟ボーナス</div></div></div><div class="panel"><div class="p-title">セーヴィング・スロー</div><div class="s-row"><div class="dot "></div><div class="bonus">+4</div><div class="name">筋力</div></div><div class="s-row"><div class="dot "></div><div class="bonus">-1</div><div class="name">敏捷</div></div><div class="s-row"><div class="dot "></div><div class="bonus">+4</div><div class="name">耐久</div></div><div class="s-row"><div class="dot "></div><div class="bonus">-1</div><div class="name">知力</div></div><div class="s-row"><div class="dot full"></div><div class="bonus">+6</div><div class="name">判断</div></div><div class="s-row"><div class="dot full"></div><div class="bonus">+3</div><div class="name">魅力</div></div></div><div class="panel"><div class="p-title">技能</div><div class="s-row"><div class="dot "></div><div class="bonus">-1</div><div class="name">軽業<span class="abil">dex</span></div></div><div class="s-row"><div class="dot "></div><div class="bonus">+3</div><div class="name">動物使い<span class="abil">wis</span></div></div><div class="s-row"><div class="dot "></div><div class="bonus">-1</div><div class="name">魔法学<span class="abil">int</span></div></div><div class="s-row"><div class="dot "></div><div class="bonus">+4</div><div class="name">運動<span class="abil">str</span></div></div><div class="s-row"><div class="dot "></div><div class="bonus">+0</div><div class="name">ペテン<span class="abil">cha</span></div></div><div class="s-row"><div class="dot full"></div><div class="bonus">+2</div><div class="name">歴史<span class="abil">int</span></div></div><div class="s-row"><div class="dot full"></div><div class="bonus">+6</div><div class="name">看破<span class="abil">wis</span></div></div><div class="s-row"><div class="dot full"></div><div class="bonus">+3</div><div class="name">威圧<span class="abil">cha</span></div></div><div class="s-row"><div class="dot "></div><div class="bonus">-1</div><div class="name">捜査<span class="abil">int</span></div></div><div class="s-row"><div class="dot full"></div><div class="bonus">+6</div><div class="name">医術<span class="abil">wis</span></div></div><div class="s-row"><div class="dot "></div><div class="bonus">-1</div><div class="name">自然<span class="abil">int</span></div></div><div class="s-row"><div class="dot "></div><div class="bonus">+3</div><div class="name">知覚<span class="abil">wis</span></div></div><div class="s-row"><div class="dot "></div><div class="bonus">+0</div><div class="name">芸能<span class="abil">cha</span></div></div><div class="s-row"><div class="dot "></div><div class="bonus">+0</div><div class="name">説得<span class="abil">cha</span></div></div><div class="s-row"><div class="dot full"></div><div class="bonus">+2</div><div class="name">宗教<span class="abil">int</span></div></div><div class="s-row"><div class="dot "></div><div class="bonus">-1</div><div class="name">手先の早業<span class="abil">dex</span></div></div><div class="s-row"><div class="dot "></div><div class="bonus">-1</div><div class="name">隠密<span class="abil">dex</span></div></div><div class="s-row"><div class="dot "></div><div class="bonus">+3</div><div class="name">生存<span class="abil">wis</span></div></div></div><div class="passive"><div class="big">13</div><div class="lbl">受動知覚 (Passive Perception)</div></div></div><div><div class="combat-trio"><div class="c-box"><div class="lbl">AC</div><div class="val">16</div></div><div class="c-box"><div class="lbl">イニシアチブ</div><div class="val">-1</div></div><div class="c-box"><div class="lbl">移動速度</div><div class="val">30</div><div class="unit">ft</div></div></div><div class="hp-panel"><div class="p-title">ヒットポイント</div><div class="hp-row"><span class="nc"><button type="button" class="nc-btn" data-nc="-1">−</button><input type="number" class="hp-cur" data-action="set-hp" value="48" min="0" max="48"><button type="button" class="nc-btn" data-nc="1">+</button></span><span class="hp-sep">/</span><span class="hp-max">48</span></div><div class="hp-bar"><div class="hp-bar-fill" style="width:100%;background:var(--grn)"></div></div><div class="hp-adj"><button class="hp-btn hp-btn-dmg" data-action="hp-dmg">Damage</button><span class="nc"><button type="button" class="nc-btn" data-nc="-1">−</button><input type="number" class="hp-adj-input" id="hpDelta" value="0" min="0"><button type="button" class="nc-btn" data-nc="1">+</button></span><button class="hp-btn hp-btn-heal" data-action="hp-heal">Heal</button></div><div class="hp-temp-row">一時HP: <span class="nc"><button type="button" class="nc-btn" data-nc="-1">−</button><input type="number" class="hp-temp-input" data-action="set-temp-hp" value="0" min="0"><button type="button" class="nc-btn" data-nc="1">+</button></span></div></div><div class="hd-death"><div class="mini-p"><div class="lbl">ヒットダイス</div><div style="margin:3px 0"><span class="text-s">d8</span> <span style="font-weight:700">5</span>/5 <button class="hp-btn hp-btn-dmg" style="font-size:10px;padding:1px 6px" data-action="hd-use" data-class-idx="0">使用</button> <button class="hp-btn hp-btn-heal" style="font-size:10px;padding:1px 6px" data-action="hd-recover" data-class-idx="0">回復</button></div></div><div class="mini-p"><div class="lbl">デス・セーヴ</div><div class="text-s">成功</div><div class="dd"><div class="d " data-action="death-success" data-idx="0"></div><div class="d " data-action="death-success" data-idx="1"></div><div class="d " data-action="death-success" data-idx="2"></div></div><div class="text-s">失敗</div><div class="dd"><div class="d " data-action="death-failure" data-idx="0"></div><div class="d " data-action="death-failure" data-idx="1"></div><div class="d " data-action="death-failure" data-idx="2"></div></div></div></div><div class="panel"><div class="p-title">攻撃</div><table class="t"><thead><tr><th>名称</th><th>攻撃</th><th>ダメージ</th></tr></thead><tbody><tr><td><span class="tip" tabindex="0" data-action="edit-desc" data-item-idx="9">ウォーハンマー<span class="tip-body">片手で持って盾を使用するか、あるいは両手で振り回すか、どちらにしても強力な打撃を与えることができる金属製のハンマー。</span></span></td><td>+7</td><td>—</td></tr><tr><td><span class="tip" tabindex="0" data-action="edit-desc" data-item-idx="26">ライト・クロスボウ<span class="tip-body">木製の柄と交差するように弦が張られた小型の遠隔武器。1本のボルトをその中央から射出し、重い装甲にさえ穴をあける。</span></span></td><td>+2</td><td>—</td></tr><tr><td><span class="tip" tabindex="0" data-action="edit-desc" data-item-idx="44">ハンドアックス +1<span class="tip-body">悪魔の加護、天界の遺物、狂気の実験、熟練の技など、この武器は持ち主にさらなる流血をもたらすよう強化されている。
君はこの魔法の武器で行う攻撃とダメージのロールにボーナスを得ることができる。</span></span></td><td>+8</td><td>— +1</td></tr><tr><td><span class="tip" tabindex="0" data-action="edit-desc" data-item-idx="68">+1 Mace<span class="tip-body">Melee Weapon Attack: [[/r 1d20+5]]{+5} to hit, reach 5 ft., one target. Hit: 6 ([[/damage 1d6 + 3 type=bludgeoning]]) damage.</span></span></td><td>+8</td><td>— +1</td></tr></tbody></table></div><div class="panel"><div class="p-title">装備・所持品</div><table class="t"><thead><tr><th>名称</th><th>種別</th><th>数</th></tr></thead><tbody><tr><td><span class="tip" tabindex="0" data-action="edit-desc" data-item-idx="14">ポーチ<span class="tip-body">布、または革製の小物入れ。スリング･ブリットなら20個、ブロウガン用ニードルなら50本などを入れておくことができる。0.2立方フィート / 6ポンドの物を入れることができる。</span></span></td><td class="text-s text-m">container</td><td><span class="nc"><button type="button" class="nc-btn" data-nc="-1">−</button><input type="number" class="e-num" data-action="set-quantity" data-item-idx="14" value="1" min="0"><button type="button" class="nc-btn" data-nc="1">+</button></span></td></tr><tr><td><span class=" eq-toggle" style="color:var(--grn)" data-action="toggle-equip" data-item-idx="15">◆</span> <span class="tip" tabindex="0" data-action="edit-desc" data-item-idx="15">聖印：アミュレット<span class="tip-body">神をあらわす印を帯びたアミュレットで、忠実な信者は神の力を喚起し、信仰を広めることができる。
呪文の焦点具クレリックやパラディンは聖印を呪文発動焦点具として使用できる。聖印を呪文発動の焦点具として使用するには、術者は聖印を手に持つか、外から明らかに見えるように着用するか、盾の表面に付けていなければならない。</span></span></td><td class="text-s text-m">equipment</td><td><span class="nc"><button type="button" class="nc-btn" data-nc="-1">−</button><input type="number" class="e-num" data-action="set-quantity" data-item-idx="15" value="1" min="0"><button type="button" class="nc-btn" data-nc="1">+</button></span></td></tr><tr><td><span class=" eq-toggle" style="color:var(--grn)" data-action="toggle-equip" data-item-idx="16">◆</span> <span class="tip" tabindex="0" data-action="edit-desc" data-item-idx="16">僧服<span class="tip-body">神官や宗教者が儀式や式典で使用することが多い、シンプルだが仰々しい服装。</span></span></td><td class="text-s text-m">equipment</td><td><span class="nc"><button type="button" class="nc-btn" data-nc="-1">−</button><input type="number" class="e-num" data-action="set-quantity" data-item-idx="16" value="1" min="0"><button type="button" class="nc-btn" data-nc="1">+</button></span></td></tr><tr><td><span class="tip" tabindex="0" data-action="edit-desc" data-item-idx="17">お香<span class="tip-body">富裕層や宗教家が、快楽や儀式のために香りをつけるために頻繁に使用されました。</span></span></td><td class="text-s text-m">loot</td><td><span class="nc"><button type="button" class="nc-btn" data-nc="-1">−</button><input type="number" class="e-num" data-action="set-quantity" data-item-idx="17" value="1" min="0"><button type="button" class="nc-btn" data-nc="1">+</button></span></td></tr><tr><td><span class="tip" tabindex="0" data-action="edit-desc" data-item-idx="18">祈祷書<span class="tip-body">特定の力に捧げる祈りや呪文を記した本で、信者が従うべきもの。</span></span></td><td class="text-s text-m">loot</td><td><span class="nc"><button type="button" class="nc-btn" data-nc="-1">−</button><input type="number" class="e-num" data-action="set-quantity" data-item-idx="18" value="1" min="0"><button type="button" class="nc-btn" data-nc="1">+</button></span></td></tr><tr><td><span class="tip" tabindex="0" data-action="edit-desc" data-item-idx="27">クロスボウ・ボルト<span class="tip-body">この矢はあらゆる種類のクロスボウで使用され、通常は鋭い先端を持った短い金属製のシャフトだ。</span></span></td><td class="text-s text-m">consumable</td><td><span class="nc"><button type="button" class="nc-btn" data-nc="-1">−</button><input type="number" class="e-num" data-action="set-quantity" data-item-idx="27" value="20" min="0"><button type="button" class="nc-btn" data-nc="1">+</button></span></td></tr><tr><td><span class="tip" tabindex="0" data-action="edit-desc" data-item-idx="28">僧侶パック<span class="tip-body">背負い袋には、1立方フィートまたは30ポンドの道具を入れることができます。また、バックパックの外側に、ベッドロールやロープのコイルなどのアイテムをストラップで取り付けることもできます。</span></span></td><td class="text-s text-m">container</td><td><span class="nc"><button type="button" class="nc-btn" data-nc="-1">−</button><input type="number" class="e-num" data-action="set-quantity" data-item-idx="28" value="1" min="0"><button type="button" class="nc-btn" data-nc="1">+</button></span></td></tr><tr><td><span class="tip" tabindex="0" data-action="edit-desc" data-item-idx="29">ほくち箱<span class="tip-body">この小箱の中には、火打ち石と打ち金、ほくちが入っている。君は1回のアクションとして、松明や、その他の引火性の強い可燃物に火を付けることができる。それ以外のものに火を付けるには1分かかる。</span></span></td><td class="text-s text-m">loot</td><td><span class="nc"><button type="button" class="nc-btn" data-nc="-1">−</button><input type="number" class="e-num" data-action="set-quantity" data-item-idx="29" value="1" min="0"><button type="button" class="nc-btn" data-nc="1">+</button></span></td></tr><tr><td><span class="tip" tabindex="0" data-action="edit-desc" data-item-idx="30">水袋<span class="tip-body">4パイント液体を入れることができる。</span></span></td><td class="text-s text-m">consumable</td><td><span class="nc"><button type="button" class="nc-btn" data-nc="-1">−</button><input type="number" class="e-num" data-action="set-quantity" data-item-idx="30" value="1" min="0"><button type="button" class="nc-btn" data-nc="1">+</button></span></td></tr><tr><td><span class="tip" tabindex="0" data-action="edit-desc" data-item-idx="31">寄付金箱<span class="tip-body">主に聖職者が喜捨を集める際に使用する賽銭箱で、台座が取り外し可能である。</span></span></td><td class="text-s text-m">container</td><td><span class="nc"><button type="button" class="nc-btn" data-nc="-1">−</button><input type="number" class="e-num" data-action="set-quantity" data-item-idx="31" value="1" min="0"><button type="button" class="nc-btn" data-nc="1">+</button></span></td></tr><tr><td><span class="tip" tabindex="0" data-action="edit-desc" data-item-idx="32">香炉<span class="tip-body">通常、お香と一緒に使用し、空間に香りを漂らせる。</span></span></td><td class="text-s text-m">loot</td><td><span class="nc"><button type="button" class="nc-btn" data-nc="-1">−</button><input type="number" class="e-num" data-action="set-quantity" data-item-idx="32" value="1" min="0"><button type="button" class="nc-btn" data-nc="1">+</button></span></td></tr><tr><td><span class=" eq-toggle" style="color:var(--td)" data-action="toggle-equip" data-item-idx="33">◇</span> <span class="tip" tabindex="0" data-action="edit-desc" data-item-idx="33">僧服<span class="tip-body">神官や宗教者が儀式や式典で使用することが多い、シンプルだが仰々しい服装。</span></span></td><td class="text-s text-m">equipment</td><td><span class="nc"><button type="button" class="nc-btn" data-nc="-1">−</button><input type="number" class="e-num" data-action="set-quantity" data-item-idx="33" value="1" min="0"><button type="button" class="nc-btn" data-nc="1">+</button></span></td></tr><tr><td><span class="tip" tabindex="0" data-action="edit-desc" data-item-idx="34">ろうそく<span class="tip-body">ろうそくは、半径5フィートまでを明るく照らし、その先5フィートまでを薄暗い明かりで照らす。

ろうそくは1時間、燃え続ける。</span></span></td><td class="text-s text-m">consumable</td><td><span class="nc"><button type="button" class="nc-btn" data-nc="-1">−</button><input type="number" class="e-num" data-action="set-quantity" data-item-idx="34" value="1" min="0"><button type="button" class="nc-btn" data-nc="1">+</button></span></td></tr><tr><td><span class="tip" tabindex="0" data-action="edit-desc" data-item-idx="35">毛布<span class="tip-body">夜を暖かく過ごすための、厚手の毛織物。</span></span></td><td class="text-s text-m">loot</td><td><span class="nc"><button type="button" class="nc-btn" data-nc="-1">−</button><input type="number" class="e-num" data-action="set-quantity" data-item-idx="35" value="1" min="0"><button type="button" class="nc-btn" data-nc="1">+</button></span></td></tr><tr><td><span class="tip" tabindex="0" data-action="edit-desc" data-item-idx="36">お香<span class="tip-body">富裕層や宗教家が、快楽や儀式のために香りをつけるために頻繁に使用されました。</span></span></td><td class="text-s text-m">loot</td><td><span class="nc"><button type="button" class="nc-btn" data-nc="-1">−</button><input type="number" class="e-num" data-action="set-quantity" data-item-idx="36" value="2" min="0"><button type="button" class="nc-btn" data-nc="1">+</button></span></td></tr><tr><td><span class="tip" tabindex="0" data-action="edit-desc" data-item-idx="40">保存食<span class="tip-body">保存食は、主に水気の無い乾物を揃えたもので、長旅に向いた携行食だ。これには堅パンや干し肉、干し果物、ナッツなどが含まれる。</span></span></td><td class="text-s text-m">consumable</td><td><span class="nc"><button type="button" class="nc-btn" data-nc="-1">−</button><input type="number" class="e-num" data-action="set-quantity" data-item-idx="40" value="8" min="0"><button type="button" class="nc-btn" data-nc="1">+</button></span></td></tr><tr><td><span class="tip" tabindex="0" data-action="edit-desc" data-item-idx="45">呪文スクロール: レッサー・レストレーション<span class="tip-body">5レベル &amp;Reference[Spell Scroll], 集中必要射程内にいる､君が見ることのできるクリーチャーを1体選ぶこと。その目標は【判断力】セーヴを行わねばならず､失敗すると持続時間じゅう麻痺状態となる。この呪文はアンデッドには効果がない。目標は自身のターンが終了するたびに､新たに【判断力】セーヴを行うことができる。成功したならば､その目標について､この呪文は終了する。
高レベル発動：君がこの呪文を6レベル以上の呪文スロットを用いて発動する場合､スロットのレベルが5レベルを1上回るごとに追加で1体のクリーチャーを目標とすることができる。それらのクリーチャーは､君が目標に取る時点で互いに30ft​以内にいなければならない。</span></span></td><td class="text-s text-m">consumable</td><td><span class="nc"><button type="button" class="nc-btn" data-nc="-1">−</button><input type="number" class="e-num" data-action="set-quantity" data-item-idx="45" value="1" min="0"><button type="button" class="nc-btn" data-nc="1">+</button></span></td></tr><tr><td><span class="tip" tabindex="0" data-action="edit-desc" data-item-idx="47">呪文スクロール: ブレス<span class="tip-body">5レベル &amp;Reference[Spell Scroll], 集中必要射程内にいる､君が見ることのできるクリーチャーを1体選ぶこと。その目標は【判断力】セーヴを行わねばならず､失敗すると持続時間じゅう麻痺状態となる。この呪文はアンデッドには効果がない。目標は自身のターンが終了するたびに､新たに【判断力】セーヴを行うことができる。成功したならば､その目標について､この呪文は終了する。
高レベル発動：君がこの呪文を6レベル以上の呪文スロットを用いて発動する場合､スロットのレベルが5レベルを1上回るごとに追加で1体のクリーチャーを目標とすることができる。それらのクリーチャーは､君が目標に取る時点で互いに30ft​以内にいなければならない。</span></span></td><td class="text-s text-m">consumable</td><td><span class="nc"><button type="button" class="nc-btn" data-nc="-1">−</button><input type="number" class="e-num" data-action="set-quantity" data-item-idx="47" value="1" min="0"><button type="button" class="nc-btn" data-nc="1">+</button></span></td></tr><tr><td><span class=" eq-toggle" style="color:var(--grn)" data-action="toggle-equip" data-item-idx="49">◆</span> <span class="tip" tabindex="0" data-action="edit-desc" data-item-idx="49">シールド +1<span class="tip-body">この盾を手に持っている間、君はACに+1ボーナスを得る。このボーナスは普通の盾がACに与えるボーナスと累積する。</span></span></td><td class="text-s text-m">equipment</td><td><span class="nc"><button type="button" class="nc-btn" data-nc="-1">−</button><input type="number" class="e-num" data-action="set-quantity" data-item-idx="49" value="1" min="0"><button type="button" class="nc-btn" data-nc="1">+</button></span></td></tr><tr><td><span class="tip" tabindex="0" data-action="edit-desc" data-item-idx="53">クロスボウ・ボルト・ケース<span class="tip-body">クロスボウ・ボルトを最大20本収納できる木製ケースです。</span></span></td><td class="text-s text-m">container</td><td><span class="nc"><button type="button" class="nc-btn" data-nc="-1">−</button><input type="number" class="e-num" data-action="set-quantity" data-item-idx="53" value="1" min="0"><button type="button" class="nc-btn" data-nc="1">+</button></span></td></tr><tr><td><span class="tip" tabindex="0" data-action="edit-desc" data-item-idx="54">ポーション・オヴ・グレーター・ヒーリング<span class="tip-body">ポーションの赤い液体をゆらすと、ほのかな光輝を放つ。
このポーションを飲むことで、4d4 + 4ヒットポイントが回復する。</span></span></td><td class="text-s text-m">consumable</td><td><span class="nc"><button type="button" class="nc-btn" data-nc="-1">−</button><input type="number" class="e-num" data-action="set-quantity" data-item-idx="54" value="1" min="0"><button type="button" class="nc-btn" data-nc="1">+</button></span></td></tr><tr><td><span class=" eq-toggle" style="color:var(--grn)" data-action="toggle-equip" data-item-idx="55">◆</span> <span class="tip" tabindex="0" data-action="edit-desc" data-item-idx="55">アイウーン・ストーン・オヴ・アウェアネス<span class="tip-body">その他の魔法のアイテム（要同調）
アイウーン・ストーンは、一部の世界で崇拝されている知識と予言の神、アイウーンにちなんで名づけられました。アイウーン・ストーンには多くの種類があり、それぞれ形と色の組み合わせが異なる。
アクションを使用してこれらの石を空中に投げると、石は君の頭の周りを1D3フィートの距離で回り、君に利益をもたらす。その後、他のクリーチャーがアクションを使用して石を掴むか網を張って、AC24に対する攻撃ロールに成功するか、DC24の【敏捷力】〈軽業〉判定に成功するかして、君から石を引き離す必要がある。君はアクションを使用して石を掴み、収納し、その効果を終了させることができる。
石はAC24、ヒットポイント10、あらゆるダメージに対する抵抗力を持つ。頭の周りを回っている間は、身に着けている物だとみなされる。
ストーン・オヴ・アウェアネス／警戒の石。この紺色の平行六面体が君の頭の周りを旋回している間、君は不意を討たれない。</span></span></td><td class="text-s text-m">equipment</td><td><span class="nc"><button type="button" class="nc-btn" data-nc="-1">−</button><input type="number" class="e-num" data-action="set-quantity" data-item-idx="55" value="1" min="0"><button type="button" class="nc-btn" data-nc="1">+</button></span></td></tr><tr><td><span class="tip" tabindex="0" data-action="edit-desc" data-item-idx="56">聖水フラスコ<span class="tip-body">君は1回のアクションとして、5フィート以内のクリーチャーに中の聖水を浴びせるか、20フィートまで投擲することができる(衝撃で割れる)。どちらの場合も、聖水のビンを代用武器として扱い、1回の遠隔攻撃として判定する。命中したら、対象がアンデッドまたはフィーンドであるなら2d6[光輝]ダメージを受ける。クレリックとパラディンは、特殊な儀式によって聖水を作ることができる。その儀式には1時間が掛かり、25gp相当の銀の粉末を使用して、1レベルの呪文スロットを1つ消費しなくてはならない。</span></span></td><td class="text-s text-m">consumable</td><td><span class="nc"><button type="button" class="nc-btn" data-nc="-1">−</button><input type="number" class="e-num" data-action="set-quantity" data-item-idx="56" value="1" min="0"><button type="button" class="nc-btn" data-nc="1">+</button></span></td></tr><tr><td><span class="tip" tabindex="0" data-action="edit-desc" data-item-idx="57">0050_ジャスパー(碧玉)<span class="tip-body">(説明なし)</span></span></td><td class="text-s text-m">loot</td><td><span class="nc"><button type="button" class="nc-btn" data-nc="-1">−</button><input type="number" class="e-num" data-action="set-quantity" data-item-idx="57" value="1" min="0"><button type="button" class="nc-btn" data-nc="1">+</button></span></td></tr><tr><td><span class="tip" tabindex="0" data-action="edit-desc" data-item-idx="58">ネックレス・オヴ・ファイアーボールズ／火球の首飾り<span class="tip-body">その他の魔法のアイテム
このネックレスには1d6+3個のビーズがぶら下がっている。アクションでビーズを切り離し、最大60フィート先まで投げることができる。ビーズが軌道の端に達したとき、3レベルの ファイアーボール呪文として爆発する（セーヴ難易度15）。
君は複数のビーズ、あるいはネックレス全体を1回のアクションで投げることができる。その際、最初の珠から1つ増えるごとに ファイアーボールレベルが1上がる。
**Foundry note：9つのチャージはビーズを見つけることができる最大の数を表しています；必要に応じて調整してください。その他の計算式 "ボタンは、追加でビーズを投げたときの追加ダメージを計算するのに使用します。
さらに、残りのビーズの数に応じた価格のガイドを示します。これらの価格はあくまで目安であり、ダンジョンマスターの世界観に合わせ て適宜調整してください。




ビーズの数 ビーズの数

価格(gp)


8
30,720


7
15,360


6
7680


5
3840


4
1600


3
960


2
480


1
300</span></span></td><td class="text-s text-m">consumable</td><td><span class="nc"><button type="button" class="nc-btn" data-nc="-1">−</button><input type="number" class="e-num" data-action="set-quantity" data-item-idx="58" value="1" min="0"><button type="button" class="nc-btn" data-nc="1">+</button></span></td></tr><tr><td><span class=" eq-toggle" style="color:var(--grn)" data-action="toggle-equip" data-item-idx="60">◆</span> <span class="tip" tabindex="0" data-action="edit-desc" data-item-idx="60">チェイン・メイル +1<span class="tip-body">この防具は、しなやかな革と金属製の胸当てで作られている。手足の保護については十分ではないものの、着用者の重要な部位をしっかりと保護しつつ、動きの妨げにはならないよう作られている。
この鎧を着用している間、君はACに+1ボーナスを得る。</span></span></td><td class="text-s text-m">equipment</td><td><span class="nc"><button type="button" class="nc-btn" data-nc="-1">−</button><input type="number" class="e-num" data-action="set-quantity" data-item-idx="60" value="1" min="0"><button type="button" class="nc-btn" data-nc="1">+</button></span></td></tr><tr><td><span class="tip" tabindex="0" data-action="edit-desc" data-item-idx="66">ヘンプロープ（50フィート）<span class="tip-body">ロープはHP2。引きちぎる場合、難易度17【筋力】判定を要する。</span></span></td><td class="text-s text-m">consumable</td><td><span class="nc"><button type="button" class="nc-btn" data-nc="-1">−</button><input type="number" class="e-num" data-action="set-quantity" data-item-idx="66" value="1" min="0"><button type="button" class="nc-btn" data-nc="1">+</button></span></td></tr><tr><td><span class="tip" tabindex="0" data-action="edit-desc" data-item-idx="67">呪文の巻物: プロテクション・フロム・イーヴル・アンド・グッド<span class="tip-body">1レベル &amp;Reference[Spell Scroll], 集中必要この呪文が終了するまで､君が触れた同意するクリーチャー1体は特定の種別 (アンデッド､異形､エレメンタル､セレスチャル､フィーンド､およびフェイ) のクリーチャーから護られる。
この護りは以下のような複数の利益を与える。(1)それらの種別のクリーチャーは目標に対する攻撃ロールに不利を受ける。(2)目標はそれらのクリーチャーによって魅了状態や恐怖状態にされることがなく､憑依もされない。目標がすでにそれらのクリーチャーによって魅了状態や恐怖状態にされているか､憑依されているなら､目標はその効果に対してセーヴを行う際に有利を得る。</span></span></td><td class="text-s text-m">consumable</td><td><span class="nc"><button type="button" class="nc-btn" data-nc="-1">−</button><input type="number" class="e-num" data-action="set-quantity" data-item-idx="67" value="1" min="0"><button type="button" class="nc-btn" data-nc="1">+</button></span></td></tr></tbody></table><div class="coins"><span class="coin coin-pp"><span class="cl">PP</span> <span class="nc"><button type="button" class="nc-btn" data-nc="-1">−</button><input type="number" class="e-coin" data-action="set-currency" data-coin="pp" value="0" min="0"><button type="button" class="nc-btn" data-nc="1">+</button></span></span><span class="coin coin-gp"><span class="cl">GP</span> <span class="nc"><button type="button" class="nc-btn" data-nc="-1">−</button><input type="number" class="e-coin" data-action="set-currency" data-coin="gp" value="18" min="0"><button type="button" class="nc-btn" data-nc="1">+</button></span></span><span class="coin coin-ep"><span class="cl">EP</span> <span class="nc"><button type="button" class="nc-btn" data-nc="-1">−</button><input type="number" class="e-coin" data-action="set-currency" data-coin="ep" value="0" min="0"><button type="button" class="nc-btn" data-nc="1">+</button></span></span><span class="coin coin-sp"><span class="cl">SP</span> <span class="nc"><button type="button" class="nc-btn" data-nc="-1">−</button><input type="number" class="e-coin" data-action="set-currency" data-coin="sp" value="0" min="0"><button type="button" class="nc-btn" data-nc="1">+</button></span></span><span class="coin coin-cp"><span class="cl">CP</span> <span class="nc"><button type="button" class="nc-btn" data-nc="-1">−</button><input type="number" class="e-coin" data-action="set-currency" data-coin="cp" value="0" min="0"><button type="button" class="nc-btn" data-nc="1">+</button></span></span></div></div><div style="font-size:12px;color:var(--tm);text-align:center;margin-top:6px">暗視 300ft</div></div></div><div class="pers-grid"><div class="pers-box clickable" data-action="edit-detail" data-detail-key="trait"><div class="lbl">性格特徴</div><div class="ct"><p><span style="font-family: Meiryo">何者も私の楽天的な態度を揺るがすことはできない</span></p></div></div><div class="pers-box clickable" data-action="edit-detail" data-detail-key="ideal"><div class="lbl">理想</div><div class="ct"><p><span style="font-family: Meiryo">神々は常にこの世に変化をもたらすべく活動しており、我々はそれを手助けせねばならぬ</span></p></div></div><div class="pers-box clickable" data-action="edit-detail" data-detail-key="bond"><div class="lbl">絆</div><div class="ct"><p><span style="font-family: Meiryo">私の行うことはすべて一般庶民のためだ</span></p></div></div><div class="pers-box clickable" data-action="edit-detail" data-detail-key="flaw"><div class="lbl">弱点</div><div class="ct"><p><span style="font-family: Meiryo">いったん目標を定めると、そのことしか考えられなくなり、人生におけるほかのあらゆる事柄を置き捨ててしまう</span></p></div></div></div><div class="sec"><div class="sec-title">習熟・言語</div><div class="pl-grid"><div class="pl-grp"><div class="lbl">言語</div><div class="items"><span class="pill">common</span><span class="pill">orc</span><span class="pill">infernal</span><span class="pill">abyssal</span></div></div><div class="pl-grp"><div class="lbl">武器習熟</div><div class="items"><span class="pill">軍用武器</span><span class="pill">単純武器</span></div></div><div class="pl-grp"><div class="lbl">防具習熟</div><div class="items"><span class="pill">重装鎧</span><span class="pill">軽装鎧</span><span class="pill">中装鎧</span><span class="pill">盾</span></div></div></div></div><div class="sec"><div class="sec-title">特徴・特技</div><div class="feat-item"><span class="fn"><span class="tip" tabindex="0" data-action="edit-desc" data-item-idx="1">呪文発動<span class="tip-body">信仰の力を伝える導管である君は、クレリック呪文を発動できる。
初級呪文
1レベルの時点で、君はクレリック呪文リストから任意の3つの初級呪文を修得している。さらに、レベルアップにともない、『クレリック』表の初級呪文修得数の項にある通り、追加でクレリックの初級呪文を学んでゆく。
呪文の準備と発動
君が1レベル以上の呪文を発動するための呪文スロットをどれだけ有するかは、『クレリック』表に示してある。これらの呪文を1つ発動するには、その呪文のレベル以上のスロットを1つ消費せねばならない。大休憩を終えたなら、君は消費した呪文スロットをすべて回復する。
君は、クレリック呪文リストから“自分が発動可能なクレリック呪文”はどれとどれにするかを選択し、そのリストを作成する(リストにある呪文が、君の準備した呪文になる)。発動可能なものとして選択できるクレリック呪文の数は、(【判断力】修正値+クレリック・レベル)に等しい(最低1種)。また、選択する呪文の呪文レベルは、君が呪文スロットを有する呪文レベルでなければならない。
たとえば君が3レベル・クレリックだったとしよう。君は1レベルの呪文スロットを4つ、2レベルの呪文スロットを2つ有している。【判断力】が16なら、君は1レベル呪文、2レベル呪文あわせて6種類を準備できる(うち、1レベル呪文をいくつ、2レベル呪文をいくつ準備するかは自由である)。1レベル呪文のキュア・ウーンズを準備している場合、君はこれを1レベル・スロットを使って発動することも、2レベル・スロットを使って発動することもできる。呪文を発動しても、その呪文が“いま準備している呪文”のリストから消え去るわけではない。
君は、大休憩を終了するたびに、準備している呪文のリストを変更できる。新しいリストを作成するには、祈りと瞑想に時を過ごす必要がある。リストに含める呪文1つごとに(その呪文の呪文レベル×1分)以上の時間をかけねばならない。
呪文発動能力
君のクレリック呪文発動能力値は【判断力】である。君の魔法の力は神への献身に由来するからである。クレリック呪文に“呪文発動能力値”とある場合、君は常に【判断力】を使う。加えて、君が発動するクレリック呪文のセーヴ難易度を決定する際や、クレリック呪文の攻撃ロールを行なう際にも【判断力】を使う。
呪文のセーヴ難易度=8+君の習熟ボーナス+君の【判断力】修正値
呪文攻撃の修正値&nbsp;=君の習熟ボーナス+君の【判断力】修正値
儀式発動
あるクレリック呪文に(儀式)のタグが付いており、君がその呪文を準備しているなら、君はその呪文を儀式として発動できる。
呪文発動の焦点具
君はクレリック呪文発動の焦点具として聖印 (@UUID[Compendium.dnd5e.rules.JournalEntry.BYFd9hiJGo9L5aOM.JournalEntryPage.AjavRU4yPfI9hfaI] 参照)を使える。</span></span></span><span class="fs">クレリック 1</span><div class="fd">信仰の力を伝える導管である君は、クレリック呪文を発動できる。
初級呪文
1レベルの時点で、君はクレリック呪文リストから任意の3つの初級呪文を修得している。さらに、レベルアップにともない、『クレリック』表の初級呪文修得数の項にある通り、追加でクレリックの初級呪文を学んでゆく。
呪文の準備と発動
君が1レベル以上の呪文を発動するための呪文スロットをどれだけ有するかは、『クレリック』表に示してある。これらの呪文を1つ発動するには、その呪文のレベル以上のスロットを1つ消費せねばならない。大休憩を終えたな…</div></div><div class="feat-item"><span class="fn"><span class="tip" tabindex="0" data-action="edit-desc" data-item-idx="2">信仰の領域<span class="tip-body">君は、君が信仰する神に関係した領域（例えば@UUID[Compendium.dnd5e.subclasses.Item.H3RYLGqCiqm8BP3q]）を1つ選ぶ。1レベルでこの選択をした時点で、君は領域呪文その他の特徴を得る。2レベルで神性伝導を得た時点で、領域に応じた“神性伝導の使い方”を得る。さらに6、8、17レベルで追加の利益を得る。
領域呪文
各領域には領域呪文リストがある。君はこれらの呪文を、各領域の記述にある通りのクレリック・レベルにおいて得る。ひとたび特定の領域呪文を得たなら、君はこれらの呪文を常に準備しており、しかもこれらの呪文は君が呪文をいくつ準備しているのかを数える際には勘定に入れない。
君が本来クレリック呪文リストにない呪文を領域呪文として得ている場合、その呪文は君にとってはクレリック呪文となる。</span></span></span><span class="fs">クレリック 1</span><div class="fd">君は、君が信仰する神に関係した領域（例えば@UUID[Compendium.dnd5e.subclasses.Item.H3RYLGqCiqm8BP3q]）を1つ選ぶ。1レベルでこの選択をした時点で、君は領域呪文その他の特徴を得る。2レベルで神性伝導を得た時点で、領域に応じた“神性伝導の使い方”を得る。さらに6、8、17レベルで追加の利益を得る。
領域呪文
各領域には領域呪文リストがある。君はこれらの呪文を、各領域の記述にある通りのクレリック・レベルにおいて得る。ひとたび特定の領域呪文を得たなら…</div></div><div class="feat-item"><span class="fn"><span class="tip" tabindex="0" data-action="edit-desc" data-item-idx="4">習熟追加(黄昏)<span class="tip-body">君は軍用武器と重装鎧に習熟する。</span></span></span><span class="fs">黄昏の領域 Lv1</span><div class="fd">君は軍用武器と重装鎧に習熟する。</div></div><div class="feat-item"><span class="fn"><span class="tip" tabindex="0" data-action="edit-desc" data-item-idx="5">夜の目<span class="tip-body">君は暗闇の奥底まで見通すとができる。君は暗視300フィートを持つ。すなわち、300フィート以内の“薄暗い”光の範囲内を“明るい”光の範囲内であるかのように見ることができ、暗闇の範囲内を“薄暗い”光の範囲内であるかのように見ることができる。　君は1回のアクションとして、君が見ることのできる、10フィート以内の、最大で君の【判断力】修正値に等しい数(最低1体)の、同意するクリーチャーたちに、この特徴による暗視を魔法的に分け与えることができる。こうして分け与えた暗視は1時間持続する。暗視を分け与えるこの能力は、1度使用すると、君が大休憩を終えるまで再使用できない。ただし、この特徴を再使用するために任意のレベルの呪文スロットを1つ消費することで、再使用できる。</span></span></span><span class="feat-uses">(<span class="nc"><button type="button" class="nc-btn" data-nc="-1">−</button><input type="number" class="e-num" style="width:32px" data-action="set-uses" data-item-idx="5" value="0" min="0" max="1"><button type="button" class="nc-btn" data-nc="1">+</button></span> / 1)</span><span class="fs">黄昏の領域 Lv1</span><div class="fd">君は暗闇の奥底まで見通すとができる。君は暗視300フィートを持つ。すなわち、300フィート以内の“薄暗い”光の範囲内を“明るい”光の範囲内であるかのように見ることができ、暗闇の範囲内を“薄暗い”光の範囲内であるかのように見ることができる。　君は1回のアクションとして、君が見ることのできる、10フィート以内の、最大で君の【判断力】修正値に等しい数(最低1体)の、同意するクリーチャーたちに、この特徴による暗視を魔法的に分け与えることができる。こうして分け与えた暗視は1時間持続する。暗視を分け与えるこ…</div></div><div class="feat-item"><span class="fn"><span class="tip" tabindex="0" data-action="edit-desc" data-item-idx="6">用心の祝福<span class="tip-body">君は夜から用心深さを教わった。君は1回のアクションとして1体のクリーチャー（君自身も可）に触れ、そのクリーチャーが次に行なう1回のイニシアチプ判定に有利を与えることができる。この利益は、そのクリーチャーがイニシアチブをロールするか、君がこの特徴を再使用した時点で、即座に終了する。</span></span></span><span class="fs">黄昏の領域 Lv1</span><div class="fd">君は夜から用心深さを教わった。君は1回のアクションとして1体のクリーチャー（君自身も可）に触れ、そのクリーチャーが次に行なう1回のイニシアチプ判定に有利を与えることができる。この利益は、そのクリーチャーがイニシアチブをロールするか、君がこの特徴を再使用した時点で、即座に終了する。</div></div><div class="feat-item"><span class="fn"><span class="tip" tabindex="0" data-action="edit-desc" data-item-idx="11">ハーフオークのしぶとさ<span class="tip-body">君のヒット・ポイントが0になり、しかも君が即死しないなら、君のヒット・ポイントは0ではなく1になる。君はこの特徴を1度使用したなら、大休憩を終えるまでは、再び使用できない。</span></span></span><span class="feat-uses">(<span class="nc"><button type="button" class="nc-btn" data-nc="-1">−</button><input type="number" class="e-num" style="width:32px" data-action="set-uses" data-item-idx="11" value="0" min="0" max="1"><button type="button" class="nc-btn" data-nc="1">+</button></span> / 1)</span><span class="fs">ハーフオーク</span><div class="fd">君のヒット・ポイントが0になり、しかも君が即死しないなら、君のヒット・ポイントは0ではなく1になる。君はこの特徴を1度使用したなら、大休憩を終えるまでは、再び使用できない。</div></div><div class="feat-item"><span class="fn"><span class="tip" tabindex="0" data-action="edit-desc" data-item-idx="12">猛打<span class="tip-body">近接武器攻撃でクリティカル・ヒットを与えたなら、君はその武器のダメージ・ダイスのうち1つをもう1度ロールして、その結果をクリティカル・ヒットの追加ダメージに加えることができる。
注意： この特徴は例外的特性から追加のクリティカルダイスの数を増やすことで対応してください。</span></span></span><span class="fs">ハーフオーク</span><div class="fd">近接武器攻撃でクリティカル・ヒットを与えたなら、君はその武器のダメージ・ダイスのうち1つをもう1度ロールして、その結果をクリティカル・ヒットの追加ダメージに加えることができる。
注意： この特徴は例外的特性から追加のクリティカルダイスの数を増やすことで対応してください。</div></div><div class="feat-item"><span class="fn"><span class="tip" tabindex="0" data-action="edit-desc" data-item-idx="19">信仰あつき者の保護<span class="tip-body">侍祭である君は自身と信仰を同じくする人々からの尊敬を集めており、自身の奉じる神格のための宗教的儀式を執り行なうことができる。　君と君の冒険仲間は、君の奉じる神格の“寺院、社、その他の施設”において、無料で治療や世話をうけられるが、呪文に必要な物質要素はすべて君が提供しなければならない。君と信仰を共有する人物はみな、君を助けて生活レベル“質素”相当の生活をさせてくれる（ただし、君だけだ。君の仲間は含まない） 。　君は君が信仰する神格あるいはパンテオンにささげられた寺院のうち、特定のひとつと結びつきを持っており、そこに自分の部屋を持っている。君がこれまで仕えていた寺院と良好な関係を保っているならその寺院が“特に結びつきのある寺院”となってもよいし、君が新たな“ホーム”として見出した寺院がその種の寺院となるのでもよい。君は自身の寺院の近くにいるのならそこの司祭たちに手伝いを頼むことができる。この場合、この“手伝い’'は危険を伴わないものでなければならず、また、君は自身の寺院と良好な関係を保っていなければならない。</span></span></span><span class="fs">侍祭</span><div class="fd">侍祭である君は自身と信仰を同じくする人々からの尊敬を集めており、自身の奉じる神格のための宗教的儀式を執り行なうことができる。　君と君の冒険仲間は、君の奉じる神格の“寺院、社、その他の施設”において、無料で治療や世話をうけられるが、呪文に必要な物質要素はすべて君が提供しなければならない。君と信仰を共有する人物はみな、君を助けて生活レベル“質素”相当の生活をさせてくれる（ただし、君だけだ。君の仲間は含まない） 。　君は君が信仰する神格あるいはパンテオンにささげられた寺院のうち、特定のひとつと結びつき…</div></div><div class="feat-item"><span class="fn"><span class="tip" tabindex="0" data-action="edit-desc" data-item-idx="37">神性伝導<span class="tip-body">2レベルの時点で、君は神から信仰のエネルギーを直接授かり、これを放って魔法効果を生み出すことができるようになる。最初は2つの効果をあらわすことができる。ひとつは“アンデッド退散”であり、もうひとつは領域によって決まる。一部の領域においては、レベルアップに従って新しく追加の効果が得られることがある(各領域の記述を参照)。神性伝導を用いるさい、いずれの効果を生み出すかは君が選択する。ひとたび神性伝導を使用したなら、以後小休憩または大休憩を終了するまでは、神性伝導は使用できなくなる。神性伝導の効果の中にはセーヴィング・スローを要求するものがある。クレリックのクラスに由来するこのような効果を用いる場合、そのセーヴ難易度は、君のクレリック呪文のセーヴ難易度に等しい。6レベル以降、君は休憩と休憩の間に神性伝導を2回まで使用できるようになる。18レベル以降、休憩と休憩の間に3回まで使用できるようになる。小休憩または大休憩を終えるたび、消費した使用回数はすべて回復する。Foundryノートクレリックが神性伝導を使用した際に、使用状況を記録する。</span></span></span><span class="feat-uses">(<span class="nc"><button type="button" class="nc-btn" data-nc="-1">−</button><input type="number" class="e-num" style="width:32px" data-action="set-uses" data-item-idx="37" value="0" min="0" max="@scale.cleric.channel-divinity"><button type="button" class="nc-btn" data-nc="1">+</button></span> / @scale.cleric.channel-divinity)</span><span class="fs">クレリック 2</span><div class="fd">2レベルの時点で、君は神から信仰のエネルギーを直接授かり、これを放って魔法効果を生み出すことができるようになる。最初は2つの効果をあらわすことができる。ひとつは“アンデッド退散”であり、もうひとつは領域によって決まる。一部の領域においては、レベルアップに従って新しく追加の効果が得られることがある(各領域の記述を参照)。神性伝導を用いるさい、いずれの効果を生み出すかは君が選択する。ひとたび神性伝導を使用したなら、以後小休憩または大休憩を終了するまでは、神性伝導は使用できなくなる。神性伝導の効果の中…</div></div><div class="feat-item"><span class="fn"><span class="tip" tabindex="0" data-action="edit-desc" data-item-idx="38">神性伝導：アンデッド退散<span class="tip-body">君は1回のアクションとして、聖印をかざしてアンデッドを叱責する祈りを口にする。君から30フィート以内におり、君の姿を見るか声を聞くことのできるアンデッドはみな、【判断力】セーヴィング・スローを行なわねばならない。セーヴに失敗したクリーチャーは、1分間が経過するかダメージを受けるまで“退散"する。退散中のクリーチャーは、自分のターンを、できるだけ君から遠くへ移動することに費やさねばならず、また自ら進んで君から30フィート以内の場所へ移動することは不可能であり、リアクションをとることもできない。そのクリーチャーはアクションとしては早足アクションか、自分の移動を妨げる効果を脱しようとするためのアクションしか使用できない。ただし、どこへも移動できない場合に限り、回避アクションも使用可能である。</span></span></span><span class="fs">feat</span><div class="fd">君は1回のアクションとして、聖印をかざしてアンデッドを叱責する祈りを口にする。君から30フィート以内におり、君の姿を見るか声を聞くことのできるアンデッドはみな、【判断力】セーヴィング・スローを行なわねばならない。セーヴに失敗したクリーチャーは、1分間が経過するかダメージを受けるまで“退散"する。退散中のクリーチャーは、自分のターンを、できるだけ君から遠くへ移動することに費やさねばならず、また自ら進んで君から30フィート以内の場所へ移動することは不可能であり、リアクションをとることもできない。その…</div></div><div class="feat-item"><span class="fn"><span class="tip" tabindex="0" data-action="edit-desc" data-item-idx="39">神性伝導：黄昏の聖域<span class="tip-body">君は神性伝導を使うことで、心安らぐ黄昏によって仲間たちをリフレッシュさせることができる。　君が1回のアクションとして聖印をかかげると、君から黄昏の球体が広がる。この球体の中心は君であり、半径は30フィート、内部は“薄暗い”光に包まれる。この球体は君と一緒に移動し、1分たつか、君が@Compendium[completecompendium.betterconditions.無力状態]になるか、君が死ぬまで、持続する。クリーチャー（君自身を含む）がこの球体内でターンを終了するたび、君はそのクリーチャーに以下の利益のいずれかを与えることができる：([[/r 1d6]]+君のクレリック・レベル)に等しい一時的ヒット・ポイント。そのクリーチャーを@Compendium[completecompendium.betterconditions.恐怖状態]または@Compendium[completecompendium.betterconditions.魅了状態]にしている効果1つが終了する。</span></span></span><span class="fs">黄昏の領域 Lv2</span><div class="fd">君は神性伝導を使うことで、心安らぐ黄昏によって仲間たちをリフレッシュさせることができる。　君が1回のアクションとして聖印をかかげると、君から黄昏の球体が広がる。この球体の中心は君であり、半径は30フィート、内部は“薄暗い”光に包まれる。この球体は君と一緒に移動し、1分たつか、君が@Compendium[completecompendium.betterconditions.無力状態]になるか、君が死ぬまで、持続する。クリーチャー（君自身を含む）がこの球体内でターンを終了するたび、君はそのクリーチ…</div></div><div class="feat-item"><span class="fn"><span class="tip" tabindex="0" data-action="edit-desc" data-item-idx="61">アンデッド破壊<span class="tip-body">5レベル以降、君の“アンデッド退散”に対するセーヴに失敗したアンデッドは、『アンデッド破壊』表に記された脅威度の値以下であるなら即座に破壊される。



クレリック・レベル
破壊されるアンデッドの脅威度


5th
1/2以下


8th
1以下


11th
2以下


14th
3以下


17th
4以下</span></span></span><span class="fs">クレリック 5</span><div class="fd">5レベル以降、君の“アンデッド退散”に対するセーヴに失敗したアンデッドは、『アンデッド破壊』表に記された脅威度の値以下であるなら即座に破壊される。



クレリック・レベル
破壊されるアンデッドの脅威度


5th
1/2以下


8th
1以下


11th
2以下


14th
3以下


17th
4以下</div></div></div><div class="sec"><div class="sec-title">呪文</div><div class="sp-meta"><div><b>呪文発動能力:</b> 判断</div><div><b>呪文セーヴDC:</b> 14</div><div><b>呪文攻撃:</b> +6</div></div><div class="sp-slots"><div class="sl-grp"><span class="lv">1lv</span><div class="sl-d on" data-action="toggle-slot" data-slot-lv="1" data-slot-idx="0"></div><div class="sl-d on" data-action="toggle-slot" data-slot-lv="1" data-slot-idx="1"></div><div class="sl-d on" data-action="toggle-slot" data-slot-lv="1" data-slot-idx="2"></div><div class="sl-d on" data-action="toggle-slot" data-slot-lv="1" data-slot-idx="3"></div></div><div class="sl-grp"><span class="lv">2lv</span><div class="sl-d on" data-action="toggle-slot" data-slot-lv="2" data-slot-idx="0"></div><div class="sl-d on" data-action="toggle-slot" data-slot-lv="2" data-slot-idx="1"></div><div class="sl-d on" data-action="toggle-slot" data-slot-lv="2" data-slot-idx="2"></div></div><div class="sl-grp"><span class="lv">3lv</span><div class="sl-d on" data-action="toggle-slot" data-slot-lv="3" data-slot-idx="0"></div><div class="sl-d on" data-action="toggle-slot" data-slot-lv="3" data-slot-idx="1"></div></div></div><details class="sp-lv" open=""><summary>キャントリップ (4)</summary><div class="sp-lv-body"><div class="sp-entry"><span class="prep ">●</span><span class="sn"><span class="tip" tabindex="0" data-action="edit-desc" data-item-idx="20">セイクリッド・フレイム<span class="tip-body">射程内の君が見ることができるクリーチャー1体に対し､天から炎のような輝きが降り注ぐ。目標は【敏捷力】セーヴィング・スローを行わねばならず､失敗すると1d8の [光輝] ダメージを受ける。目標はこのセーヴィング・スローに対しては遮蔽から利益を得ることができない。
この呪文のダメージは君のレベルが特定の値に上昇するごとに1d8ずつ増加する､すなわち5レベルで2d8､11レベルで3d8､17レベルで4d8である。</span></span></span><span class="sd">力術 · action · 射程:60</span></div><div class="sp-entry"><span class="prep ">●</span><span class="sn"><span class="tip" tabindex="0" data-action="edit-desc" data-item-idx="21">ガイダンス<span class="tip-body">1体の同意するクリーチャーに接触する。呪文が終了する前に1回､目標は自身が選んだ1回の能力値判定に対し､1d4をロールして出た目を加算することができる。このダイスをロールするかどうかの選択は､能力値判定を行う前でも後でも良い。1d4をロールした時点でこの呪文は終了する。</span></span></span><span class="sd">占術 · action · 射程:[object Object] · 持続:1</span></div><div class="sp-entry"><span class="prep ">●</span><span class="sn"><span class="tip" tabindex="0" data-action="edit-desc" data-item-idx="22">スペア・ザ・ダイイング<span class="tip-body">君はヒット・ポイントが0になっている､生きているクリーチャー1体に接触する。そのクリーチャーは容体安定化する。この呪文はアンデッドや人造クリーチャーにはなんの効果ももたらさない。</span></span></span><span class="sd">死霊 · action · 射程:[object Object]</span></div><div class="sp-entry"><span class="prep ">●</span><span class="sn"><span class="tip" tabindex="0" data-action="edit-desc" data-item-idx="51">ライト<span class="tip-body">1つの物体に接触する。その物体は差し渡し、奥行き、高さいずれも10フィート以内でなければならない。呪文が終了するまで、その物体は半径20フィートまでを“明るい”明るさに、そこからさらに20フィートを“薄暗い”明るさに照らす。この光には君が望む色を付けることができる。なにか不透明なものでこの物体を完全に覆ったなら、明かりは遮断されてしまう。君が再度この呪文を発動するか、1回のアクションとして消した時点で、この呪文は終了する。敵対するクリーチャーが手に持っている物体や、着用している物体を目標にする時には、そのクリーチャーはこの呪文を避けたければ【敏捷カ】セーヴィング・スローを行なわなければならない。</span></span></span><span class="sd">力術 · action · 射程:[object Object] · 持続:1</span></div></div></details><details class="sp-lv" open=""><summary>Lv1 (8)</summary><div class="sp-lv-body"><div class="sp-entry"><span class="prep off" data-action="toggle-prepared" data-item-idx="7" title="クリックで準備切替">○</span><span class="sn"><span class="tip" tabindex="0" data-action="edit-desc" data-item-idx="7">スリープ<span class="tip-body">この呪文はクリーチャーを魔法の眠りへといざなう。[[/r 5d8]]をロールすること。その合計値がこの呪文が作用するクリーチャーのヒット・ポイントの総計となる。射程内の君が選択した1点から20フィート以内にいるクリーチャーは、その現在ヒット・ポイントの低い順からこの呪文の作用を受ける（@Compendium[completecompendium.betterconditions.S499QUmXTVx81wk8]{気絶状態}のクリーチャーは無視すること）。
現在ヒット・ポイントが最も低いクリーチャーから順に、“作用するクリーチャーのヒット・ポイントの合計値”(=5d8の合計値)から作用を受けたクリーチャーのヒット・ポイントを差し引いてゆき、現在ヒット・ポイントが次に低いクリーチャーに移っていく。あるクリーチャーに作用を及ぼすためには、残りの“合計値”がそのクリーチャーの現在ヒット・ポイントよりも多くなければならない。この呪文の作用を受けたクリーチャーはみな眠ってしまい、この呪文が終了するか、寝ている者がダメージを受けるか、あるいは誰かがアクションを使って寝ている者を起こすために揺り動かしたり引っ叩いたりするまで、@Compendium[completecompendium.betterconditions.S499QUmXTVx81wk8]{気絶状態}に陥る。
アンデッド、および@Compendium[completecompendium.betterconditions.UWlXFfSX95JVWrYs]{魅了状態}に完全耐性を持つクリーチャーはこの呪文の作用を受けない。



高レベル版：君がこの呪文を2レベル以上の呪文スロットを用いて発動する場合、スロットのレベルが1レベルを1上回るごとに[[/r 2d8]]を追加でロールする。</span></span></span><span class="sd">心術 · action · 射程:90 · 持続:1</span></div><div class="sp-entry"><span class="prep off" data-action="toggle-prepared" data-item-idx="8" title="クリックで準備切替">○</span><span class="sn"><span class="tip" tabindex="0" data-action="edit-desc" data-item-idx="8">フェアリー・ファイアー<span class="tip-body">射程内の1辺が20フィートの立方体の中にある物体はみな、青、緑または紫色の光で縁取られる（色は君が選択する）。呪文の効果範囲の中にいるすべてのクリーチャーもまた、【敏捷力】セーヴィング・スローに失敗したなら、この光で縁取られる。持続時間の間、物体及びこの呪文の作用を受けたクリーチャーは半径10フィートに“薄暗い”明かりを放つ。　作用を受けたクリーチャーあるいは物体に対する攻撃ロールは、攻撃を行なう者がその光を見ることができるなら、有利を得る。また、作用を受けたクリーチャーと物体は@Compendium[completecompendium.betterconditions.pSvtps6WHVAuWh9l]{不可視状態}であることによる利益を得られない。</span></span></span><span class="sd">力術 · action · 射程:60 · 持続:1</span></div><div class="sp-entry"><span class="prep off" data-action="toggle-prepared" data-item-idx="23" title="クリックで準備切替">○</span><span class="sn"><span class="tip" tabindex="0" data-action="edit-desc" data-item-idx="23">ブレス<span class="tip-body">射程内にいる3体までのクリーチャーを選択し、祝福を与える。呪文が終了するまで、目標は攻撃ロールまたはセーヴィング・スローを行う時には常に、1d4をロールして、その結果を攻撃ロールまたはセーヴィング・スローの結果に加算できる。
高レベル発動：君がこの呪文を2レベル以上の呪文スロットを用いて発動する場合、スロットのレベルが1レベルを1上回るごとに追加で1体のクリーチャーを目標とすることができる。</span></span></span><span class="sd">心術 · action · 射程:30 · 持続:1</span></div><div class="sp-entry"><span class="prep off" data-action="toggle-prepared" data-item-idx="24" title="クリックで準備切替">○</span><span class="sn"><span class="tip" tabindex="0" data-action="edit-desc" data-item-idx="24">ヒーリング・ワード<span class="tip-body">射程内にいて､君が見ることのできるクリーチャー1体を選ぶ。そのクリーチャーは(1d4+君の呪文発動能力修正値) に等しいヒット・ポイントを回復する。この呪文はアンデッドや人造クリーチャーにはなんの効果ももたらさない。
高レベル発動：君がこの呪文を2レベル以上の呪文スロットを用いて発動する場合､スロットのレベルが1レベルを1上回るごとに回復量が1d4増加する。</span></span></span><span class="sd">力術 · bonus · 射程:60</span></div><div class="sp-entry"><span class="prep off" data-action="toggle-prepared" data-item-idx="25" title="クリックで準備切替">○</span><span class="sn"><span class="tip" tabindex="0" data-action="edit-desc" data-item-idx="25">キュア・ウーンズ<span class="tip-body">君が接触したクリーチャー1体は(1d8+君の呪文発動能力修正値) に等しいヒット・ポイントを回復する。この呪文はアンデッドや人造クリーチャーにはなんの効果ももたらさない。
高レベル発動：君がこの呪文を2レベル以上の呪文スロットを用いて発動する場合､スロットのレベルが1レベルを1上回るごとに回復量が1d8増加する。</span></span></span><span class="sd">力術 · action · 射程:[object Object]</span></div><div class="sp-entry"><span class="prep off" data-action="toggle-prepared" data-item-idx="43" title="クリックで準備切替">○</span><span class="sn"><span class="tip" tabindex="0" data-action="edit-desc" data-item-idx="43">サンクチュアリ<span class="tip-body">君は射程内のクリーチャー1体を攻撃から守る。この呪文が終了するまで､この守られたクリーチャーを攻撃や有害な呪文の目標とする者は誰でも､まず【判断力】セーヴィング･スローを行なわなければならない。セーヴに失敗すると､そのクリーチャーは新しい目標を選び直さなければならず､それができないならばその攻撃や呪文はむだになる。この呪文は対象クリーチャーを､ファイアーボールの爆発などの範囲に及ぶ効果から守る事はできない。この呪文で守られているクリーチャーが攻撃を行なったり､敵のクリーチャーに作用する呪文を発動したりすると､この呪文は終了する。</span></span></span><span class="sd">防御 · bonus · 射程:30 · 持続:1</span></div><div class="sp-entry"><span class="prep off" data-action="toggle-prepared" data-item-idx="48" title="クリックで準備切替">○</span><span class="sn"><span class="tip" tabindex="0" data-action="edit-desc" data-item-idx="48">ブレス<span class="tip-body">射程内にいる3体までのクリーチャーを選択し、祝福を与える。呪文が終了するまで、目標は攻撃ロールまたはセーヴィング・スローを行う時には常に、1d4をロールして、その結果を攻撃ロールまたはセーヴィング・スローの結果に加算できる。
高レベル発動：君がこの呪文を2レベル以上の呪文スロットを用いて発動する場合、スロットのレベルが1レベルを1上回るごとに追加で1体のクリーチャーを目標とすることができる。</span></span></span><span class="sd">心術 · action · 射程:30 · 持続:1</span></div><div class="sp-entry"><span class="prep off" data-action="toggle-prepared" data-item-idx="50" title="クリックで準備切替">○</span><span class="sn"><span class="tip" tabindex="0" data-action="edit-desc" data-item-idx="50">ガイディング・ボルト<span class="tip-body">射程内の君が選んだクリーチャーに向かって、閃光が伸びる。1体の目標に対して遠隔呪文攻撃を行なうこと。ヒットしたなら、目標は[[/r 4d6]]の［光輝］ダメージを受け、さらに次の君のターン終了時までに行なわれる、この目標に対する次の1回の攻撃ロールは有利を得る。神秘的な薄暗い光が目標のまわりできらめき、導いてくれるからだ。


 高レベル版：君がこの呪文を2レベル以上の呪文スロットを用いて発動する場合、スロットのレベルが1レベルを1上回るごとにダメージが[[/r 1d6]]増加する。</span></span></span><span class="sd">力術 · action · 射程:120 · 持続:1</span></div></div></details><details class="sp-lv"><summary>Lv2 (5)</summary><div class="sp-lv-body"><div class="sp-entry"><span class="prep off" data-action="toggle-prepared" data-item-idx="41" title="クリックで準備切替">○</span><span class="sn"><span class="tip" tabindex="0" data-action="edit-desc" data-item-idx="41">シー・インヴィジビリティ<span class="tip-body">持続時間中、君は不可視のクリーチャーや物体を可視であるかのように見ることができ、またエーテル界も覗き見ることができる。エーテル界のクリーチャーや物体は半透明の幽霊じみた姿に見える。</span></span></span><span class="sd">占術 · action · 射程:[object Object] · 持続:1</span></div><div class="sp-entry"><span class="prep off" data-action="toggle-prepared" data-item-idx="42" title="クリックで準備切替">○</span><span class="sn"><span class="tip" tabindex="0" data-action="edit-desc" data-item-idx="42">ムーンビーム<span class="tip-body">射程内の一点を中心とした半径5フィート高さ40フィートの円筒形の範囲に、淡い銀色の光線が降り注ぐ。この呪文が終了するまで、この円筒内は“薄暗い”明るさの光に満たされる。
クリーチャーがこの呪文の範囲に入った時、この範囲に入るのがそのターン中で初めてなら、そのクリーチャーはおぼろげな炎に包まれて焼けつくような痛みを覚え、【耐久力】セーヴを行なわねばならない。この範囲内でターンを開始したクリーチャーも同じセーヴを行なう。このセーヴに失敗したクリーチャーは[[/r 2d10]]［光輝］ダメージを受ける（成功した者は半分のダメージ） 。
変身生物はこのセーヴに不利を受ける。このセーヴに失敗した変身生物は即座に本来の姿に戻され、この呪文の光の外に出るまで別の形態に変化できなくなる。
この呪文を発動したターンよりも後の君の各ターンにおいて、君は1回のアクションとしてこの光を任意の方向へ最大60フィートまで移動させることができる。



高レベル版：君がこの呪文を3レベル以上の呪文スロットを用いて発動する場合、スロットのレベルが2レベルを1上回るごとに、ダメージが[[/r 1d10]]増加する。</span></span></span><span class="sd">力術 · action · 射程:120 · 持続:1</span></div><div class="sp-entry"><span class="prep off" data-action="toggle-prepared" data-item-idx="46" title="クリックで準備切替">○</span><span class="sn"><span class="tip" tabindex="0" data-action="edit-desc" data-item-idx="46">レッサー・レストレーション<span class="tip-body">クリーチャー1体に接触することにより､君はそのクリーチャーに影を及ぼしている病気1種類､あるいは以下の状態1種類を終了させることができる：聴覚喪失状態､毒状態､麻痺状態､盲目状態。</span></span></span><span class="sd">防御 · action · 射程:[object Object]</span></div><div class="sp-entry"><span class="prep off" data-action="toggle-prepared" data-item-idx="52" title="クリックで準備切替">○</span><span class="sn"><span class="tip" tabindex="0" data-action="edit-desc" data-item-idx="52">プレイヤー・オヴ・ヒーリング<span class="tip-body">射程内にいて君から見えるクリーチャーを最大6体まで選ぶ。それらのクリーチャーは([[/r 2d8]]+君の呪文発動能力修正値）に等しいヒット・ポイントを回復する。この呪文はアンデッドや人造クリーチャーにはなんの効果ももたらさない。



高レベル版：君がこの呪文を3レベル以上の呪文スロットを用いて発動する場合、スロットのレベルが2レベルを1上回るごとに回復量が[[/r 1d8]]増加する。</span></span></span><span class="sd">力術 · minute · 射程:30</span></div><div class="sp-entry"><span class="prep off" data-action="toggle-prepared" data-item-idx="65" title="クリックで準備切替">○</span><span class="sn"><span class="tip" tabindex="0" data-action="edit-desc" data-item-idx="65">サイレンス<span class="tip-body">持続時間の間､射程内の君が選んだ地点を中心とした半径20ft​の球形内ではいかなる音も､範囲内で発生することも､範囲内に入ってくることも､範囲内を通り抜けることもない。この球形の内側に完全に入ったクリーチャーや物体は､ [雷嗚] ダメージに完全耐性を有する。また､クリーチャーはこの球形の内側に完全に入っている間は聴覚喪失状態となる。音声要素を含む呪文はこの球形の中では発動できない。</span></span></span><span class="sd">幻術 · action · 射程:120 · 持続:10</span></div></div></details><details class="sp-lv"><summary>Lv3 (4)</summary><div class="sp-lv-body"><div class="sp-entry"><span class="prep off" data-action="toggle-prepared" data-item-idx="59" title="クリックで準備切替">○</span><span class="sn"><span class="tip" tabindex="0" data-action="edit-desc" data-item-idx="59">ファイアーボール<span class="tip-body">君の指先から射程内の君の選んだ一点に向かってまばゆい光茫が閃き､そして腹に響く轟音とともに火焔が爆裂する。その点を中心とした半径20ft​の球形の範囲内にいるすべてのクリーチャーは【敏捷力】セーヴィング・スローを行わなければならない。セーヴィング・スローを失敗したクリーチャーは8d6の [火] ダメージを受ける。成功したものはその半分のダメージを受ける。
この炎は角を回り込んで拡がる。ファイアボールの範囲内にあって､何者にも着用されたり､運搬されていない可燃物は発火する。
高レベル発動：君がこの呪文を4レベル以上の呪文スロットを用いて発動する場合､スロットのレベルが3レベルを1上回るごとにダメージが1d6増加する。</span></span></span><span class="sd">力術 · action · 射程:150</span></div><div class="sp-entry"><span class="prep off" data-action="toggle-prepared" data-item-idx="62" title="クリックで準備切替">○</span><span class="sn"><span class="tip" tabindex="0" data-action="edit-desc" data-item-idx="62">オーラ・オヴ・ヴァイタリティ<span class="tip-body">君が放つ癒しのエネルギーが半径30フィートのオーラを作る。この呪文が終了するまで、このオーラは常に君が球形の中心となるよう君と共に移動する。君はボーナス・アクションとして、このオーラ内のクリーチャー1体（君自身も可）のhpを[[/r 2d6]]回復させることができる。</span></span></span><span class="sd">力術 · action · 射程:[object Object] · 持続:1</span></div><div class="sp-entry"><span class="prep off" data-action="toggle-prepared" data-item-idx="63" title="クリックで準備切替">○</span><span class="sn"><span class="tip" tabindex="0" data-action="edit-desc" data-item-idx="63">レオムンズ・タイニイ・ハット<span class="tip-body">君の頭上と周囲を半径10フィートの移動不能な力場のドームが毅い、持続時間じゅうその場に留まる。君がこの呪文の範囲を離れた時点でこの呪文は終了する。君以外に、中型以下のサイズのクリーチャー9体がこのドームに収まる。大型サイズ以上のクリーチャーや10体以上のクリーチャーが範囲内にいたなら、この呪文は失敗する。君がこの呪文を発動した際にドームの中にいたクリーチャーおよび物体は自由にドームの壁を通過できるが、他のすべてのクリーチャーおよび物体は通過できない。呪文その他の魔法的な効果はドームの壁を通過できず、この壁ごしに発動することもできない。外の天候に関係なく、ドーム内の大気は快適で乾いている。この呪文が終了するまで、君はドームの内部を“蒋暗い”明るさまたは“暗闇”に変えることができる。このドームは外側から見ると不透明だが（色は君が指定した任意の色）、内側からは透明である。</span></span></span><span class="sd">力術 · minute · 射程:[object Object] · 持続:8</span></div><div class="sp-entry"><span class="prep off" data-action="toggle-prepared" data-item-idx="64" title="クリックで準備切替">○</span><span class="sn"><span class="tip" tabindex="0" data-action="edit-desc" data-item-idx="64">スピリット・ガーディアンズ<span class="tip-body">君は自分を守護する霊たちを招請する。これらの盟たちは持続時間の間、君の周辺15フィート以内に漂っている。君の属性が善または中立ならば、その霊の透き通った体はエンジェル、あるいはフェイのような外見をしている（君が選択すること） 。君の屈性が悪ならば、それらはフィーンドめいた外見をしている。
この呪文を発動するさい、君は自分が見ることのできるクリーチャーを任意の数だけ選択し、この呪文の作用を受けないようにすることができる。選択されなかった者は以下の作用を受ける。そのクリーチャーはこの呪文の効果範囲の中では移動速度が半減する。また、あるターン中にこの効果範囲に初めて入るとき、およびその中で自分のターンを開始するさい、【判断力】セーヴィング・スローを行なわねばならない。セーヴに失敗したなら、そのクリーチャーは君が善または中立なら[[/r 3d8]]の［光輝］ダメージを受け、君が悪ならば[[/r 3d8]]の［死霊］ダメージを受ける。セーヴに成功すればその半分のダメージで済む。



高レベル版：君がこの呪文を4レベル以上の呪文スロットを用いて発動する場合、スロットのレベルが3レベルを1上回るごとにダメージが[[/r 1d8]]増加する。</span></span></span><span class="sd">召喚 · action · 射程:[object Object] · 持続:10</span></div></div></details></div><div class="sec bio-section clickable" data-action="edit-bio"><div class="sec-title">経歴・外見</div><div style="font-size:13px;color:var(--td);margin-bottom:8px;font-style:italic">(外見なし)</div><div class="bio-ct"><p><span style="font-family:Meiryo">【ザナサーの百科事典より引用】<br style="color:rgb(0, 0, 0);font-family:Meiryo;font-size:12px;font-style:normal;font-variant-ligatures:normal;font-variant-caps:normal;font-weight:400;letter-spacing:normal;orphans:2;text-align:start;text-indent:0px;text-transform:none;widows:2;word-spacing:0px;-webkit-text-stroke-width:0px;white-space:normal;text-decoration-thickness:initial;text-decoration-style:initial;text-decoration-color:initial">両親…父オーク 母ヒューマン<br style="color:rgb(0, 0, 0);font-family:Meiryo;font-size:12px;font-style:normal;font-variant-ligatures:normal;font-variant-caps:normal;font-weight:400;letter-spacing:normal;orphans:2;text-align:start;text-indent:0px;text-transform:none;widows:2;word-spacing:0px;-webkit-text-stroke-width:0px;white-space:normal;text-decoration-thickness:initial;text-decoration-style:initial;text-decoration-color:initial">出生地…寺院<br style="color:rgb(0, 0, 0);font-family:Meiryo;font-size:12px;font-style:normal;font-variant-ligatures:normal;font-variant-caps:normal;font-weight:400;letter-spacing:normal;orphans:2;text-align:start;text-indent:0px;text-transform:none;widows:2;word-spacing:0px;-webkit-text-stroke-width:0px;white-space:normal;text-decoration-thickness:initial;text-decoration-style:initial;text-decoration-color:initial">家族…孤児院<br style="color:rgb(0, 0, 0);font-family:Meiryo;font-size:12px;font-style:normal;font-variant-ligatures:normal;font-variant-caps:normal;font-weight:400;letter-spacing:normal;orphans:2;text-align:start;text-indent:0px;text-transform:none;widows:2;word-spacing:0px;-webkit-text-stroke-width:0px;white-space:normal;text-decoration-thickness:initial;text-decoration-style:initial;text-decoration-color:initial">待祭になった理由<br style="color:rgb(0, 0, 0);font-family:Meiryo;font-size:12px;font-style:normal;font-variant-ligatures:normal;font-variant-caps:normal;font-weight:400;letter-spacing:normal;orphans:2;text-align:start;text-indent:0px;text-transform:none;widows:2;word-spacing:0px;-webkit-text-stroke-width:0px;white-space:normal;text-decoration-thickness:initial;text-decoration-style:initial;text-decoration-color:initial">…家族(母)は私を養育できない、あるいはしたくなかったので、私を寺院にいれた<br style="color:rgb(0, 0, 0);font-family:Meiryo;font-size:12px;font-style:normal;font-variant-ligatures:normal;font-variant-caps:normal;font-weight:400;letter-spacing:normal;orphans:2;text-align:start;text-indent:0px;text-transform:none;widows:2;word-spacing:0px;-webkit-text-stroke-width:0px;white-space:normal;text-decoration-thickness:initial;text-decoration-style:initial;text-decoration-color:initial">クレリックになった理由<br style="color:rgb(0, 0, 0);font-family:Meiryo;font-size:12px;font-style:normal;font-variant-ligatures:normal;font-variant-caps:normal;font-weight:400;letter-spacing:normal;orphans:2;text-align:start;text-indent:0px;text-transform:none;widows:2;word-spacing:0px;-webkit-text-stroke-width:0px;white-space:normal;text-decoration-thickness:initial;text-decoration-style:initial;text-decoration-color:initial">…私はこの世界にはびこる不正義と恐怖を目の当たりにし、それらに立ち向かわねばならぬと決意した<br style="color:rgb(0, 0, 0);font-family:Meiryo;font-size:12px;font-style:normal;font-variant-ligatures:normal;font-variant-caps:normal;font-weight:400;letter-spacing:normal;orphans:2;text-align:start;text-indent:0px;text-transform:none;widows:2;word-spacing:0px;-webkit-text-stroke-width:0px;white-space:normal;text-decoration-thickness:initial;text-decoration-style:initial;text-decoration-color:initial"><br style="color:rgb(0, 0, 0);font-family:Meiryo;font-size:12px;font-style:normal;font-variant-ligatures:normal;font-variant-caps:normal;font-weight:400;letter-spacing:normal;orphans:2;text-align:start;text-indent:0px;text-transform:none;widows:2;word-spacing:0px;-webkit-text-stroke-width:0px;white-space:normal;text-decoration-thickness:initial;text-decoration-style:initial;text-decoration-color:initial"><br style="color:rgb(0, 0, 0);font-family:Meiryo;font-size:12px;font-style:normal;font-variant-ligatures:normal;font-variant-caps:normal;font-weight:400;letter-spacing:normal;orphans:2;text-align:start;text-indent:0px;text-transform:none;widows:2;word-spacing:0px;-webkit-text-stroke-width:0px;white-space:normal;text-decoration-thickness:initial;text-decoration-style:initial;text-decoration-color:initial">産まれてすぐ寺院が運営する孤児院に預けられ、親の顔を全く知らずに育つ。孤児院ではみんなのお姉ちゃん的な存在で、年少の子供達の面倒を見ることが多かった。<br style="color:rgb(0, 0, 0);font-family:Meiryo;font-size:12px;font-style:normal;font-variant-ligatures:normal;font-variant-caps:normal;font-weight:400;letter-spacing:normal;orphans:2;text-align:start;text-indent:0px;text-transform:none;widows:2;word-spacing:0px;-webkit-text-stroke-width:0px;white-space:normal;text-decoration-thickness:initial;text-decoration-style:initial;text-decoration-color:initial"><br style="color:rgb(0, 0, 0);font-family:Meiryo;font-size:12px;font-style:normal;font-variant-ligatures:normal;font-variant-caps:normal;font-weight:400;letter-spacing:normal;orphans:2;text-align:start;text-indent:0px;text-transform:none;widows:2;word-spacing:0px;-webkit-text-stroke-width:0px;white-space:normal;text-decoration-thickness:initial;text-decoration-style:initial;text-decoration-color:initial">15歳で待祭として働き始め、布教や慈善活動に勤しむ。<br style="color:rgb(0, 0, 0);font-family:Meiryo;font-size:12px;font-style:normal;font-variant-ligatures:normal;font-variant-caps:normal;font-weight:400;letter-spacing:normal;orphans:2;text-align:start;text-indent:0px;text-transform:none;widows:2;word-spacing:0px;-webkit-text-stroke-width:0px;white-space:normal;text-decoration-thickness:initial;text-decoration-style:initial;text-decoration-color:initial">「世界中のチビ共を寝かしつけてやりてぇ」が信条<br style="color:rgb(0, 0, 0);font-family:Meiryo;font-size:12px;font-style:normal;font-variant-ligatures:normal;font-variant-caps:normal;font-weight:400;letter-spacing:normal;orphans:2;text-align:start;text-indent:0px;text-transform:none;widows:2;word-spacing:0px;-webkit-text-stroke-width:0px;white-space:normal;text-decoration-thickness:initial;text-decoration-style:initial;text-decoration-color:initial">面倒見がよく豪快な性格で、お残しと夜更かしを許さない。<br style="color:rgb(0, 0, 0);font-family:Meiryo;font-size:12px;font-style:normal;font-variant-ligatures:normal;font-variant-caps:normal;font-weight:400;letter-spacing:normal;orphans:2;text-align:start;text-indent:0px;text-transform:none;widows:2;word-spacing:0px;-webkit-text-stroke-width:0px;white-space:normal;text-decoration-thickness:initial;text-decoration-style:initial;text-decoration-color:initial">教義的に夜更かしに厳しく、警告に耳を貸さない夜更かしウィザードを毛布で簀巻きにすることもしばしば。</span></p></div></div></div>

<!-- Description Edit Modal -->
<div id="descModal" class="modal-overlay">
  <div class="modal">
    <div class="modal-header">
      <span class="modal-title" id="modalTitle">経歴・外見</span>
      <button class="modal-close" id="modalClose">×</button>
    </div>
    <div class="modal-body">
      <div id="modalNameRow" style="display:flex;align-items:center;gap:8px;margin-bottom:12px">
        <label class="modal-label" id="modalNameLabel" style="margin:0;flex:1">外見</label>
        <button class="modal-btn modal-btn-edit" id="modalEditToggle">編集モード</button>
      </div>
      <div id="modalNoNameRow" style="display:none;margin-bottom:12px;text-align:right">
        <button class="modal-btn modal-btn-edit" id="modalEditToggle2">編集モード</button>
      </div>
      <textarea class="modal-input modal-name" id="modalName" placeholder="アイテム名" readonly="" rows="1" style="display: block;"></textarea>
      <label class="modal-label" style="margin-top:12px">説明</label>
      <div class="modal-view" id="modalView" style="display: block;"><p><span style="font-family:&#39;Noto Sans JP&#39;">遠方の国からやってきた異邦人。<br style="color:rgb(0, 0, 0);font-family:&#39;Noto Sans JP&#39;;font-size:12px;font-style:normal;font-variant-ligatures:normal;font-variant-caps:normal;font-weight:400;letter-spacing:normal;orphans:2;text-align:start;text-indent:0px;text-transform:none;widows:2;word-spacing:0px;-webkit-text-stroke-width:0px;white-space:normal;text-decoration-thickness:initial;text-decoration-style:initial;text-decoration-color:initial">「彼は忠義に厚く仕えていた主人を亡くしたことがきっかけで国を出た。彼は今新たな土地で新たな主君を探しているのだ」<br style="color:rgb(0, 0, 0);font-family:&#39;Noto Sans JP&#39;;font-size:12px;font-style:normal;font-variant-ligatures:normal;font-variant-caps:normal;font-weight:400;letter-spacing:normal;orphans:2;text-align:start;text-indent:0px;text-transform:none;widows:2;word-spacing:0px;-webkit-text-stroke-width:0px;white-space:normal;text-decoration-thickness:initial;text-decoration-style:initial;text-decoration-color:initial">「いや彼は故郷の君主の息子の一人で、何か大きな事を成し遂げることで次なる君主へと認められようとしているのだ」<br style="color:rgb(0, 0, 0);font-family:&#39;Noto Sans JP&#39;;font-size:12px;font-style:normal;font-variant-ligatures:normal;font-variant-caps:normal;font-weight:400;letter-spacing:normal;orphans:2;text-align:start;text-indent:0px;text-transform:none;widows:2;word-spacing:0px;-webkit-text-stroke-width:0px;white-space:normal;text-decoration-thickness:initial;text-decoration-style:initial;text-decoration-color:initial">「彼の持ち物の大半は虎のマークが入っている。あのタイガーマークは遠方の侵略者の印なのではないか。他の仲間と共に我らの土地に浸透し奪おうとしているのだ」<br style="color:rgb(0, 0, 0);font-family:&#39;Noto Sans JP&#39;;font-size:12px;font-style:normal;font-variant-ligatures:normal;font-variant-caps:normal;font-weight:400;letter-spacing:normal;orphans:2;text-align:start;text-indent:0px;text-transform:none;widows:2;word-spacing:0px;-webkit-text-stroke-width:0px;white-space:normal;text-decoration-thickness:initial;text-decoration-style:initial;text-decoration-color:initial">……などは異国のイントネーションや言葉の細かな違い、更に彼が強く否定できず寡黙な人柄であることから、尾ひれが付き続けたことによる膨らんだ噂である。<br style="color:rgb(0, 0, 0);font-family:&#39;Noto Sans JP&#39;;font-size:12px;font-style:normal;font-variant-ligatures:normal;font-variant-caps:normal;font-weight:400;letter-spacing:normal;orphans:2;text-align:start;text-indent:0px;text-transform:none;widows:2;word-spacing:0px;-webkit-text-stroke-width:0px;white-space:normal;text-decoration-thickness:initial;text-decoration-style:initial;text-decoration-color:initial"><br style="color:rgb(0, 0, 0);font-family:&#39;Noto Sans JP&#39;;font-size:12px;font-style:normal;font-variant-ligatures:normal;font-variant-caps:normal;font-weight:400;letter-spacing:normal;orphans:2;text-align:start;text-indent:0px;text-transform:none;widows:2;word-spacing:0px;-webkit-text-stroke-width:0px;white-space:normal;text-decoration-thickness:initial;text-decoration-style:initial;text-decoration-color:initial">本名は大岡光忠。<br style="color:rgb(0, 0, 0);font-family:&#39;Noto Sans JP&#39;;font-size:12px;font-style:normal;font-variant-ligatures:normal;font-variant-caps:normal;font-weight:400;letter-spacing:normal;orphans:2;text-align:start;text-indent:0px;text-transform:none;widows:2;word-spacing:0px;-webkit-text-stroke-width:0px;white-space:normal;text-decoration-thickness:initial;text-decoration-style:initial;text-decoration-color:initial">家は確かに大陸でいう貴族のようなものであったが無精で不躾で忠義はなく、家出のような形で国を飛び出してきた。<br style="color:rgb(0, 0, 0);font-family:&#39;Noto Sans JP&#39;;font-size:12px;font-style:normal;font-variant-ligatures:normal;font-variant-caps:normal;font-weight:400;letter-spacing:normal;orphans:2;text-align:start;text-indent:0px;text-transform:none;widows:2;word-spacing:0px;-webkit-text-stroke-width:0px;white-space:normal;text-decoration-thickness:initial;text-decoration-style:initial;text-decoration-color:initial">剣の才はあったので腕試し感覚で荒事をして回っていたが、言葉がうまく伝わらないことも度々ありいつのまにかラッパンアスクに挑むことになっていた。<br style="color:rgb(0, 0, 0);font-family:&#39;Noto Sans JP&#39;;font-size:12px;font-style:normal;font-variant-ligatures:normal;font-variant-caps:normal;font-weight:400;letter-spacing:normal;orphans:2;text-align:start;text-indent:0px;text-transform:none;widows:2;word-spacing:0px;-webkit-text-stroke-width:0px;white-space:normal;text-decoration-thickness:initial;text-decoration-style:initial;text-decoration-color:initial">故郷にはないタイプの人間(特に女性)と食事に目が無い。<br style="color:rgb(0, 0, 0);font-family:&#39;Noto Sans JP&#39;;font-size:12px;font-style:normal;font-variant-ligatures:normal;font-variant-caps:normal;font-weight:400;letter-spacing:normal;orphans:2;text-align:start;text-indent:0px;text-transform:none;widows:2;word-spacing:0px;-webkit-text-stroke-width:0px;white-space:normal;text-decoration-thickness:initial;text-decoration-style:initial;text-decoration-color:initial"><br style="color:rgb(0, 0, 0);font-family:&#39;Noto Sans JP&#39;;font-size:12px;font-style:normal;font-variant-ligatures:normal;font-variant-caps:normal;font-weight:400;letter-spacing:normal;orphans:2;text-align:start;text-indent:0px;text-transform:none;widows:2;word-spacing:0px;-webkit-text-stroke-width:0px;white-space:normal;text-decoration-thickness:initial;text-decoration-style:initial;text-decoration-color:initial">脇差と大弓は海を渡る際に持ってきた、それ以外の武器はこちらに来てから購入。<br style="color:rgb(0, 0, 0);font-family:&#39;Noto Sans JP&#39;;font-size:12px;font-style:normal;font-variant-ligatures:normal;font-variant-caps:normal;font-weight:400;letter-spacing:normal;orphans:2;text-align:start;text-indent:0px;text-transform:none;widows:2;word-spacing:0px;-webkit-text-stroke-width:0px;white-space:normal;text-decoration-thickness:initial;text-decoration-style:initial;text-decoration-color:initial">虎のマークの道具は故郷では大変質の良いもので、特に湯が冷めにくい魔法のような瓶がお気に入り。</span></p></div>
      <textarea class="modal-input modal-textarea" id="modalDesc" placeholder="説明文を入力..." style="display:none"></textarea>
    </div>
    <div class="modal-footer">
      <button class="modal-btn modal-btn-cancel" id="modalCancel">閉じる</button>
      <button class="modal-btn modal-btn-revert" id="modalRevert" style="display:none">元に戻す</button>
      <button class="modal-btn modal-btn-save" id="modalSave" style="display:none">保存</button>
    </div>
  </div>
</div>

<footer class="site-footer">Copyright © 2026, Kendermore Convention &amp; Visitors Bureau Office. Licensed under the <span class="mit-tip" tabindex="0">MIT License<span class="mit-body">MIT License

Copyright (c) 2026 Kendermore Convention &amp; Visitors Bureau Office

Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the "Software"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.</span></span>. Version 20260131.</footer>

<script>
const $=s=>document.querySelector(s);
const ABILS={str:'筋力',dex:'敏捷',con:'耐久',int:'知力',wis:'判断',cha:'魅力'};
const SKILL_MAP={
  acr:['軽業','dex'],ani:['動物使い','wis'],arc:['魔法学','int'],ath:['運動','str'],
  dec:['ペテン','cha'],his:['歴史','int'],ins:['看破','wis'],itm:['威圧','cha'],
  inv:['捜査','int'],med:['医術','wis'],nat:['自然','int'],prc:['知覚','wis'],
  prf:['芸能','cha'],per:['説得','cha'],rel:['宗教','int'],slt:['手先の早業','dex'],
  ste:['隠密','dex'],sur:['生存','wis']
};
const SCHOOLS={abj:'防御',con:'召喚',div:'占術',enc:'心術',evo:'力術',ill:'幻術',nec:'死霊',trs:'変成'};
const WEAPON_PROF={sim:'単純武器',mar:'軍用武器'};
const ARMOR_PROF={lgt:'軽装鎧',med:'中装鎧',hvy:'重装鎧',shl:'盾'};

function mod(s){return Math.floor(((s??10)-10)/2)}
function fm(m){return m>=0?'+'+m:''+m}
function tx(html){if(!html)return '';const d=document.createElement('div');d.innerHTML=html;return d.textContent.trim()}
function dotCls(p){return p>=2?'expert':p>=1?'full':p>0?'half':''}
function clamp(v,lo,hi){return Math.max(lo,Math.min(hi,v))}

// Tooltip - now includes data attribute for item index
function tip(name,descHtml,itemIdx){
  const desc=tx(descHtml);
  const safe=desc?desc.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/"/g,'&quot;'):'(説明なし)';
  const idxAttr=itemIdx!=null?` data-item-idx="${itemIdx}"`:'';
  return `<span class="tip" tabindex="0" data-action="edit-desc"${idxAttr}>${name}<span class="tip-body">${safe}</span></span>`;
}

function nc(cls,attrs,val,min,max){
  const mn=min!=null?` min="${min}"`:'';
  const mx=max!=null?` max="${max}"`:'';
  return `<span class="nc"><button type="button" class="nc-btn" data-nc="-1">−</button><input type="number" class="${cls}" ${attrs} value="${val}"${mn}${mx}><button type="button" class="nc-btn" data-nc="1">+</button></span>`;
}

// --- Data ---
let currentActor=null;
let currentActors=[];
let dirty=false;

// Modal state
let modalItemIdx=null;

function ensurePath(obj,...keys){
  let c=obj;
  for(const k of keys){if(!c[k])c[k]={};c=c[k];}
  return c;
}

function pickActors(json){
  if(Array.isArray(json)) return json.filter(a=>a?.type==='character'||a?.type==='npc'||a?.system?.abilities);
  if(json?.actors) return json.actors.filter(a=>a?.type==='character'||a?.system?.abilities);
  if(json?.type&&json?.system) return [json];
  return [];
}

function getLevel(actor){
  const items=actor.items||[];
  const cls=items.filter(i=>i.type==='class');
  if(cls.length>0) return cls.reduce((s,c)=>s+(c.system?.levels||0),0);
  const sys=actor.system||{};
  return sys.details?.level??sys.details?.levels??0;
}

function getClasses(items){
  const cls=items.filter(i=>i.type==='class');
  if(!cls.length) return '—';
  return cls.map(c=>{
    const sub=items.find(i=>i.type==='subclass'&&(i.system?.classIdentifier===c.system?.identifier||i.system?.parentClass===c._id));
    return c.name+(sub?' ('+sub.name+')':'');
  }).join(' / ');
}

function getRace(actor){
  const raceItem=(actor.items||[]).find(i=>i.type==='race');
  if(raceItem) return raceItem.name;
  const r=actor.system?.details?.race;
  return (typeof r==='string')?r:'';
}

function getBackground(actor){
  const bgItem=(actor.items||[]).find(i=>i.type==='background');
  if(bgItem) return bgItem.name;
  const r=actor.system?.details?.background;
  return (typeof r==='string')?r:'';
}

function getAC(sys,items){
  if(typeof sys.attributes?.ac?.value==='number') return sys.attributes.ac.value;
  if(typeof sys.attributes?.ac?.flat==='number') return sys.attributes.ac.flat;
  if(typeof sys.attributes?.ac==='number') return sys.attributes.ac;
  const dexMod=mod(sys.abilities?.dex?.value);
  const calc=sys.attributes?.ac?.calc||'default';
  const armors=(items||[]).filter(i=>(i.type==='equipment'||i.type==='armor')&&i.system?.equipped&&i.system?.armor?.value);
  if(armors.length){
    let best=10;
    for(const a of armors){
      const av=a.system.armor.value;
      const at=a.system?.type?.value||a.system?.armor?.type||'light';
      if(at==='heavy') best=Math.max(best,av);
      else if(at==='medium') best=Math.max(best,av+Math.min(dexMod,2));
      else if(at==='shield') best+=2;
      else best=Math.max(best,av+dexMod);
    }
    return best;
  }
  if(calc==='mage') return 13+dexMod;
  if(calc==='natural') return 10+dexMod;
  return 10+dexMod;
}

function getAbilMod(sys,abil){
  const a=sys.abilities?.[abil]||{};
  return typeof a.mod==='number'?a.mod:mod(a.value);
}

function weaponDmg(ws,sys,prof){
  const acts=ws.activities?Object.values(ws.activities):[];
  const atk=acts.find(a=>a.type==='attack'||a.type==='damage');
  if(atk){
    let ability=atk.attack?.ability||ws.ability||'';
    const atkType=atk.attack?.type?.value||'melee';
    let abilMod;
    if(ability==='spellcasting'){
      ability=sys.attributes?.spellcasting||'int';
      abilMod=getAbilMod(sys,ability);
    }else if(ability&&sys.abilities?.[ability]){
      abilMod=getAbilMod(sys,ability);
    }else{
      const props=Array.isArray(ws.properties)?ws.properties:(ws.properties?.value||[]);
      const fin=Array.isArray(props)?props.includes('fin'):false;
      if(atkType==='ranged') abilMod=getAbilMod(sys,'dex');
      else if(fin) abilMod=Math.max(getAbilMod(sys,'str'),getAbilMod(sys,'dex'));
      else abilMod=getAbilMod(sys,'str');
    }
    const mag=ws.magicalBonus||0;
    const ab=parseInt(atk.attack?.bonus)||0;
    const pr=ws.proficient!==false?(sys.attributes?.prof??prof??2):0;
    const atkTotal=abilMod+pr+mag+ab;
    const parts=atk.damage?.parts||[];
    let dmg=parts.map(p=>{
      if(Array.isArray(p)) return p.join(' ');
      let d='';
      if(p.number&&p.denomination) d=p.number+'d'+p.denomination;
      if(p.bonus) d+=(String(p.bonus).startsWith('+')||String(p.bonus).startsWith('-')?'':'+')+p.bonus;
      const types=(p.types||[]).filter(t=>t&&t!=='none');
      return [d,types.join('/')].filter(Boolean).join(' ');
    }).join(' + ')||'—';
    if(dmg!=='—'&&abilMod) dmg+=' '+fm(abilMod);
    if(mag>0) dmg+=' +'+mag;
    return {atk:fm(atkTotal),dmg};
  }
  const ability=ws.ability||'str';
  const abilMod=getAbilMod(sys,ability);
  const pr2=ws.proficient!==false?(sys.attributes?.prof??prof??2):0;
  const atkB=abilMod+pr2+(ws.attackBonus||0);
  const parts=(ws.damage?.parts||[]).map(p=>Array.isArray(p)?p.join(' '):String(p)).join(' / ');
  return {atk:fm(atkB),dmg:parts||'—'};
}

// --- Save details open state ---
function saveDetailsState(){
  const state={};
  document.querySelectorAll('#sheet details').forEach((d,i)=>{state[i]=d.open;});
  return state;
}
function restoreDetailsState(state){
  document.querySelectorAll('#sheet details').forEach((d,i)=>{if(i in state)d.open=state[i];});
}

// --- Render ---
function render(actor){
  if(!actor){$('#sheet').innerHTML='<p class="text-m">キャラが見つかりません</p>';return;}
  currentActor=actor;

  const detState=saveDetailsState();
  const scrollY=window.scrollY;

  const sys=actor.system||{};
  const items=actor.items||[];
  const level=getLevel(actor);
  const prof=sys.attributes?.prof??Math.floor(Math.max(level-1,0)/4)+2;
  let h='';

  // Header
  const name=actor.name||'(unnamed)';
  const cls=getClasses(items);
  const race=getRace(actor);
  const bg=getBackground(actor);
  const align=sys.details?.alignment||'';
  const xp=sys.details?.xp?.value;
  h+=`<div class="char-header"><div class="char-name">${name}</div><div class="char-sub">${cls} Lv${level||'?'} · ${race||'—'} · ${bg||'—'} · ${align||'—'}${xp!=null?' · '+xp+' XP':''}</div></div>`;

  h+='<div class="sheet-body">';

  // Col1: Abilities
  h+='<div class="ab-col">';
  for(const[k,label] of Object.entries(ABILS)){
    const a=sys.abilities?.[k]||{};
    const sc=a.value??10;
    const m=typeof a.mod==='number'?a.mod:mod(sc);
    h+=`<div class="ab-box"><div class="ab-lbl">${k.toUpperCase()}</div><div class="ab-score">${sc}</div><div class="ab-mod">${fm(m)}</div></div>`;
  }
  h+='</div>';

  // Col2: Saves & Skills
  h+='<div>';

  // Inspiration & Prof
  const insp=sys.attributes?.inspiration;
  h+=`<div class="prof-row"><div class="prof-box"><div class="big clickable" data-action="toggle-inspiration">${insp?'★':'☆'}</div><div class="lbl">Inspiration</div></div><div class="prof-box"><div class="big">+${prof}</div><div class="lbl">習熟ボーナス</div></div></div>`;

  // Saves
  h+='<div class="panel"><div class="p-title">セーヴィング・スロー</div>';
  for(const[k,label] of Object.entries(ABILS)){
    const a=sys.abilities?.[k]||{};
    const m=getAbilMod(sys,k);
    const p=a.proficient?true:false;
    const total=p?m+prof:m;
    h+=`<div class="s-row"><div class="dot ${p?'full':''}"></div><div class="bonus">${fm(total)}</div><div class="name">${label}</div></div>`;
  }
  h+='</div>';

  // Skills
  h+='<div class="panel"><div class="p-title">技能</div>';
  for(const[k,[label,defAbil]] of Object.entries(SKILL_MAP)){
    const sk=sys.skills?.[k]||{};
    const abil=sk.ability||defAbil;
    const abilMod=getAbilMod(sys,abil);
    const pl=sk.value??sk.prof??0;
    const total=abilMod+(pl?Math.round(prof*pl):0);
    h+=`<div class="s-row"><div class="dot ${dotCls(pl)}"></div><div class="bonus">${fm(total)}</div><div class="name">${label}<span class="abil">${abil}</span></div></div>`;
  }
  h+='</div>';

  // Passive Perception
  const prc=sys.skills?.prc||{};
  const prcAbil=prc.ability||'wis';
  const prcMod=getAbilMod(sys,prcAbil);
  const prcPl=prc.value??prc.prof??0;
  const passiveP=10+prcMod+(prcPl?Math.round(prof*prcPl):0);
  h+=`<div class="passive"><div class="big">${passiveP}</div><div class="lbl">受動知覚 (Passive Perception)</div></div>`;
  h+='</div>';

  // Col3: Combat
  h+='<div>';

  // AC, Init, Speed
  const ac=getAC(sys,items);
  const init=getAbilMod(sys,'dex')+(parseInt(sys.attributes?.init?.bonus)||0);
  const spd=sys.attributes?.movement?.walk??sys.attributes?.speed?.value??30;
  h+=`<div class="combat-trio"><div class="c-box"><div class="lbl">AC</div><div class="val">${ac}</div></div><div class="c-box"><div class="lbl">イニシアチブ</div><div class="val">${fm(init)}</div></div><div class="c-box"><div class="lbl">移動速度</div><div class="val">${spd}</div><div class="unit">ft</div></div></div>`;

  // HP
  const hp=ensurePath(sys,'attributes','hp');
  if(hp.max==null && hp.value!=null) hp.max=hp.value; // maxがnullなら現在値で初期化
  const hpCur=hp.value??0;
  const hpMax=hp.max??hpCur;
  const hpTemp=hp.temp??0;
  const hpR=hpMax>0?hpCur/hpMax:1;
  const hpC=hpR>.5?'var(--grn)':hpR>.25?'#c8a030':'var(--red)';
  h+=`<div class="hp-panel"><div class="p-title">ヒットポイント</div>`;
  h+=`<div class="hp-row">${nc('hp-cur','data-action="set-hp"',hpCur,0,hpMax)}<span class="hp-sep">/</span><span class="hp-max">${hpMax}</span></div>`;
  h+=`<div class="hp-bar"><div class="hp-bar-fill" style="width:${Math.round(hpR*100)}%;background:${hpC}"></div></div>`;
  h+=`<div class="hp-adj"><button class="hp-btn hp-btn-dmg" data-action="hp-dmg">Damage</button>${nc('hp-adj-input','id="hpDelta"',0,0,null)}<button class="hp-btn hp-btn-heal" data-action="hp-heal">Heal</button></div>`;
  h+=`<div class="hp-temp-row">一時HP: ${nc('hp-temp-input','data-action="set-temp-hp"',hpTemp,0,null)}</div>`;
  h+=`</div>`;

  // Hit Dice & Death Saves
  const clsItems=items.filter(i=>i.type==='class');
  h+=`<div class="hd-death">`;
  // Hit Dice
  h+=`<div class="mini-p"><div class="lbl">ヒットダイス</div>`;
  if(clsItems.length){
    for(let ci=0;ci<clsItems.length;ci++){
      const c=clsItems[ci];
      const hd=c.system?.hd||{};
      const den=hd.denomination||'d8';
      const lvl=c.system?.levels||0;
      const spent=hd.spent||0;
      const remain=lvl-spent;
      h+=`<div style="margin:3px 0"><span class="text-s">${den}</span> <span style="font-weight:700">${remain}</span>/${lvl} `;
      h+=`<button class="hp-btn hp-btn-dmg" style="font-size:10px;padding:1px 6px" data-action="hd-use" data-class-idx="${ci}">使用</button> `;
      h+=`<button class="hp-btn hp-btn-heal" style="font-size:10px;padding:1px 6px" data-action="hd-recover" data-class-idx="${ci}">回復</button>`;
      h+=`</div>`;
    }
  }else h+='<div>—</div>';
  h+=`</div>`;
  // Death Saves
  const death=ensurePath(sys,'attributes','death');
  const dS=death.success||0,dF=death.failure||0;
  h+=`<div class="mini-p"><div class="lbl">デス・セーヴ</div>`;
  h+=`<div class="text-s">成功</div><div class="dd">${[0,1,2].map(i=>`<div class="d ${i<dS?'ok':''}" data-action="death-success" data-idx="${i}"></div>`).join('')}</div>`;
  h+=`<div class="text-s">失敗</div><div class="dd">${[0,1,2].map(i=>`<div class="d ${i<dF?'ng':''}" data-action="death-failure" data-idx="${i}"></div>`).join('')}</div>`;
  h+=`</div></div>`;

  // Attacks
  const weapons=items.filter(i=>i.type==='weapon');
  h+='<div class="panel"><div class="p-title">攻撃</div>';
  if(weapons.length){
    h+='<table class="t"><thead><tr><th>名称</th><th>攻撃</th><th>ダメージ</th></tr></thead><tbody>';
    for(const w of weapons){
      const r=weaponDmg(w.system||{},sys,prof);
      const idx=items.indexOf(w);
      h+=`<tr><td>${tip(w.name,w.system?.description?.value,idx)}</td><td>${r.atk}</td><td>${r.dmg}</td></tr>`;
    }
    h+='</tbody></table>';
  }else h+='<div class="text-m text-s">—</div>';
  h+='</div>';

  // Equipment
  const eqTypes=new Set(['equipment','consumable','tool','loot','backpack','armor','container']);
  const eqItems=items.filter(i=>eqTypes.has(i.type));
  if(eqItems.length){
    h+='<div class="panel"><div class="p-title">装備・所持品</div><table class="t"><thead><tr><th>名称</th><th>種別</th><th>数</th></tr></thead><tbody>';
    for(const it of eqItems){
      const s=it.system||{};
      const idx=items.indexOf(it);
      const hasEquip=(it.type==='equipment'||it.type==='armor');
      const eqIcon=hasEquip?(s.equipped?'◆':'◇'):'';
      const eqAttr=hasEquip?` data-action="toggle-equip" data-item-idx="${idx}"`:'';
      const eqCls=hasEquip?' eq-toggle':'';
      const eqColor=s.equipped?'color:var(--grn)':'color:var(--td)';
      h+=`<tr><td>${hasEquip?`<span class="${eqCls}" style="${eqColor}"${eqAttr}>${eqIcon}</span> `:''}${tip(it.name,s.description?.value,idx)}</td><td class="text-s text-m">${it.type}</td><td>${nc('e-num',`data-action="set-quantity" data-item-idx="${idx}"`,s.quantity??1,0,null)}</td></tr>`;
    }
    h+='</tbody></table>';
    // Currency
    const cur=ensurePath(sys,'currency');
    h+=`<div class="coins">`;
    for(const[k,label] of [['pp','PP'],['gp','GP'],['ep','EP'],['sp','SP'],['cp','CP']]){
      h+=`<span class="coin coin-${k}"><span class="cl">${label}</span> ${nc('e-coin',`data-action="set-currency" data-coin="${k}"`,cur[k]||0,0,null)}</span>`;
    }
    h+=`</div></div>`;
  }

  // Senses
  const senses=sys.attributes?.senses||{};
  const sl=[];
  if(senses.darkvision)sl.push('暗視 '+senses.darkvision+'ft');
  if(senses.blindsight)sl.push('盲目視 '+senses.blindsight+'ft');
  if(senses.tremorsense)sl.push('振動感知 '+senses.tremorsense+'ft');
  if(senses.truesight)sl.push('真実の目 '+senses.truesight+'ft');
  if(sl.length) h+=`<div style="font-size:12px;color:var(--tm);text-align:center;margin-top:6px">${sl.join(' · ')}</div>`;

  h+='</div>'; // end col3
  h+='</div>'; // end sheet-body

  // Personality
  const det=sys.details||{};
  const trait=det.trait||'';
  const ideal=det.ideal||'';
  const bond=det.bond||'';
  const flaw=det.flaw||'';
  h+='<div class="pers-grid">';
  h+=`<div class="pers-box clickable" data-action="edit-detail" data-detail-key="trait"><div class="lbl">性格特徴</div><div class="ct">${trait||'—'}</div></div>`;
  h+=`<div class="pers-box clickable" data-action="edit-detail" data-detail-key="ideal"><div class="lbl">理想</div><div class="ct">${ideal||'—'}</div></div>`;
  h+=`<div class="pers-box clickable" data-action="edit-detail" data-detail-key="bond"><div class="lbl">絆</div><div class="ct">${bond||'—'}</div></div>`;
  h+=`<div class="pers-box clickable" data-action="edit-detail" data-detail-key="flaw"><div class="lbl">弱点</div><div class="ct">${flaw||'—'}</div></div>`;
  h+='</div>';

  // Proficiencies & Languages
  const traits=sys.traits||{};
  const langs=Array.isArray(traits.languages?.value)?traits.languages.value:[];
  const wProf=Array.isArray(traits.weaponProf?.value)?traits.weaponProf.value:[];
  const aProf=Array.isArray(traits.armorProf?.value)?traits.armorProf.value:[];
  if(langs.length||wProf.length||aProf.length){
    h+='<div class="sec"><div class="sec-title">習熟・言語</div><div class="pl-grid">';
    h+=`<div class="pl-grp"><div class="lbl">言語</div><div class="items">${langs.map(l=>'<span class="pill">'+l+'</span>').join('')||'—'}</div></div>`;
    h+=`<div class="pl-grp"><div class="lbl">武器習熟</div><div class="items">${wProf.map(w=>'<span class="pill">'+(WEAPON_PROF[w]||w)+'</span>').join('')||'—'}</div></div>`;
    h+=`<div class="pl-grp"><div class="lbl">防具習熟</div><div class="items">${aProf.map(a=>'<span class="pill">'+(ARMOR_PROF[a]||a)+'</span>').join('')||'—'}</div></div>`;
    h+='</div></div>';
  }

  // Features (with uses)
  const featTypes=new Set(['feat','class','race','background','subclass']);
  const allFeats=items.filter(i=>featTypes.has(i.type));
  if(allFeats.length){
    h+='<div class="sec"><div class="sec-title">特徴・特技</div>';
    for(const f of allFeats){
      if(f.type==='class'||f.type==='race'||f.type==='background'||f.type==='subclass') continue;
      const desc=tx(f.system?.description?.value);
      const short=desc.length>250?desc.substring(0,250)+'…':desc;
      const src=f.system?.requirements||f.type||'';
      const idx=items.indexOf(f);
      const uses=f.system?.uses;
      const hasUses=uses&&(uses.max||uses.value);
      let usesHtml='';
      if(hasUses){
        const uMax=uses.max||0;
        const uVal=uses.value||0;
        usesHtml=`<span class="feat-uses">(${nc('e-num',`style="width:32px" data-action="set-uses" data-item-idx="${idx}"`,uVal,0,uMax)} / ${uMax})</span>`;
      }
      h+=`<div class="feat-item"><span class="fn">${tip(f.name,f.system?.description?.value,idx)}</span>${usesHtml}<span class="fs">${src}</span>${short?'<div class="fd">'+short+'</div>':''}</div>`;
    }
    h+='</div>';
  }

  // Spells
  const spells=items.filter(i=>i.type==='spell');
  if(spells.length){
    h+='<div class="sec"><div class="sec-title">呪文</div>';

    // Spellcasting info
    const scAbil=sys.attributes?.spellcasting||'';
    if(scAbil){
      const scMod=getAbilMod(sys,scAbil);
      const dc=8+prof+scMod;
      const sAtk=prof+scMod;
      h+=`<div class="sp-meta"><div><b>呪文発動能力:</b> ${ABILS[scAbil]||scAbil.toUpperCase()}</div><div><b>呪文セーヴDC:</b> ${dc}</div><div><b>呪文攻撃:</b> ${fm(sAtk)}</div></div>`;
    }

    // Spell slots (editable)
    const slots=ensurePath(sys,'spells');
    const hasSlots=Object.keys(slots).some(k=>k.startsWith('spell')&&(slots[k]?.value>0||slots[k]?.override>0));
    if(hasSlots){
      h+='<div class="sp-slots">';
      for(let lv=1;lv<=9;lv++){
        const s=slots['spell'+lv];
        if(!s) continue;
        const max=s.override??s.value??0;
        if(!max) continue;
        const cur=s.value??0;
        h+=`<div class="sl-grp"><span class="lv">${lv}lv</span>`;
        for(let i=0;i<max;i++){
          h+=`<div class="sl-d ${i<cur?'on':''}" data-action="toggle-slot" data-slot-lv="${lv}" data-slot-idx="${i}"></div>`;
        }
        h+='</div>';
      }
      h+='</div>';
    }

    // Group by level
    const byLv=new Map();
    for(const sp of spells){
      const lv=sp.system?.level??0;
      if(!byLv.has(lv)) byLv.set(lv,[]);
      byLv.get(lv).push(sp);
    }
    const levels=[...byLv.keys()].sort((a,b)=>a-b);
    for(const lv of levels){
      const list=byLv.get(lv);
      const pretty=lv===0?'キャントリップ':'Lv'+lv;
      h+=`<details class="sp-lv"${lv<=1?' open':''}><summary>${pretty} (${list.length})</summary><div class="sp-lv-body">`;
      for(const sp of list){
        const ss=sp.system||{};
        const school=SCHOOLS[ss.school]||ss.school||'';
        const actType=ss.activation?.type||'';
        const range=ss.range?.value||ss.range||'';
        const dur=ss.duration?.value||(ss.duration?.units&&ss.duration.units!=='inst'?ss.duration.units:'')||'';
        const conc=ss.properties?.value?.includes?.('concentration')||ss.components?.concentration||false;
        const ritual=ss.properties?.value?.includes?.('ritual')||ss.components?.ritual||false;
        const prepared=ss.preparation?.prepared||ss.preparation?.mode==='always'||ss.preparation?.mode==='atwill'||lv===0;
        const canToggle=lv>0&&ss.preparation?.mode!=='always'&&ss.preparation?.mode!=='atwill';
        const tags=[school,actType,range?'射程:'+range:'',dur?'持続:'+dur:'',conc?'集中':'',ritual?'儀式':''].filter(Boolean).join(' · ');
        const idx=items.indexOf(sp);
        h+=`<div class="sp-entry"><span class="prep ${prepared?'':'off'}" ${canToggle?`data-action="toggle-prepared" data-item-idx="${idx}"`:''} ${canToggle?'title="クリックで準備切替"':''}>${prepared?'●':'○'}</span><span class="sn">${tip(sp.name,ss.description?.value,idx)}</span><span class="sd">${tags}</span></div>`;
      }
      h+='</div></details>';
    }
    h+='</div>';
  }

  // Biography
  const bio=det.biography?.value||'';
  const appear=det.appearance||'';
  h+='<div class="sec bio-section clickable" data-action="edit-bio"><div class="sec-title">経歴・外見</div>';
  if(appear) h+=`<div style="font-size:13px;color:var(--tm);margin-bottom:8px;white-space:pre-line">${appear}</div>`;
  else h+=`<div style="font-size:13px;color:var(--td);margin-bottom:8px;font-style:italic">(外見なし)</div>`;
  if(bio) h+=`<div class="bio-ct">${bio}</div>`;
  else h+=`<div class="bio-ct" style="color:var(--td);font-style:italic">(経歴なし)</div>`;
  h+='</div>';

  $('#sheet').innerHTML=h;
  $('#sheet').classList.add('active');
  $('#dropzone').style.display='none';
  $('#exportBtn').style.display='inline-block';

  restoreDetailsState(detState);
  window.scrollTo(0,scrollY);
}

// --- Modal Functions ---
let modalEditMode=false;
let modalType=null; // 'item', 'detail', 'bio'
let modalDetailKey=null; // for detail: 'trait','ideal','bond','flaw'

const DETAIL_LABELS={trait:'性格特徴',ideal:'理想',bond:'絆',flaw:'弱点'};

function openModal(itemIdx){
  const item=currentActor?.items?.[itemIdx];
  if(!item) return;
  modalItemIdx=itemIdx;
  modalEditMode=false;
  modalType='item';
  modalDetailKey=null;

  $('#modalTitle').textContent=item.name||'(名称なし)';
  const nameVal=item.name||'';
  $('#modalName').value=nameVal;
  $('#modalName').classList.toggle('multi',nameVal.includes('\n'));
  $('#modalNameRow').style.display='flex';
  const descHtml=item.system?.description?.value||'';
  $('#modalDesc').value=descHtml;

  updateModalMode();
  $('#descModal').classList.add('open');
}

function openDetailModal(key){
  if(!currentActor) return;
  modalItemIdx=null;
  modalEditMode=false;
  modalType='detail';
  modalDetailKey=key;

  const det=currentActor.system?.details||{};
  const value=det[key]||'';

  $('#modalTitle').textContent=DETAIL_LABELS[key]||key;
  $('#modalName').value='';
  $('#modalNameRow').style.display='none';
  $('#modalDesc').value=value;

  updateModalMode();
  $('#descModal').classList.add('open');
}

function openBioModal(){
  if(!currentActor) return;
  modalItemIdx=null;
  modalEditMode=false;
  modalType='bio';
  modalDetailKey=null;

  const det=currentActor.system?.details||{};
  const appear=det.appearance||'';
  const bio=det.biography?.value||'';

  $('#modalTitle').textContent='経歴・外見';
  $('#modalName').value=appear;
  $('#modalName').classList.toggle('multi',appear.includes('\n'));
  $('#modalNameRow').style.display='flex';
  $('#modalNameLabel').textContent='外見';
  $('#modalDesc').value=bio;

  updateModalMode();
  $('#descModal').classList.add('open');
}

function updateModalMode(){
  const nameInput=$('#modalName');
  const viewDiv=$('#modalView');
  const editArea=$('#modalDesc');
  const saveBtn=$('#modalSave');
  const editBtn=$('#modalEditToggle');
  const editBtn2=$('#modalEditToggle2');
  const cancelBtn=$('#modalCancel');
  const revertBtn=$('#modalRevert');
  const nameRow=$('#modalNameRow');
  const noNameRow=$('#modalNoNameRow');
  const nameLabel=$('#modalNameLabel');

  // Show/hide name row based on modalType
  if(modalType==='detail'){
    nameRow.style.display='none';
    noNameRow.style.display='block';
    nameInput.style.display='none';
  }else{
    nameRow.style.display='flex';
    noNameRow.style.display='none';
    nameInput.style.display='block';
    nameLabel.textContent=modalType==='bio'?'外見':'名称';
  }

  if(modalEditMode){
    // Edit mode
    nameInput.removeAttribute('readonly');
    viewDiv.style.display='none';
    editArea.style.display='block';
    saveBtn.style.display='inline-block';
    revertBtn.style.display='inline-block';
    editBtn.classList.add('active');
    editBtn.textContent='表示モード';
    editBtn2.classList.add('active');
    editBtn2.textContent='表示モード';
    cancelBtn.textContent='キャンセル';
  }else{
    // View mode
    nameInput.setAttribute('readonly','');
    const descHtml=$('#modalDesc').value;
    if(modalType==='detail'){
      // For detail fields, show as plain text (no HTML)
      if(descHtml.trim()){
        viewDiv.textContent=descHtml;
        viewDiv.classList.remove('modal-no-desc');
      }else{
        viewDiv.innerHTML='<span class="modal-no-desc">(未設定)</span>';
      }
    }else{
      // For items and bio, render HTML
      if(descHtml.trim()){
        viewDiv.innerHTML=descHtml;
        viewDiv.classList.remove('modal-no-desc');
      }else{
        viewDiv.innerHTML='<span class="modal-no-desc">(説明なし)</span>';
      }
    }
    viewDiv.style.display='block';
    editArea.style.display='none';
    saveBtn.style.display='none';
    revertBtn.style.display='none';
    editBtn.classList.remove('active');
    editBtn.textContent='編集モード';
    editBtn2.classList.remove('active');
    editBtn2.textContent='編集モード';
    cancelBtn.textContent='閉じる';
  }
}

function toggleEditMode(){
  modalEditMode=!modalEditMode;
  updateModalMode();
  if(modalEditMode){
    $('#modalName').focus();
  }
}

function closeModal(){
  $('#descModal').classList.remove('open');
  modalItemIdx=null;
  modalEditMode=false;
  modalType=null;
  modalDetailKey=null;
}

function saveModal(){
  if(!currentActor) return;

  if(modalType==='item'){
    if(modalItemIdx==null) return;
    const item=currentActor.items[modalItemIdx];
    if(!item) return;

    const newName=$('#modalName').value.trim();
    const newDesc=$('#modalDesc').value;

    if(newName) item.name=newName;
    const desc=ensurePath(item,'system','description');
    desc.value=newDesc;
  }else if(modalType==='detail'){
    const det=ensurePath(currentActor,'system','details');
    det[modalDetailKey]=$('#modalDesc').value;
  }else if(modalType==='bio'){
    const det=ensurePath(currentActor,'system','details');
    det.appearance=$('#modalName').value;
    const bio=ensurePath(det,'biography');
    bio.value=$('#modalDesc').value;
  }

  markDirty();
  closeModal();
  render(currentActor);
}

function revertModal(){
  if(!currentActor) return;

  if(modalType==='item'){
    const item=currentActor.items[modalItemIdx];
    if(item){
      $('#modalName').value=item.name||'';
      $('#modalDesc').value=item.system?.description?.value||'';
    }
  }else if(modalType==='detail'){
    const det=currentActor.system?.details||{};
    $('#modalDesc').value=det[modalDetailKey]||'';
  }else if(modalType==='bio'){
    const det=currentActor.system?.details||{};
    $('#modalName').value=det.appearance||'';
    $('#modalDesc').value=det.biography?.value||'';
  }
}

// Modal event listeners
$('#modalClose').addEventListener('click',closeModal);
$('#modalCancel').addEventListener('click',()=>{
  if(modalEditMode){
    // Cancel edit - revert to view mode
    revertModal();
    modalEditMode=false;
    updateModalMode();
  }else{
    closeModal();
  }
});
$('#modalSave').addEventListener('click',saveModal);
$('#modalEditToggle').addEventListener('click',toggleEditMode);
$('#modalEditToggle2').addEventListener('click',toggleEditMode);
$('#modalRevert').addEventListener('click',revertModal);
$('#descModal').addEventListener('click',e=>{
  if(e.target.id==='descModal'){
    if(modalEditMode){
      // In edit mode, don't close on overlay click
    }else{
      closeModal();
    }
  }
});
document.addEventListener('keydown',e=>{
  if(!$('#descModal').classList.contains('open')) return;
  if(e.key==='Escape'){
    if(modalEditMode){
      // Revert and go back to view mode
      revertModal();
      modalEditMode=false;
      updateModalMode();
    }else{
      closeModal();
    }
  }
  if(e.key==='Enter'&&e.ctrlKey&&modalEditMode) saveModal();
});

// --- Event Delegation ---
$('#sheet').addEventListener('click',e=>{
  const t=e.target;
  const action=t.dataset?.action||t.closest('[data-action]')?.dataset?.action;
  if(!action||!currentActor) return;
  const sys=currentActor.system;
  const target=t.closest('[data-action]')||t;

  // Handle description edit (編集許可がONの時のみ)
  if(action==='edit-desc' && $('#editModeChk').checked){
    const itemIdx=parseInt(target.dataset.itemIdx);
    if(!isNaN(itemIdx)){
      e.preventDefault();
      e.stopPropagation();
      openModal(itemIdx);
      return;
    }
  }

  // Handle detail edit (trait, ideal, bond, flaw)
  if(action==='edit-detail' && $('#editModeChk').checked){
    const key=target.dataset.detailKey;
    if(key){
      e.preventDefault();
      e.stopPropagation();
      openDetailModal(key);
      return;
    }
  }

  // Handle biography edit
  if(action==='edit-bio' && $('#editModeChk').checked){
    e.preventDefault();
    e.stopPropagation();
    openBioModal();
    return;
  }

  if(action==='toggle-inspiration'){
    const attr=ensurePath(sys,'attributes');
    attr.inspiration=!attr.inspiration;
    markDirty();render(currentActor);
  }

  if(action==='hp-dmg'||action==='hp-heal'){
    const input=document.getElementById('hpDelta');
    const delta=parseInt(input?.value)||0;
    if(delta<=0) return;
    const hp=ensurePath(sys,'attributes','hp');
    const max=hp.max??hp.value??0;
    if(action==='hp-dmg'){
      let dmg=delta;
      const temp=hp.temp||0;
      if(temp>0){
        const absorbed=Math.min(temp,dmg);
        hp.temp=temp-absorbed;
        dmg-=absorbed;
      }
      hp.value=clamp((hp.value??0)-dmg,0,max);
    }else{
      hp.value=clamp((hp.value??0)+delta,0,max);
    }
    markDirty();render(currentActor);
  }

  if(action==='death-success'){
    const idx=parseInt(target.dataset.idx);
    const death=ensurePath(sys,'attributes','death');
    const cur=death.success||0;
    death.success=(idx<cur)?idx:idx+1;
    markDirty();render(currentActor);
  }
  if(action==='death-failure'){
    const idx=parseInt(target.dataset.idx);
    const death=ensurePath(sys,'attributes','death');
    const cur=death.failure||0;
    death.failure=(idx<cur)?idx:idx+1;
    markDirty();render(currentActor);
  }

  if(action==='hd-use'){
    const ci=parseInt(target.dataset.classIdx);
    const clsItems=(currentActor.items||[]).filter(i=>i.type==='class');
    const c=clsItems[ci];if(!c) return;
    const hd=ensurePath(c,'system','hd');
    const lvl=c.system?.levels||0;
    const spent=hd.spent||0;
    if(spent<lvl){hd.spent=spent+1;markDirty();render(currentActor);}
  }
  if(action==='hd-recover'){
    const ci=parseInt(target.dataset.classIdx);
    const clsItems=(currentActor.items||[]).filter(i=>i.type==='class');
    const c=clsItems[ci];if(!c) return;
    const hd=ensurePath(c,'system','hd');
    if((hd.spent||0)>0){hd.spent=(hd.spent||0)-1;markDirty();render(currentActor);}
  }

  if(action==='toggle-slot'){
    const lv=parseInt(target.dataset.slotLv);
    const idx=parseInt(target.dataset.slotIdx);
    const slots=ensurePath(sys,'spells');
    const key='spell'+lv;
    if(!slots[key]) slots[key]={value:0,override:0};
    const s=slots[key];
    const max=s.override??s.value??0;
    const cur=s.value??0;
    if(idx<cur) s.value=idx; else s.value=idx+1;
    s.value=clamp(s.value,0,max);
    markDirty();render(currentActor);
  }

  if(action==='toggle-prepared'){
    const idx=parseInt(target.dataset.itemIdx);
    const item=currentActor.items[idx];if(!item) return;
    const prep=ensurePath(item,'system','preparation');
    prep.prepared=!prep.prepared;
    markDirty();render(currentActor);
  }

  if(action==='toggle-equip'){
    const idx=parseInt(target.dataset.itemIdx);
    const item=currentActor.items[idx];if(!item) return;
    const s=ensurePath(item,'system');
    s.equipped=!s.equipped;
    markDirty();render(currentActor);
  }
});

// +/- button handler
$('#sheet').addEventListener('click',e=>{
  const btn=e.target.closest('[data-nc]');
  if(!btn) return;
  const wrap=btn.closest('.nc');
  const input=wrap?.querySelector('input[type=number]');
  if(!input) return;
  const step=parseInt(btn.dataset.nc)||0;
  const min=input.min!==''?parseInt(input.min):-Infinity;
  const max=input.max!==''?parseInt(input.max):Infinity;
  input.value=clamp((parseInt(input.value)||0)+step,min,max);
  input.dispatchEvent(new Event('change',{bubbles:true}));
});

// Number input changes (HP, temp, quantity, currency, uses)
$('#sheet').addEventListener('change',e=>{
  const t=e.target;
  const action=t.dataset?.action;
  if(!action||!currentActor) return;
  const sys=currentActor.system;
  const val=parseInt(t.value)||0;

  if(action==='set-hp'){
    const hp=ensurePath(sys,'attributes','hp');
    const max=hp.max??hp.value??999;
    hp.value=clamp(val,0,max);
    markDirty();render(currentActor);
  }
  if(action==='set-temp-hp'){
    const hp=ensurePath(sys,'attributes','hp');
    hp.temp=Math.max(0,val);
    markDirty();render(currentActor);
  }
  if(action==='set-quantity'){
    const idx=parseInt(t.dataset.itemIdx);
    const item=currentActor.items[idx];if(!item) return;
    ensurePath(item,'system').quantity=Math.max(0,val);
    markDirty();
  }
  if(action==='set-currency'){
    const coin=t.dataset.coin;
    const cur=ensurePath(sys,'currency');
    cur[coin]=Math.max(0,val);
    markDirty();
  }
  if(action==='set-uses'){
    const idx=parseInt(t.dataset.itemIdx);
    const item=currentActor.items[idx];if(!item) return;
    const uses=ensurePath(item,'system','uses');
    const max=uses.max||0;
    uses.value=clamp(val,0,max);
    markDirty();
  }
});

function markDirty(){
  dirty=true;
  const btn=$('#exportBtn');
  if(btn) btn.textContent='Export JSON *';
  // Auto-save to localStorage if enabled
  if($('#autoSaveChk')?.checked && currentActor){
    localStorage.setItem('fvtt-autosave',JSON.stringify(currentActor));
    localStorage.setItem('fvtt-autosave-name',currentActor.name||'unknown');
  }
}

// --- Export ---
$('#exportBtn').addEventListener('click',()=>{
  if(!currentActor) return;
  const json=JSON.stringify(currentActor,null,2);
  const blob=new Blob([json],{type:'application/json'});
  const url=URL.createObjectURL(blob);
  const a=document.createElement('a');
  a.href=url;
  a.download=(currentActor.name||'character').replace(/[^a-zA-Z0-9_\-\u3000-\u9fff]/g,'_')+'.json';
  a.click();
  URL.revokeObjectURL(url);
  dirty=false;
  $('#exportBtn').textContent='Export JSON';
});

// --- Actor selection ---
function populateSelect(actors){
  const sel=$('#actorSel');
  if(actors.length<=1){sel.style.display='none';return;}
  sel.style.display='inline-block';sel.innerHTML='';
  actors.forEach((a,i)=>{
    const o=document.createElement('option');
    o.value=i;o.textContent=(a.name||'(no name)')+' Lv'+(getLevel(a)||'?');
    sel.appendChild(o);
  });
  sel.onchange=()=>render(actors[+sel.value]);
}

function handleJson(text){
  let data;try{data=JSON.parse(text)}catch(e){alert('JSON解析に失敗');return;}
  currentActors=pickActors(data);
  dirty=false;
  $('#exportBtn').textContent='Export JSON';
  $('#autoSaveChk').checked=false; // 読み込み時は自動保存OFF
  populateSelect(currentActors);
  render(currentActors[0]);
}

function readFile(f){const r=new FileReader();r.onload=e=>handleJson(e.target.result);r.readAsText(f,'utf-8');}

// Drag & drop
const dz=$('#dropzone');
['dragenter','dragover'].forEach(e=>dz.addEventListener(e,ev=>{ev.preventDefault();dz.classList.add('drag')}));
['dragleave','drop'].forEach(e=>dz.addEventListener(e,ev=>{ev.preventDefault();dz.classList.remove('drag')}));
dz.addEventListener('drop',e=>{const f=e.dataTransfer.files?.[0];if(f)readFile(f)});
$('#file').addEventListener('click',function(){this.value=''});
$('#file').addEventListener('change',e=>{const f=e.target.files?.[0];if(f)readFile(f)});

// Edit mode toggle
$('#editModeChk').checked=false; // 常にOFFで開始

// Autosave toggle
const autoSaveChk=$('#autoSaveChk');
autoSaveChk.checked=false; // 常にOFFで開始
autoSaveChk.addEventListener('change',()=>{
  // ONにした時点でキャラが読み込まれていれば即座に保存
  if(autoSaveChk.checked && currentActor){
    localStorage.setItem('fvtt-autosave',JSON.stringify(currentActor));
    localStorage.setItem('fvtt-autosave-name',currentActor.name||'unknown');
    updateRestoreBtn();
  }
});

// Restore button
const restoreBtn=$('#restoreBtn');
function updateRestoreBtn(){
  const saved=localStorage.getItem('fvtt-autosave');
  const name=localStorage.getItem('fvtt-autosave-name')||'';
  if(saved){
    restoreBtn.style.display='inline-block';
    restoreBtn.title='復元: '+name;
  }else{
    restoreBtn.style.display='none';
  }
}
updateRestoreBtn();
restoreBtn.addEventListener('click',()=>{
  const saved=localStorage.getItem('fvtt-autosave');
  if(saved){
    const data=JSON.parse(saved);
    const name=data.name||'(名称なし)';
    if(confirm('「'+name+'」のデータを復元しますか？')){
      handleJson(saved);
    }
  }
});

// Demo
$('#demoBtn').addEventListener('click',()=>{
  handleJson(JSON.stringify({
    name:"Melissa the Heretic",type:"character",
    system:{
      details:{level:5,race:"Human",alignment:"Lawful Good",
        trait:"信仰に篤く、困っている人を見過ごせない。",
        ideal:"癒し：傷ついた者を癒すことが自分の使命。",
        bond:"幼い頃に救ってくれた神官への恩義を忘れない。",
        flaw:"頑固で、一度決めたことを曲げようとしない。",
        biography:{value:"<p>元シーク教徒。ヘイヴンの神殿で、シーク教徒が隠していた「異端の力」に触れ、まことのクレリックとなる。</p><p>それが元でシーカー評議会で異端審問にかけられ、辺境の村ソレースに逃げて来たのだが...</p>"},
        appearance:"Gender: Female\nEyes: Dark Blue\nHair: Brown\nHeight: 5'2''"
      },
      abilities:{str:{value:14,mod:2,proficient:0},dex:{value:16,mod:3,proficient:1},con:{value:14,mod:2,proficient:0},int:{value:10,mod:0,proficient:0},wis:{value:18,mod:4,proficient:1},cha:{value:12,mod:1,proficient:0}},
      skills:{prc:{value:1,ability:'wis'},per:{value:1,ability:'cha'},ste:{value:1,ability:'dex'},med:{value:2,ability:'wis'},ins:{value:1,ability:'wis'},rel:{value:1,ability:'int'}},
      attributes:{ac:{value:17},hp:{value:36,max:36,temp:0},prof:3,movement:{walk:30},senses:{darkvision:0},speed:{value:30},
        death:{success:0,failure:0},inspiration:false,spellcasting:'wis'},
      traits:{languages:{value:["Common","Elvish","Dwarvish"]},weaponProf:{value:["sim"]},armorProf:{value:["lgt","med","shl"]}},
      spells:{spell1:{value:4,override:4},spell2:{value:3,override:3},spell3:{value:2,override:2}},
      currency:{pp:2,gp:45,ep:0,sp:12,cp:30},
      resources:{primary:{value:2,max:3,sr:false,lr:true,label:"Channel Divinity"}}
    },
    items:[
      {type:'class',name:'Cleric',system:{levels:5,hd:{denomination:'d8',spent:1},identifier:'cleric',spellcasting:{progression:'full',ability:'wis'}}},
      {type:'subclass',name:'Life Domain',system:{classIdentifier:'cleric'}},
      {type:'race',name:'Human',system:{}},
      {type:'background',name:'Acolyte',system:{}},
      {type:'weapon',name:'Mace',system:{ability:'str',proficient:true,attackBonus:0,damage:{parts:[["1d6+2","bludgeoning"]]},properties:{},description:{value:'A simple melee weapon. 1d6 bludgeoning damage.'}}},
      {type:'weapon',name:'Light Crossbow',system:{ability:'dex',proficient:true,attackBonus:0,damage:{parts:[["1d8+3","piercing"]]},properties:{amm:true,lod:true},description:{value:'A simple ranged weapon. 1d8 piercing damage. Ammunition (range 80/320), loading, two-handed.'}}},
      {type:'equipment',name:'Chain Shirt',system:{quantity:1,equipped:true,armor:{value:13,type:'medium'},description:{value:"Medium armor, AC 13 + DEX (max 2)."}}},
      {type:'equipment',name:'Shield',system:{quantity:1,equipped:true,armor:{value:2,type:'shield'},description:{value:"+2 AC."}}},
      {type:'feat',name:'Channel Divinity',system:{uses:{value:2,max:3},description:{value:'Turn Undead or Preserve Life.'}}},
      {type:'feat',name:'Disciple of Life',system:{description:{value:'Healing spells restore additional HP equal to 2 + spell level.'}}},
      {type:'feat',name:'Blessed Healer',system:{description:{value:'When you cast a healing spell on another, you also regain HP.'}}},
      {type:'consumable',name:'Holy Water',system:{quantity:3,description:{value:'Splash weapon dealing 2d6 radiant to fiends/undead.'}}},
      {type:'tool',name:'Medallion of Mishakal',system:{quantity:1,description:{value:'A blue crystal medallion, holy symbol of Mishakal, goddess of healing.'}}},
      {type:'tool',name:"Priest's Pack",system:{quantity:1,weight:29,description:{value:'Includes a backpack, blanket, candles, tinderbox, alms box, incense, censer, vestments, rations, and a waterskin.'}}},
      {type:'spell',name:'Guidance',system:{level:0,school:'div',activation:{type:'Action',cost:1},range:{value:'Touch'},duration:{value:'1 min'},description:{value:'Add 1d4 to an ability check.'},preparation:{prepared:true}}},
      {type:'spell',name:'Sacred Flame',system:{level:0,school:'evo',activation:{type:'Action',cost:1},range:{value:'60 ft'},duration:{units:'inst'},description:{value:'DEX save or 2d8 radiant damage.'},preparation:{prepared:true}}},
      {type:'spell',name:'Spare the Dying',system:{level:0,school:'nec',activation:{type:'Action',cost:1},range:{value:'Touch'},duration:{units:'inst'},description:{value:'Stabilize a creature at 0 HP.'},preparation:{prepared:true}}},
      {type:'spell',name:'Bless',system:{level:1,school:'enc',activation:{type:'Action',cost:1},range:{value:'30 ft'},duration:{value:'1 min'},description:{value:'Up to 3 creatures add 1d4 to attacks/saves.'},preparation:{prepared:true,mode:'prepared'},properties:{value:['concentration']}}},
      {type:'spell',name:'Cure Wounds',system:{level:1,school:'evo',activation:{type:'Action',cost:1},range:{value:'Touch'},duration:{units:'inst'},description:{value:'Heal 1d8 + WIS mod HP.'},preparation:{prepared:true,mode:'prepared'}}},
      {type:'spell',name:'Shield of Faith',system:{level:1,school:'abj',activation:{type:'Bonus',cost:1},range:{value:'60 ft'},duration:{value:'10 min'},description:{value:'+2 AC to target.'},preparation:{prepared:true,mode:'prepared'},properties:{value:['concentration']}}},
      {type:'spell',name:'Healing Word',system:{level:1,school:'evo',activation:{type:'Bonus',cost:1},range:{value:'60 ft'},duration:{units:'inst'},description:{value:'Heal 1d4 + WIS mod HP as bonus action.'},preparation:{prepared:true,mode:'prepared'}}},
      {type:'spell',name:'Spiritual Weapon',system:{level:2,school:'evo',activation:{type:'Bonus',cost:1},range:{value:'60 ft'},duration:{value:'1 min'},description:{value:'Create spectral weapon. 1d8 + WIS force damage.'},preparation:{prepared:true,mode:'prepared'}}},
      {type:'spell',name:'Lesser Restoration',system:{level:2,school:'abj',activation:{type:'Action',cost:1},range:{value:'Touch'},duration:{units:'inst'},description:{value:'End one disease or condition.'},preparation:{prepared:true,mode:'prepared'}}},
      {type:'spell',name:'Spirit Guardians',system:{level:3,school:'con',activation:{type:'Action',cost:1},range:{value:'Self (15ft)'},duration:{value:'10 min'},description:{value:'Spirits guard you. Enemies take 3d8 radiant.'},preparation:{prepared:true,mode:'prepared'},properties:{value:['concentration']}}},
      {type:'spell',name:'Revivify',system:{level:3,school:'nec',activation:{type:'Action',cost:1},range:{value:'Touch'},duration:{units:'inst'},description:{value:'Return creature dead within 1 minute to life with 1 HP.'},preparation:{prepared:true,mode:'prepared'}}}
    ]
  }));
});

// Warn on unsaved
window.addEventListener('beforeunload',e=>{
  if(dirty){e.preventDefault();e.returnValue='';}
});


// ブラウザの遷移対策
(() => {
  window.addEventListener('beforeunload', (e) => {
    e.preventDefault();
    e.returnValue = '';
  });

  const pushGuard = () => history.pushState({ __guard: true, t: Date.now() }, '', location.href);
  history.replaceState({ __base: true }, '', location.href);
  pushGuard();
  window.addEventListener('pageshow', (e) => {
    if (e.persisted) pushGuard();
  });
  const armWithUserActivation = () => pushGuard();
  window.addEventListener('pointerdown', armWithUserActivation, { once: true, capture: true });
  window.addEventListener('keydown', armWithUserActivation, { once: true, capture: true });
  window.addEventListener('popstate', () => {
    history.go(1);
    setTimeout(pushGuard, 0);
  });

})();
</script>


<deepl-input-controller translate="no"><template shadowrootmode="open"><link rel="stylesheet" href="chrome-extension://cofdbpoegempjloogbagkncekinflcnj/build/content.css"><div dir="ltr" style="visibility: initial !important;"><div class="dl-input-translation-container svelte-95aucy"><div></div></div></div></template></deepl-input-controller></body></html>