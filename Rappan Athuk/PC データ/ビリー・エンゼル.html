<!DOCTYPE html>
<!-- saved from url=(0152)file:///F:/SynologyDrive/D&D5e%20%E6%97%A5%E6%9C%AC%E8%AA%9E%E3%83%99%E3%83%BC%E3%82%B7%E3%83%83%E3%82%AF/FVTT%20D&D5e%20Character%20Sheet%20Viewer.html -->
<html lang="ja"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<meta name="viewport" content="width=device-width,initial-scale=1">
<title>FVTT D&amp;D5e Character Sheet Viewer</title>
<style>
:root{--bg:#1a1714;--sf:#242018;--sf2:#2e2820;--bd:#3e362a;--bda:#8b7340;--tx:#e8e2d6;--tm:#9e9486;--td:#6e6458;--ac:#c9a84c;--acd:#7a6630;--red:#c44040;--grn:#48a848;--blu:#5588cc}
*,*::before,*::after{box-sizing:border-box}
html,body{margin:0;height:100%}
body{background:var(--bg);color:var(--tx);font:14px/1.5 'Segoe UI',system-ui,-apple-system,'Hiragino Kaku Gothic ProN',Meiryo,sans-serif}

/* Toolbar */
.toolbar{background:var(--sf);border-bottom:1px solid var(--bd);padding:10px 16px;display:flex;flex-wrap:wrap;gap:8px;align-items:center;position:sticky;top:0;z-index:100;backdrop-filter:blur(6px)}
.toolbar-title{font-size:15px;font-weight:700;color:var(--ac);margin-right:auto}
.btn,input[type=file]{background:var(--sf2);border:1px solid var(--bd);color:var(--tx);padding:6px 12px;border-radius:6px;font-size:13px}
.btn{cursor:pointer;transition:border-color .15s}
.btn:hover{border-color:var(--ac)}
.btn-export{background:#2a3020;border-color:#4a6030;color:#a0d070}
.btn-export:hover{border-color:#80c040}
.btn-restore{background:#302a20;border-color:#605030;color:#d0b070}
.btn-restore:hover{border-color:#a08040}
select.btn{appearance:auto}

/* Autosave toggle */
.autosave-toggle{display:flex;align-items:center;gap:6px;cursor:pointer;user-select:none;font-size:12px;color:var(--tm)}
.autosave-toggle input{display:none}
.autosave-slider{width:36px;height:20px;background:var(--sf2);border:1px solid var(--bd);border-radius:10px;position:relative;transition:background .2s}
.autosave-slider::after{content:'';position:absolute;left:2px;top:2px;width:14px;height:14px;background:var(--td);border-radius:50%;transition:transform .2s,background .2s}
.autosave-toggle input:checked+.autosave-slider{background:var(--acd);border-color:var(--ac)}
.autosave-toggle input:checked+.autosave-slider::after{transform:translateX(16px);background:var(--ac)}
.autosave-label{color:var(--tm)}

.dropzone{border:2px dashed var(--bd);border-radius:12px;padding:24px;text-align:center;color:var(--tm);margin:16px;transition:.2s}
.dropzone.drag{border-color:var(--ac);color:var(--tx);background:rgba(201,168,76,.05)}

/* Sheet */
.sheet{max-width:1120px;margin:0 auto;padding:12px 16px 48px;display:none}
.sheet.active{display:block}

/* Header */
.char-header{text-align:center;padding:20px 0 14px;border-bottom:2px solid var(--bda);margin-bottom:16px}
.char-name{font-size:30px;font-weight:700;letter-spacing:.04em}
.char-sub{font-size:14px;color:var(--tm);margin-top:4px}

/* 3-column body */
.sheet-body{display:grid;grid-template-columns:86px minmax(220px,1fr) minmax(300px,1.4fr);gap:12px;margin-bottom:16px}

/* Ability boxes */
.ab-col{display:flex;flex-direction:column;gap:16px}
.ab-box{position:relative;border:2px solid var(--bda);border-radius:8px;padding:8px 4px 22px;text-align:center;background:var(--sf)}
.ab-lbl{font-size:10px;font-weight:700;text-transform:uppercase;letter-spacing:1.5px;color:var(--ac)}
.ab-score{font-size:26px;font-weight:700;line-height:1.2}
.ab-mod{position:absolute;bottom:-14px;left:50%;transform:translateX(-50%);width:36px;height:28px;display:flex;align-items:center;justify-content:center;border:2px solid var(--bda);border-radius:14px;background:var(--sf);font-size:14px;font-weight:700}

/* Panels */
.panel{background:var(--sf);border:1px solid var(--bd);border-radius:8px;padding:10px 12px}
.panel+.panel{margin-top:10px}
.p-title{font-size:10px;font-weight:700;text-transform:uppercase;letter-spacing:1.5px;color:var(--ac);text-align:center;padding-bottom:5px;border-bottom:1px solid var(--bd);margin-bottom:6px}

/* Prof & Inspiration */
.prof-row{display:flex;gap:8px;margin-bottom:10px}
.prof-box{flex:1;display:flex;align-items:center;gap:8px;background:var(--sf);border:1px solid var(--bd);border-radius:8px;padding:8px 10px}
.prof-box .big{font-size:22px;font-weight:700;color:var(--ac);min-width:34px;text-align:center}
.prof-box .lbl{font-size:10px;text-transform:uppercase;letter-spacing:.8px;color:var(--tm);line-height:1.3}

/* Dot */
.dot{display:inline-block;width:10px;height:10px;border:1.5px solid var(--ac);border-radius:50%;flex-shrink:0;margin-right:5px;vertical-align:middle}
.dot.full{background:var(--ac)}
.dot.half{background:linear-gradient(90deg,var(--ac) 50%,transparent 50%)}
.dot.expert{background:var(--ac);box-shadow:0 0 0 2px var(--sf),0 0 0 3.5px var(--ac)}

/* Save / Skill rows */
.s-row{display:flex;align-items:center;padding:2.5px 0;font-size:13px}
.s-row .bonus{min-width:30px;text-align:right;font-weight:600;margin-right:6px}
.s-row .name{flex:1}
.s-row .abil{font-size:10px;color:var(--td);text-transform:uppercase;margin-left:3px}

/* Passive */
.passive{display:flex;align-items:center;background:var(--sf);border:1px solid var(--bd);border-radius:8px;padding:6px 10px;margin-top:10px}
.passive .big{font-size:20px;font-weight:700;min-width:32px;text-align:center;margin-right:8px}
.passive .lbl{font-size:10px;text-transform:uppercase;letter-spacing:.8px;color:var(--tm)}

/* Combat trio */
.combat-trio{display:flex;gap:8px;margin-bottom:10px}
.c-box{flex:1;text-align:center;border:2px solid var(--bda);border-radius:8px;padding:6px 4px;background:var(--sf)}
.c-box .lbl{font-size:9px;font-weight:700;text-transform:uppercase;letter-spacing:1px;color:var(--ac)}
.c-box .val{font-size:26px;font-weight:700}
.c-box .unit{font-size:11px;color:var(--tm)}

/* HP */
.hp-panel{border:2px solid var(--bda);border-radius:8px;padding:10px;background:var(--sf);margin-bottom:10px}
.hp-row{display:flex;justify-content:center;align-items:center;gap:6px}
.hp-cur{font-size:28px;font-weight:700;width:60px;text-align:center;background:transparent;border:1px solid var(--bd);border-radius:6px;color:var(--tx);font-family:inherit}
.hp-cur:focus{border-color:var(--ac);outline:none}
.hp-sep{color:var(--td);font-size:20px;font-weight:700}
.hp-max{font-size:28px;font-weight:700}
.hp-bar{height:6px;background:var(--sf2);border-radius:3px;overflow:hidden;margin:6px 0}
.hp-bar-fill{height:100%;border-radius:3px;transition:width .3s,background .3s}
.hp-adj{display:flex;justify-content:center;gap:6px;margin-top:6px}
.hp-adj-input{width:50px;text-align:center;background:var(--sf2);border:1px solid var(--bd);border-radius:4px;color:var(--tx);font-size:13px;padding:3px}
.hp-adj-input:focus{border-color:var(--ac);outline:none}
.hp-btn{padding:3px 10px;border-radius:4px;cursor:pointer;font-size:12px;font-weight:700;border:1px solid}
.hp-btn-dmg{background:#3a2020;border-color:#804040;color:#e08080}
.hp-btn-dmg:hover{background:#4a2020;border-color:#c04040}
.hp-btn-heal{background:#203a20;border-color:#408040;color:#80e080}
.hp-btn-heal:hover{background:#204a20;border-color:#40c040}
.hp-temp-row{display:flex;justify-content:center;align-items:center;gap:4px;margin-top:4px;font-size:12px;color:var(--blu)}
.hp-temp-input{width:40px;text-align:center;background:transparent;border:1px solid var(--bd);border-radius:4px;color:var(--blu);font-size:12px;padding:2px;font-family:inherit}
.hp-temp-input:focus{border-color:var(--ac);outline:none}

/* HD & Death */
.hd-death{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-bottom:10px}
.mini-p{background:var(--sf);border:1px solid var(--bd);border-radius:8px;padding:8px;text-align:center}
.mini-p .lbl{font-size:10px;text-transform:uppercase;letter-spacing:1px;color:var(--ac);margin-bottom:3px}
.dd{display:flex;justify-content:center;gap:5px;margin:2px 0}
.dd .d{width:14px;height:14px;border:1.5px solid var(--td);border-radius:50%;cursor:pointer;transition:all .15s}
.dd .d:hover{border-color:var(--ac);transform:scale(1.2)}
.dd .d.ok{background:var(--grn);border-color:var(--grn)}
.dd .d.ng{background:var(--red);border-color:var(--red)}

/* Tables */
.t{width:100%;border-collapse:collapse;font-size:13px}
.t th{font-size:10px;text-transform:uppercase;letter-spacing:1px;color:var(--tm);font-weight:600;text-align:left;padding:4px 6px;border-bottom:1px solid var(--bd)}
.t td{padding:4px 6px;border-bottom:1px solid rgba(62,54,42,.4);vertical-align:top}

/* Hide native number spinner */
input[type=number]::-webkit-inner-spin-button,input[type=number]::-webkit-outer-spin-button{-webkit-appearance:none;margin:0}
input[type=number]{-moz-appearance:textfield}

/* Inline edit inputs */
.e-num{width:42px;text-align:center;background:transparent;border:1px solid var(--bd);border-radius:4px;color:var(--tx);font-size:13px;padding:2px 4px;font-family:inherit}
.e-num:focus{border-color:var(--ac);outline:none}
.e-coin{width:48px;text-align:center;background:transparent;border:1px solid var(--bd);border-radius:4px;font-size:13px;padding:2px 4px;font-family:inherit}
.e-coin:focus{border-color:var(--ac);outline:none}
.coin-pp .e-coin{color:#b0b8cc}
.coin-gp .e-coin{color:#d4a848}
.coin-ep .e-coin{color:#8898a8}
.coin-sp .e-coin{color:#a8b0b8}
.coin-cp .e-coin{color:#b88860}

/* Number control +/- buttons */
.nc{display:inline-flex;align-items:center;gap:2px;vertical-align:middle}
.nc-btn{width:26px;height:26px;display:inline-flex;align-items:center;justify-content:center;border:1px solid var(--bd);border-radius:5px;background:var(--sf2);color:var(--tm);font-size:16px;font-weight:700;cursor:pointer;user-select:none;line-height:1;padding:0;transition:all .12s}
.nc-btn:hover{border-color:var(--ac);color:var(--tx);background:var(--sf)}
.nc-btn:active{transform:scale(.9);background:var(--bda);color:var(--bg)}
.nc .e-num,.nc .e-coin{border-radius:0;border-left:none;border-right:none}
.nc .nc-btn:first-child{border-radius:5px 0 0 5px}
.nc .nc-btn:last-child{border-radius:0 5px 5px 0}

/* Clickable toggles */
.clickable{cursor:pointer;user-select:none;transition:transform .1s}
.clickable:hover{transform:scale(1.15)}
.clickable:active{transform:scale(.95)}

/* Full-width sections */
.sec{background:var(--sf);border:1px solid var(--bd);border-radius:8px;padding:12px 14px;margin-bottom:12px}
.sec-title{font-size:11px;font-weight:700;text-transform:uppercase;letter-spacing:1.5px;color:var(--ac);border-bottom:1px solid var(--bd);padding-bottom:5px;margin-bottom:8px}

/* Personality grid */
.pers-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:12px}
.pers-box{background:var(--sf);border:1px solid var(--bd);border-radius:8px;padding:10px 12px}
.pers-box .lbl{font-size:10px;font-weight:700;text-transform:uppercase;letter-spacing:1px;color:var(--ac);margin-bottom:3px}
.pers-box .ct{font-size:13px;color:var(--tm);line-height:1.5}
.pers-box.clickable{cursor:pointer;transition:border-color .15s}
.pers-box.clickable:hover{border-color:var(--ac);transform:none}

/* Prof & Languages */
.pl-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:10px}
.pl-grp .lbl{font-size:10px;font-weight:700;text-transform:uppercase;color:var(--ac);margin-bottom:3px}
.pl-grp .items{font-size:12px;color:var(--tm)}
.pill{display:inline-block;border:1px solid var(--bd);border-radius:999px;padding:1px 8px;margin:2px 3px 2px 0;font-size:12px}

/* Spells */
.sp-meta{display:flex;flex-wrap:wrap;gap:12px;margin-bottom:8px;font-size:13px}
.sp-meta b{color:var(--tm);font-weight:600}
.sp-slots{display:flex;flex-wrap:wrap;gap:10px;margin-bottom:10px;font-size:12px}
.sl-grp{display:flex;align-items:center;gap:3px}
.sl-grp .lv{font-size:11px;color:var(--tm);min-width:26px}
.sl-d{width:14px;height:14px;border:1.5px solid var(--acd);border-radius:50%;cursor:pointer;transition:all .15s}
.sl-d:hover{border-color:var(--ac);transform:scale(1.2)}
.sl-d.on{background:var(--ac);border-color:var(--ac)}
.sp-lv{border:1px solid var(--bd);border-radius:8px;margin-bottom:6px}
.sp-lv summary{cursor:pointer;padding:6px 10px;font-size:13px;font-weight:600;user-select:none}
.sp-lv summary:hover{color:var(--ac)}
.sp-lv-body{padding:0 10px 8px}
.sp-entry{display:flex;align-items:flex-start;gap:6px;padding:3px 0;font-size:13px;border-bottom:1px solid rgba(62,54,42,.3)}
.sp-entry:last-child{border-bottom:none}
.sp-entry .prep{color:var(--grn);font-size:14px;flex-shrink:0;width:18px;text-align:center;cursor:pointer;user-select:none;transition:transform .1s}
.sp-entry .prep:hover{transform:scale(1.3)}
.sp-entry .prep.off{color:var(--td)}
.sp-entry .sn{font-weight:600;min-width:110px}
.sp-entry .sd{font-size:12px;color:var(--tm);flex:1}

/* Features */
.feat-item{border-bottom:1px solid rgba(62,54,42,.4);padding:5px 0}
.feat-item:last-child{border-bottom:none}
.feat-item .fn{font-weight:600;font-size:13px}
.feat-item .fs{font-size:11px;color:var(--td);margin-left:6px}
.feat-item .fd{font-size:12px;color:var(--tm);margin-top:2px;line-height:1.5}
.feat-uses{display:inline-flex;align-items:center;gap:3px;margin-left:8px;font-size:12px;color:var(--blu)}

/* Currency */
.coins{display:flex;gap:14px;justify-content:center;padding:6px 0;font-size:13px}
.coin{display:flex;align-items:center;gap:3px}
.coin .cl{font-size:11px;font-weight:700;text-transform:uppercase}
.coin-pp .cl{color:#b0b8cc}
.coin-gp .cl{color:#d4a848}
.coin-ep .cl{color:#8898a8}
.coin-sp .cl{color:#a8b0b8}
.coin-cp .cl{color:#b88860}

/* Equipped toggle */
.eq-toggle{cursor:pointer;user-select:none;font-size:14px}
.eq-toggle:hover{filter:brightness(1.3)}

/* Bio */
.bio-ct{font-size:13px;line-height:1.7;color:var(--tm)}
.bio-ct h1,.bio-ct h2,.bio-ct h3{color:var(--tx);margin:10px 0 4px}
.bio-section.clickable{cursor:pointer;transition:border-color .15s}
.bio-section.clickable:hover{border-color:var(--ac);transform:none}

/* Responsive */
@media(max-width:900px){
  .sheet-body{grid-template-columns:1fr}
  .ab-col{flex-direction:row;flex-wrap:wrap;justify-content:center;gap:10px}
  .pers-grid{grid-template-columns:1fr}
  .pl-grid{grid-template-columns:1fr}
}
@media(max-width:600px){
  body{font-size:13px}
  .toolbar{padding:8px 10px;gap:6px}
  .toolbar-title{font-size:13px;width:100%}
  input[type=file]{font-size:11px;max-width:160px;overflow:hidden}
  .btn{padding:5px 8px;font-size:12px}
  .dropzone{margin:8px;padding:16px;font-size:13px}
  .sheet{padding:8px 8px 40px}
  .char-name{font-size:22px}
  .char-sub{font-size:12px}
  .combat-trio{flex-wrap:wrap}
  .c-box{min-width:0}
  .c-box .val{font-size:22px}
  .hp-cur{font-size:22px;width:50px}
  .hp-max{font-size:22px}
  .hp-adj{flex-wrap:wrap;gap:4px}
  .hp-btn{padding:6px 12px;font-size:13px}
  .hd-death{grid-template-columns:1fr}
  .coins{flex-wrap:wrap;gap:8px}
  .coin{gap:2px}
  .nc-btn{width:30px;height:30px;font-size:18px}
  .nc{gap:1px}
  .e-num{width:38px;font-size:12px}
  .e-coin{width:42px;font-size:12px}
  .sp-entry{flex-wrap:wrap}
  .sp-entry .sn{min-width:0}
  .sp-entry .sd{width:100%;padding-left:24px}
  .sp-slots{gap:8px}
  .sec{padding:10px 8px}
  .panel{padding:8px}
  /* Tables scroll horizontally if needed */
  .panel,.sec{overflow-x:auto;-webkit-overflow-scrolling:touch}
  .t{min-width:280px}
  .t th,.t td{padding:4px 4px;font-size:12px}
  .prof-row{flex-wrap:wrap}
  .prof-box{padding:6px 8px}
  .feat-item .fn{font-size:12px}
  .feat-item .fd{font-size:11px}
  .pl-grp{margin-bottom:6px}
}
.text-m{color:var(--tm)}
.text-d{color:var(--td)}
.text-s{font-size:12px}
/* Prevent horizontal overflow */
html{overflow-x:hidden}
.sheet,.sec,.panel{max-width:100%}

/* Item tooltip - clickable for edit */
.tip{position:relative;cursor:pointer;border-bottom:1px dotted var(--td)}
.tip:hover{color:var(--ac)}
.tip .tip-body{display:none;position:absolute;left:0;top:calc(100% + 6px);width:min(360px,85vw);background:var(--sf);border:1px solid var(--bda);border-radius:8px;padding:10px 12px;font-size:12px;line-height:1.6;color:var(--tm);text-align:left;white-space:normal;z-index:200;box-shadow:0 4px 16px rgba(0,0,0,.5);font-weight:400;pointer-events:none}
.tip:hover .tip-body,.tip:focus .tip-body{display:block}

/* Modal */
.modal-overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,.7);z-index:300;align-items:center;justify-content:center;padding:16px}
.modal-overlay.open{display:flex}
.modal{background:var(--sf);border:2px solid var(--bda);border-radius:12px;width:min(600px,95vw);max-height:90vh;display:flex;flex-direction:column;box-shadow:0 8px 32px rgba(0,0,0,.6)}
.modal-header{display:flex;align-items:center;padding:12px 16px;border-bottom:1px solid var(--bd)}
.modal-title{flex:1;font-size:16px;font-weight:700;color:var(--ac)}
.modal-close{background:none;border:none;font-size:24px;color:var(--tm);cursor:pointer;padding:0 4px;line-height:1}
.modal-close:hover{color:var(--tx)}
.modal-body{flex:1;overflow-y:auto;padding:16px}
.modal-footer{display:flex;gap:8px;justify-content:flex-end;padding:12px 16px;border-top:1px solid var(--bd)}
.modal-label{display:block;font-size:12px;color:var(--tm);margin-bottom:4px}
.modal-input{width:100%;background:var(--sf2);border:1px solid var(--bd);border-radius:6px;color:var(--tx);font-size:14px;padding:8px 10px;font-family:inherit;resize:vertical}
.modal-input:focus{border-color:var(--ac);outline:none}
.modal-name{resize:none;overflow:hidden}
.modal-name.multi{min-height:80px;overflow-y:auto;resize:vertical}
.modal-textarea{min-height:200px}
.modal-btn{padding:8px 16px;border-radius:6px;font-size:13px;font-weight:600;cursor:pointer;border:1px solid}
.modal-btn-cancel{background:var(--sf2);border-color:var(--bd);color:var(--tm)}
.modal-btn-cancel:hover{border-color:var(--ac);color:var(--tx)}
.modal-btn-save{background:#2a4020;border-color:#4a8030;color:#a0e070}
.modal-btn-save:hover{background:#304820;border-color:#60a040}
.modal-btn-edit{background:#203040;border-color:#406080;color:#80b0e0}
.modal-btn-edit:hover{background:#284050;border-color:#5080a0}
.modal-btn-edit.active{background:#406080;border-color:#80b0e0}
.modal-btn-revert{background:#402020;border-color:#804040;color:#e0a080}
.modal-btn-revert:hover{background:#503030;border-color:#a06060}

/* Modal view/edit modes */
.modal-view{line-height:1.7;color:var(--tm);font-size:14px;min-height:100px;max-height:400px;overflow-y:auto;padding:12px;background:var(--sf2);border:1px solid var(--bd);border-radius:6px}
.modal-view h1,.modal-view h2,.modal-view h3{color:var(--tx);margin:12px 0 6px;font-size:1.1em}
.modal-view p{margin:8px 0}
.modal-view ul,.modal-view ol{margin:8px 0;padding-left:24px}
.modal-view li{margin:4px 0}
.modal-view strong,.modal-view b{color:var(--tx)}
.modal-view em,.modal-view i{font-style:italic}
.modal-no-desc{color:var(--td);font-style:italic}

/* Footer */
.site-footer{text-align:center;padding:16px;font-size:11px;color:var(--td);border-top:1px solid var(--bd);margin-top:24px}
.mit-tip{position:relative;display:inline;cursor:help;color:var(--tm);text-decoration:underline dotted var(--td);text-underline-offset:2px}
.mit-tip .mit-body{display:none;position:absolute;bottom:calc(100% + 8px);left:50%;transform:translateX(-50%);width:min(480px,90vw);background:var(--sf);border:1px solid var(--bd);border-radius:8px;padding:12px 14px;font-size:11px;line-height:1.6;color:var(--tm);text-align:left;white-space:pre-wrap;z-index:200;box-shadow:0 4px 20px rgba(0,0,0,.5)}
.mit-tip:hover .mit-body,.mit-tip:focus .mit-body{display:block}
</style>
</head>
<body>
<div class="toolbar">
  <span class="toolbar-title">D&amp;D 5e Character Sheet</span>
  <input id="file" type="file" accept=".json,application/json">
  <button class="btn" id="demoBtn">Demo Sample</button>
  <button class="btn btn-export" id="exportBtn" style="display: inline-block;">Export JSON</button>
  <button class="btn btn-restore" id="restoreBtn" style="display:none">復元</button>
  <select id="actorSel" class="btn" style="display:none"></select>
  <label class="autosave-toggle"><input type="checkbox" id="autoSaveChk"><span class="autosave-slider"></span><span class="autosave-label">自動保存</span></label>
  <label class="autosave-toggle"><input type="checkbox" id="editModeChk"><span class="autosave-slider"></span><span class="autosave-label">詳細修正</span></label>
</div>
<div id="dropzone" class="dropzone" style="display: none;">
  JSONファイルをドラッグ＆ドロップ / ファイル選択で読み込み<br>
  <span class="text-s text-m">Foundry VTT D&amp;D5e Actor JSON対応 — すべてローカル処理</span>
</div>
<div id="sheet" class="sheet active"><div class="char-header"><div class="char-name">ビリー・エンゼル</div><div class="char-sub">ウォーロック (The Fiend) Lv5 · ヒューマン(ヴァリアント) · イカサマ師 · — · 10080 XP</div></div><div class="sheet-body"><div class="ab-col"><div class="ab-box"><div class="ab-lbl">STR</div><div class="ab-score">10</div><div class="ab-mod">+0</div></div><div class="ab-box"><div class="ab-lbl">DEX</div><div class="ab-score">14</div><div class="ab-mod">+2</div></div><div class="ab-box"><div class="ab-lbl">CON</div><div class="ab-score">14</div><div class="ab-mod">+2</div></div><div class="ab-box"><div class="ab-lbl">INT</div><div class="ab-score">10</div><div class="ab-mod">+0</div></div><div class="ab-box"><div class="ab-lbl">WIS</div><div class="ab-score">12</div><div class="ab-mod">+1</div></div><div class="ab-box"><div class="ab-lbl">CHA</div><div class="ab-score">18</div><div class="ab-mod">+4</div></div></div><div><div class="prof-row"><div class="prof-box"><div class="big clickable" data-action="toggle-inspiration">★</div><div class="lbl">Inspiration</div></div><div class="prof-box"><div class="big">+3</div><div class="lbl">習熟ボーナス</div></div></div><div class="panel"><div class="p-title">セーヴィング・スロー</div><div class="s-row"><div class="dot "></div><div class="bonus">+0</div><div class="name">筋力</div></div><div class="s-row"><div class="dot "></div><div class="bonus">+2</div><div class="name">敏捷</div></div><div class="s-row"><div class="dot "></div><div class="bonus">+2</div><div class="name">耐久</div></div><div class="s-row"><div class="dot "></div><div class="bonus">+0</div><div class="name">知力</div></div><div class="s-row"><div class="dot full"></div><div class="bonus">+4</div><div class="name">判断</div></div><div class="s-row"><div class="dot full"></div><div class="bonus">+7</div><div class="name">魅力</div></div></div><div class="panel"><div class="p-title">技能</div><div class="s-row"><div class="dot "></div><div class="bonus">+2</div><div class="name">軽業<span class="abil">dex</span></div></div><div class="s-row"><div class="dot "></div><div class="bonus">+1</div><div class="name">動物使い<span class="abil">wis</span></div></div><div class="s-row"><div class="dot full"></div><div class="bonus">+3</div><div class="name">魔法学<span class="abil">int</span></div></div><div class="s-row"><div class="dot "></div><div class="bonus">+0</div><div class="name">運動<span class="abil">str</span></div></div><div class="s-row"><div class="dot full"></div><div class="bonus">+7</div><div class="name">ペテン<span class="abil">cha</span></div></div><div class="s-row"><div class="dot "></div><div class="bonus">+0</div><div class="name">歴史<span class="abil">int</span></div></div><div class="s-row"><div class="dot "></div><div class="bonus">+1</div><div class="name">看破<span class="abil">wis</span></div></div><div class="s-row"><div class="dot "></div><div class="bonus">+4</div><div class="name">威圧<span class="abil">cha</span></div></div><div class="s-row"><div class="dot full"></div><div class="bonus">+3</div><div class="name">捜査<span class="abil">int</span></div></div><div class="s-row"><div class="dot "></div><div class="bonus">+1</div><div class="name">医術<span class="abil">wis</span></div></div><div class="s-row"><div class="dot "></div><div class="bonus">+0</div><div class="name">自然<span class="abil">int</span></div></div><div class="s-row"><div class="dot "></div><div class="bonus">+1</div><div class="name">知覚<span class="abil">wis</span></div></div><div class="s-row"><div class="dot "></div><div class="bonus">+4</div><div class="name">芸能<span class="abil">cha</span></div></div><div class="s-row"><div class="dot "></div><div class="bonus">+4</div><div class="name">説得<span class="abil">cha</span></div></div><div class="s-row"><div class="dot "></div><div class="bonus">+0</div><div class="name">宗教<span class="abil">int</span></div></div><div class="s-row"><div class="dot full"></div><div class="bonus">+5</div><div class="name">手先の早業<span class="abil">dex</span></div></div><div class="s-row"><div class="dot full"></div><div class="bonus">+5</div><div class="name">隠密<span class="abil">dex</span></div></div><div class="s-row"><div class="dot "></div><div class="bonus">+1</div><div class="name">生存<span class="abil">wis</span></div></div></div><div class="passive"><div class="big">11</div><div class="lbl">受動知覚 (Passive Perception)</div></div></div><div><div class="combat-trio"><div class="c-box"><div class="lbl">AC</div><div class="val">13</div></div><div class="c-box"><div class="lbl">イニシアチブ</div><div class="val">+2</div></div><div class="c-box"><div class="lbl">移動速度</div><div class="val">30</div><div class="unit">ft</div></div></div><div class="hp-panel"><div class="p-title">ヒットポイント</div><div class="hp-row"><span class="nc"><button type="button" class="nc-btn" data-nc="-1">−</button><input type="number" class="hp-cur" data-action="set-hp" value="38" min="0" max="38"><button type="button" class="nc-btn" data-nc="1">+</button></span><span class="hp-sep">/</span><span class="hp-max">38</span></div><div class="hp-bar"><div class="hp-bar-fill" style="width:100%;background:var(--grn)"></div></div><div class="hp-adj"><button class="hp-btn hp-btn-dmg" data-action="hp-dmg">Damage</button><span class="nc"><button type="button" class="nc-btn" data-nc="-1">−</button><input type="number" class="hp-adj-input" id="hpDelta" value="0" min="0"><button type="button" class="nc-btn" data-nc="1">+</button></span><button class="hp-btn hp-btn-heal" data-action="hp-heal">Heal</button></div><div class="hp-temp-row">一時HP: <span class="nc"><button type="button" class="nc-btn" data-nc="-1">−</button><input type="number" class="hp-temp-input" data-action="set-temp-hp" value="9" min="0"><button type="button" class="nc-btn" data-nc="1">+</button></span></div></div><div class="hd-death"><div class="mini-p"><div class="lbl">ヒットダイス</div><div style="margin:3px 0"><span class="text-s">d8</span> <span style="font-weight:700">5</span>/5 <button class="hp-btn hp-btn-dmg" style="font-size:10px;padding:1px 6px" data-action="hd-use" data-class-idx="0">使用</button> <button class="hp-btn hp-btn-heal" style="font-size:10px;padding:1px 6px" data-action="hd-recover" data-class-idx="0">回復</button></div></div><div class="mini-p"><div class="lbl">デス・セーヴ</div><div class="text-s">成功</div><div class="dd"><div class="d " data-action="death-success" data-idx="0"></div><div class="d " data-action="death-success" data-idx="1"></div><div class="d " data-action="death-success" data-idx="2"></div></div><div class="text-s">失敗</div><div class="dd"><div class="d " data-action="death-failure" data-idx="0"></div><div class="d " data-action="death-failure" data-idx="1"></div><div class="d " data-action="death-failure" data-idx="2"></div></div></div></div><div class="panel"><div class="p-title">攻撃</div><table class="t"><thead><tr><th>名称</th><th>攻撃</th><th>ダメージ</th></tr></thead><tbody><tr><td><span class="tip" tabindex="0" data-action="edit-desc" data-item-idx="14">ライト・クロスボウ<span class="tip-body">単純武器, 遠隔武器, 無
			
				25 gp, 5 lb.
				1d8 piercing  - 両手用, 矢弾 (80/320 ft.), 装填
			
		
		
		 射程. 遠隔攻撃を行なえる武器には、“矢弾”または“投榔”の特性の直後の（）内に射程が記されている。射程には2つの数字がある。1つ目の数字はその武器の通常射程（単位はフィート）であり、2つ目の数字は長距離射程だ。通常射程よりも遠くの目標を攻撃する際、君は攻撃ロールに“不利”をこうむる。長距離射程より遠くの目標を攻撃することはできない。 矢弾. “矢弾”の特性を持つ武器を用いて遠隔攻撃を行なうためには、その武器から射出する矢弾を持っていなければならない。この種の武器で攻限を1回行なうたび、矢弾が1つ消費される。矢筒やケースその他の容器から矢弾を取り出すのは攻撃の一部とみなされる（片手武器に装填を行なうには、1本の手が空いていなければならない）。戦闘終了後に1分かけて戦場を捜し歩くことにより、消費した矢弾の半数を回収することができる。矢弾の特性を持つ武器を用いて近接攻撃を行なう場合、その武器は代用武器とみなされる（後述の「代用武器」の項を見よ）。スリングを代用武器として用いてダメージを与えるためには、そのスリングが装填済みでなければならない。 装填. “装填”の特性を持つ武器は装填に時間がかかるため、君が1回のアクション、ボーナス・アクション、またはリアクションを費やして攻撃を行なう際、（君が通常行なえる攻撃の回数とは無関係に） 1つの矢弾しか射出できない。 両手用. “両手用”の特性を持つ武器で攻撃を行なうには2本の手を要する。持つだけならば1本の手でよい。</span></span></td><td>+3</td><td>—</td></tr><tr><td><span class="tip" tabindex="0" data-action="edit-desc" data-item-idx="17">ダガー<span class="tip-body">単純武器, 近接武器, 無
			
				2 gp, 1 lb.
				1d4 piercing  - 妙技, 投擲 (20/60 ft.), 軽武器
			
		
		
		金属製の短い刃と小さな柄を持つ武器。ダガーは、戦士や暗殺者、泥棒のための予備の武器として隠し持つのに最適だ。 妙技. “妙技”の特性を持つ武器を用いて攻撃を行なう際には、攻撃ロールとダメージ・ロールに関して【筋力】と【敏捷力】のうち好きな方を用いることができる。ただし攻撃ロールとダメージ・ロールには必ず同一の能力値を用いること。 軽武器. 軽武器は小さくて扱いやすいため、二刀流に最適だ。二刀流に関するルールは第9章を見よ。 投擲. “投擲”の特性を持つ武器は、それを投げつけて遠隔攻撃を行なうことができる。“投擲”の特性を持つ近接武器の場合、その武器で近接攻撃を行なう際に用いるのと同じ能力値を、投擲時の攻撃ロールとダメージ・ロールにも加える。たとえば、ハンドアックスを投擲する際には【筋力】を用いるが、ダガーを投榔する際には【筋力】と【敏捷力】のいずれか好きな方を用いることができる（ダガーは“妙技”の特性を持っているため） 。</span></span></td><td>+5</td><td>—</td></tr></tbody></table></div><div class="panel"><div class="p-title">装備・所持品</div><table class="t"><thead><tr><th>名称</th><th>種別</th><th>数</th></tr></thead><tbody><tr><td><span class="tip" tabindex="0" data-action="edit-desc" data-item-idx="9">変装用具<span class="tip-body">このポーチには、君が変装するための化粧品や髪染め、その他の小道具が入っている。君がこの道具に習熟しているなら、変装を行なう君の能力値判定に習熟ボーナスが得られる。</span></span></td><td class="text-s text-m">tool</td><td><span class="nc"><button type="button" class="nc-btn" data-nc="-1">−</button><input type="number" class="e-num" data-action="set-quantity" data-item-idx="9" value="1" min="0"><button type="button" class="nc-btn" data-nc="1">+</button></span></td></tr><tr><td><span class=" eq-toggle" style="color:var(--td)" data-action="toggle-equip" data-item-idx="10">◇</span> <span class="tip" tabindex="0" data-action="edit-desc" data-item-idx="10">上等な服<span class="tip-body">高価な品であることが、はっきり分かるよう特別に仕立てられた服一式。</span></span></td><td class="text-s text-m">equipment</td><td><span class="nc"><button type="button" class="nc-btn" data-nc="-1">−</button><input type="number" class="e-num" data-action="set-quantity" data-item-idx="10" value="1" min="0"><button type="button" class="nc-btn" data-nc="1">+</button></span></td></tr><tr><td><span class="tip" tabindex="0" data-action="edit-desc" data-item-idx="11">ポーチ<span class="tip-body">布、または革製の小物入れ。スリング･ブリットなら20個、ブロウガン用ニードルなら50本などを入れておくことができる。0.2立方フィート / 6ポンドの物を入れることができる。</span></span></td><td class="text-s text-m">container</td><td><span class="nc"><button type="button" class="nc-btn" data-nc="-1">−</button><input type="number" class="e-num" data-action="set-quantity" data-item-idx="11" value="1" min="0"><button type="button" class="nc-btn" data-nc="1">+</button></span></td></tr><tr><td><span class="tip" tabindex="0" data-action="edit-desc" data-item-idx="12">詐欺に必要な用具一式<span class="tip-body">1種類の詐欺に必要な用具一式（色つきの液体が入った栓をしてある瓶10本、重りをしこんだサイコロ一式、目立たぬ印を付けたカードー式、架空の公爵の印章指輪など。</span></span></td><td class="text-s text-m">tool</td><td><span class="nc"><button type="button" class="nc-btn" data-nc="-1">−</button><input type="number" class="e-num" data-action="set-quantity" data-item-idx="12" value="1" min="0"><button type="button" class="nc-btn" data-nc="1">+</button></span></td></tr><tr><td><span class=" eq-toggle" style="color:var(--grn)" data-action="toggle-equip" data-item-idx="15">◆</span> <span class="tip" tabindex="0" data-action="edit-desc" data-item-idx="15">レザー・アーマー<span class="tip-body">軽装鎧, 無
			
				10 gp, 10 lb.
				AC 11 + Dex  
			
		
		
		この防具の胸当てと肩当ての部分は、煮立った油で硬化させた革が用いられ、その他の部分は、より柔らかく柔軟な材料で作られている。</span></span></td><td class="text-s text-m">equipment</td><td><span class="nc"><button type="button" class="nc-btn" data-nc="-1">−</button><input type="number" class="e-num" data-action="set-quantity" data-item-idx="15" value="1" min="0"><button type="button" class="nc-btn" data-nc="1">+</button></span></td></tr><tr><td><span class="tip" tabindex="0" data-action="edit-desc" data-item-idx="16">クロスボウ･ボルト<span class="tip-body">Ammunition, 無
			
				5 cp, 0.075 lb.
				  
			
		
		
		この矢はあらゆる種類のクロスボウで使用され、通常は鋭い先端を持った短い金属製のシャフトだ。</span></span></td><td class="text-s text-m">consumable</td><td><span class="nc"><button type="button" class="nc-btn" data-nc="-1">−</button><input type="number" class="e-num" data-action="set-quantity" data-item-idx="16" value="20" min="0"><button type="button" class="nc-btn" data-nc="1">+</button></span></td></tr><tr><td><span class=" eq-toggle" style="color:var(--grn)" data-action="toggle-equip" data-item-idx="18">◆</span> <span class="tip" tabindex="0" data-action="edit-desc" data-item-idx="18">ワンド<span class="tip-body">秘術呪文の力を導き出すために作られた特殊なアイテム。

ウィザード、ウォーロック、ソーサラーは、これを呪文発動焦点具として使用できる。</span></span></td><td class="text-s text-m">equipment</td><td><span class="nc"><button type="button" class="nc-btn" data-nc="-1">−</button><input type="number" class="e-num" data-action="set-quantity" data-item-idx="18" value="1" min="0"><button type="button" class="nc-btn" data-nc="1">+</button></span></td></tr><tr><td><span class="tip" tabindex="0" data-action="edit-desc" data-item-idx="19">地下探険家パック<span class="tip-body">背負い袋には、1立方フィートまたは30ポンドの道具を入れることができます。また、バックパックの外側に、ベッドロールやロープのコイルなどのアイテムをストラップで取り付けることもできます。</span></span></td><td class="text-s text-m">container</td><td><span class="nc"><button type="button" class="nc-btn" data-nc="-1">−</button><input type="number" class="e-num" data-action="set-quantity" data-item-idx="19" value="1" min="0"><button type="button" class="nc-btn" data-nc="1">+</button></span></td></tr><tr><td><span class="tip" tabindex="0" data-action="edit-desc" data-item-idx="20">水袋<span class="tip-body">4パイント液体を入れることができる。</span></span></td><td class="text-s text-m">consumable</td><td><span class="nc"><button type="button" class="nc-btn" data-nc="-1">−</button><input type="number" class="e-num" data-action="set-quantity" data-item-idx="20" value="1" min="0"><button type="button" class="nc-btn" data-nc="1">+</button></span></td></tr><tr><td><span class="tip" tabindex="0" data-action="edit-desc" data-item-idx="21">保存食<span class="tip-body">保存食は、主に水気の無い乾物を揃えたもので、長旅に向いた携行食だ。これには堅パンや干し肉、干し果物、ナッツなどが含まれる。</span></span></td><td class="text-s text-m">consumable</td><td><span class="nc"><button type="button" class="nc-btn" data-nc="-1">−</button><input type="number" class="e-num" data-action="set-quantity" data-item-idx="21" value="10" min="0"><button type="button" class="nc-btn" data-nc="1">+</button></span></td></tr><tr><td><span class="tip" tabindex="0" data-action="edit-desc" data-item-idx="22">かなてこ<span class="tip-body">扉や箱をこじ開ける場合など、かなてこを使うことで【筋力】判定に有利が得られる。</span></span></td><td class="text-s text-m">loot</td><td><span class="nc"><button type="button" class="nc-btn" data-nc="-1">−</button><input type="number" class="e-num" data-action="set-quantity" data-item-idx="22" value="1" min="0"><button type="button" class="nc-btn" data-nc="1">+</button></span></td></tr><tr><td><span class="tip" tabindex="0" data-action="edit-desc" data-item-idx="23">ヘンプロープ（50フィート）<span class="tip-body">ロープはHP2。引きちぎる場合、難易度17【筋力】判定を要する。</span></span></td><td class="text-s text-m">consumable</td><td><span class="nc"><button type="button" class="nc-btn" data-nc="-1">−</button><input type="number" class="e-num" data-action="set-quantity" data-item-idx="23" value="1" min="0"><button type="button" class="nc-btn" data-nc="1">+</button></span></td></tr><tr><td><span class="tip" tabindex="0" data-action="edit-desc" data-item-idx="24">トーチ<span class="tip-body">たいまつは、半径20フィートまでを明るく照らし、その先20フィートまでを薄暗い明かりで照らす。たいまつは1時間、燃え続ける。君は火の付いた たいまつで近接攻撃を行なうこともでき、命中したなら1[火]ダメージを与える。</span></span></td><td class="text-s text-m">consumable</td><td><span class="nc"><button type="button" class="nc-btn" data-nc="-1">−</button><input type="number" class="e-num" data-action="set-quantity" data-item-idx="24" value="8" min="0"><button type="button" class="nc-btn" data-nc="1">+</button></span></td></tr><tr><td><span class="tip" tabindex="0" data-action="edit-desc" data-item-idx="25">ほくち箱<span class="tip-body">この小箱の中には、火打ち石と打ち金、ほくちが入っている。君は1回のアクションとして、松明や、その他の引火性の強い可燃物に火を付けることができる。それ以外のものに火を付けるには1分かかる。</span></span></td><td class="text-s text-m">loot</td><td><span class="nc"><button type="button" class="nc-btn" data-nc="-1">−</button><input type="number" class="e-num" data-action="set-quantity" data-item-idx="25" value="1" min="0"><button type="button" class="nc-btn" data-nc="1">+</button></span></td></tr><tr><td><span class="tip" tabindex="0" data-action="edit-desc" data-item-idx="26">ピトン<span class="tip-body">登攀用ハンマーで登攀面の継ぎ目に打ち込む金属製のスパイク。鉄のスパイクのように、いざというときにドアを塞ぐために使うこともできる。</span></span></td><td class="text-s text-m">consumable</td><td><span class="nc"><button type="button" class="nc-btn" data-nc="-1">−</button><input type="number" class="e-num" data-action="set-quantity" data-item-idx="26" value="10" min="0"><button type="button" class="nc-btn" data-nc="1">+</button></span></td></tr><tr><td><span class="tip" tabindex="0" data-action="edit-desc" data-item-idx="27">ハンマー（鎚）<span class="tip-body">柄の先に直角に重い金属製の頭を取り付けた工具で、物を壊したり、釘を打ったりする作業に使用します。</span></span></td><td class="text-s text-m">loot</td><td><span class="nc"><button type="button" class="nc-btn" data-nc="-1">−</button><input type="number" class="e-num" data-action="set-quantity" data-item-idx="27" value="1" min="0"><button type="button" class="nc-btn" data-nc="1">+</button></span></td></tr><tr><td><span class="tip" tabindex="0" data-action="edit-desc" data-item-idx="32">偽造用具<span class="tip-body">Tool, 無
			
				15 gp, 5 lb.
				  
			
		
		
		偽造用具は、文書のニセものを作り、特定人物の印章や署名をまねるのに役立つようにできている。 道具の中身. 偽造用具には複数種類のインク、各種の羊皮紙と紙、羽ペン数本、印章と封蝋、箔押しに使う金箔銀箔、溶けた蝋を整形して印章の跡と同じ形にするための小さな道具類が含まれる。 〈魔法学〉. 偽造用具を〈魔法学〉技能と組み合せて使うことで、魔法のアイテムが本物かニセものかを判断できる。 〈ペテン〉. 精巧な偽造品、たとえば君が貴族であることを示す偽造文書や偽造通行証があると、ウソがさらにもっともらしくなる。 〈歴史〉. 偽造用具を歴史知識と組み合せて使うことで、ニセの歴史的文書を作ることや、古い文書が本物かどうかを見分けることができる。 〈捜査〉. 物体を検分する際、偽造用具に習熟していると、その物体がどうやって作られているか、本物かどうかを見分けるのに役立つ。 他の道具. 他の道具の知識があれば、君の偽造はさらにもっともらしくなる。たとえば偽造用具の習熟と地図作成用品の習熟を組み合せてニセ地図を作るなど。 ニセ文書高速作成. 小休憩の一部として、長さ1ページ以下の偽造文書を作成できる。大休憩の一部として、長さ4ページ以下の偽造文書を作成できる。君の偽造用具を使った【知力】判定の結果が、他の者がその文書をにせものだと気づくための【知力】〈捜査〉判定の難易度になる。偽造用具用途難易度筆跡をまねる15封蝋に捺された印を模造する20See the Tool Proficiencies entry for more information.</span></span></td><td class="text-s text-m">tool</td><td><span class="nc"><button type="button" class="nc-btn" data-nc="-1">−</button><input type="number" class="e-num" data-action="set-quantity" data-item-idx="32" value="1" min="0"><button type="button" class="nc-btn" data-nc="1">+</button></span></td></tr><tr><td><span class="tip" tabindex="0" data-action="edit-desc" data-item-idx="33">携帯用炊事用具<span class="tip-body">錫でできた入れ物の中には、1つのコップ、ナイフ、フォーク、スプーンなどが入っている。さらに入れ物自体が2つに分かれ、一方は平鍋、もう一方は皿として使用できる。</span></span></td><td class="text-s text-m">loot</td><td><span class="nc"><button type="button" class="nc-btn" data-nc="-1">−</button><input type="number" class="e-num" data-action="set-quantity" data-item-idx="33" value="1" min="0"><button type="button" class="nc-btn" data-nc="1">+</button></span></td></tr><tr><td><span class="tip" tabindex="0" data-action="edit-desc" data-item-idx="34">携帯用寝具<span class="tip-body">旅人が寝るときに使う、丸められた布。</span></span></td><td class="text-s text-m">loot</td><td><span class="nc"><button type="button" class="nc-btn" data-nc="-1">−</button><input type="number" class="e-num" data-action="set-quantity" data-item-idx="34" value="1" min="0"><button type="button" class="nc-btn" data-nc="1">+</button></span></td></tr><tr><td><span class="tip" tabindex="0" data-action="edit-desc" data-item-idx="35">まきびし<span class="tip-body">君は1回のアクションとして、まきびしを5×5フィートの平らな床にバラまくことができる。この範囲に入ったクリーチャーは、難易度15【敏捷力】セーヴィング･スローを行ない、失敗するとその場所で移動を止め、さらに1[刺突]ダメージを受ける。これによりダメージを受けたクリーチャーは、1点以上のHPを回復しない限り、移動速度が10フィート減少する。あるいは半分の移動速度で移動するなら、そのセーヴィング･スローを行なう必要は無い。</span></span></td><td class="text-s text-m">consumable</td><td><span class="nc"><button type="button" class="nc-btn" data-nc="-1">−</button><input type="number" class="e-num" data-action="set-quantity" data-item-idx="35" value="2" min="0"><button type="button" class="nc-btn" data-nc="1">+</button></span></td></tr><tr><td><span class="tip" tabindex="0" data-action="edit-desc" data-item-idx="36">ずだ袋<span class="tip-body">1立方フィート / 300ポンドの物を入れることができる。</span></span></td><td class="text-s text-m">container</td><td><span class="nc"><button type="button" class="nc-btn" data-nc="-1">−</button><input type="number" class="e-num" data-action="set-quantity" data-item-idx="36" value="1" min="0"><button type="button" class="nc-btn" data-nc="1">+</button></span></td></tr><tr><td><span class="tip" tabindex="0" data-action="edit-desc" data-item-idx="37">呪文構成要素ポーチ<span class="tip-body">この防水性の小さなポーチは、物質要素として呪文の発動に必要とされる特殊な物が、小さな仕切りで小分けされて入っている。しかし、呪文の説明欄で価格が明記された物質要素は含まれていない。</span></span></td><td class="text-s text-m">container</td><td><span class="nc"><button type="button" class="nc-btn" data-nc="-1">−</button><input type="number" class="e-num" data-action="set-quantity" data-item-idx="37" value="1" min="0"><button type="button" class="nc-btn" data-nc="1">+</button></span></td></tr><tr><td><span class="tip" tabindex="0" data-action="edit-desc" data-item-idx="38">ファインド・ファミリアの構成要素<span class="tip-body">(説明なし)</span></span></td><td class="text-s text-m">consumable</td><td><span class="nc"><button type="button" class="nc-btn" data-nc="-1">−</button><input type="number" class="e-num" data-action="set-quantity" data-item-idx="38" value="1" min="0"><button type="button" class="nc-btn" data-nc="1">+</button></span></td></tr><tr><td><span class="tip" tabindex="0" data-action="edit-desc" data-item-idx="45">呪文スクロール: スリープ<span class="tip-body">1レベル &amp;Reference[Spell Scroll]この呪文よクリーチャーを魔法の眠りへといざなう。5d8をロールすること。その合計値がこの呪文が作用するクリーチャーのヒット・ポイントの総計となる。射程内の君が選択した1点から20ft​以内にいるクリーチャーは､その現在ヒット・ポイントの低い順からこの呪文の作用を受ける (気絶状態のクリーチャーは無視すること) 。
現在ヒソト・ポイントが最も低いクリーチャーから順に､‘‘作用するクリーチャーのヒット・ポイントの合計値"(=5d8の合計値) から作用を受けたク) ーチャーのヒット・ポイントを差し引いてゆき､現在ヒット・ポイントが次に低いクリーチャーに移っていく。あるクリーチャーに作用を及ぽすためには､残りの“合計値”がそのクリーチャーの現在ヒット・ポイントよりも多くなければならない。この呪文の作用を受けたクリーチャーはみな眠ってしまい､この呪文が終了するか､寝ている者がダメージを受けるか､あるいは誰かがアクションを使って寝ている者を起こすために揺り動かしたり引っ叩いたりするまで､気絶状態に陥る。アンデッド､および魅了状態に完全耐性を持つクリーチャーはこの呪文の作用を受けない。
高レベル発動：君がこの呪文を2レベル以上の呪文スロットを用いて発動する場合､スロットのレベルが1レベルを1上回るごとに2d8を追加でロールする。</span></span></td><td class="text-s text-m">consumable</td><td><span class="nc"><button type="button" class="nc-btn" data-nc="-1">−</button><input type="number" class="e-num" data-action="set-quantity" data-item-idx="45" value="1" min="0"><button type="button" class="nc-btn" data-nc="1">+</button></span></td></tr><tr><td><span class="tip" tabindex="0" data-action="edit-desc" data-item-idx="50">クロスボウ・ボルト・ケース<span class="tip-body">クロスボウ・ボルトを最大20本収納できる木製ケースです。</span></span></td><td class="text-s text-m">container</td><td><span class="nc"><button type="button" class="nc-btn" data-nc="-1">−</button><input type="number" class="e-num" data-action="set-quantity" data-item-idx="50" value="1" min="0"><button type="button" class="nc-btn" data-nc="1">+</button></span></td></tr><tr><td><span class="tip" tabindex="0" data-action="edit-desc" data-item-idx="51">鋼鉄製の鏡<span class="tip-body">鉄でできた鏡。</span></span></td><td class="text-s text-m">loot</td><td><span class="nc"><button type="button" class="nc-btn" data-nc="-1">−</button><input type="number" class="e-num" data-action="set-quantity" data-item-idx="51" value="1" min="0"><button type="button" class="nc-btn" data-nc="1">+</button></span></td></tr><tr><td><span class="tip" tabindex="0" data-action="edit-desc" data-item-idx="52">ゲーム用カード一揃い<span class="tip-body">このアイテムは、無印と有印を問わず、幅広い種類のトランプを網羅しています。
君があるゲーム・セットに習熟している場合、そのセットを使ってゲームをプレイするための能力判定に習熟ボーナスを加えることができる。ゲーム・セットの種類ごとに、個別の習熟が必要である。</span></span></td><td class="text-s text-m">tool</td><td><span class="nc"><button type="button" class="nc-btn" data-nc="-1">−</button><input type="number" class="e-num" data-action="set-quantity" data-item-idx="52" value="1" min="0"><button type="button" class="nc-btn" data-nc="1">+</button></span></td></tr><tr><td><span class=" eq-toggle" style="color:var(--td)" data-action="toggle-equip" data-item-idx="53">◇</span> <span class="tip" tabindex="0" data-action="edit-desc" data-item-idx="53">Reed Whistle of Confusion<span class="tip-body">Blowing this whistle acts as casting the spell confusion with a 4th level spell slot. The DC for the saving throw is 15. After this whistle has been used once, it is destroyed.</span></span></td><td class="text-s text-m">equipment</td><td><span class="nc"><button type="button" class="nc-btn" data-nc="-1">−</button><input type="number" class="e-num" data-action="set-quantity" data-item-idx="53" value="1" min="0"><button type="button" class="nc-btn" data-nc="1">+</button></span></td></tr><tr><td><span class="tip" tabindex="0" data-action="edit-desc" data-item-idx="55">ポーション・オヴ・ヒーリング／癒しの水薬<span class="tip-body">ポーションの赤い液体をゆらすと、ほのかな光輝を放つ。
このポーションを飲むことで、2d4 + 2ヒットポイントが回復する。</span></span></td><td class="text-s text-m">consumable</td><td><span class="nc"><button type="button" class="nc-btn" data-nc="-1">−</button><input type="number" class="e-num" data-action="set-quantity" data-item-idx="55" value="2" min="0"><button type="button" class="nc-btn" data-nc="1">+</button></span></td></tr><tr><td><span class="tip" tabindex="0" data-action="edit-desc" data-item-idx="56">エレメンタル・ジェム／エレメンタルの宝石<span class="tip-body">その他の魔法のアイテム
この青いサファイアには、元素のエネルギーの欠片が含まれています。この宝石を壊すアクションを行うと、@UUID[Compendium.dnd5e.monsters.Actor.banHjKDMCegbUwYE]が、@UUID[Compendium.dnd5e.spells.Item.1LkZvINag7KqBmDR]呪文を行使するかのように召喚されて、この宝石から魔力が失われる。</span></span></td><td class="text-s text-m">consumable</td><td><span class="nc"><button type="button" class="nc-btn" data-nc="-1">−</button><input type="number" class="e-num" data-action="set-quantity" data-item-idx="56" value="1" min="0"><button type="button" class="nc-btn" data-nc="1">+</button></span></td></tr><tr><td><span class="tip" tabindex="0" data-action="edit-desc" data-item-idx="61">ファッショナブルな革のブーツ<span class="tip-body">小洒落た雰囲気のブーツだ。都会でならこれを身につけていればオシャレさん扱いだろう。特に戦略的なアドバンテージはない。</span></span></td><td class="text-s text-m">loot</td><td><span class="nc"><button type="button" class="nc-btn" data-nc="-1">−</button><input type="number" class="e-num" data-action="set-quantity" data-item-idx="61" value="1" min="0"><button type="button" class="nc-btn" data-nc="1">+</button></span></td></tr></tbody></table><div class="coins"><span class="coin coin-pp"><span class="cl">PP</span> <span class="nc"><button type="button" class="nc-btn" data-nc="-1">−</button><input type="number" class="e-coin" data-action="set-currency" data-coin="pp" value="0" min="0"><button type="button" class="nc-btn" data-nc="1">+</button></span></span><span class="coin coin-gp"><span class="cl">GP</span> <span class="nc"><button type="button" class="nc-btn" data-nc="-1">−</button><input type="number" class="e-coin" data-action="set-currency" data-coin="gp" value="24" min="0"><button type="button" class="nc-btn" data-nc="1">+</button></span></span><span class="coin coin-ep"><span class="cl">EP</span> <span class="nc"><button type="button" class="nc-btn" data-nc="-1">−</button><input type="number" class="e-coin" data-action="set-currency" data-coin="ep" value="0" min="0"><button type="button" class="nc-btn" data-nc="1">+</button></span></span><span class="coin coin-sp"><span class="cl">SP</span> <span class="nc"><button type="button" class="nc-btn" data-nc="-1">−</button><input type="number" class="e-coin" data-action="set-currency" data-coin="sp" value="8" min="0"><button type="button" class="nc-btn" data-nc="1">+</button></span></span><span class="coin coin-cp"><span class="cl">CP</span> <span class="nc"><button type="button" class="nc-btn" data-nc="-1">−</button><input type="number" class="e-coin" data-action="set-currency" data-coin="cp" value="9" min="0"><button type="button" class="nc-btn" data-nc="1">+</button></span></span></div></div></div></div><div class="pers-grid"><div class="pers-box clickable" data-action="edit-detail" data-detail-key="trait"><div class="lbl">性格特徴</div><div class="ct"><p>どんなときでも冗談を言わずにはいられない</p><p></p></div></div><div class="pers-box clickable" data-action="edit-detail" data-detail-key="ideal"><div class="lbl">理想</div><div class="ct"><p>物は入っては出ていくが、友情は永遠だ</p></div></div><div class="pers-box clickable" data-action="edit-detail" data-detail-key="bond"><div class="lbl">絆</div><div class="ct"><p>私は手を出すべきではない相手を騙してしまった</p></div></div><div class="pers-box clickable" data-action="edit-detail" data-detail-key="flaw"><div class="lbl">弱点</div><div class="ct"><p>自分は騙すことがあっても騙されることはないと思い込んでいる</p></div></div></div><div class="sec"><div class="sec-title">習熟・言語</div><div class="pl-grid"><div class="pl-grp"><div class="lbl">言語</div><div class="items"><span class="pill">common</span><span class="pill">goblin</span></div></div><div class="pl-grp"><div class="lbl">武器習熟</div><div class="items"><span class="pill">単純武器</span></div></div><div class="pl-grp"><div class="lbl">防具習熟</div><div class="items"><span class="pill">軽装鎧</span></div></div></div></div><div class="sec"><div class="sec-title">特徴・特技</div><div class="feat-item"><span class="fn"><span class="tip" tabindex="0" data-action="edit-desc" data-item-idx="1">この世ならぬ契約相手<span class="tip-body">1レベル時点で、君はすでに、@Compendium[dnd5e.subclasses.WPFVBg589uI8iOMH]{フィーンド}などのこの世ならぬなにものかと契約を済ませている。この選択によって、君が1、6、10、14レベルで得る特徴が決定される。</span></span></span><span class="fs">ウォーロック 1</span><div class="fd">1レベル時点で、君はすでに、@Compendium[dnd5e.subclasses.WPFVBg589uI8iOMH]{フィーンド}などのこの世ならぬなにものかと契約を済ませている。この選択によって、君が1、6、10、14レベルで得る特徴が決定される。</div></div><div class="feat-item"><span class="fn"><span class="tip" tabindex="0" data-action="edit-desc" data-item-idx="2">契約による魔術<span class="tip-body">君は秘術の研究と、契約相手から与えられた魔力によって、呪文を自在に操れるようになった。呪文発動の一般則は第10章、ウォーロック呪文リストは第11章を参照。
初級呪文
1レベルの時点で、君はウォーロック呪文リストから2種類の初級呪文を修得している。さらに、レベルアップにともない、『ウォーロック』表の『修得初級呪文』の項にある通り、追加でウォーロックの初級呪文を学んでゆく。
呪文スロット
君が1レベルおよびそれ以後のレベルにおいて、呪文発動のための呪文スロットをどれだけ有するかは、『ウォーロック』表に示してある。君の呪文スロットはすべて同じレベルである。1レベル以上のウォーロック呪文を1つ発動するには、呪文スロットを1つ消費せねばならない。君は、小休憩または大休憩を終えるたび、消費済の呪文スロットをすべて回復する。たとえば5レベル・ウォーロックは3レベル呪文スロットを2つ有している。1レベル呪文のウィッチ・ボルトを発動するにも、この3レベル呪文スロットを1つ使用せねばならず、そしてその呪文は3レベル呪文として発動される。
1レベル以上の修得呪文
1レベルの時点で、君はウォーロック呪文リストから任意の2種類の1レベル呪文を修得している。『ウォーロック』表の修得呪文の項には、君がどの段階で1レベル以上のウォーロック呪文を追加で修得してゆくかが示されている。選択する呪文は、表のスロット・レベルの欄にある数字以下のレベルのものに限られる。たとえば君は6レベルになった時点で新しいウォーロック呪文を1つ修得するが、それは1~3レベルのものでなければならない。また君は、このクラスのレベルを得るたびに、修得しているウォーロック呪文のうち1つを、ウォーロック呪文リストの中から選んだ任意の呪文1つと入れ替えることができる。新しい呪文は君が呪文スロットを有しているレベルのものでなければならない。



レベル
初級呪文習得
呪文修得数
呪文スロット
スロット・レベル




1
2
2
1
1


2
2
3
2
1


3
2
4
2
2


4
3
5
2
2


5
3
6
2
3


6
3
7
2
3


7
3
8
2
4


8
3
9
2
4


9
3
10
2
5


10
4
10
2
5


11
4
11
3
5


12
4
11
3
5


13
4
12
3
5


14
4
12
3
5


15
4
13
3
5


16
4
13
3
5


17
4
14
4
5


18
4
14
4
5


19
4
15
4
5


20
4
15
4
5



呪文発動能力値
君のウォーロック呪文発動能力値は【魅力】である。呪文に"呪文発動能力値"とある場合、君は常に【魅力】を使う。加えて、君が発動するウォーロック呪文のセーヴ難易度を決定する際や、ウォーロック呪文の攻撃ロールを行なう際にも【魅力】を使う。呪文のセーヴ難易度 = 8+君の習熟ボーナス+君の【魅力】修正値呪文攻撃の修正値 = 君の習熟ボーナス+君の【魅力】修正値
呪文発動の焦点具
君はウォーロック呪文発動の焦点具として秘術焦点具（第5章「装備」参照）を使うことができる。</span></span></span><span class="fs">ウォーロック 1</span><div class="fd">君は秘術の研究と、契約相手から与えられた魔力によって、呪文を自在に操れるようになった。呪文発動の一般則は第10章、ウォーロック呪文リストは第11章を参照。
初級呪文
1レベルの時点で、君はウォーロック呪文リストから2種類の初級呪文を修得している。さらに、レベルアップにともない、『ウォーロック』表の『修得初級呪文』の項にある通り、追加でウォーロックの初級呪文を学んでゆく。
呪文スロット
君が1レベルおよびそれ以後のレベルにおいて、呪文発動のための呪文スロットをどれだけ有するかは、『ウォーロック』表…</div></div><div class="feat-item"><span class="fn"><span class="tip" tabindex="0" data-action="edit-desc" data-item-idx="4">Expanded Spell List<span class="tip-body">The Fiend lets you choose from an expanded list of spells when you learn a warlock spell. The following spells are added to the warlock spell list for you.
Fiend Expanded Spells



Spell Level
Spells





1st


burning hands, command




2nd


blindness/deafness, scorching ray




3rd


fireball, stinking cloud




4th


fire shield, wall of fire




5th


flame strike, hallow</span></span></span><span class="fs">The Fiend 1</span><div class="fd">The Fiend lets you choose from an expanded list of spells when you learn a warlock spell. The following spells are added to the warlock spell list for you.
Fiend Expanded Spells



Spell Level
Spells





1st


burning hands, command




2nd


blindn…</div></div><div class="feat-item"><span class="fn"><span class="tip" tabindex="0" data-action="edit-desc" data-item-idx="5">Dark One’s Blessing<span class="tip-body">Starting at 1st level, when you reduce a hostile creature to 0 hit points, you gain temporary hit points equal to your Charisma modifier + your warlock level (minimum of 1).</span></span></span><span class="fs">The Fiend 1</span><div class="fd">Starting at 1st level, when you reduce a hostile creature to 0 hit points, you gain temporary hit points equal to your Charisma modifier + your warlock level (minimum of 1).</div></div><div class="feat-item"><span class="fn"><span class="tip" tabindex="0" data-action="edit-desc" data-item-idx="7">役者<span class="tip-body">物まねや演技の技を身につけた君は、以下の利益を得る：君の【魅力】の数値を1上昇させる(最大値20)君は別人を装って状況を切り抜ける際の【魅力】〈ペテン〉および【魅力】〈芸能〉の判定に有利を得る。君は他の人の話し方や、他のクリーチャーの作り出す音を真似ることができる。そのためには、真似しようとしている人物の話しているところや、そのクリーチャーが音を立てているところを少なくとも1分間は聞いたことがなければならない。その音を聞いたものは、君の【魅力】〈ペテン〉に対して【判断力】〈看破〉で対抗判定を行い、勝利したならその音が偽者だとわかる。</span></span></span><span class="fs">feat</span><div class="fd">物まねや演技の技を身につけた君は、以下の利益を得る：君の【魅力】の数値を1上昇させる(最大値20)君は別人を装って状況を切り抜ける際の【魅力】〈ペテン〉および【魅力】〈芸能〉の判定に有利を得る。君は他の人の話し方や、他のクリーチャーの作り出す音を真似ることができる。そのためには、真似しようとしている人物の話しているところや、そのクリーチャーが音を立てているところを少なくとも1分間は聞いたことがなければならない。その音を聞いたものは、君の【魅力】〈ペテン〉に対して【判断力】〈看破〉で対抗判定を行い…</div></div><div class="feat-item"><span class="fn"><span class="tip" tabindex="0" data-action="edit-desc" data-item-idx="13">身元偽装<span class="tip-body">君はもうひとつの身元素性の設定をつくりあげてある。必要な文書も、設定に対応した知人も、変装も用意した。その人格になりすます用意はばっちりだ。かてて加えて、君は公文書や個人的な手紙などの文書を偽造できる（ただし、範例となる同種の文書や、真似ようとする筆跡を目にしたことがある場合に限る） 。</span></span></span><span class="fs">イカサマ師</span><div class="fd">君はもうひとつの身元素性の設定をつくりあげてある。必要な文書も、設定に対応した知人も、変装も用意した。その人格になりすます用意はばっちりだ。かてて加えて、君は公文書や個人的な手紙などの文書を偽造できる（ただし、範例となる同種の文書や、真似ようとする筆跡を目にしたことがある場合に限る） 。</div></div><div class="feat-item"><span class="fn"><span class="tip" tabindex="0" data-action="edit-desc" data-item-idx="30">妖術<span class="tip-body">君は以下の契約の妖術から、クラス表の契約の妖術に等しい数の妖術を得ることができる。レベルアップするたびに君は取得した妖術を一つを取得可能な他のものと入れ替えることができる。
契約の妖術
妖術に前提条件が指定されている場合、それを満たすことで取得できる。前提条件を満たしたそのレベルで取得可能である。レベルとは君のウォーロックレベルを指す。



前提条件
恩寵


クラスレベル
その他




2nd
@Compendium[dnd5e.spells.Z9p1vezIn95jw1Yw]
@Compendium[dnd5e.classfeatures.2fyuw7MiCnocDeAU]



@Compendium[dnd5e.classfeatures.alUqO6c6OEKFQJdb]



@Compendium[dnd5e.classfeatures.61kXR1sniXHjvN17]



@Compendium[dnd5e.classfeatures.eNvpIaSnJUdF8fHl]


@Compendium[dnd5e.classfeatures.MYM908WLZ1lVvA1u]
@Compendium[dnd5e.classfeatures.CFIYXDmbmSP8BXjN]



@Compendium[dnd5e.classfeatures.3sN91lT1R3oxcDKd]



@Compendium[dnd5e.classfeatures.bbUEsCPTLzbbwK6o]


@Compendium[dnd5e.spells.Z9p1vezIn95jw1Yw]
@Compendium[dnd5e.classfeatures.r01WtcxTg4yTHm9m]



@Compendium[dnd5e.classfeatures.lEZKbWaVrSljRa9n]



@Compendium[dnd5e.classfeatures.id0gmGvzNZBEdzbx]



@Compendium[dnd5e.classfeatures.65ReXU4ZWqcSs3Cm]



@Compendium[dnd5e.classfeatures.MhJfdBl1B7PdU4oZ]



@Compendium[dnd5e.classfeatures.k5DU0mMuYVHejiqz]


@Compendium[dnd5e.spells.Z9p1vezIn95jw1Yw]
@Compendium[dnd5e.classfeatures.rdBPd6CwqXT64iJM]



@Compendium[dnd5e.classfeatures.rhbwDZ9XNTmdkX2u]


@Compendium[dnd5e.classfeatures.Ic1CSjvbWKudVUv9]
@Compendium[dnd5e.classfeatures.k5M8gsl7MMcdjOjs]


5th

@Compendium[dnd5e.classfeatures.DjXi0IkCTbJx1gsp]



@Compendium[dnd5e.classfeatures.KfnUyjUWAk0bAAus]



@Compendium[dnd5e.classfeatures.dTSV0xZMpY5CxkRk]


@Compendium[dnd5e.classfeatures.9dSSa68mIPoX2ezA]
@Compendium[dnd5e.classfeatures.pJADgAxxefgcATWr]


7th

@Compendium[dnd5e.classfeatures.KygHql3cTj4IRrvZ]



@Compendium[dnd5e.classfeatures.QBk1RsuTIEF4GEBC]



@Compendium[dnd5e.classfeatures.Xa2MLUJGCReJ28B7]


9th

@Compendium[dnd5e.classfeatures.QEuH5TeBN4PPYT2g]



@Compendium[dnd5e.classfeatures.QnRKYXb2bXpnNd2k]



@Compendium[dnd5e.classfeatures.8zciiglzEOZo7DDN]



@Compendium[dnd5e.classfeatures.gFjxo01hAN4c9hDG]


12th
@Compendium[dnd5e.classfeatures.9dSSa68mIPoX2ezA]
@Compendium[dnd5e.classfeatures.zUIAzBnyt0NDvVXb]


15th
@Compendium[dnd5e.classfeatures.Ic1CSjvbWKudVUv9]
@Compendium[dnd5e.classfeatures.Phy02H5x0TKHd7T3]



@Compendium[dnd5e.classfeatures.lxfdjLer3uKjyZqU]



@Compendium[dnd5e.classfeatures.zYIdNAjqRyhS6qWs]



@Compendium[dnd5e.classfeatures.snsjxGfmzWfZR5Nh]



選択した恩寵をキャラクターシートにドラッグ＆ドロップすると獲得できます。</span></span></span><span class="fs">ウォーロック 2</span><div class="fd">君は以下の契約の妖術から、クラス表の契約の妖術に等しい数の妖術を得ることができる。レベルアップするたびに君は取得した妖術を一つを取得可能な他のものと入れ替えることができる。
契約の妖術
妖術に前提条件が指定されている場合、それを満たすことで取得できる。前提条件を満たしたそのレベルで取得可能である。レベルとは君のウォーロックレベルを指す。



前提条件
恩寵


クラスレベル
その他




2nd
@Compendium[dnd5e.spells.Z9p1vezIn95jw1Yw]
@Comp…</div></div><div class="feat-item"><span class="fn"><span class="tip" tabindex="0" data-action="edit-desc" data-item-idx="31">苦悶の怪光線<span class="tip-body">@UUID[Compendium.dnd5e.sells.Item.Z9p1vezIn95jw1Yw]{エルドリッチ・ブラスト／怪光線}を発動する際、その呪文がヒット時に与えるダメージに君の【魅力】修正値を足す</span></span></span><span class="fs">ウォーロック 2, エルドリッチ・ブラスト</span><div class="fd">@UUID[Compendium.dnd5e.sells.Item.Z9p1vezIn95jw1Yw]{エルドリッチ・ブラスト／怪光線}を発動する際、その呪文がヒット時に与えるダメージに君の【魅力】修正値を足す</div></div><div class="feat-item"><span class="fn"><span class="tip" tabindex="0" data-action="edit-desc" data-item-idx="39">契約の恩恵<span class="tip-body">3レベルの時点で、この世ならぬ契約相手は、君の忠実な奉仕を愛でて贈物を贈る。君は以下の特徴のうち1つを得る。
@Compendium[dnd5e.classfeatures.9dSSa68mIPoX2ezA]{剣の契約}
@Compendium[dnd5e.classfeatures.MYM908WLZ1lVvA1u]{書の契約}
@Compendium[dnd5e.classfeatures.Ic1CSjvbWKudVUv9]{鎖の契約}</span></span></span><span class="fs">ウォーロック 3</span><div class="fd">3レベルの時点で、この世ならぬ契約相手は、君の忠実な奉仕を愛でて贈物を贈る。君は以下の特徴のうち1つを得る。
@Compendium[dnd5e.classfeatures.9dSSa68mIPoX2ezA]{剣の契約}
@Compendium[dnd5e.classfeatures.MYM908WLZ1lVvA1u]{書の契約}
@Compendium[dnd5e.classfeatures.Ic1CSjvbWKudVUv9]{鎖の契約}</div></div><div class="feat-item"><span class="fn"><span class="tip" tabindex="0" data-action="edit-desc" data-item-idx="40">鎖の契約<span class="tip-body">君は@Compendium[dnd5e.spells.JGT5bNqu9REL7Fuz]の呪文を修得し、これを儀式として発動できる。この呪文は君の呪文修得数を数える際には計算に入れない。君はこの呪文を発動する際、使い魔の形態として通常のものを選択してもよいし、「@Compendium[dnd5e.monsters.dLQiESMsfsXijD5c]{Imp}」、「pseudodragon,」「@Compendium[dnd5e.monsters.bwtkdzavdNHISgp4]{Quasit}」「@Compendium[dnd5e.monsters.MUpBNDoJEr09bLaO]{Sprite}」の中から選択しても良い。

　また、君は攻撃アクションを行なう際、自分の攻撃のうち1回分を取り止めにして、代わりに使い魔にリアクションとして使い魔自身の攻撃を1回行なわせることもできる。</span></span></span><span class="fs">ウォーロック 3</span><div class="fd">君は@Compendium[dnd5e.spells.JGT5bNqu9REL7Fuz]の呪文を修得し、これを儀式として発動できる。この呪文は君の呪文修得数を数える際には計算に入れない。君はこの呪文を発動する際、使い魔の形態として通常のものを選択してもよいし、「@Compendium[dnd5e.monsters.dLQiESMsfsXijD5c]{Imp}」、「pseudodragon,」「@Compendium[dnd5e.monsters.bwtkdzavdNHISgp4]{Quasit}…</div></div><div class="feat-item"><span class="fn"><span class="tip" tabindex="0" data-action="edit-desc" data-item-idx="41">鎖契約者の魔力付与<span class="tip-body">前提条件：@Compendium[completecompendium.classfeatures-PHB.鎖の契約]の特徴　君は@Compendium[completecompendium.betterspells.ファインド・ファミリアー]呪文を発動する際、召喚した使い魔に自分の魔力の一部を吹き込み、以下のすべての利益を与える：君の使い魔は飛行移動速度40フィートまたは水泳移動速度40フィートを得る（君が選択）。君は1回のボーナス・アクションとして、使い魔に1回の攻撃アクションを行なわせることができる。君の使い魔の武器攻撃は、非魔法的攻撃に対する抵抗および完全耐性を克服する際には、魔法的なものとみなされる。君の使い魔がクリーチャーにセーヴィング・スローを行なわせる際、そのセーヴ難易度は君の呪文セーヴ難易度に等しい。君の使い魔がダメージを受けた時、君はリアクションを使用して、使い魔にそのダメージに対する抵抗を与えることができる。</span></span></span><span class="fs">ウォーロック Lv2、鎖の契約</span><div class="fd">前提条件：@Compendium[completecompendium.classfeatures-PHB.鎖の契約]の特徴　君は@Compendium[completecompendium.betterspells.ファインド・ファミリアー]呪文を発動する際、召喚した使い魔に自分の魔力の一部を吹き込み、以下のすべての利益を与える：君の使い魔は飛行移動速度40フィートまたは水泳移動速度40フィートを得る（君が選択）。君は1回のボーナス・アクションとして、使い魔に1回の攻撃アクションを行なわせるこ…</div></div><div class="feat-item"><span class="fn"><span class="tip" tabindex="0" data-action="edit-desc" data-item-idx="44">暗黒の祝福<span class="tip-body">1レベル以降、君は敵対的なクリーチャーのヒット・ポイントを0にするたびに、君の【魅力】修正値+君のウォーロック・レベルに等しい一時的ヒット・ポイントを得る(最低でも1は得る)。</span></span></span><span class="fs">フィーンド 1</span><div class="fd">1レベル以降、君は敵対的なクリーチャーのヒット・ポイントを0にするたびに、君の【魅力】修正値+君のウォーロック・レベルに等しい一時的ヒット・ポイントを得る(最低でも1は得る)。</div></div><div class="feat-item"><span class="fn"><span class="tip" tabindex="0" data-action="edit-desc" data-item-idx="58">悪魔の目<span class="tip-body">魔法の暗聞や魔法でない暗閣の中でも、距離120フィートまで、通常に物を見ることができる。</span></span></span><span class="fs">ウォーロック 2</span><div class="fd">魔法の暗聞や魔法でない暗閣の中でも、距離120フィートまで、通常に物を見ることができる。</div></div></div><div class="sec"><div class="sec-title">呪文</div><div class="sp-meta"><div><b>呪文発動能力:</b> 魅力</div><div><b>呪文セーヴDC:</b> 15</div><div><b>呪文攻撃:</b> +7</div></div><details class="sp-lv" open=""><summary>キャントリップ (3)</summary><div class="sp-lv-body"><div class="sp-entry"><span class="prep ">●</span><span class="sn"><span class="tip" tabindex="0" data-action="edit-desc" data-item-idx="28">エルドリッチ・ブラスト<span class="tip-body">射程内のクリーチャー1体めがけて､バチバチと鳴るエネルギー光線が放たれる目標に対して1回の遠隔呪文攻撃を行うこと。これがヒットすると目標は1d10 [力場] ダメージを受ける。
この呪文は君のレベルが特定の値に上昇するごとに追加の光線を作り出す､すなわち5レベルで2本､11レベルで3本､17レベルで4本である。君よこれらの光線を同一の目標に向けてもよいし､別々の目標に向けてもよい。光線1本ごとに別々の攻撃ロールを行うこと。</span></span></span><span class="sd">力術 · action · 射程:120</span></div><div class="sp-entry"><span class="prep ">●</span><span class="sn"><span class="tip" tabindex="0" data-action="edit-desc" data-item-idx="46">メイジ・ハンド<span class="tip-body">射程内の君が選んだ地点に、幽霊のような空中に浮遊する手が1つ出現する。この手は持続時間の間じゅう、もしくは君がアクションとして消すまで、存在し続ける。この手は君から30フィートより遠くに離れた場合、あるいは君がこの呪文をもう1度発動したなら消滅する。君はアクションを使うことで、この手を操ることができる。この手を使って1つの物体を操作したり、鍵のかかっていない扉や容器1つを開いたり、開いた容器にアイテム1つをしまったり、取り出したり、あるいは1本の瓶の中身を注いだりできる。君はこの手を操るたびに最大30フィートまでこの手を移動させることができる。この手は攻撃を行なったり、魔法のアイテムを起動したり、あるいは10ポンドを超える物を迎搬することはできない。</span></span></span><span class="sd">召喚 · action · 射程:30 · 持続:1</span></div><div class="sp-entry"><span class="prep ">●</span><span class="sn"><span class="tip" tabindex="0" data-action="edit-desc" data-item-idx="47">マイナー・イリュージョン<span class="tip-body">君は射程内に、持続時間の間持続する1種類の音、あるいは1種類の映像のうち、どちらか1つを作り出す。この幻は君が1回のアクションとして解除するか、この呪文をもう1度発動した時点で終了する。
1種類の音を作り出した場合、その音磁はささやき声から絶叫の間まで設定できる。その音は君の声や他の誰かの声、ライオンの咆晦や太鼓を叩く音、その他どんな音をも選ぶことができる。その音は持続時間の間中ずっと衰えずに続くが、君は呪文が終わる前なら、それぞれ別のタイミングで不連続に音を嗚らすこともできる。
物体の映像、例えば椅子や泥の足跡、小さな宝箱などを作り出す場合、その映像の大きさは一辺5フィートの立方体以下でなければならない。この映像は音を立てることも、光や匂いを放つことも、その他いかなる感覚的な効果も作り出すこともない。映像と物理的なやり取りを行なえば、それが幻と言うことはただちに判明する。なぜなら、物がその映像を通り抜けてしまうからだ。
クリーチャーがそのアクションを使ってこの呪文による音や映像を確かめようとするなら、そのクリーチャーは君の呪文セーヴィング・スロ一難易度に対して、【知力】〈捜査〉の判定を行なう。成功したならば、それが幻と識別できる。クリーチャーがそれを幻だと識別したなら、そのクリーチャーにとってその幻はただのぽんやりとしたものとなる。</span></span></span><span class="sd">幻術 · action · 射程:30 · 持続:1</span></div></div></details><details class="sp-lv" open=""><summary>Lv1 (2)</summary><div class="sp-lv-body"><div class="sp-entry"><span class="prep off" data-action="toggle-prepared" data-item-idx="29" title="クリックで準備切替">○</span><span class="sn"><span class="tip" tabindex="0" data-action="edit-desc" data-item-idx="29">ヘクス<span class="tip-body">この呪文が終了するまで、君の攻撃が目標にヒットするたび、君は目標に[[/r 1d6]]の追加［死霊］ダメージを与える。さらに、君はこの呪文を発動する際に1種類の能力値を選ぶ。目標はその能力値を用いて行なう能力値判定に不利を受ける。
この呪文が終了する前に目標のhpが0になったなら、君は次以降の君のターンにボーナス・アクションとして新たなクリーチャー1体を呪うことができる。
目標に対して発動されたリムーヴ・カースはこの呪文を終了させる。



高レベル版：君がこの呪文を3レベルまた4レベルの呪文スロットを用いて発動する場合、君はこの呪文への精神集中を最大8時間まで維持できる。5レベル以上の呪文スロットを用いて発動する場合は最大24時間まで維持できる。</span></span></span><span class="sd">心術 · bonus · 射程:90 · 持続:1</span></div><div class="sp-entry"><span class="prep off" data-action="toggle-prepared" data-item-idx="42" title="クリックで準備切替">○</span><span class="sn"><span class="tip" tabindex="0" data-action="edit-desc" data-item-idx="42">ファインド・ファミリアー<span class="tip-body">君は1体の使い魔すなわち動物の姿をした霊を従者にする。以下の動物から1種類を選ぶこと；アウル (フクロウ) ､ウィーゼル (イタチ) ､オクトパス (タコ) ､キャット (ネコ) ､クラプ (カニ) ､シー・ホース (タツノオトシゴ) ､スパイダー (クモ) ､バット (コウモリ) ､フィッシュ／クイッパー (魚) ､フロッグ／トード (カエル) ､ポイザナス・スネーク (毒蛇) ､ホーク (タカ) ､ラット (ネズミ) ､リザード (トカゲ) ､レイヴン (ワタリガラス) 。君の使い魔は射程内の何ものにも占められていない場所に出現する。使い魔のデータは選んだ動物のデータに等しいが､クリーチャー種別は野獣ではなくセレスチャル､フェイ､フィーンドのいずれかである (君が選ぶ) 。
君の使い魔は君から独立して行動するが､常に君の命令に従う。戦闘においては使い魔自身のイニシアチブをロールし､使い魔自身のターンに行動を行う。使い魔は攻撃を行えないが､他のアクションは通常通り行える。
使い魔のhpが0になった時点で､使い魔は跡形もなく消えうせる。この呪文を再び発動すれば使い魔は再出現する。
君の使い魔が君から100ft​以内にいる限り､君は使い魔とテレパシーで意志相通できる。さらに､君は1回のアクションとして､君の次のターンの開始時まで使い魔の目を通してものを見､使い魔が聞いた音を聞くことができる。この間､君は使い魔が持つ特殊な感覚の利益をすべて得られるが､自分自身の周囲に関しては盲目状態かつ聴覚喪失状態である。
君は1回のアクションとして､自分の使い魔を一時的に退去させることができる。君の使い魔はポケット次元界に消え去り､君の呼び出しを待ち続ける。あるいは､君は自分の使い魔を永遠に退去させることもできる。一時的に使い魔を退去させている間､君は1回のアクションとして､君から30ft​以内の何ものにも占められていない場所に使い魔を再出現させることができる。
1人の術者が2体以上の使い魔を持つことはできない。すでに使い魔を持っている者が再度この呪文を発動すると､新たな使い魔が現れるのではなく､既存の使い魔の姿が変わる。前述の動物のリストから1種類を選ぶこと。君の使い魔は選んだ動物に変化する。
最後に､君が“射程：接触”の呪文を発動する際､君の使い魔がその呪文を発動したかのように､使い魔経由でその呪文を伝達することができる。これを行うためには､君の使い魔は君から100ft​以内にいなければならず､君が接触呪文を発動した際に使い魔がリアクションを消究する必要がある。その呪文が攻撃ロールを要する場合､ (訳注：使い魔のものではなく) 君の攻撃ボーナスを用いてロールを行う。</span></span></span><span class="sd">召喚 · hour · 射程:10</span></div></div></details><details class="sp-lv"><summary>Lv2 (3)</summary><div class="sp-lv-body"><div class="sp-entry"><span class="prep off" data-action="toggle-prepared" data-item-idx="43" title="クリックで準備切替">○</span><span class="sn"><span class="tip" tabindex="0" data-action="edit-desc" data-item-idx="43">ダークネス<span class="tip-body">射程内の君が選択した起点から半径15ft​の球形の範囲を､持続時間の間､魔法の暗闇が拡がって満たす。この暗闇は角を回り込んで拡がる。暗視を持つクリーチャーでもこの暗闇を見通すことはできず､魔法でない明かりはこの暗闇を照らし出すことができない。
君の手にしている物体､あるいは誰にも着用も運搬もされていない物体を起点として選んだなら､暗闇はその物体から拡がり､その物体と共に移動する。なにか不透明なもの (碗や兜など) でこの暗闇の起点となる物体を完全に覆ったなら､暗闇は遮断されてしまう。
もしこの呪文の効果範囲が2レベル以下の呪文によって作られた光の効果範囲と重複したばあい､その光を作り出した呪文は解呪される。</span></span></span><span class="sd">力術 · action · 射程:60 · 持続:10</span></div><div class="sp-entry"><span class="prep off" data-action="toggle-prepared" data-item-idx="48" title="クリックで準備切替">○</span><span class="sn"><span class="tip" tabindex="0" data-action="edit-desc" data-item-idx="48">シャター<span class="tip-body">突如として､射程内の君が選んだ地点から耳を聾さんばかりの雑音が弾けだし､響き渡る。その地点を中心とした半径10ft​の範囲内にいるすべてのクリーチャーは【耐久力】セーヴィング・スローを行わなければならない。セーヴィング・スローを失敗したクリーチャーは3d8の [雷鳴] ダメージを受ける。成功したものはその半分のダメージを受ける。
無機的な材料 (石やクリスタル､あるいは金属など) から構成されたクリーチャーはこのセーヴィング・スローに不利を被る。
また､着用されたり運搬されているのではない､非魔法の物体も､その範囲内にあるならダメージを受ける。
高レベル発動：君がこの呪文を3レベル以上の呪文スロットを用いて発動する場合､スロットのレベルが2レベルを1上回るごとにダメージが1d8増加する。</span></span></span><span class="sd">力術 · action · 射程:60</span></div><div class="sp-entry"><span class="prep off" data-action="toggle-prepared" data-item-idx="49" title="クリックで準備切替">○</span><span class="sn"><span class="tip" tabindex="0" data-action="edit-desc" data-item-idx="49">ホールド・パースン<span class="tip-body">射程内にいる、君が見ることのできる人型生物を1体選ぶこと。その目標は【判断力】セーヴィング・スローを行なわねばならず、失敗すると持続時間の間、@Compendium[completecompendium.betterconditions.o5oZVdHSWmceeFyx]{麻痺状態}となる。目標は自身のターンが終了するたびに、新たに【判断力】セーヴィング・スローを行なうことができる。成功したならば、その目標について、この呪文は終了する。



高レベル版：君がこの呪文を3レベル以上の呪文スロットを用いて発動する場合、スロットのレベルが2レベルを1上回るごとに追加で1体の人型生物を目標とすることができる。それらの人型生物は、君が目標に取る時点で互いに30フィート以内にいなければならない。</span></span></span><span class="sd">心術 · action · 射程:60 · 持続:1</span></div></div></details><details class="sp-lv"><summary>Lv3 (2)</summary><div class="sp-lv-body"><div class="sp-entry"><span class="prep off" data-action="toggle-prepared" data-item-idx="59" title="クリックで準備切替">○</span><span class="sn"><span class="tip" tabindex="0" data-action="edit-desc" data-item-idx="59">ファイアーボール<span class="tip-body">君の指先から射程内の君の選んだ一点に向かってまばゆい光茫が閃き､そして腹に響く轟音とともに火焔が爆裂する。その点を中心とした半径20ft​の球形の範囲内にいるすべてのクリーチャーは【敏捷力】セーヴィング・スローを行わなければならない。セーヴィング・スローを失敗したクリーチャーは8d6の [火] ダメージを受ける。成功したものはその半分のダメージを受ける。
この炎は角を回り込んで拡がる。ファイアボールの範囲内にあって､何者にも着用されたり､運搬されていない可燃物は発火する。
高レベル発動：君がこの呪文を4レベル以上の呪文スロットを用いて発動する場合､スロットのレベルが3レベルを1上回るごとにダメージが1d6増加する。</span></span></span><span class="sd">力術 · action · 射程:150</span></div><div class="sp-entry"><span class="prep off" data-action="toggle-prepared" data-item-idx="60" title="クリックで準備切替">○</span><span class="sn"><span class="tip" tabindex="0" data-action="edit-desc" data-item-idx="60">カウンタースペル<span class="tip-body">君は今まさに呪文を発動しようとしているクリーチャーに妨害を試みる。そのクリーチャーが3レベル以下の呪文を発動しようとしていたなら､その呪文は失敗し､何ら効果を及ぼさない。その呪文が4レベル以上であるなら､君の呪文発動能力値を用いて能力値判定を行うこと。難易度は(10+その呪文のレベル) である。成功したなら､そのクリーチャーの呪文は失敗し､何ら効果を及ぼさない。
高レベル発動：君がこの呪文を4レベル以上の呪文スロットを用いて発動した場合､使用した呪文スロットのレベル以下の呪文を (訳注：能力値判定なしで) 妨害し､何ら効果を及ぼさなくできる。</span></span></span><span class="sd">防御 · reaction · 射程:60</span></div></div></details><details class="sp-lv"><summary>Lv4 (1)</summary><div class="sp-lv-body"><div class="sp-entry"><span class="prep off" data-action="toggle-prepared" data-item-idx="54" title="クリックで準備切替">○</span><span class="sn"><span class="tip" tabindex="0" data-action="edit-desc" data-item-idx="54">Confusion<span class="tip-body">(説明なし)</span></span></span><span class="sd">心術 · action · 射程:90 · 持続:1</span></div></div></details><details class="sp-lv"><summary>Lv5 (1)</summary><div class="sp-lv-body"><div class="sp-entry"><span class="prep off" data-action="toggle-prepared" data-item-idx="57" title="クリックで準備切替">○</span><span class="sn"><span class="tip" tabindex="0" data-action="edit-desc" data-item-idx="57">カンジャー・エレメンタル<span class="tip-body">君は下僕のエレメンタルを1体呼び出す。射程内にある､土 (アース) ､水 (ウォーター) ､風 (エア) ､火 (ファイア) のいずれかで満たされた一辺10ft​の立方体の範囲を選ぶこと。その範囲から10ft​以内の何ものにも占められていない場所に､選んだ元素に対応する種類の脅威度5以下のエレメンタルが1体出現する。たとえば大きな焚火からはファイア・エレメンタルが現れ､地面からはアース・エレメンタルが現れる。このエレメンタルはhpが0になるかこの呪文が終了した時点で消えうせる。
このエレメンタルは持続時間中は､君および君の仲間に対して友好的である。このエレメンタルのイニシアチプをロールすること。このエレメンタルは自分自身のターンを有する。このエレメンタルは君の言葉によるあらゆる命令 (これは君自身のアクションを必要としない) に従う。君からの命令がない場合､このエレメンタルは敵対的なクリーチャーから身を護る以外何のアクションも行わない。
君の精神集中が途切れても､このエレメンタルは消えない。その代わり､君はこのエレメンタルの制御を失い､このエレメンタルは君および君の仲間に対して敵対的になるので､君たちを攻撃する可能性もある。君は自分の制御下を離れたエレメンタルを退去させることができない。こうなったエレメンタルは君が召喚してから1時間後に消えうせる。召喚されるエレメンタルのデータはDMが決めること。
高レベル発動：君がこの呪文を6レベル以上の呪文スロットを用いて発動する場合､スロットのレベルが5レベルを1上回るごとに､召喚するエレメンタルの脅威度が1ずつ増加する。</span></span></span><span class="sd">召喚 · minute · 射程:90 · 持続:1</span></div></div></details></div><div class="sec bio-section clickable" data-action="edit-bio"><div class="sec-title">経歴・外見</div><div style="font-size:13px;color:var(--tm);margin-bottom:8px;white-space:pre-line"><p>黒人男性</p></div><div class="bio-ct"><p>クロメノウの大冒険の隅でひっそりとヘマをやって投獄されたイカサマ師</p><p>処刑されそうなところにフィーンドに救われ、契約する羽目になる</p><p></p><p>フィーンドの命令でラッパンアスクのダンジョンに挑まざるを得ない状況になる</p><p>どこかでフィーンドを出し抜けないか考えつつ、仲間たちに近づく</p></div></div></div>

<!-- Description Edit Modal -->
<div id="descModal" class="modal-overlay">
  <div class="modal">
    <div class="modal-header">
      <span class="modal-title" id="modalTitle">説明を編集</span>
      <button class="modal-close" id="modalClose">×</button>
    </div>
    <div class="modal-body">
      <div id="modalNameRow" style="display:flex;align-items:center;gap:8px;margin-bottom:12px">
        <label class="modal-label" id="modalNameLabel" style="margin:0;flex:1">名称</label>
        <button class="modal-btn modal-btn-edit" id="modalEditToggle">編集モード</button>
      </div>
      <div id="modalNoNameRow" style="display:none;margin-bottom:12px;text-align:right">
        <button class="modal-btn modal-btn-edit" id="modalEditToggle2">編集モード</button>
      </div>
      <textarea class="modal-input modal-name" id="modalName" placeholder="アイテム名" readonly="" rows="1"></textarea>
      <label class="modal-label" style="margin-top:12px">説明</label>
      <div class="modal-view" id="modalView"></div>
      <textarea class="modal-input modal-textarea" id="modalDesc" placeholder="説明文を入力..." style="display:none"></textarea>
    </div>
    <div class="modal-footer">
      <button class="modal-btn modal-btn-cancel" id="modalCancel">閉じる</button>
      <button class="modal-btn modal-btn-revert" id="modalRevert" style="display:none">元に戻す</button>
      <button class="modal-btn modal-btn-save" id="modalSave" style="display:none">保存</button>
    </div>
  </div>
</div>

<footer class="site-footer">Copyright © 2026, Kendermore Convention &amp; Visitors Bureau Office. Licensed under the <span class="mit-tip" tabindex="0">MIT License<span class="mit-body">MIT License

Copyright (c) 2026 Kendermore Convention &amp; Visitors Bureau Office

Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the "Software"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.</span></span>. Version 20260131.</footer>

<script>
const $=s=>document.querySelector(s);
const ABILS={str:'筋力',dex:'敏捷',con:'耐久',int:'知力',wis:'判断',cha:'魅力'};
const SKILL_MAP={
  acr:['軽業','dex'],ani:['動物使い','wis'],arc:['魔法学','int'],ath:['運動','str'],
  dec:['ペテン','cha'],his:['歴史','int'],ins:['看破','wis'],itm:['威圧','cha'],
  inv:['捜査','int'],med:['医術','wis'],nat:['自然','int'],prc:['知覚','wis'],
  prf:['芸能','cha'],per:['説得','cha'],rel:['宗教','int'],slt:['手先の早業','dex'],
  ste:['隠密','dex'],sur:['生存','wis']
};
const SCHOOLS={abj:'防御',con:'召喚',div:'占術',enc:'心術',evo:'力術',ill:'幻術',nec:'死霊',trs:'変成'};
const WEAPON_PROF={sim:'単純武器',mar:'軍用武器'};
const ARMOR_PROF={lgt:'軽装鎧',med:'中装鎧',hvy:'重装鎧',shl:'盾'};

function mod(s){return Math.floor(((s??10)-10)/2)}
function fm(m){return m>=0?'+'+m:''+m}
function tx(html){if(!html)return '';const d=document.createElement('div');d.innerHTML=html;return d.textContent.trim()}
function dotCls(p){return p>=2?'expert':p>=1?'full':p>0?'half':''}
function clamp(v,lo,hi){return Math.max(lo,Math.min(hi,v))}

// Tooltip - now includes data attribute for item index
function tip(name,descHtml,itemIdx){
  const desc=tx(descHtml);
  const safe=desc?desc.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/"/g,'&quot;'):'(説明なし)';
  const idxAttr=itemIdx!=null?` data-item-idx="${itemIdx}"`:'';
  return `<span class="tip" tabindex="0" data-action="edit-desc"${idxAttr}>${name}<span class="tip-body">${safe}</span></span>`;
}

function nc(cls,attrs,val,min,max){
  const mn=min!=null?` min="${min}"`:'';
  const mx=max!=null?` max="${max}"`:'';
  return `<span class="nc"><button type="button" class="nc-btn" data-nc="-1">−</button><input type="number" class="${cls}" ${attrs} value="${val}"${mn}${mx}><button type="button" class="nc-btn" data-nc="1">+</button></span>`;
}

// --- Data ---
let currentActor=null;
let currentActors=[];
let dirty=false;

// Modal state
let modalItemIdx=null;

function ensurePath(obj,...keys){
  let c=obj;
  for(const k of keys){if(!c[k])c[k]={};c=c[k];}
  return c;
}

function pickActors(json){
  if(Array.isArray(json)) return json.filter(a=>a?.type==='character'||a?.type==='npc'||a?.system?.abilities);
  if(json?.actors) return json.actors.filter(a=>a?.type==='character'||a?.system?.abilities);
  if(json?.type&&json?.system) return [json];
  return [];
}

function getLevel(actor){
  const items=actor.items||[];
  const cls=items.filter(i=>i.type==='class');
  if(cls.length>0) return cls.reduce((s,c)=>s+(c.system?.levels||0),0);
  const sys=actor.system||{};
  return sys.details?.level??sys.details?.levels??0;
}

function getClasses(items){
  const cls=items.filter(i=>i.type==='class');
  if(!cls.length) return '—';
  return cls.map(c=>{
    const sub=items.find(i=>i.type==='subclass'&&(i.system?.classIdentifier===c.system?.identifier||i.system?.parentClass===c._id));
    return c.name+(sub?' ('+sub.name+')':'');
  }).join(' / ');
}

function getRace(actor){
  const raceItem=(actor.items||[]).find(i=>i.type==='race');
  if(raceItem) return raceItem.name;
  const r=actor.system?.details?.race;
  return (typeof r==='string')?r:'';
}

function getBackground(actor){
  const bgItem=(actor.items||[]).find(i=>i.type==='background');
  if(bgItem) return bgItem.name;
  const r=actor.system?.details?.background;
  return (typeof r==='string')?r:'';
}

function getAC(sys,items){
  if(typeof sys.attributes?.ac?.value==='number') return sys.attributes.ac.value;
  if(typeof sys.attributes?.ac?.flat==='number') return sys.attributes.ac.flat;
  if(typeof sys.attributes?.ac==='number') return sys.attributes.ac;
  const dexMod=mod(sys.abilities?.dex?.value);
  const calc=sys.attributes?.ac?.calc||'default';
  const armors=(items||[]).filter(i=>(i.type==='equipment'||i.type==='armor')&&i.system?.equipped&&i.system?.armor?.value);
  if(armors.length){
    let best=10;
    for(const a of armors){
      const av=a.system.armor.value;
      const at=a.system?.type?.value||a.system?.armor?.type||'light';
      if(at==='heavy') best=Math.max(best,av);
      else if(at==='medium') best=Math.max(best,av+Math.min(dexMod,2));
      else if(at==='shield') best+=2;
      else best=Math.max(best,av+dexMod);
    }
    return best;
  }
  if(calc==='mage') return 13+dexMod;
  if(calc==='natural') return 10+dexMod;
  return 10+dexMod;
}

function getAbilMod(sys,abil){
  const a=sys.abilities?.[abil]||{};
  return typeof a.mod==='number'?a.mod:mod(a.value);
}

function weaponDmg(ws,sys,prof){
  const acts=ws.activities?Object.values(ws.activities):[];
  const atk=acts.find(a=>a.type==='attack'||a.type==='damage');
  if(atk){
    let ability=atk.attack?.ability||ws.ability||'';
    const atkType=atk.attack?.type?.value||'melee';
    let abilMod;
    if(ability==='spellcasting'){
      ability=sys.attributes?.spellcasting||'int';
      abilMod=getAbilMod(sys,ability);
    }else if(ability&&sys.abilities?.[ability]){
      abilMod=getAbilMod(sys,ability);
    }else{
      const props=Array.isArray(ws.properties)?ws.properties:(ws.properties?.value||[]);
      const fin=Array.isArray(props)?props.includes('fin'):false;
      if(atkType==='ranged') abilMod=getAbilMod(sys,'dex');
      else if(fin) abilMod=Math.max(getAbilMod(sys,'str'),getAbilMod(sys,'dex'));
      else abilMod=getAbilMod(sys,'str');
    }
    const mag=ws.magicalBonus||0;
    const ab=parseInt(atk.attack?.bonus)||0;
    const pr=ws.proficient!==false?(sys.attributes?.prof??prof??2):0;
    const atkTotal=abilMod+pr+mag+ab;
    const parts=atk.damage?.parts||[];
    let dmg=parts.map(p=>{
      if(Array.isArray(p)) return p.join(' ');
      let d='';
      if(p.number&&p.denomination) d=p.number+'d'+p.denomination;
      if(p.bonus) d+=(String(p.bonus).startsWith('+')||String(p.bonus).startsWith('-')?'':'+')+p.bonus;
      const types=(p.types||[]).filter(t=>t&&t!=='none');
      return [d,types.join('/')].filter(Boolean).join(' ');
    }).join(' + ')||'—';
    if(dmg!=='—'&&abilMod) dmg+=' '+fm(abilMod);
    if(mag>0) dmg+=' +'+mag;
    return {atk:fm(atkTotal),dmg};
  }
  const ability=ws.ability||'str';
  const abilMod=getAbilMod(sys,ability);
  const pr2=ws.proficient!==false?(sys.attributes?.prof??prof??2):0;
  const atkB=abilMod+pr2+(ws.attackBonus||0);
  const parts=(ws.damage?.parts||[]).map(p=>Array.isArray(p)?p.join(' '):String(p)).join(' / ');
  return {atk:fm(atkB),dmg:parts||'—'};
}

// --- Save details open state ---
function saveDetailsState(){
  const state={};
  document.querySelectorAll('#sheet details').forEach((d,i)=>{state[i]=d.open;});
  return state;
}
function restoreDetailsState(state){
  document.querySelectorAll('#sheet details').forEach((d,i)=>{if(i in state)d.open=state[i];});
}

// --- Render ---
function render(actor){
  if(!actor){$('#sheet').innerHTML='<p class="text-m">キャラが見つかりません</p>';return;}
  currentActor=actor;

  const detState=saveDetailsState();
  const scrollY=window.scrollY;

  const sys=actor.system||{};
  const items=actor.items||[];
  const level=getLevel(actor);
  const prof=sys.attributes?.prof??Math.floor(Math.max(level-1,0)/4)+2;
  let h='';

  // Header
  const name=actor.name||'(unnamed)';
  const cls=getClasses(items);
  const race=getRace(actor);
  const bg=getBackground(actor);
  const align=sys.details?.alignment||'';
  const xp=sys.details?.xp?.value;
  h+=`<div class="char-header"><div class="char-name">${name}</div><div class="char-sub">${cls} Lv${level||'?'} · ${race||'—'} · ${bg||'—'} · ${align||'—'}${xp!=null?' · '+xp+' XP':''}</div></div>`;

  h+='<div class="sheet-body">';

  // Col1: Abilities
  h+='<div class="ab-col">';
  for(const[k,label] of Object.entries(ABILS)){
    const a=sys.abilities?.[k]||{};
    const sc=a.value??10;
    const m=typeof a.mod==='number'?a.mod:mod(sc);
    h+=`<div class="ab-box"><div class="ab-lbl">${k.toUpperCase()}</div><div class="ab-score">${sc}</div><div class="ab-mod">${fm(m)}</div></div>`;
  }
  h+='</div>';

  // Col2: Saves & Skills
  h+='<div>';

  // Inspiration & Prof
  const insp=sys.attributes?.inspiration;
  h+=`<div class="prof-row"><div class="prof-box"><div class="big clickable" data-action="toggle-inspiration">${insp?'★':'☆'}</div><div class="lbl">Inspiration</div></div><div class="prof-box"><div class="big">+${prof}</div><div class="lbl">習熟ボーナス</div></div></div>`;

  // Saves
  h+='<div class="panel"><div class="p-title">セーヴィング・スロー</div>';
  for(const[k,label] of Object.entries(ABILS)){
    const a=sys.abilities?.[k]||{};
    const m=getAbilMod(sys,k);
    const p=a.proficient?true:false;
    const total=p?m+prof:m;
    h+=`<div class="s-row"><div class="dot ${p?'full':''}"></div><div class="bonus">${fm(total)}</div><div class="name">${label}</div></div>`;
  }
  h+='</div>';

  // Skills
  h+='<div class="panel"><div class="p-title">技能</div>';
  for(const[k,[label,defAbil]] of Object.entries(SKILL_MAP)){
    const sk=sys.skills?.[k]||{};
    const abil=sk.ability||defAbil;
    const abilMod=getAbilMod(sys,abil);
    const pl=sk.value??sk.prof??0;
    const total=abilMod+(pl?Math.round(prof*pl):0);
    h+=`<div class="s-row"><div class="dot ${dotCls(pl)}"></div><div class="bonus">${fm(total)}</div><div class="name">${label}<span class="abil">${abil}</span></div></div>`;
  }
  h+='</div>';

  // Passive Perception
  const prc=sys.skills?.prc||{};
  const prcAbil=prc.ability||'wis';
  const prcMod=getAbilMod(sys,prcAbil);
  const prcPl=prc.value??prc.prof??0;
  const passiveP=10+prcMod+(prcPl?Math.round(prof*prcPl):0);
  h+=`<div class="passive"><div class="big">${passiveP}</div><div class="lbl">受動知覚 (Passive Perception)</div></div>`;
  h+='</div>';

  // Col3: Combat
  h+='<div>';

  // AC, Init, Speed
  const ac=getAC(sys,items);
  const init=getAbilMod(sys,'dex')+(parseInt(sys.attributes?.init?.bonus)||0);
  const spd=sys.attributes?.movement?.walk??sys.attributes?.speed?.value??30;
  h+=`<div class="combat-trio"><div class="c-box"><div class="lbl">AC</div><div class="val">${ac}</div></div><div class="c-box"><div class="lbl">イニシアチブ</div><div class="val">${fm(init)}</div></div><div class="c-box"><div class="lbl">移動速度</div><div class="val">${spd}</div><div class="unit">ft</div></div></div>`;

  // HP
  const hp=ensurePath(sys,'attributes','hp');
  if(hp.max==null && hp.value!=null) hp.max=hp.value; // maxがnullなら現在値で初期化
  const hpCur=hp.value??0;
  const hpMax=hp.max??hpCur;
  const hpTemp=hp.temp??0;
  const hpR=hpMax>0?hpCur/hpMax:1;
  const hpC=hpR>.5?'var(--grn)':hpR>.25?'#c8a030':'var(--red)';
  h+=`<div class="hp-panel"><div class="p-title">ヒットポイント</div>`;
  h+=`<div class="hp-row">${nc('hp-cur','data-action="set-hp"',hpCur,0,hpMax)}<span class="hp-sep">/</span><span class="hp-max">${hpMax}</span></div>`;
  h+=`<div class="hp-bar"><div class="hp-bar-fill" style="width:${Math.round(hpR*100)}%;background:${hpC}"></div></div>`;
  h+=`<div class="hp-adj"><button class="hp-btn hp-btn-dmg" data-action="hp-dmg">Damage</button>${nc('hp-adj-input','id="hpDelta"',0,0,null)}<button class="hp-btn hp-btn-heal" data-action="hp-heal">Heal</button></div>`;
  h+=`<div class="hp-temp-row">一時HP: ${nc('hp-temp-input','data-action="set-temp-hp"',hpTemp,0,null)}</div>`;
  h+=`</div>`;

  // Hit Dice & Death Saves
  const clsItems=items.filter(i=>i.type==='class');
  h+=`<div class="hd-death">`;
  // Hit Dice
  h+=`<div class="mini-p"><div class="lbl">ヒットダイス</div>`;
  if(clsItems.length){
    for(let ci=0;ci<clsItems.length;ci++){
      const c=clsItems[ci];
      const hd=c.system?.hd||{};
      const den=hd.denomination||'d8';
      const lvl=c.system?.levels||0;
      const spent=hd.spent||0;
      const remain=lvl-spent;
      h+=`<div style="margin:3px 0"><span class="text-s">${den}</span> <span style="font-weight:700">${remain}</span>/${lvl} `;
      h+=`<button class="hp-btn hp-btn-dmg" style="font-size:10px;padding:1px 6px" data-action="hd-use" data-class-idx="${ci}">使用</button> `;
      h+=`<button class="hp-btn hp-btn-heal" style="font-size:10px;padding:1px 6px" data-action="hd-recover" data-class-idx="${ci}">回復</button>`;
      h+=`</div>`;
    }
  }else h+='<div>—</div>';
  h+=`</div>`;
  // Death Saves
  const death=ensurePath(sys,'attributes','death');
  const dS=death.success||0,dF=death.failure||0;
  h+=`<div class="mini-p"><div class="lbl">デス・セーヴ</div>`;
  h+=`<div class="text-s">成功</div><div class="dd">${[0,1,2].map(i=>`<div class="d ${i<dS?'ok':''}" data-action="death-success" data-idx="${i}"></div>`).join('')}</div>`;
  h+=`<div class="text-s">失敗</div><div class="dd">${[0,1,2].map(i=>`<div class="d ${i<dF?'ng':''}" data-action="death-failure" data-idx="${i}"></div>`).join('')}</div>`;
  h+=`</div></div>`;

  // Attacks
  const weapons=items.filter(i=>i.type==='weapon');
  h+='<div class="panel"><div class="p-title">攻撃</div>';
  if(weapons.length){
    h+='<table class="t"><thead><tr><th>名称</th><th>攻撃</th><th>ダメージ</th></tr></thead><tbody>';
    for(const w of weapons){
      const r=weaponDmg(w.system||{},sys,prof);
      const idx=items.indexOf(w);
      h+=`<tr><td>${tip(w.name,w.system?.description?.value,idx)}</td><td>${r.atk}</td><td>${r.dmg}</td></tr>`;
    }
    h+='</tbody></table>';
  }else h+='<div class="text-m text-s">—</div>';
  h+='</div>';

  // Equipment
  const eqTypes=new Set(['equipment','consumable','tool','loot','backpack','armor','container']);
  const eqItems=items.filter(i=>eqTypes.has(i.type));
  if(eqItems.length){
    h+='<div class="panel"><div class="p-title">装備・所持品</div><table class="t"><thead><tr><th>名称</th><th>種別</th><th>数</th></tr></thead><tbody>';
    for(const it of eqItems){
      const s=it.system||{};
      const idx=items.indexOf(it);
      const hasEquip=(it.type==='equipment'||it.type==='armor');
      const eqIcon=hasEquip?(s.equipped?'◆':'◇'):'';
      const eqAttr=hasEquip?` data-action="toggle-equip" data-item-idx="${idx}"`:'';
      const eqCls=hasEquip?' eq-toggle':'';
      const eqColor=s.equipped?'color:var(--grn)':'color:var(--td)';
      h+=`<tr><td>${hasEquip?`<span class="${eqCls}" style="${eqColor}"${eqAttr}>${eqIcon}</span> `:''}${tip(it.name,s.description?.value,idx)}</td><td class="text-s text-m">${it.type}</td><td>${nc('e-num',`data-action="set-quantity" data-item-idx="${idx}"`,s.quantity??1,0,null)}</td></tr>`;
    }
    h+='</tbody></table>';
    // Currency
    const cur=ensurePath(sys,'currency');
    h+=`<div class="coins">`;
    for(const[k,label] of [['pp','PP'],['gp','GP'],['ep','EP'],['sp','SP'],['cp','CP']]){
      h+=`<span class="coin coin-${k}"><span class="cl">${label}</span> ${nc('e-coin',`data-action="set-currency" data-coin="${k}"`,cur[k]||0,0,null)}</span>`;
    }
    h+=`</div></div>`;
  }

  // Senses
  const senses=sys.attributes?.senses||{};
  const sl=[];
  if(senses.darkvision)sl.push('暗視 '+senses.darkvision+'ft');
  if(senses.blindsight)sl.push('盲目視 '+senses.blindsight+'ft');
  if(senses.tremorsense)sl.push('振動感知 '+senses.tremorsense+'ft');
  if(senses.truesight)sl.push('真実の目 '+senses.truesight+'ft');
  if(sl.length) h+=`<div style="font-size:12px;color:var(--tm);text-align:center;margin-top:6px">${sl.join(' · ')}</div>`;

  h+='</div>'; // end col3
  h+='</div>'; // end sheet-body

  // Personality
  const det=sys.details||{};
  const trait=det.trait||'';
  const ideal=det.ideal||'';
  const bond=det.bond||'';
  const flaw=det.flaw||'';
  h+='<div class="pers-grid">';
  h+=`<div class="pers-box clickable" data-action="edit-detail" data-detail-key="trait"><div class="lbl">性格特徴</div><div class="ct">${trait||'—'}</div></div>`;
  h+=`<div class="pers-box clickable" data-action="edit-detail" data-detail-key="ideal"><div class="lbl">理想</div><div class="ct">${ideal||'—'}</div></div>`;
  h+=`<div class="pers-box clickable" data-action="edit-detail" data-detail-key="bond"><div class="lbl">絆</div><div class="ct">${bond||'—'}</div></div>`;
  h+=`<div class="pers-box clickable" data-action="edit-detail" data-detail-key="flaw"><div class="lbl">弱点</div><div class="ct">${flaw||'—'}</div></div>`;
  h+='</div>';

  // Proficiencies & Languages
  const traits=sys.traits||{};
  const langs=Array.isArray(traits.languages?.value)?traits.languages.value:[];
  const wProf=Array.isArray(traits.weaponProf?.value)?traits.weaponProf.value:[];
  const aProf=Array.isArray(traits.armorProf?.value)?traits.armorProf.value:[];
  if(langs.length||wProf.length||aProf.length){
    h+='<div class="sec"><div class="sec-title">習熟・言語</div><div class="pl-grid">';
    h+=`<div class="pl-grp"><div class="lbl">言語</div><div class="items">${langs.map(l=>'<span class="pill">'+l+'</span>').join('')||'—'}</div></div>`;
    h+=`<div class="pl-grp"><div class="lbl">武器習熟</div><div class="items">${wProf.map(w=>'<span class="pill">'+(WEAPON_PROF[w]||w)+'</span>').join('')||'—'}</div></div>`;
    h+=`<div class="pl-grp"><div class="lbl">防具習熟</div><div class="items">${aProf.map(a=>'<span class="pill">'+(ARMOR_PROF[a]||a)+'</span>').join('')||'—'}</div></div>`;
    h+='</div></div>';
  }

  // Features (with uses)
  const featTypes=new Set(['feat','class','race','background','subclass']);
  const allFeats=items.filter(i=>featTypes.has(i.type));
  if(allFeats.length){
    h+='<div class="sec"><div class="sec-title">特徴・特技</div>';
    for(const f of allFeats){
      if(f.type==='class'||f.type==='race'||f.type==='background'||f.type==='subclass') continue;
      const desc=tx(f.system?.description?.value);
      const short=desc.length>250?desc.substring(0,250)+'…':desc;
      const src=f.system?.requirements||f.type||'';
      const idx=items.indexOf(f);
      const uses=f.system?.uses;
      const hasUses=uses&&(uses.max||uses.value);
      let usesHtml='';
      if(hasUses){
        const uMax=uses.max||0;
        const uVal=uses.value||0;
        usesHtml=`<span class="feat-uses">(${nc('e-num',`style="width:32px" data-action="set-uses" data-item-idx="${idx}"`,uVal,0,uMax)} / ${uMax})</span>`;
      }
      h+=`<div class="feat-item"><span class="fn">${tip(f.name,f.system?.description?.value,idx)}</span>${usesHtml}<span class="fs">${src}</span>${short?'<div class="fd">'+short+'</div>':''}</div>`;
    }
    h+='</div>';
  }

  // Spells
  const spells=items.filter(i=>i.type==='spell');
  if(spells.length){
    h+='<div class="sec"><div class="sec-title">呪文</div>';

    // Spellcasting info
    const scAbil=sys.attributes?.spellcasting||'';
    if(scAbil){
      const scMod=getAbilMod(sys,scAbil);
      const dc=8+prof+scMod;
      const sAtk=prof+scMod;
      h+=`<div class="sp-meta"><div><b>呪文発動能力:</b> ${ABILS[scAbil]||scAbil.toUpperCase()}</div><div><b>呪文セーヴDC:</b> ${dc}</div><div><b>呪文攻撃:</b> ${fm(sAtk)}</div></div>`;
    }

    // Spell slots (editable)
    const slots=ensurePath(sys,'spells');
    const hasSlots=Object.keys(slots).some(k=>k.startsWith('spell')&&(slots[k]?.value>0||slots[k]?.override>0));
    if(hasSlots){
      h+='<div class="sp-slots">';
      for(let lv=1;lv<=9;lv++){
        const s=slots['spell'+lv];
        if(!s) continue;
        const max=s.override??s.value??0;
        if(!max) continue;
        const cur=s.value??0;
        h+=`<div class="sl-grp"><span class="lv">${lv}lv</span>`;
        for(let i=0;i<max;i++){
          h+=`<div class="sl-d ${i<cur?'on':''}" data-action="toggle-slot" data-slot-lv="${lv}" data-slot-idx="${i}"></div>`;
        }
        h+='</div>';
      }
      h+='</div>';
    }

    // Group by level
    const byLv=new Map();
    for(const sp of spells){
      const lv=sp.system?.level??0;
      if(!byLv.has(lv)) byLv.set(lv,[]);
      byLv.get(lv).push(sp);
    }
    const levels=[...byLv.keys()].sort((a,b)=>a-b);
    for(const lv of levels){
      const list=byLv.get(lv);
      const pretty=lv===0?'キャントリップ':'Lv'+lv;
      h+=`<details class="sp-lv"${lv<=1?' open':''}><summary>${pretty} (${list.length})</summary><div class="sp-lv-body">`;
      for(const sp of list){
        const ss=sp.system||{};
        const school=SCHOOLS[ss.school]||ss.school||'';
        const actType=ss.activation?.type||'';
        const range=ss.range?.value||ss.range||'';
        const dur=ss.duration?.value||(ss.duration?.units&&ss.duration.units!=='inst'?ss.duration.units:'')||'';
        const conc=ss.properties?.value?.includes?.('concentration')||ss.components?.concentration||false;
        const ritual=ss.properties?.value?.includes?.('ritual')||ss.components?.ritual||false;
        const prepared=ss.preparation?.prepared||ss.preparation?.mode==='always'||ss.preparation?.mode==='atwill'||lv===0;
        const canToggle=lv>0&&ss.preparation?.mode!=='always'&&ss.preparation?.mode!=='atwill';
        const tags=[school,actType,range?'射程:'+range:'',dur?'持続:'+dur:'',conc?'集中':'',ritual?'儀式':''].filter(Boolean).join(' · ');
        const idx=items.indexOf(sp);
        h+=`<div class="sp-entry"><span class="prep ${prepared?'':'off'}" ${canToggle?`data-action="toggle-prepared" data-item-idx="${idx}"`:''} ${canToggle?'title="クリックで準備切替"':''}>${prepared?'●':'○'}</span><span class="sn">${tip(sp.name,ss.description?.value,idx)}</span><span class="sd">${tags}</span></div>`;
      }
      h+='</div></details>';
    }
    h+='</div>';
  }

  // Biography
  const bio=det.biography?.value||'';
  const appear=det.appearance||'';
  h+='<div class="sec bio-section clickable" data-action="edit-bio"><div class="sec-title">経歴・外見</div>';
  if(appear) h+=`<div style="font-size:13px;color:var(--tm);margin-bottom:8px;white-space:pre-line">${appear}</div>`;
  else h+=`<div style="font-size:13px;color:var(--td);margin-bottom:8px;font-style:italic">(外見なし)</div>`;
  if(bio) h+=`<div class="bio-ct">${bio}</div>`;
  else h+=`<div class="bio-ct" style="color:var(--td);font-style:italic">(経歴なし)</div>`;
  h+='</div>';

  $('#sheet').innerHTML=h;
  $('#sheet').classList.add('active');
  $('#dropzone').style.display='none';
  $('#exportBtn').style.display='inline-block';

  restoreDetailsState(detState);
  window.scrollTo(0,scrollY);
}

// --- Modal Functions ---
let modalEditMode=false;
let modalType=null; // 'item', 'detail', 'bio'
let modalDetailKey=null; // for detail: 'trait','ideal','bond','flaw'

const DETAIL_LABELS={trait:'性格特徴',ideal:'理想',bond:'絆',flaw:'弱点'};

function openModal(itemIdx){
  const item=currentActor?.items?.[itemIdx];
  if(!item) return;
  modalItemIdx=itemIdx;
  modalEditMode=false;
  modalType='item';
  modalDetailKey=null;

  $('#modalTitle').textContent=item.name||'(名称なし)';
  const nameVal=item.name||'';
  $('#modalName').value=nameVal;
  $('#modalName').classList.toggle('multi',nameVal.includes('\n'));
  $('#modalNameRow').style.display='flex';
  const descHtml=item.system?.description?.value||'';
  $('#modalDesc').value=descHtml;

  updateModalMode();
  $('#descModal').classList.add('open');
}

function openDetailModal(key){
  if(!currentActor) return;
  modalItemIdx=null;
  modalEditMode=false;
  modalType='detail';
  modalDetailKey=key;

  const det=currentActor.system?.details||{};
  const value=det[key]||'';

  $('#modalTitle').textContent=DETAIL_LABELS[key]||key;
  $('#modalName').value='';
  $('#modalNameRow').style.display='none';
  $('#modalDesc').value=value;

  updateModalMode();
  $('#descModal').classList.add('open');
}

function openBioModal(){
  if(!currentActor) return;
  modalItemIdx=null;
  modalEditMode=false;
  modalType='bio';
  modalDetailKey=null;

  const det=currentActor.system?.details||{};
  const appear=det.appearance||'';
  const bio=det.biography?.value||'';

  $('#modalTitle').textContent='経歴・外見';
  $('#modalName').value=appear;
  $('#modalName').classList.toggle('multi',appear.includes('\n'));
  $('#modalNameRow').style.display='flex';
  $('#modalNameLabel').textContent='外見';
  $('#modalDesc').value=bio;

  updateModalMode();
  $('#descModal').classList.add('open');
}

function updateModalMode(){
  const nameInput=$('#modalName');
  const viewDiv=$('#modalView');
  const editArea=$('#modalDesc');
  const saveBtn=$('#modalSave');
  const editBtn=$('#modalEditToggle');
  const editBtn2=$('#modalEditToggle2');
  const cancelBtn=$('#modalCancel');
  const revertBtn=$('#modalRevert');
  const nameRow=$('#modalNameRow');
  const noNameRow=$('#modalNoNameRow');
  const nameLabel=$('#modalNameLabel');

  // Show/hide name row based on modalType
  if(modalType==='detail'){
    nameRow.style.display='none';
    noNameRow.style.display='block';
    nameInput.style.display='none';
  }else{
    nameRow.style.display='flex';
    noNameRow.style.display='none';
    nameInput.style.display='block';
    nameLabel.textContent=modalType==='bio'?'外見':'名称';
  }

  if(modalEditMode){
    // Edit mode
    nameInput.removeAttribute('readonly');
    viewDiv.style.display='none';
    editArea.style.display='block';
    saveBtn.style.display='inline-block';
    revertBtn.style.display='inline-block';
    editBtn.classList.add('active');
    editBtn.textContent='表示モード';
    editBtn2.classList.add('active');
    editBtn2.textContent='表示モード';
    cancelBtn.textContent='キャンセル';
  }else{
    // View mode
    nameInput.setAttribute('readonly','');
    const descHtml=$('#modalDesc').value;
    if(modalType==='detail'){
      // For detail fields, show as plain text (no HTML)
      if(descHtml.trim()){
        viewDiv.textContent=descHtml;
        viewDiv.classList.remove('modal-no-desc');
      }else{
        viewDiv.innerHTML='<span class="modal-no-desc">(未設定)</span>';
      }
    }else{
      // For items and bio, render HTML
      if(descHtml.trim()){
        viewDiv.innerHTML=descHtml;
        viewDiv.classList.remove('modal-no-desc');
      }else{
        viewDiv.innerHTML='<span class="modal-no-desc">(説明なし)</span>';
      }
    }
    viewDiv.style.display='block';
    editArea.style.display='none';
    saveBtn.style.display='none';
    revertBtn.style.display='none';
    editBtn.classList.remove('active');
    editBtn.textContent='編集モード';
    editBtn2.classList.remove('active');
    editBtn2.textContent='編集モード';
    cancelBtn.textContent='閉じる';
  }
}

function toggleEditMode(){
  modalEditMode=!modalEditMode;
  updateModalMode();
  if(modalEditMode){
    $('#modalName').focus();
  }
}

function closeModal(){
  $('#descModal').classList.remove('open');
  modalItemIdx=null;
  modalEditMode=false;
  modalType=null;
  modalDetailKey=null;
}

function saveModal(){
  if(!currentActor) return;

  if(modalType==='item'){
    if(modalItemIdx==null) return;
    const item=currentActor.items[modalItemIdx];
    if(!item) return;

    const newName=$('#modalName').value.trim();
    const newDesc=$('#modalDesc').value;

    if(newName) item.name=newName;
    const desc=ensurePath(item,'system','description');
    desc.value=newDesc;
  }else if(modalType==='detail'){
    const det=ensurePath(currentActor,'system','details');
    det[modalDetailKey]=$('#modalDesc').value;
  }else if(modalType==='bio'){
    const det=ensurePath(currentActor,'system','details');
    det.appearance=$('#modalName').value;
    const bio=ensurePath(det,'biography');
    bio.value=$('#modalDesc').value;
  }

  markDirty();
  closeModal();
  render(currentActor);
}

function revertModal(){
  if(!currentActor) return;

  if(modalType==='item'){
    const item=currentActor.items[modalItemIdx];
    if(item){
      $('#modalName').value=item.name||'';
      $('#modalDesc').value=item.system?.description?.value||'';
    }
  }else if(modalType==='detail'){
    const det=currentActor.system?.details||{};
    $('#modalDesc').value=det[modalDetailKey]||'';
  }else if(modalType==='bio'){
    const det=currentActor.system?.details||{};
    $('#modalName').value=det.appearance||'';
    $('#modalDesc').value=det.biography?.value||'';
  }
}

// Modal event listeners
$('#modalClose').addEventListener('click',closeModal);
$('#modalCancel').addEventListener('click',()=>{
  if(modalEditMode){
    // Cancel edit - revert to view mode
    revertModal();
    modalEditMode=false;
    updateModalMode();
  }else{
    closeModal();
  }
});
$('#modalSave').addEventListener('click',saveModal);
$('#modalEditToggle').addEventListener('click',toggleEditMode);
$('#modalEditToggle2').addEventListener('click',toggleEditMode);
$('#modalRevert').addEventListener('click',revertModal);
$('#descModal').addEventListener('click',e=>{
  if(e.target.id==='descModal'){
    if(modalEditMode){
      // In edit mode, don't close on overlay click
    }else{
      closeModal();
    }
  }
});
document.addEventListener('keydown',e=>{
  if(!$('#descModal').classList.contains('open')) return;
  if(e.key==='Escape'){
    if(modalEditMode){
      // Revert and go back to view mode
      revertModal();
      modalEditMode=false;
      updateModalMode();
    }else{
      closeModal();
    }
  }
  if(e.key==='Enter'&&e.ctrlKey&&modalEditMode) saveModal();
});

// --- Event Delegation ---
$('#sheet').addEventListener('click',e=>{
  const t=e.target;
  const action=t.dataset?.action||t.closest('[data-action]')?.dataset?.action;
  if(!action||!currentActor) return;
  const sys=currentActor.system;
  const target=t.closest('[data-action]')||t;

  // Handle description edit (編集許可がONの時のみ)
  if(action==='edit-desc' && $('#editModeChk').checked){
    const itemIdx=parseInt(target.dataset.itemIdx);
    if(!isNaN(itemIdx)){
      e.preventDefault();
      e.stopPropagation();
      openModal(itemIdx);
      return;
    }
  }

  // Handle detail edit (trait, ideal, bond, flaw)
  if(action==='edit-detail' && $('#editModeChk').checked){
    const key=target.dataset.detailKey;
    if(key){
      e.preventDefault();
      e.stopPropagation();
      openDetailModal(key);
      return;
    }
  }

  // Handle biography edit
  if(action==='edit-bio' && $('#editModeChk').checked){
    e.preventDefault();
    e.stopPropagation();
    openBioModal();
    return;
  }

  if(action==='toggle-inspiration'){
    const attr=ensurePath(sys,'attributes');
    attr.inspiration=!attr.inspiration;
    markDirty();render(currentActor);
  }

  if(action==='hp-dmg'||action==='hp-heal'){
    const input=document.getElementById('hpDelta');
    const delta=parseInt(input?.value)||0;
    if(delta<=0) return;
    const hp=ensurePath(sys,'attributes','hp');
    const max=hp.max??hp.value??0;
    if(action==='hp-dmg'){
      let dmg=delta;
      const temp=hp.temp||0;
      if(temp>0){
        const absorbed=Math.min(temp,dmg);
        hp.temp=temp-absorbed;
        dmg-=absorbed;
      }
      hp.value=clamp((hp.value??0)-dmg,0,max);
    }else{
      hp.value=clamp((hp.value??0)+delta,0,max);
    }
    markDirty();render(currentActor);
  }

  if(action==='death-success'){
    const idx=parseInt(target.dataset.idx);
    const death=ensurePath(sys,'attributes','death');
    const cur=death.success||0;
    death.success=(idx<cur)?idx:idx+1;
    markDirty();render(currentActor);
  }
  if(action==='death-failure'){
    const idx=parseInt(target.dataset.idx);
    const death=ensurePath(sys,'attributes','death');
    const cur=death.failure||0;
    death.failure=(idx<cur)?idx:idx+1;
    markDirty();render(currentActor);
  }

  if(action==='hd-use'){
    const ci=parseInt(target.dataset.classIdx);
    const clsItems=(currentActor.items||[]).filter(i=>i.type==='class');
    const c=clsItems[ci];if(!c) return;
    const hd=ensurePath(c,'system','hd');
    const lvl=c.system?.levels||0;
    const spent=hd.spent||0;
    if(spent<lvl){hd.spent=spent+1;markDirty();render(currentActor);}
  }
  if(action==='hd-recover'){
    const ci=parseInt(target.dataset.classIdx);
    const clsItems=(currentActor.items||[]).filter(i=>i.type==='class');
    const c=clsItems[ci];if(!c) return;
    const hd=ensurePath(c,'system','hd');
    if((hd.spent||0)>0){hd.spent=(hd.spent||0)-1;markDirty();render(currentActor);}
  }

  if(action==='toggle-slot'){
    const lv=parseInt(target.dataset.slotLv);
    const idx=parseInt(target.dataset.slotIdx);
    const slots=ensurePath(sys,'spells');
    const key='spell'+lv;
    if(!slots[key]) slots[key]={value:0,override:0};
    const s=slots[key];
    const max=s.override??s.value??0;
    const cur=s.value??0;
    if(idx<cur) s.value=idx; else s.value=idx+1;
    s.value=clamp(s.value,0,max);
    markDirty();render(currentActor);
  }

  if(action==='toggle-prepared'){
    const idx=parseInt(target.dataset.itemIdx);
    const item=currentActor.items[idx];if(!item) return;
    const prep=ensurePath(item,'system','preparation');
    prep.prepared=!prep.prepared;
    markDirty();render(currentActor);
  }

  if(action==='toggle-equip'){
    const idx=parseInt(target.dataset.itemIdx);
    const item=currentActor.items[idx];if(!item) return;
    const s=ensurePath(item,'system');
    s.equipped=!s.equipped;
    markDirty();render(currentActor);
  }
});

// +/- button handler
$('#sheet').addEventListener('click',e=>{
  const btn=e.target.closest('[data-nc]');
  if(!btn) return;
  const wrap=btn.closest('.nc');
  const input=wrap?.querySelector('input[type=number]');
  if(!input) return;
  const step=parseInt(btn.dataset.nc)||0;
  const min=input.min!==''?parseInt(input.min):-Infinity;
  const max=input.max!==''?parseInt(input.max):Infinity;
  input.value=clamp((parseInt(input.value)||0)+step,min,max);
  input.dispatchEvent(new Event('change',{bubbles:true}));
});

// Number input changes (HP, temp, quantity, currency, uses)
$('#sheet').addEventListener('change',e=>{
  const t=e.target;
  const action=t.dataset?.action;
  if(!action||!currentActor) return;
  const sys=currentActor.system;
  const val=parseInt(t.value)||0;

  if(action==='set-hp'){
    const hp=ensurePath(sys,'attributes','hp');
    const max=hp.max??hp.value??999;
    hp.value=clamp(val,0,max);
    markDirty();render(currentActor);
  }
  if(action==='set-temp-hp'){
    const hp=ensurePath(sys,'attributes','hp');
    hp.temp=Math.max(0,val);
    markDirty();render(currentActor);
  }
  if(action==='set-quantity'){
    const idx=parseInt(t.dataset.itemIdx);
    const item=currentActor.items[idx];if(!item) return;
    ensurePath(item,'system').quantity=Math.max(0,val);
    markDirty();
  }
  if(action==='set-currency'){
    const coin=t.dataset.coin;
    const cur=ensurePath(sys,'currency');
    cur[coin]=Math.max(0,val);
    markDirty();
  }
  if(action==='set-uses'){
    const idx=parseInt(t.dataset.itemIdx);
    const item=currentActor.items[idx];if(!item) return;
    const uses=ensurePath(item,'system','uses');
    const max=uses.max||0;
    uses.value=clamp(val,0,max);
    markDirty();
  }
});

function markDirty(){
  dirty=true;
  const btn=$('#exportBtn');
  if(btn) btn.textContent='Export JSON *';
  // Auto-save to localStorage if enabled
  if($('#autoSaveChk')?.checked && currentActor){
    localStorage.setItem('fvtt-autosave',JSON.stringify(currentActor));
    localStorage.setItem('fvtt-autosave-name',currentActor.name||'unknown');
  }
}

// --- Export ---
$('#exportBtn').addEventListener('click',()=>{
  if(!currentActor) return;
  const json=JSON.stringify(currentActor,null,2);
  const blob=new Blob([json],{type:'application/json'});
  const url=URL.createObjectURL(blob);
  const a=document.createElement('a');
  a.href=url;
  a.download=(currentActor.name||'character').replace(/[^a-zA-Z0-9_\-\u3000-\u9fff]/g,'_')+'.json';
  a.click();
  URL.revokeObjectURL(url);
  dirty=false;
  $('#exportBtn').textContent='Export JSON';
});

// --- Actor selection ---
function populateSelect(actors){
  const sel=$('#actorSel');
  if(actors.length<=1){sel.style.display='none';return;}
  sel.style.display='inline-block';sel.innerHTML='';
  actors.forEach((a,i)=>{
    const o=document.createElement('option');
    o.value=i;o.textContent=(a.name||'(no name)')+' Lv'+(getLevel(a)||'?');
    sel.appendChild(o);
  });
  sel.onchange=()=>render(actors[+sel.value]);
}

function handleJson(text){
  let data;try{data=JSON.parse(text)}catch(e){alert('JSON解析に失敗');return;}
  currentActors=pickActors(data);
  dirty=false;
  $('#exportBtn').textContent='Export JSON';
  $('#autoSaveChk').checked=false; // 読み込み時は自動保存OFF
  populateSelect(currentActors);
  render(currentActors[0]);
}

function readFile(f){const r=new FileReader();r.onload=e=>handleJson(e.target.result);r.readAsText(f,'utf-8');}

// Drag & drop
const dz=$('#dropzone');
['dragenter','dragover'].forEach(e=>dz.addEventListener(e,ev=>{ev.preventDefault();dz.classList.add('drag')}));
['dragleave','drop'].forEach(e=>dz.addEventListener(e,ev=>{ev.preventDefault();dz.classList.remove('drag')}));
dz.addEventListener('drop',e=>{const f=e.dataTransfer.files?.[0];if(f)readFile(f)});
$('#file').addEventListener('click',function(){this.value=''});
$('#file').addEventListener('change',e=>{const f=e.target.files?.[0];if(f)readFile(f)});

// Edit mode toggle
$('#editModeChk').checked=false; // 常にOFFで開始

// Autosave toggle
const autoSaveChk=$('#autoSaveChk');
autoSaveChk.checked=false; // 常にOFFで開始
autoSaveChk.addEventListener('change',()=>{
  // ONにした時点でキャラが読み込まれていれば即座に保存
  if(autoSaveChk.checked && currentActor){
    localStorage.setItem('fvtt-autosave',JSON.stringify(currentActor));
    localStorage.setItem('fvtt-autosave-name',currentActor.name||'unknown');
    updateRestoreBtn();
  }
});

// Restore button
const restoreBtn=$('#restoreBtn');
function updateRestoreBtn(){
  const saved=localStorage.getItem('fvtt-autosave');
  const name=localStorage.getItem('fvtt-autosave-name')||'';
  if(saved){
    restoreBtn.style.display='inline-block';
    restoreBtn.title='復元: '+name;
  }else{
    restoreBtn.style.display='none';
  }
}
updateRestoreBtn();
restoreBtn.addEventListener('click',()=>{
  const saved=localStorage.getItem('fvtt-autosave');
  if(saved){
    const data=JSON.parse(saved);
    const name=data.name||'(名称なし)';
    if(confirm('「'+name+'」のデータを復元しますか？')){
      handleJson(saved);
    }
  }
});

// Demo
$('#demoBtn').addEventListener('click',()=>{
  handleJson(JSON.stringify({
    name:"Melissa the Heretic",type:"character",
    system:{
      details:{level:5,race:"Human",alignment:"Lawful Good",
        trait:"信仰に篤く、困っている人を見過ごせない。",
        ideal:"癒し：傷ついた者を癒すことが自分の使命。",
        bond:"幼い頃に救ってくれた神官への恩義を忘れない。",
        flaw:"頑固で、一度決めたことを曲げようとしない。",
        biography:{value:"<p>元シーク教徒。ヘイヴンの神殿で、シーク教徒が隠していた「異端の力」に触れ、まことのクレリックとなる。</p><p>それが元でシーカー評議会で異端審問にかけられ、辺境の村ソレースに逃げて来たのだが...</p>"},
        appearance:"Gender: Female\nEyes: Dark Blue\nHair: Brown\nHeight: 5'2''"
      },
      abilities:{str:{value:14,mod:2,proficient:0},dex:{value:16,mod:3,proficient:1},con:{value:14,mod:2,proficient:0},int:{value:10,mod:0,proficient:0},wis:{value:18,mod:4,proficient:1},cha:{value:12,mod:1,proficient:0}},
      skills:{prc:{value:1,ability:'wis'},per:{value:1,ability:'cha'},ste:{value:1,ability:'dex'},med:{value:2,ability:'wis'},ins:{value:1,ability:'wis'},rel:{value:1,ability:'int'}},
      attributes:{ac:{value:17},hp:{value:36,max:36,temp:0},prof:3,movement:{walk:30},senses:{darkvision:0},speed:{value:30},
        death:{success:0,failure:0},inspiration:false,spellcasting:'wis'},
      traits:{languages:{value:["Common","Elvish","Dwarvish"]},weaponProf:{value:["sim"]},armorProf:{value:["lgt","med","shl"]}},
      spells:{spell1:{value:4,override:4},spell2:{value:3,override:3},spell3:{value:2,override:2}},
      currency:{pp:2,gp:45,ep:0,sp:12,cp:30},
      resources:{primary:{value:2,max:3,sr:false,lr:true,label:"Channel Divinity"}}
    },
    items:[
      {type:'class',name:'Cleric',system:{levels:5,hd:{denomination:'d8',spent:1},identifier:'cleric',spellcasting:{progression:'full',ability:'wis'}}},
      {type:'subclass',name:'Life Domain',system:{classIdentifier:'cleric'}},
      {type:'race',name:'Human',system:{}},
      {type:'background',name:'Acolyte',system:{}},
      {type:'weapon',name:'Mace',system:{ability:'str',proficient:true,attackBonus:0,damage:{parts:[["1d6+2","bludgeoning"]]},properties:{},description:{value:'A simple melee weapon. 1d6 bludgeoning damage.'}}},
      {type:'weapon',name:'Light Crossbow',system:{ability:'dex',proficient:true,attackBonus:0,damage:{parts:[["1d8+3","piercing"]]},properties:{amm:true,lod:true},description:{value:'A simple ranged weapon. 1d8 piercing damage. Ammunition (range 80/320), loading, two-handed.'}}},
      {type:'equipment',name:'Chain Shirt',system:{quantity:1,equipped:true,armor:{value:13,type:'medium'},description:{value:"Medium armor, AC 13 + DEX (max 2)."}}},
      {type:'equipment',name:'Shield',system:{quantity:1,equipped:true,armor:{value:2,type:'shield'},description:{value:"+2 AC."}}},
      {type:'feat',name:'Channel Divinity',system:{uses:{value:2,max:3},description:{value:'Turn Undead or Preserve Life.'}}},
      {type:'feat',name:'Disciple of Life',system:{description:{value:'Healing spells restore additional HP equal to 2 + spell level.'}}},
      {type:'feat',name:'Blessed Healer',system:{description:{value:'When you cast a healing spell on another, you also regain HP.'}}},
      {type:'consumable',name:'Holy Water',system:{quantity:3,description:{value:'Splash weapon dealing 2d6 radiant to fiends/undead.'}}},
      {type:'tool',name:'Medallion of Mishakal',system:{quantity:1,description:{value:'A blue crystal medallion, holy symbol of Mishakal, goddess of healing.'}}},
      {type:'tool',name:"Priest's Pack",system:{quantity:1,weight:29,description:{value:'Includes a backpack, blanket, candles, tinderbox, alms box, incense, censer, vestments, rations, and a waterskin.'}}},
      {type:'spell',name:'Guidance',system:{level:0,school:'div',activation:{type:'Action',cost:1},range:{value:'Touch'},duration:{value:'1 min'},description:{value:'Add 1d4 to an ability check.'},preparation:{prepared:true}}},
      {type:'spell',name:'Sacred Flame',system:{level:0,school:'evo',activation:{type:'Action',cost:1},range:{value:'60 ft'},duration:{units:'inst'},description:{value:'DEX save or 2d8 radiant damage.'},preparation:{prepared:true}}},
      {type:'spell',name:'Spare the Dying',system:{level:0,school:'nec',activation:{type:'Action',cost:1},range:{value:'Touch'},duration:{units:'inst'},description:{value:'Stabilize a creature at 0 HP.'},preparation:{prepared:true}}},
      {type:'spell',name:'Bless',system:{level:1,school:'enc',activation:{type:'Action',cost:1},range:{value:'30 ft'},duration:{value:'1 min'},description:{value:'Up to 3 creatures add 1d4 to attacks/saves.'},preparation:{prepared:true,mode:'prepared'},properties:{value:['concentration']}}},
      {type:'spell',name:'Cure Wounds',system:{level:1,school:'evo',activation:{type:'Action',cost:1},range:{value:'Touch'},duration:{units:'inst'},description:{value:'Heal 1d8 + WIS mod HP.'},preparation:{prepared:true,mode:'prepared'}}},
      {type:'spell',name:'Shield of Faith',system:{level:1,school:'abj',activation:{type:'Bonus',cost:1},range:{value:'60 ft'},duration:{value:'10 min'},description:{value:'+2 AC to target.'},preparation:{prepared:true,mode:'prepared'},properties:{value:['concentration']}}},
      {type:'spell',name:'Healing Word',system:{level:1,school:'evo',activation:{type:'Bonus',cost:1},range:{value:'60 ft'},duration:{units:'inst'},description:{value:'Heal 1d4 + WIS mod HP as bonus action.'},preparation:{prepared:true,mode:'prepared'}}},
      {type:'spell',name:'Spiritual Weapon',system:{level:2,school:'evo',activation:{type:'Bonus',cost:1},range:{value:'60 ft'},duration:{value:'1 min'},description:{value:'Create spectral weapon. 1d8 + WIS force damage.'},preparation:{prepared:true,mode:'prepared'}}},
      {type:'spell',name:'Lesser Restoration',system:{level:2,school:'abj',activation:{type:'Action',cost:1},range:{value:'Touch'},duration:{units:'inst'},description:{value:'End one disease or condition.'},preparation:{prepared:true,mode:'prepared'}}},
      {type:'spell',name:'Spirit Guardians',system:{level:3,school:'con',activation:{type:'Action',cost:1},range:{value:'Self (15ft)'},duration:{value:'10 min'},description:{value:'Spirits guard you. Enemies take 3d8 radiant.'},preparation:{prepared:true,mode:'prepared'},properties:{value:['concentration']}}},
      {type:'spell',name:'Revivify',system:{level:3,school:'nec',activation:{type:'Action',cost:1},range:{value:'Touch'},duration:{units:'inst'},description:{value:'Return creature dead within 1 minute to life with 1 HP.'},preparation:{prepared:true,mode:'prepared'}}}
    ]
  }));
});

// Warn on unsaved
window.addEventListener('beforeunload',e=>{
  if(dirty){e.preventDefault();e.returnValue='';}
});


// ブラウザの遷移対策
(() => {
  window.addEventListener('beforeunload', (e) => {
    e.preventDefault();
    e.returnValue = '';
  });

  const pushGuard = () => history.pushState({ __guard: true, t: Date.now() }, '', location.href);
  history.replaceState({ __base: true }, '', location.href);
  pushGuard();
  window.addEventListener('pageshow', (e) => {
    if (e.persisted) pushGuard();
  });
  const armWithUserActivation = () => pushGuard();
  window.addEventListener('pointerdown', armWithUserActivation, { once: true, capture: true });
  window.addEventListener('keydown', armWithUserActivation, { once: true, capture: true });
  window.addEventListener('popstate', () => {
    history.go(1);
    setTimeout(pushGuard, 0);
  });

})();
</script>


<deepl-input-controller translate="no"><template shadowrootmode="open"><link rel="stylesheet" href="chrome-extension://cofdbpoegempjloogbagkncekinflcnj/build/content.css"><div dir="ltr" style="visibility: initial !important;"><div class="dl-input-translation-container svelte-95aucy"><div></div></div></div></template></deepl-input-controller></body><deepl-inline-trigger translate="no" style="z-index: 2147483639;"><template shadowrootmode="open"><link rel="stylesheet" href="chrome-extension://cofdbpoegempjloogbagkncekinflcnj/build/content.css"><div style="position: absolute; top: 0px; left: 0px; width: 100%; z-index: 2147483139; visibility: initial !important;"><div style="position: absolute; z-index: 2147483139; top: 133px; left: 952px;"><div dir="ltr"> <div class="layout-container svelte-552fez"> <div class="icon-container svelte-552fez" data-testid="deepl-inline-translate-icon-container" role="group"><div data-tooltip="オフにする" style="--tooltip-z-index: 2147483639; " class="svelte-1yqkvai"><div data-testid="deepl-advanced-trigger-turnoff-icon" class="dl-turnoff-inline-icon svelte-552fez advanced hidden left"></div></div> <div data-tooltip="DeepLでテキストを推敲" style="--tooltip-z-index: 2147483639; " class="svelte-1yqkvai"><div class="dl-inline-icon dl-write-icon svelte-15hlb3a" data-testid="deepl-advanced-trigger-write-icon" data-qa="deepl-inline-translate-menu-icon"></div></div> <div data-tooltip="DeepLで翻訳 (Ctrl+Shift+Y)" style="--tooltip-z-index: 2147483639; " class="svelte-1yqkvai showProShield"><div class="dl-inline-icon dl-translate-icon svelte-552fez" data-testid="dl-advanced-trigger-translate-icon" data-qa="deepl-inline-translate-menu-icon"></div></div> </div></div></div></div></div></template></deepl-inline-trigger></html>